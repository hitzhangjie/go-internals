<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ä»‹ç» on Goè®¾è®¡å®ç°å†…å¹•</title><link>https://hitzhangjie.pro/go-internals-v2/</link><description>Recent content in ä»‹ç» on Goè®¾è®¡å®ç°å†…å¹•</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://hitzhangjie.pro/go-internals-v2/index.xml" rel="self" type="application/rss+xml"/><item><title>Diagnostics Methods</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/diagnostics-methods/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/diagnostics-methods/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºå¼€å‘äººå‘˜å¸¸ç”¨çš„é—®é¢˜è¯Šæ–­æ–¹æ³•ï¼š
1 profilingï¼šæ‰§è¡Œgo tool pprofå¯¹cpuã€å†…å­˜ã€çº¿ç¨‹åˆ›å»ºã€é”ä½¿ç”¨é—®é¢˜ç­‰è¿›è¡Œåˆ†æã€é—®é¢˜å®šä½ã€ä¼˜åŒ–ï¼› 2 tracingï¼šç»‡å…¥ä»£ç å¯¹è¿è¡Œè¿‡ç¨‹ä¸­å„é˜¶æ®µè€—æ—¶è¿›è¡Œç»Ÿè®¡ç­‰ç­‰ï¼Œå¦‚golang.org/x/net/traceè¿™ä¸ªåŒ…ï¼Œæ²¡æ€ä¹ˆä½¿ç”¨è¿‡ï¼› 3 debuggingï¼šè°ƒè¯•å™¨è°ƒè¯•ï¼Œæœ‰è°ƒè¯•éœ€æ±‚çš„æ—¶å€™ï¼Œé€šè¿‡-gcflags=&amp;ldquo;all=-N -l&amp;quot;ç¦ç”¨ä¼˜åŒ–ã€å†…è”æ±‡ç¼–ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶å¯¹è°ƒè¯•æ›´å‹å¥½ï¼› 4 runtime statistics and eventsï¼šè¿è¡Œæ—¶ä¿¡æ¯æ”¶é›†ï¼Œå¦‚å†…å­˜ã€gcã€stackã€heapã€goroutinesæ•°é‡ç­‰ä¿¡æ¯ï¼› 5 execution tracerï¼šå¯¹ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­è¿è¡Œæ—¶è¡Œä¸ºã€äº‹ä»¶è¿›è¡Œåˆ†æã€é—®é¢˜å®šä½ã€ä¼˜åŒ–ï¼Œå¦‚gcã€goroutineè°ƒåº¦latencyã€ç³»ç»Ÿè°ƒç”¨ç­‰ç­‰ï¼› 6 GODEBUGï¼šè¯¥ç¯å¢ƒå˜é‡ç”¨æ¥æ§åˆ¶ä¸€äº›è¡Œä¸ºï¼Œå¦‚ï¼š
GODEBUG=gctrace=1ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æ‰“å°gcçš„ä¿¡æ¯ï¼Œå›æ”¶å†…å­˜æ•°ï¼Œä»¥åŠåœé¡¿æ—¶é—´ï¼› GODEBUG=inittrace=1ï¼Œæ‰“å°åŒ…åˆå§‹åŒ–èŠ±è´¹çš„æ—¶é—´ï¼› GODEBUG=schedtrace=Xï¼Œæ¯éš”Xæ¯«ç§’æ‰“å°è°ƒåº¦ç›¸å…³ä¿¡æ¯ï¼› GODEBUGè¿˜å¯ä»¥ç”¨æ¥ç¦ç”¨å…¨éƒ¨æˆ–è€…æŸäº›æŒ‡ä»¤çº§æ‰©å±•ï¼Œè¿™ä¸ªä¸æ€ä¹ˆå¸¸ç”¨ï¼Œå…ˆå¿½ç•¥ã€‚ è¿™é‡Œçš„execution traceræ•°æ®çš„ç”Ÿæˆï¼Œå¯ä»¥å€ŸåŠ©ï¼š
ä»£ç é‡Œé¢import runtime/traceè¿™ä¸ªpackageï¼Œç„¶åmainå‡½æ•°é‡Œtrace.Start(os.Stderr), defer trace.Stop()ï¼Œè¿è¡Œèµ·æ¥go run main.go &amp;amp;&amp;gt; trace.outï¼› é€šè¿‡go test -trace trace.outï¼› ç„¶åé€šè¿‡go tool trace trace.outæŸ¥çœ‹ï¼› å…³äºGODEBUG=schedtrace=Xçš„è¾“å‡ºæ ¼å¼çš„ç†è§£ï¼Œsee https://www.ardanlabs.com/blog/2015/02/scheduler-tracing-in-go.htmlã€‚ä¸¾ä¸ªä¾‹å­ runqueue 0 [4 4]æ˜¯è¯´å…¨å±€queueé‡Œé¢æœ‰0ä¸ªgï¼Œç°åœ¨æœ‰ä¸¤ä¸ªpï¼Œæ¯ä¸ªpä¸Šçš„queueå‡æœ‰4ä¸ªgå¾…è¿è¡Œã€‚
Source Analysis # References # https://golang.org/doc/diagnostics</description></item><item><title>what is a goproxy</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Infrastructure/what-is-a-goproxy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Infrastructure/what-is-a-goproxy/</guid><description>Let&amp;rsquo;s summarize # ä»‹ç»äº†goproxyçš„ç”¨é€”ï¼Œä¿è¯â€œæ„å»ºçš„ç¡®å®šæ€§â€å’Œâ€œæ„å»ºæ—¶ä¾èµ–çš„å¯ç”¨æ€§â€ã€‚
public goproxyå’Œprivate goproxyé€šè¿‡ç¯å¢ƒå˜é‡GOPROXYå’ŒGOPRIVATEè¿›è¡ŒåŒºåˆ†ï¼Œé€šå¸¸æˆ‘ä»¬è®¿é—®å…¬å…±çš„ä»£ç åº“è¦é€šè¿‡GOPROXYä¸­çš„é…ç½®å»è·å–ï¼Œè€Œè®¿é—®å…¬å¸å†…ç§æœ‰ä»“åº“åˆ™è®¿é—®GOPRIVATEä¸­é…ç½®çš„å»è®¿é—®ã€‚
å…¶å®å°±æ˜¯è¦è·å–çš„module importPathå»å’ŒGOPRIVATEåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™èµ°importPathä¸­çš„åŸŸåå»æ‹‰å–ï¼Œåä¹‹åˆ™å…¨éƒ¨èµ°GOPROXYå»æ‹‰å–ã€‚
ä¹Ÿæœ‰ä¸­åŠæ³•é€šè¿‡é…ç½®ä¸€ä¸ªé›†ä¸­å¼çš„GOPROXYæ¥ä»£æ›¿publicã€privateæ¨¡å—è¯·æ±‚ï¼Œå®ƒå†…éƒ¨å†å»åŒºåˆ†å¯¹å¾…ï¼Œæ¯”å¦‚JFrog Artifactoryï¼Œè…¾è®¯å†…éƒ¨ä¹Ÿæ˜¯è‡ªå·±æ­äº†ä¸€ä¸ªé›†ä¸­çš„proxyæ¥ä»£ç†publicã€private modulesæ‰€æœ‰è¯·æ±‚ã€‚
Source Analysis # Reference # https://jfrog.com/blog/why-goproxy-matters-and-which-to-pick/'</description></item><item><title>what is a goproxy</title><link>https://hitzhangjie.pro/go-internals-v2/posts/what-is-a-goproxy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/what-is-a-goproxy/</guid><description>Let&amp;rsquo;s summarize # ä»‹ç»äº†goproxyçš„ç”¨é€”ï¼Œä¿è¯â€œæ„å»ºçš„ç¡®å®šæ€§â€å’Œâ€œæ„å»ºæ—¶ä¾èµ–çš„å¯ç”¨æ€§â€ã€‚
public goproxyå’Œprivate goproxyé€šè¿‡ç¯å¢ƒå˜é‡GOPROXYå’ŒGOPRIVATEè¿›è¡ŒåŒºåˆ†ï¼Œé€šå¸¸æˆ‘ä»¬è®¿é—®å…¬å…±çš„ä»£ç åº“è¦é€šè¿‡GOPROXYä¸­çš„é…ç½®å»è·å–ï¼Œè€Œè®¿é—®å…¬å¸å†…ç§æœ‰ä»“åº“åˆ™è®¿é—®GOPRIVATEä¸­é…ç½®çš„å»è®¿é—®ã€‚
å…¶å®å°±æ˜¯è¦è·å–çš„module importPathå»å’ŒGOPRIVATEåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™èµ°importPathä¸­çš„åŸŸåå»æ‹‰å–ï¼Œåä¹‹åˆ™å…¨éƒ¨èµ°GOPROXYå»æ‹‰å–ã€‚
ä¹Ÿæœ‰ä¸­åŠæ³•é€šè¿‡é…ç½®ä¸€ä¸ªé›†ä¸­å¼çš„GOPROXYæ¥ä»£æ›¿publicã€privateæ¨¡å—è¯·æ±‚ï¼Œå®ƒå†…éƒ¨å†å»åŒºåˆ†å¯¹å¾…ï¼Œæ¯”å¦‚JFrog Artifactoryï¼Œè…¾è®¯å†…éƒ¨ä¹Ÿæ˜¯è‡ªå·±æ­äº†ä¸€ä¸ªé›†ä¸­çš„proxyæ¥ä»£ç†publicã€private modulesæ‰€æœ‰è¯·æ±‚ã€‚
Source Analysis # Reference # https://jfrog.com/blog/why-goproxy-matters-and-which-to-pick/'</description></item><item><title>å‰è¨€</title><link>https://hitzhangjie.pro/go-internals-v2/docs/preface/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/preface/</guid><description>å‰è¨€ # æˆ‘ä»¬å‡†å¤‡åšä»€ä¹ˆ å¦‚ä»Šï¼Œgoè¯­è¨€è¢«å¹¿æ³›åœ°åº”ç”¨ï¼Œç›¸å…³çš„åˆ†äº«ã€ä¹¦ç±ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œä»åŸºç¡€åˆ°å®ç°ç»†èŠ‚ï¼Œã€Šgo programming languageã€‹ã€ã€Šgoè¯­è¨€101ã€‹ã€ã€Šgoè¯­è¨€è®¾è®¡å®ç°ã€‹ç­‰ã€‚å¯¹äºé«˜è´¨é‡çš„çŸ¥è¯†åˆ†äº«ï¼Œâ€œfeed me moreâ€å¯èƒ½æ˜¯å¾ˆå¤šæŠ€æœ¯äººçš„åŒæ„Ÿã€‚å½“æœ‰äº†ä¸€å®šçš„æ²‰æ·€åï¼Œæ˜¯å¯ä»¥é è‡ªå·±é’»ç ”æ¥è§£æƒ‘æˆ–ç­”ç–‘çš„ï¼Œä½†èƒ½ä¸èƒ½ç³»ç»Ÿæ€§åœ°æ²‰æ·€ã€ç”±ç‚¹åŠé¢æ¥å¸®åŠ©æ›´å¤šçš„å¼€å‘è€…å‘¢ï¼Ÿæ¯”å¦‚goroutineå¦‚ä½•åº”ç”¨ã€ä¸ºä»€ä¹ˆåç¨‹å¥½ç”¨å‘¢ã€åç¨‹æœ‰å“ªäº›å®ç°æ€è·¯ã€goä¸ºä½•é‡‡ç”¨ç°åœ¨çš„æ–¹æ¡ˆï¼Ÿèä¼šè´¯é€šã€ç»™å¤§è„‘åšå‡æ³•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„åˆè¡·ã€‚ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš é’»ç ”è®¡ç®—æœºæŠ€æœ¯ï¼Œéœ€è¦å¤§é‡çš„æ²‰æ·€ç§¯ç´¯ï¼Œå­¦ä¹ å·¥ä½œä¸­æ·±åˆ»ç†è§£äº†ä¸€ç‚¹â€œäº†è§£çš„è¶Šå¤šï¼Œè®¤è¯†åˆ°ä¸æ‡‚çš„ä¹Ÿè¶Šå¤šâ€ã€‚å½“å°è¯•äº†è§£ä¸€ä¸ªä¸ç†Ÿæ‚‰çš„é¢†åŸŸæ—¶ï¼Œæ— å¼‚äºâ€œè·¨ç•Œâ€ï¼Œå³ä¾¿æ˜¯go test -raceè¿™ç§å¸¸è§æ“ä½œï¼Œå¦‚æœä¸äº†è§£å¹¶å‘å†²çªæ£€æµ‹çš„å®ç°ç»†èŠ‚ï¼Œå…¶å®ä¹Ÿä¸èƒ½ç®—æ˜¯çœŸçš„äº†è§£çš„ï¼Œè¦ç†è§£è¿™äº›ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ç‚¹åˆ†å¸ƒå¼åŸç†çš„çŸ¥è¯†ï¼ˆå¦‚å‘é‡æ—¶é’ŸåŠåº”ç”¨ï¼‰ï¼Œè¿˜æœ‰å¹¶å‘å†²çªæ£€æµ‹çš„æ¡†æ¶ï¼ˆå¦‚Thread Sanitizerï¼‰ã€‚å½“æˆ‘ä»¬èƒ½ç®€æ˜æ‰¼è¦åœ°è§£ç­”ä¸€ä¸ªå¤æ‚é—®é¢˜æ—¶ï¼Œå°±ç®—æ˜¯çœŸç†è§£äº†ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å¸®åŠ©æ›´å¤šäººã€‚ å‡†å¤‡æ€ä¹ˆè½åœ° â€œä¸€åªç©¿äº‘ç®­ï¼Œåƒå†›ä¸‡é©¬æ¥ç›¸è§â€ï¼Œå¼€æºè®©æˆ‘æ„Ÿå—åˆ°äº†åä½œåˆ†äº«çš„åŠ›é‡ã€‚æˆ‘è®¤åŒå‡­è‡ªèº«åŠªåŠ›æ·±å…¥é’»ç ”çš„è¿‡ç¨‹ï¼Œä½†ä¸ªä½“æ—¶é—´ç»ˆç©¶æœ‰é™ï¼Œå€ŸåŠ©é«˜è´¨é‡çš„ååŒèƒ½è®©æˆ‘ä»¬èµ°çš„æ›´å¿«æ›´è¿œã€‚æ‰€ä»¥ä¸å‡†å¤‡ä»é›¶åˆ°ä¸€æ¥å†™æœ¬ç”µå­ä¹¦ï¼Œæ—¥å¸¸å­¦ä¹ å·¥ä½œä¸­ä¹Ÿæ”¶é›†äº†ä¸€äº›è´¨é‡å¾ˆé«˜çš„æ–‡ç« ï¼ˆå½“ç„¶ä¹Ÿæœ‰è‡ªå·±å†™çš„ï¼‰ï¼Œè¿™äº›æœ‰ä»·å€¼çš„ä¿¡æ¯å°±è¿™ä¹ˆæ•£è½åœ¨å„ä¸ªè§’è½ï¼Œéå¸¸æœ‰å¿…è¦å°†å…¶â€œä¸²â€èµ·æ¥ã€‚å¦å¤–å‡ºç‰ˆä¹¦ç±æ›´æ–°æ…¢ã€çŸ¥è¯†è¦†ç›–å—é™ï¼Œå¾ˆå¤šä¹¦æ¨æ•²èµ·æ¥å†…å®¹ä¼šç•¥æ˜¾å•è–„ï¼Œåä½œã€æœ‰ç»éªŒç”šè‡³â€œè·¨ç•Œâ€çš„åä½œè€…èƒ½å‚ä¸è¿›æ¥ï¼Œæœ‰åŠ©äºçŸ¥è¯†ç”±ç‚¹åŠé¢ã€‚ å’ŒGoè¯­è¨€çš„ç›¸è¯† # goè¯­è¨€å¹¶ä¸æ˜¯æˆ‘æ¥è§¦çš„ç¬¬ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œå½“æˆ‘ç¬¬ä¸€æ¬¡äº†è§£è¿™é—¨è¯­è¨€è¿˜æ˜¯åœ¨2016å¹´ï¼Œå’Œcè¯­è¨€æ¯”è¾ƒèµ·æ¥å…¶â€œæ€ªå¼‚â€çš„è¯­æ³•è®©æˆ‘å¾ˆä¸ä¹ æƒ¯ï¼Œå·¥ä½œä¹‹åï¼Œä½¿ç”¨çš„æœåŠ¡æ¡†æ¶å¯¹åç¨‹æ”¯æŒçš„å±€é™æ€§è®©æˆ‘é‡æ–°å¼€å§‹æ¥è§¦goè¯­è¨€ï¼Œé‚£ä¸ªæ—¶å€™æˆ‘è¿˜æ˜¯å€¾å‘äºc/c++/javaå¼€å‘çš„ï¼Œå¯¹goç”šè‡³æœ‰ç§æŠµè§¦ã€‚æˆ‘å®å¯å»é’»ç ”libmillã€libdillã€boost coroutineã€kilimã€qusarç­‰ï¼Œä¹Ÿä¸æƒ³å»ç¢ç£¨goï¼ŸåŸå› ä»…ä»…æ˜¯è§‰å¾—å®ƒçš„è¯­æ³•æœ‰ç‚¹æ€ªå¼‚ ğŸ˜‚
è¿™ä¸ªè¿‡ç¨‹æŒç»­äº†ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ°è¸©çš„å‘è¶Šæ¥è¶Šå¤šï¼Œç›´åˆ°å†ä¹Ÿä¸æƒ³å¬â€œå£è€³ç›¸ä¼ â€çš„ç»éªŒï¼š
æœåŠ¡æ¡†æ¶sppæœ‰3å¤§ä»¶ï¼Œproxyæ”¶åŒ…ã€workerå¤„ç†ã€ctrlå¥åº·æ£€æŸ¥ï¼Œæˆ‘åœ¨workeré‡ŒåŠ äº†ç‚¹å¯èƒ½å¯¼è‡´é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆéç½‘ç»œioï¼‰ï¼Œå˜¿ï¼Œå› ä¸ºworkeré˜»å¡å¤±å»å¿ƒè·³è¢«ctrlæ€æ‰äº†ã€‚ æœåŠ¡æ¡†æ¶sppåç¨‹æ ˆå›ºå®šå¤§å°128kï¼Œæœ‰ä¸ªå°ä¼™ä¼´åœ¨åç¨‹å¤„ç†é€»è¾‘å†…åˆ›å»ºäº†ä¸ªæ¯”è¾ƒå¤§çš„å±€éƒ¨å˜é‡ï¼Œå¯¼è‡´è¶…å‡ºåç¨‹æ ˆä¸Šé™ï¼Œå˜¿ï¼Œæ®µé”™è¯¯å´©æºƒäº†ã€‚ æœåŠ¡æ¡†æ¶jungleé…åˆkilimå­—èŠ‚ç ç»‡å…¥å®ç°åç¨‹ï¼Œå¶å°”å¿˜è®°åŠ @Pausableå¯¼è‡´å‡ºé—®é¢˜ï¼Œå‡ºäº†é—®é¢˜æ’æŸ¥èµ·æ¥è¿˜è´¹åŠ²ï¼Œå˜¿ï¼Œæ¯æ¬¡è¢«é«˜å·¥æŒ‡å¯¼ã€‚ æœåŠ¡æ¡†æ¶jungleä½¿ç”¨çš„kilimå­—èŠ‚ç ç»‡å…¥ï¼Œåªæ”¯æŒjdk 1.7å­—èŠ‚ç ï¼Œå˜¿ï¼Œjdkæ²¡æ³•å‡çº§äº†ã€‚ è¿™äº›æ¡†æ¶ä¸­çš„å¾®çº¿ç¨‹å®ç°ã€å­—èŠ‚ç ç»‡å…¥æ–¹æ¡ˆï¼ŒåŸºæœ¬ä¸Šåªæ˜¯å¤„ç†äº†ç½‘ç»œioï¼ˆconnectã€sendã€receiveã€readã€writeï¼‰ä¹‹ç±»çš„æ“ä½œï¼Œä½†æ˜¯å¯èƒ½å¯¼è‡´é˜»å¡çš„æ“ä½œè¿œè¿œä¸æ­¢ç½‘ç»œioå•Šï¼Œæ¯”å¦‚é”lockã€unlockâ€¦å˜¿ï¼Œéš¾é“ç”¨åˆ°å•¥éƒ½è¦hookä¸‹ï¼Ÿ â€¦â€¦ åœ¨æˆ‘çœ‹äº†sppæ¡†æ¶ã€jungleæ¡†æ¶ä»¥åŠå­—èŠ‚ç ç»‡å…¥æ–¹æ¡ˆç­‰çš„å±€é™æ€§ä¹‹åï¼Œæˆ‘ä¸æƒ³å†æŠ˜è…¾è¿™äº›äº†ï¼Œæˆ‘å¼€å§‹èŠ±æ›´å¤šæ—¶é—´å»äº†è§£goï¼Œè¿™å°±æ˜¯æˆ‘å’Œgoè¯­è¨€ç¾å¥½å…³ç³»çš„å¼€å§‹ã€‚å·¥ä½œä¸­é‡åˆ°çš„å¼€å‘æ•ˆç‡çš„é—®é¢˜ã€ä¾èµ–ç®¡ç†çš„é—®é¢˜ã€ç¼–è¯‘æ„å»ºçš„é—®é¢˜ã€ä»£ç é£æ ¼çš„é—®é¢˜ç­‰ï¼Œæœ€ç»ˆå¯¼è‡´æˆ‘ä»¬å›¢é˜Ÿä¸‹å®šå†³å¿ƒè½¬goè¯­è¨€ã€‚
æˆ‘çœ¼ä¸­çš„Goè¯­è¨€ # åœ¨è¯„ä»·goè¯­è¨€ä¹‹å‰ï¼Œæƒ³å…ˆæä¸‹å¯¹cè¯­è¨€çš„è¯„ä»·ï¼Œæ›¾ç»æœ‰äººè¿™æ ·è¯„ä»·cè¯­è¨€ï¼šâ€œä»»ä½•æ¯”cè¯­è¨€æ›´ä½çº§çš„è¯­è¨€ï¼Œéƒ½ä¸è¶³ä»¥æŠ½è±¡ä¸€ä¸ªå®Œæ•´çš„è®¡ç®—æœºç³»ç»Ÿï¼›ä»»ä½•æ¯”cè¯­è¨€æ›´é«˜çº§çš„è¯­è¨€ï¼Œéƒ½å¯ä»¥ç”¨cè¯­è¨€æ¥å®ç°â€ã€‚ç»“åˆæˆ‘å­¦ä¹ è¿‡çš„ç¼–ç¨‹è¯­è¨€æ¥çœ‹ï¼Œæ±‡ç¼–ã€cã€c++ã€javaã€swiftã€goã€rustã€pythonã€phpã€javascriptï¼Œä»”ç»†ç¢ç£¨ä¸‹æˆ‘è®¤ä¸ºè¿™æ ·çš„è¯„ä»·å®è‡³åå½’ã€‚
å­¦ä¹ è½¯ä»¶å·¥ç¨‹æ—¶ï¼Œæˆ‘ä»¬ç³»ç»Ÿæ€§å­¦ä¹ äº†è¿‡ç¨‹å¼ã€é¢å‘å¯¹è±¡çš„æ–¹æ³•ï¼Œç»“åˆä¸åŒç¼–ç¨‹è¯­è¨€å¯¹ä¸Šè™æ€æƒ³çš„æ”¯æŒï¼Œå¼€å§‹æ—¶ç»éªŒè‚¤æµ…çš„æˆ‘åƒå¾ˆå¤šå¼€å‘è€…ä¸€æ ·ï¼Œå¤©çœŸçš„è®¤ä¸ºç¼ºå°‘æŸäº›ooæ”¯æŒçš„è¯­è¨€æ˜¯éš¾ä»¥æ¶æ„å¤§å‹è½¯ä»¶çš„ï¼Œç›´åˆ°æˆ‘è¯»äº†linuxå†…æ ¸ä»£ç ï¼Œæˆ‘æ‰è®¤è¯†åˆ°è‡ªå·±çš„è®¤çŸ¥å¤šä¹ˆè‚¤æµ…ã€‚åŸæ¥ï¼Œåœ¨å¤§ä½¬çš„ä¸–ç•Œé‡Œï¼Œç¼–ç¨‹æ€æƒ³ä¸€ç›´å­˜åœ¨ï¼Œè¯­è¨€åªæ˜¯å®ç°æ€æƒ³çš„å·¥å…·è€Œå·²ï¼ˆlinuxå†…æ ¸ä¸­æœ‰éå¸¸å¤šooæ€æƒ³çš„å®è·µï¼Œä¹Ÿæœ‰å¾ˆå¤šå¯¹c++ smartpointerçš„æ¨¡æ‹Ÿï¼Œç­‰ç­‰ï¼‰ã€‚
æ—¶è‡³ä»Šæ—¥ï¼Œå†çœ‹goè¯­è¨€æˆ‘å·²ç»å®¢è§‚åœ°å¤šï¼Œå®ƒç¡®å®æ˜¯ä¸€é—¨å·¥ç¨‹åŒ–ä¸é”™çš„è¯­è¨€ï¼š
å’Œc\c++æ¯”ï¼Œå®ƒæœ‰è¾ƒå¥½çš„ä¾èµ–ç®¡ç†ï¼ŒåŸºæœ¬å¼€ç®±å³ç”¨çš„æ ‡å‡†åº“ï¼Œç»å¾—èµ·æ¨æ•²çš„ä»£ç é£æ ¼è§„èŒƒï¼Œè¾ƒå®Œæ•´çš„ç¼–è¯‘æ„å»ºã€æµ‹è¯•ã€ä»£ç åˆ†æã€æ€§èƒ½åˆ†æå·¥å…·ï¼Œè¿˜æœ‰æ›´ç®€ä¾¿æ˜“ç”¨çš„å¹¶å‘æ§åˆ¶ï¼ˆchanã€sync.*ã€goroutineï¼‰ï¼Œå…¶ç¬¦åˆå¤§å®¶è®¤çŸ¥çš„happens-beforeå…³ç³»å»ºç«‹ï¼Œå³ä¾¿æœ‰å¯èƒ½è®¤è¯†ä¸å¤Ÿåˆ°ä½ã€ä»£ç å‡ºé”™çš„æ¦‚ç‡ä¹Ÿå¤§å¤§ä¸‹é™ã€‚
å’Œjavaæ¯”ï¼Œå®ƒä¸å¼ºåˆ¶é¢å‘å¯¹è±¡çš„æ‹›å¼ï¼Œå´ä¹Ÿæœ‰é¢å‘å¯¹è±¡æ€æƒ³çš„æ”¯æŒï¼Œç»„åˆä¼˜äºç»§æ‰¿ï¼Œinterfaceçš„ç±»å‹æ–­è¨€ã€è½¬æ¢ï¼Œä»¥åŠåç»­èŒƒå‹æ”¯æŒï¼ˆå°½ç®¡ç°åœ¨go1.18ç‰ˆæœ¬è¿˜æœ‰å¾…å®Œå–„ï¼‰ã€‚å¦å¤–ï¼ŒåŒä¸ºè‡ªåŠ¨å†…å­˜ç®¡ç†çš„è¯­è¨€ï¼Œå’Œjava jvmè°ƒä¼˜çš„æ•°ä¸å°½çš„å‚æ•°æ¯”èµ·æ¥ï¼Œgoçš„GC pacerä»…ä¾é ä¸€ä¸ªå˜é‡è®¾ç½®GOGCï¼Œå¦‚ä½•åœ¨ä¸€å †å‚æ•°ä¸­è·å¾—ä¸€ä¸ªå…¨å±€æœ€ä¼˜è§£çš„ç»„åˆï¼Œjavaå¯èƒ½æ¯”goè°ƒä¼˜æ—¶æ§åˆ¶ç²’åº¦æ›´ç»†ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾goå¯ä»¥åœ¨å†…å­˜ä¸æ˜¯ä»€ä¹ˆç¡¬ä¼¤çš„æƒ…å†µä¸‹è°ƒä¼˜æ›´ç®€å•ã€‚
å’Œrustæ¯”ï¼Œrustçš„æè¿°æ€§éå¸¸å¼ºï¼Œç¼–è¯‘å™¨èƒ½åŠ›ä¹Ÿéå¸¸å¼ºï¼Œå¦‚æœèƒ½å¿å—ç¼–è¯‘å™¨çš„æ¯’æ‰“ï¼Œå¹¶æ·±åˆ»ç†è§£rustçš„è®¾è®¡æ€æƒ³ä¹‹åï¼Œrustç¡®å®ä¹Ÿæ˜¯ä¸é”™çš„ï¼Œç¼–è¯‘å™¨è¯´å¯¹é‚£å°†æ¥è·‘èµ·æ¥ä¹Ÿä¼šå¯¹ã€‚å’ŒæœåŠ¡è·‘èµ·æ¥åå†æ’æŸ¥ä¸€äº›éš¾è·Ÿè¸ªçš„é”™è¯¯ï¼Œrustçš„ä¼˜åŠ¿å°±ä¼šè®©äººè§‰å¾—å¾ˆå€¼ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸æ˜¯ä»€ä¹ˆå¼€å‘å°ç™½ã€æˆ‘ä»¬å¯èƒ½è¦ç»´æŠ¤çš„å¯¹è±¡ä¹Ÿæ²¡é‚£ä¹ˆå¤æ‚ï¼Œä¸å¦å®šrustçš„ä»·å€¼ï¼Œä½†æ˜¯rustå’Œgoç›¸æ¯”ï¼Œç›®å‰goçš„èƒ½åŠ›æ˜¯æˆ‘ä»¬å›¢é˜Ÿæ›´å¸Œæœ›æ‹¥æœ‰çš„ã€‚
psï¼šè…¾è®¯å†…éƒ¨trpcå¾®æœåŠ¡æ¡†æ¶å®ä¾‹æ•°ï¼Œgoç‰ˆæœ¬çš„æœ‰2w+ï¼Œrustç‰ˆæœ¬çš„åªæœ‰ä¸ªä½æ•°ã€‚
åœ¨åˆé€‚çš„åœºæ™¯ä¸‹goéå¸¸æœ‰ä»·å€¼ï¼Œå¦‚æœéè¦å°†å…¶ç”¨åˆ°ä¸€äº›å®ƒä¸æ“…é•¿çš„åœ°æ–¹ï¼Œå°±éœ€è¦æ³¨æ„äº†ï¼š
åµŒå…¥å¼å¼€å‘é¢†åŸŸï¼Œgoæœ‰GCæœºåˆ¶ï¼Œå¯èƒ½è¦åšç±»ä¼¼tinygoçš„ç¼–è¯‘å™¨è°ƒæ•´ã€ç‰¹æ€§è£å‰ªï¼› è¶…å¤§è§„æ¨¡é•¿è¿æ¥ç®¡ç†ï¼Œgoçš„é»˜è®¤å®ç°æ˜¯goroutine per connectionæ¨¡å‹ï¼Œè¿æ¥æ•°å¤šäº†goroutineæ•°ä¹Ÿä¸Šæ¥äº†ï¼Œgoroutine stackã€ä¸ºè¿æ¥åˆ†é…çš„resizable bufferã€è¿æ¥ä¸Šäº‹ä»¶çš„pollingéƒ½ä¼šæˆä¸ºä¸å¯å¿½ç•¥çš„é—®é¢˜ã€‚ä¸šç•Œæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ˜¯ä¸¤çº§reactorçš„å®ç°æ€è·¯ï¼Œç±»ä¼¼åœ°goç‰ˆæœ¬å®ç°gnetï¼› å¯†é›†è®¡ç®—çš„é—®é¢˜ï¼Œgoæ¯”è¾ƒå¤§çš„ä¼˜åŠ¿åœ¨äºgoroutineå¹¶å‘å¤„ç†ï¼Œä½†æ˜¯goroutineåˆ‡æ¢æœ‰å›ºå®šçš„åˆ‡æ¢æ—¶æœºï¼ˆç½‘ç»œIOç­‰ç­‰ï¼‰ï¼Œå¯†é›†è®¡ç®—åœºæ™¯ä¸‹goroutineåˆ‡æ¢ä¸ç¬¦åˆâ€œé¢„æœŸâ€ï¼Œå¹¶å‘å¤„ç†æ•ˆç‡è·Ÿä¸ä¸Šï¼Œå¯èƒ½éœ€è¦è€ƒè™‘å¤šè¿›ç¨‹+tasksetç»‘æ ¸å¤„ç†ï¼› å…¶ä»–é—®é¢˜ï¼› åœ¨ä¸åˆé€‚çš„åœºæ™¯ä¸‹å°±éœ€è¦å¤šè€ƒè™‘ã€å¤šé’»ç ”é€ä¸€äº›ï¼Œéœ€è¦ç»¼åˆæŠ•å…¥äº§å‡ºæ¯”æ…é‡è€ƒè™‘ï¼Œè¿™ç§æƒ…å†µä¸‹å…¶ä»–è¯­è¨€æ˜¯å¦æ›´æœ‰ä¼˜åŠ¿å°±å¾ˆå€¼å¾—è€ƒè™‘äº†ã€‚</description></item><item><title>ç®€ä»‹</title><link>https://hitzhangjie.pro/go-internals-v2/docs/introduction/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/introduction/</guid><description>ç®€ä»‹ # Goè¯­è¨€ç®€ä»‹ # goè¯­è¨€æ˜¯ç”±Googleè®¾è®¡å¼€å‘çš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œè¯´goè¯­è¨€å¸ˆå‡ºåé—¨ä¸€ç‚¹ä¸è¿‡åˆ†ï¼Œå®ƒçš„ä¸‰ä½è®¾è®¡è€… Robert Griesemer, Rob Pikeï¼Œä»¥åŠ Ken Thompsonï¼Œéƒ½æ˜¯è®¡ç®—æœºç§‘å­¦æŠ€æœ¯æ–¹é¢é¢‡æœ‰é€ è¯£çš„ä¸“å®¶ã€‚
Robert Griesemerï¼Œ1964å¹´ç”Ÿï¼Œå…¶ä¸»è¦è´¡çŒ®åŒ…æ‹¬ï¼šChrome V8 Javascriptå¼•æ“ã€Sawzallè¯­è¨€ã€Java Hotspotè™šæ‹Ÿæœºã€Strongtalkï¼ˆåœ¨smalltalkä¸Šå¢åŠ äº†ä¸€äº›å¼ºç±»å‹æ£€æŸ¥æ”¯æŒï¼‰ï¼› Rob Pikeï¼Œ1956å¹´ç”Ÿï¼Œå…¶ä¸»è¦è´¡çŒ®åŒ…æ‹¬ï¼šåˆ†å¸ƒå¼æ“ä½œç³»ç»ŸPlan9ã€åˆ†å¸ƒå¼æ“ä½œç³»ç»ŸInfernoã€ç¼–ç¨‹è¯­è¨€Limboï¼› Ken Thompsonï¼Œ1943å¹´ç”Ÿï¼ŒUnixæ“ä½œç³»ç»Ÿã€Bè¯­è¨€ã€å’ŒDennis Ritchieå…±åŒå‘æ˜çš„Cè¯­è¨€ã€åˆ†å¸ƒå¼æ“ä½œç³»ç»ŸPlan9ï¼› goè®¾è®¡æ—¶å¸æ”¶äº†å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ç»éªŒã€æ•™è®­ï¼Œæœ€ç»ˆå‘ˆç°å‡ºæ¥çš„æ˜¯å°½å¯èƒ½å®ç”¨é«˜æ•ˆçš„ç‰¹æ€§ï¼š
æ”¯æŒé™æ€ç±»å‹çš„ç¼–è¯‘å‹è¯­è¨€ see go programming languageï¼›
ç±»ä¼¼cè¯­è¨€çš„ç®€å•çš„è¯­æ³•ï¼ˆ compact and simpleï¼‰see go specï¼›
æ›´å¥½çš„å†…å­˜å®‰å…¨æ€§ï¼›
æ”¯æŒåŠ¨æ€å†…å­˜ç®¡ç†ï¼Œæ›´ç®€å•çš„GCè°ƒä¼˜æ§åˆ¶ï¼›
æ”¯æŒç»“æ„åŒ–ç±»å‹ see types checkingï¼›
æ”¯æŒé€šä¿¡ä¸²è¡Œå¤„ç†é£æ ¼çš„å¹¶å‘ç¼–ç¨‹æ¨¡å¼ã€‚
goè¯­è¨€æ·±å—å¹¿å¤§å¼€å‘è€…å–œçˆ±ï¼Œåœ¨ TIOBE 2021ç¼–ç¨‹è¯­è¨€æ’åä¸Šä½åˆ—ç¬¬13åï¼Œä½†æ˜¯æˆ‘ä»¬é™å®šä¸‹ä½¿ç”¨åœºæ™¯çš„è¯ï¼Œå¼ºç±»å‹ã€ç¼–è¯‘å‹è¯­è¨€ã€ç½‘ç»œæœåŠ¡ã€å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®é™…ä¸ŠGoçš„æ’åä¼šæ›´åŠ äº®çœ¼ã€‚ç»“åˆè‡ªå·±C\C++\Javaå¼€å‘ä½“éªŒæ¥çœ‹ï¼Œgoè¯­è¨€æ— ç–‘æ˜¯ä¸€é—¨ä¸é”™çš„ç¼–ç¨‹è¯­è¨€ã€‚
Jul 2022 Jul 2021 Change Programming Language Ratings Change 1 3 Python 13.</description></item><item><title>å‡†å¤‡</title><link>https://hitzhangjie.pro/go-internals-v2/docs/setup/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/setup/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å¦‚ä½•ä»æºç å®‰è£…goï¼Œè¿™å¯¹å¸Œæœ›ç»™goè´¡çŒ®ä»£ç æˆ–è€…å¸Œæœ›ä»æºç å­¦ä¹ goçš„åŒå­¦è¿˜æ˜¯æœ‰å¿…è¦æŒæ¡çš„ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæœ¬åœ°å®‰è£…äº†goï¼š
åªæ˜¯æƒ³ä»æºç ç¼–è¯‘goçš„è¯ï¼Œcd srcç„¶åæ‰§è¡Œall.bashå³å¯ã€‚ å¦‚æœæƒ³é˜…è¯»å­¦ä¹ æºç ï¼ŒIDEé‡Œé¢éœ€è¦æ­£ç¡®è®¾ç½®GOROOTæŒ‡å‘æºç ç›®å½•ï¼Œä¸ç„¶é‡åˆ°ä¸€äº›â€œuse of internal package not allowedâ€çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒé»˜è®¤èµ°åˆ°äº†/usr/local/go/srcä¸­çš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™å‘ç°å¯¼å…¥åŒ…çš„importpathåˆæ˜¯internalå°±æŠ¥é”™äº†ï¼ŒæŠŠGOROOTæŒ‡å‘ä¸‹è½½çš„æºç ç›®å½•å³å¯è§£å†³ã€‚æå®šäº†è¿™ä¸ªå°±å¯ä»¥åœ¨IDEé‡Œæ­£å¸¸é˜…è¯»ï¼Œå¹¶æ‰§è¡Œå•æµ‹ã€‚ Source Analysis # References # https://go.dev/doc/install/source</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/docs/SUMMARY/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/SUMMARY/</guid><description>Summary # headless: true bookhidden: true # SUMMARY preface introduction setup Specification [go spec](Specification/go spec.md) Toolchain [instrumentation in go](Toolchain/instrumentation in go.md) Compiler [aliases, simple and efficient](Toolchain/Compiler/aliases, simple and efficient.md) [builds &amp;amp; linker&amp;quot;s timeline](Toolchain/Compiler/builds &amp;amp; linker&amp;quot;s timeline.md) [built-in functions optimizations](Toolchain/Compiler/built-in functions optimizations.md) [how &amp;ldquo;go build&amp;rdquo; works](Toolchain/Compiler/how &amp;ldquo;go build&amp;rdquo; works.md) [how are loops translated to assembly](Toolchain/Compiler/how are loops translated to assembly.</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/buttons/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/buttons/</guid><description>Buttons # Buttons are styled links that can lead to local page or external link.
Example # {{&amp;lt; button relref=&amp;#34;/&amp;#34; [class=&amp;#34;...&amp;#34;] &amp;gt;}}Get Home{{&amp;lt; /button &amp;gt;}} {{&amp;lt; button href=&amp;#34;https://github.com/alex-shpak/hugo-book&amp;#34; &amp;gt;}}Contribute{{&amp;lt; /button &amp;gt;}} Get Home Contribute</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/columns/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/columns/</guid><description>Columns # Columns help organize shorter pieces of content horizontally for readability.
{{&amp;lt; columns &amp;gt;}} &amp;lt;!-- begin columns block --&amp;gt; # Left Content Lorem markdownum insigne... &amp;lt;---&amp;gt; &amp;lt;!-- magic separator, between columns --&amp;gt; # Mid Content Lorem markdownum insigne... &amp;lt;---&amp;gt; &amp;lt;!-- magic separator, between columns --&amp;gt; # Right Content Lorem markdownum insigne... {{&amp;lt; /columns &amp;gt;}} Example # Left Content Lorem markdownum insigne. Olympo signis Delphis! Retexi Nereius nova develat stringit, frustra Saturnius uteroque inter!</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/details/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/details/</guid><description>Details # Details shortcode is a helper for details html5 element. It is going to replace expand shortcode.
Example # {{&amp;lt; details &amp;#34;Title&amp;#34; [open] &amp;gt;}} ## Markdown content Lorem markdownum insigne... {{&amp;lt; /details &amp;gt;}} {{&amp;lt; details title=&amp;#34;Title&amp;#34; open=true &amp;gt;}} ## Markdown content Lorem markdownum insigne... {{&amp;lt; /details &amp;gt;}} Title Markdown content Lorem markdownum insigne&amp;hellip;</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/expand/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/expand/</guid><description>Expand # Expand shortcode can help to decrease clutter on screen by hiding part of text. Expand content by clicking on it.
Example # Default # {{&amp;lt; expand &amp;gt;}} ## Markdown content Lorem markdownum insigne... {{&amp;lt; /expand &amp;gt;}} å±•å¼€ â†• Markdown content Lorem markdownum insigne&amp;hellip; With Custom Label # {{&amp;lt; expand &amp;#34;Custom Label&amp;#34; &amp;#34;...&amp;#34; &amp;gt;}} ## Markdown content Lorem markdownum insigne.</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/hints/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/hints/</guid><description>Hints # Hint shortcode can be used as hint/alerts/notification block.
There are 3 colors to choose: info, warning and danger.
{{&amp;lt; hint [info|warning|danger] &amp;gt;}} **Markdown content** Lorem markdownum insigne. Olympo signis Delphis! Retexi Nereius nova develat stringit, frustra Saturnius uteroque inter! Oculis non ritibus Telethusa {{&amp;lt; /hint &amp;gt;}} Example # Markdown content
Lorem markdownum insigne. Olympo signis Delphis! Retexi Nereius nova develat stringit, frustra Saturnius uteroque inter! Oculis non ritibus Telethusa Markdown content</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/katex/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/katex/</guid><description>KaTeX # KaTeX shortcode let you render math typesetting in markdown document. See KaTeX
Example # {{&amp;lt; katex &amp;gt;}} f(x) = \int_{-\infty}^\infty\hat f(\xi)\,e^{2 \pi i \xi x}\,d\xi {{&amp;lt; /katex &amp;gt;}} \[f(x) = \int_{-\infty}^\infty\hat f(\xi)\,e^{2 \pi i \xi x}\,d\xi\] Display Mode Example # Here is some inline example: \(\pi(x)\) , rendered in the same line. And below is display example, having display: block \[f(x) = \int_{-\infty}^\infty\hat f(\xi)\,e^{2 \pi i \xi x}\,d\xi\] Text continues here.</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/mermaid/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/mermaid/</guid><description>Mermaid Chart # Mermaid is library for generating svg charts and diagrams from text.
Override Mermaid Initialization Config
To override the initialization config for Mermaid, create a mermaid.json file in your assets folder!
Example # {{&amp;lt; mermaid &amp;gt;}} sequenceDiagram Alice-&amp;gt;&amp;gt;Bob: Hello Bob, how are you? alt is sick Bob-&amp;gt;&amp;gt;Alice: Not so good :( else is well Bob-&amp;gt;&amp;gt;Alice: Feeling fresh like a daisy end opt Extra response Bob-&amp;gt;&amp;gt;Alice: Thanks for asking end {{&amp;lt; /mermaid &amp;gt;}} mermaid.</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/section/page1/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/section/page1/</guid><description>Page 1 #</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/section/page2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/section/page2/</guid><description>Page 2 #</description></item><item><title/><link>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/tabs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/examples/shortcodes/tabs/</guid><description>Tabs # Tabs let you organize content by context, for example installation instructions for each supported platform.
{{&amp;lt; tabs &amp;#34;uniqueid&amp;#34; &amp;gt;}} {{&amp;lt; tab &amp;#34;MacOS&amp;#34; &amp;gt;}} # MacOS Content {{&amp;lt; /tab &amp;gt;}} {{&amp;lt; tab &amp;#34;Linux&amp;#34; &amp;gt;}} # Linux Content {{&amp;lt; /tab &amp;gt;}} {{&amp;lt; tab &amp;#34;Windows&amp;#34; &amp;gt;}} # Windows Content {{&amp;lt; /tab &amp;gt;}} {{&amp;lt; /tabs &amp;gt;}} Example # MacOS MacOS This is tab MacOS content.
Lorem markdownum insigne. Olympo signis Delphis!</description></item><item><title>a race detector unfurled</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/RaceDetection/a-race-detector-unfurled/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/RaceDetection/a-race-detector-unfurled/</guid><description>Let&amp;rsquo;s Summarize # Talk by Kavya Joshi. Race detectors are seriously cool tools that make writing race-free concurrent code easy â€” they detect the ever so elusive race conditions in a program. The Go race detector is one such tool that ships with Go, thereby making the magic of race detection trivially accessible to you and me. This talk will present the subtleties of race detection and explore how the Go race detector does it.</description></item><item><title>a race detector unfurled</title><link>https://hitzhangjie.pro/go-internals-v2/posts/a-race-detector-unfurled/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/a-race-detector-unfurled/</guid><description>Let&amp;rsquo;s Summarize # Talk by Kavya Joshi. Race detectors are seriously cool tools that make writing race-free concurrent code easy â€” they detect the ever so elusive race conditions in a program. The Go race detector is one such tool that ships with Go, thereby making the magic of race detection trivially accessible to you and me. This talk will present the subtleties of race detection and explore how the Go race detector does it.</description></item><item><title>a whirlwind tour of Goâ€™s runtime environment variables</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/a-whirlwind-tour-of-Gos-runtime-environment-variables/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/a-whirlwind-tour-of-Gos-runtime-environment-variables/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†Goè¿è¡Œæ—¶ç›¸å…³çš„ä¸€äº›ç¯å¢ƒå˜é‡
Source Analysis # References # https://dave.cheney.net/tag/gomaxprocs</description></item><item><title>aliases, simple and efficient</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/aliases-simple-and-efficient/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/aliases-simple-and-efficient/</guid><description>Let&amp;rsquo;s Summarize # goæä¾›äº†å®šä¹‰ç±»å‹åˆ«åçš„èƒ½åŠ›ï¼Œtype A = Bï¼Œè¿™æ ·å°±å°†Aå®šä¹‰ä¸ºäº†ç±»å‹Bçš„åˆ«åï¼Œåé¢å¯ä»¥ä½¿ç”¨Aæ¥ä»£æ›¿ç±»å‹Bã€‚æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼š
åšä¸€äº›é‡æ„ç±»çš„å·¥ä½œï¼Œå‡å¦‚ä¹‹å‰ä»£ç ä¸­æœ‰ä¸ªç±»å‹Type1è¢«å¤§é‡ä½¿ç”¨ï¼Œç°åœ¨é‡æ–°å®ç°äº†ä¸€ä¸ªç±»å‹Type2å¸Œæœ›èƒ½æ›¿æ¢æ‰Type1ï¼Œå¯ä»¥åœ¨ä½¿ç”¨Type1çš„åœ°æ–¹é€šè¿‡type Type1 = Type2æ¥åˆ›å»ºä¸€ä¸ªåˆ«åå·²å®Œæˆé‡æ„ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼› æé«˜å¯è¯»æ€§ï¼Œæ¯”å¦‚æœ‰äº›å‡½æ•°çš„å‚æ•°å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚filepath.Walk(path, func(fp string, inf os.FileInfo, err error) error)ï¼Œç°åœ¨è¿˜å¥½ï¼Œå¦‚æœå‚æ•°æ›´å¤šäº›å°±å¾ˆéš¾çœ‹äº†ï¼Œå¦‚æœå®šä¹‰type WalkFunc = func(fp string, inf os.FileInfo, err error) errorï¼Œç„¶åfilepath.Walk(path, WalkFunc)`å¯è¯»æ€§å°±å¤§å¤§æå‡äº†ï¼› è¿è¡Œæ—¶ä¼šå¯¹type aliasåšä½•å¤„ç†å‘¢ï¼Ÿæ¯”å¦‚type A = Bï¼Œå¦‚æœç»™ä¸€ä¸ªemptyInterfaceèµ‹å€¼äº†ä¸€ä¸ªå˜é‡Aï¼š
é‚£ä¹ˆç±»å‹æ–­è¨€å®ƒåº”è¯¥æ˜¯Aè¿˜æ˜¯Bå‘¢ï¼Ÿéƒ½å¿…é¡»æ–­è¨€æˆåŠŸï¼ é‚£ä¹ˆåå°„è·å–å…¶ç±»å‹åº”è¯¥æ˜¯è°å‘¢ï¼Ÿåº”è¯¥æ˜¯Bï¼ åˆ°åº•æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶ï¼Œå°†å¯¹å°è¯•éœ€è¦ç±»å‹Açš„åœ°æ–¹ä½¿ç”¨ç±»å‹Bçš„ä¿¡æ¯ï¼Œå¤„ç†èµ·æ¥å°±ç®€å•äº†ã€‚ Source Analysis # References # https://medium.com/a-journey-with-go/go-aliases-simple-and-efficient-8506d93b079e</description></item><item><title>aliases, simple and efficient</title><link>https://hitzhangjie.pro/go-internals-v2/posts/aliases-simple-and-efficient/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/aliases-simple-and-efficient/</guid><description>Let&amp;rsquo;s Summarize # goæä¾›äº†å®šä¹‰ç±»å‹åˆ«åçš„èƒ½åŠ›ï¼Œtype A = Bï¼Œè¿™æ ·å°±å°†Aå®šä¹‰ä¸ºäº†ç±»å‹Bçš„åˆ«åï¼Œåé¢å¯ä»¥ä½¿ç”¨Aæ¥ä»£æ›¿ç±»å‹Bã€‚æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼š
åšä¸€äº›é‡æ„ç±»çš„å·¥ä½œï¼Œå‡å¦‚ä¹‹å‰ä»£ç ä¸­æœ‰ä¸ªç±»å‹Type1è¢«å¤§é‡ä½¿ç”¨ï¼Œç°åœ¨é‡æ–°å®ç°äº†ä¸€ä¸ªç±»å‹Type2å¸Œæœ›èƒ½æ›¿æ¢æ‰Type1ï¼Œå¯ä»¥åœ¨ä½¿ç”¨Type1çš„åœ°æ–¹é€šè¿‡type Type1 = Type2æ¥åˆ›å»ºä¸€ä¸ªåˆ«åå·²å®Œæˆé‡æ„ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼› æé«˜å¯è¯»æ€§ï¼Œæ¯”å¦‚æœ‰äº›å‡½æ•°çš„å‚æ•°å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚filepath.Walk(path, func(fp string, inf os.FileInfo, err error) error)ï¼Œç°åœ¨è¿˜å¥½ï¼Œå¦‚æœå‚æ•°æ›´å¤šäº›å°±å¾ˆéš¾çœ‹äº†ï¼Œå¦‚æœå®šä¹‰type WalkFunc = func(fp string, inf os.FileInfo, err error) errorï¼Œç„¶åfilepath.Walk(path, WalkFunc)`å¯è¯»æ€§å°±å¤§å¤§æå‡äº†ï¼› è¿è¡Œæ—¶ä¼šå¯¹type aliasåšä½•å¤„ç†å‘¢ï¼Ÿæ¯”å¦‚type A = Bï¼Œå¦‚æœç»™ä¸€ä¸ªemptyInterfaceèµ‹å€¼äº†ä¸€ä¸ªå˜é‡Aï¼š
é‚£ä¹ˆç±»å‹æ–­è¨€å®ƒåº”è¯¥æ˜¯Aè¿˜æ˜¯Bå‘¢ï¼Ÿéƒ½å¿…é¡»æ–­è¨€æˆåŠŸï¼ é‚£ä¹ˆåå°„è·å–å…¶ç±»å‹åº”è¯¥æ˜¯è°å‘¢ï¼Ÿåº”è¯¥æ˜¯Bï¼ åˆ°åº•æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶ï¼Œå°†å¯¹å°è¯•éœ€è¦ç±»å‹Açš„åœ°æ–¹ä½¿ç”¨ç±»å‹Bçš„ä¿¡æ¯ï¼Œå¤„ç†èµ·æ¥å°±ç®€å•äº†ã€‚ Source Analysis # References # https://medium.com/a-journey-with-go/go-aliases-simple-and-efficient-8506d93b079e</description></item><item><title>an insight into go garbage collector</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/an-insight-into-go-garbage-collector/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/an-insight-into-go-garbage-collector/</guid><description>Let&amp;rsquo;s Summarize # goroutineæ ˆå†…å­˜æ˜¯ä»mheapç”³è¯·è€Œæ¥ï¼Œæ ˆç©ºé—´å°äº32Kçš„æ—¶å€™ä¹Ÿæ˜¯ä»P.mcacheä¸­åˆ†é…çš„ï¼Œå‡å°é”ç«äº‰ï¼Œå½“æ ˆç©ºé—´å¤§äº32Kæ—¶å°±ä»mheapä¸­åˆ†é…äº†ã€‚/// stack splitæŒ‡çš„æ˜¯stack growthå’Œstack shrinkè¿™ç§æƒ…å†µã€‚/// stacké”€æ¯å¼€é”€æ›´å°ï¼Œè°ƒæ•´ä¸‹æ ˆæŒ‡é’ˆå¯„å­˜å™¨å³å¯ã€‚heapå¯¹è±¡é”€æ¯åˆ™è¦ä¾èµ–åƒåœ¾å›æ”¶ã€‚/// å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œé»‘è‰²è¡¨ç¤ºå¯è¾¾å¹¶ä¸”å·²ç»åˆ†æå®Œäº†å…¶å†…éƒ¨æŒ‡é’ˆçš„å¯¹è±¡ï¼Œç°è‰²è¡¨ç¤ºå¯è¾¾ä½†æ˜¯è¿˜æ²¡æœ‰åˆ†æå®Œå…¶å†…éƒ¨æŒ‡é’ˆï¼Œç™½è‰²è¡¨ç¤ºä¸å¯è¾¾å¯¹è±¡ã€‚ä¸ºäº†ç»´æŒä¸‰è‰²ä¸å˜æ€§éœ€è¦é€šè¿‡write barrieræ¥è®°å½•mutatorå¯¹æŒ‡é’ˆåšçš„ä¿®æ”¹ï¼Œæ–°ç‰ˆæœ¬ä¸­å·²ç»æ˜¯ç”¨çš„æ··åˆå†™å±éšœäº†ï¼Œç»¼åˆäº†dijkstra write barrierå’Œyuasa write barrierï¼Œå¹¶ä¸”åšäº†ä¼˜åŒ–å®ç°äº†bufferred write barrierï¼Œå…è®¸æ¯ä¸ªPç»´æŠ¤ä¸€ä¸ªbufferå¿…è¦æ—¶flushä»¥æGCæ€§èƒ½ã€‚/// go GCè¿½æ±‚æ›´ä½çš„åœé¡¿æ—¶é—´ï¼Œå¸Œæœ›GCç»™goroutineæ‰§è¡Œå¼•å…¥çš„å»¶è¿Ÿæ›´ä½ï¼
Source Analysis # References # https://golangpiter.com/system/attachments/files/000/001/718/original/GP_2019_-_An_Insight_Into_Go_Garbage_Collection.pdf?1572419303</description></item><item><title>an insight into go garbage collector</title><link>https://hitzhangjie.pro/go-internals-v2/posts/an-insight-into-go-garbage-collector/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/an-insight-into-go-garbage-collector/</guid><description>Let&amp;rsquo;s Summarize # goroutineæ ˆå†…å­˜æ˜¯ä»mheapç”³è¯·è€Œæ¥ï¼Œæ ˆç©ºé—´å°äº32Kçš„æ—¶å€™ä¹Ÿæ˜¯ä»P.mcacheä¸­åˆ†é…çš„ï¼Œå‡å°é”ç«äº‰ï¼Œå½“æ ˆç©ºé—´å¤§äº32Kæ—¶å°±ä»mheapä¸­åˆ†é…äº†ã€‚/// stack splitæŒ‡çš„æ˜¯stack growthå’Œstack shrinkè¿™ç§æƒ…å†µã€‚/// stacké”€æ¯å¼€é”€æ›´å°ï¼Œè°ƒæ•´ä¸‹æ ˆæŒ‡é’ˆå¯„å­˜å™¨å³å¯ã€‚heapå¯¹è±¡é”€æ¯åˆ™è¦ä¾èµ–åƒåœ¾å›æ”¶ã€‚/// å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œé»‘è‰²è¡¨ç¤ºå¯è¾¾å¹¶ä¸”å·²ç»åˆ†æå®Œäº†å…¶å†…éƒ¨æŒ‡é’ˆçš„å¯¹è±¡ï¼Œç°è‰²è¡¨ç¤ºå¯è¾¾ä½†æ˜¯è¿˜æ²¡æœ‰åˆ†æå®Œå…¶å†…éƒ¨æŒ‡é’ˆï¼Œç™½è‰²è¡¨ç¤ºä¸å¯è¾¾å¯¹è±¡ã€‚ä¸ºäº†ç»´æŒä¸‰è‰²ä¸å˜æ€§éœ€è¦é€šè¿‡write barrieræ¥è®°å½•mutatorå¯¹æŒ‡é’ˆåšçš„ä¿®æ”¹ï¼Œæ–°ç‰ˆæœ¬ä¸­å·²ç»æ˜¯ç”¨çš„æ··åˆå†™å±éšœäº†ï¼Œç»¼åˆäº†dijkstra write barrierå’Œyuasa write barrierï¼Œå¹¶ä¸”åšäº†ä¼˜åŒ–å®ç°äº†bufferred write barrierï¼Œå…è®¸æ¯ä¸ªPç»´æŠ¤ä¸€ä¸ªbufferå¿…è¦æ—¶flushä»¥æGCæ€§èƒ½ã€‚/// go GCè¿½æ±‚æ›´ä½çš„åœé¡¿æ—¶é—´ï¼Œå¸Œæœ›GCç»™goroutineæ‰§è¡Œå¼•å…¥çš„å»¶è¿Ÿæ›´ä½ï¼
Source Analysis # References # https://golangpiter.com/system/attachments/files/000/001/718/original/GP_2019_-_An_Insight_Into_Go_Garbage_Collection.pdf?1572419303</description></item><item><title>asynchronous preemption</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/asynchronous-preemption/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/asynchronous-preemption/</guid><description>Let&amp;rsquo;s Summarize # è¿™é‡Œçš„å¼‚æ­¥æŠ¢å ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„æŠ¢å å¼è°ƒåº¦äº†ï¼Œæ˜¯é€šè¿‡SIGURGä¿¡å·ã€ä¿¡å·å¤„ç†ã€åç¨‹è°ƒåº¦æ¥å…±åŒå®ç°çš„ã€‚
é¦–å…ˆï¼Œæ­£å¦‚å‰é¢ä»‹ç»çš„ï¼Œgoç¨‹åºä¸­æœ‰ä¸€ä¸ªsysmonçº¿ç¨‹ï¼Œå®ƒä¼šå®šæœŸæ£€æŸ¥æ‰€æœ‰çš„Pï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¿è¡Œæ—¶é—´è¶…è¿‡äº†10msï¼Œå¦‚æœè¶…è¿‡äº†åˆ™æ‰§è¡ŒæŠ¢å é€»è¾‘ï¼Œpreemptone(p)ï¼Œå…¶å†…éƒ¨å…¶å®æ˜¯è®¾ç½®Pä¸Šå½“å‰gçš„preemptæ ‡è®°ä½ä¸ºtrueï¼Œç„¶åå†å°è¯•å»æŠ¢å p.mï¼ŒpreemptM(p.m)ï¼Œè¿™ä¸ªpreemptMå†…éƒ¨ä¼šç»™mè¿™ä¸ªçº¿ç¨‹å‘é€ä¸€ä¸ªSIGURGä¿¡å·ã€‚
å‰é¢ä»‹ç»gsignalæ—¶æˆ‘ä»¬æè¿‡äº†ï¼Œsighanlderè¿™é‡Œä¼šåŒºåˆ†ä¿¡å·ç±»å‹å¹¶åšå¤„ç†ï¼Œè¿™é‡Œçš„SIGURGä¿¡å·å°±æ˜¯goä¸­é€‰å®šçš„æŠ¢å å¼ä¿¡å·sigPreemptï¼Œç„¶åæ‰§è¡ŒæŠ¢å é€»è¾‘ï¼Œè¿™ä¸ªé€»è¾‘ä¹Ÿç®€å•ï¼Œå°±æ˜¯ä¿å­˜å½“å‰gä¸Šä¸‹æ–‡ï¼Œå¹¶åˆ‡æ¢åˆ°g0ï¼Œg0é€‰æ‹©ä¸‹ä¸€ä¸ªè¦è°ƒåº¦çš„gå¹¶æ¢å¤å…¶ä¸Šä¸‹æ–‡æ‰§è¡Œã€‚æŠ¢å å°±å®Œæˆäº†ã€‚
å…³äºä¸ºä»€ä¹ˆæŠ¢å ä¿¡å·é€‰æ‹©SIGURGï¼Œä¹Ÿä¸æ˜¯å‡­ç©ºé€‰çš„ï¼Œä¸»è¦æ˜¯è€ƒè™‘äº†ä¸‹é¢å‡ ç‚¹ï¼š It should be a signal thatâ€™s passed-through by debuggers by default.
It shouldnâ€™t be used internally by libc in mixed Go/C binaries [â€¦]. It should be a signal that can happen spuriously without consequences. We need to deal with platforms without real-time signals [â€¦]. å¼‚æ­¥æŠ¢å ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥å…³é—­ï¼ŒGODEBUG=asyncpreemptoff=1.
Source Analysis # SIGURGï¼Œåœ¨ä¿¡å·å¤„ç†å‡½æ•°runtime/signal_unix.go:sighandler(&amp;hellip;)å‡½æ•°ä¸­åˆçœ‹åˆ°å¯¹sigPreemptçš„å¤„ç†ã€‚
SIGURGå®ç°æŠ¢å å¼è°ƒåº¦ï¼š å¯¹åº”è¿™ä¸ªå‡½æ•°doSigPreemptï¼Œæ£€æŸ¥å½“å‰gæ˜¯ä¸æ˜¯wantAsyncPreemptï¼Œokçš„è¯æ£€æŸ¥æ˜¯ä¸æ˜¯isAsyncSafePointï¼Œokçš„è¯ï¼Œsigctxt.pushCall(funcPC(asyncPreempt), newpc)ï¼Œè¿™ä¸ªå‡½æ•°è°ƒæ•´PCå¹¶æ³¨å…¥ä¸€ä¸ªå¯¹asyncPreemptçš„è°ƒç”¨ã€‚
TODO wantAsyncPreemptå¯¹åº”çš„åˆ¤æ–­å‚æ•°æ˜¯è°å»è®¾ç½®çš„ï¼Œä»€ä¹ˆæ—¶å€™è®¾ç½®çš„ï¼Ÿ
TODO isAsyncSafePointï¼Œsafepointçš„å«ä¹‰ï¼Ÿè¿™ä¸ªå‡½æ•°çš„æ³¨é‡Šä»¥åŠä»£ç ä¸­çš„if-elseå·²ç»è¶³å¤Ÿç»“å®æ¸…æ¥šä»€ä¹ˆæ˜¯safepointäº†ï¼Œä»¥åŠsafepointçš„æ„ä¹‰äº†ã€‚
çœ‹ä¸‹asyncPreemptçš„é€»è¾‘ï¼Œè¯¥å‡½æ•°æ˜¯åœ¨æ±‡ç¼–ä¸­å®ç°çš„ï¼Œé¦–å…ˆä¿å­˜å¯„å­˜å™¨çš„å€¼ï¼Œç„¶åè°ƒç”¨asyncPreempt2æ‰§è¡Œå…¶ä»–å¤„ç†ã€‚
g.preemptStopå†³å®šæ˜¯æŒ‚èµ·gè¿˜æ˜¯é‡æ–°è°ƒåº¦gï¼š
å¦‚æœè¢«æŠ¢å çš„gçš„g.</description></item><item><title>asynchronous preemption</title><link>https://hitzhangjie.pro/go-internals-v2/posts/asynchronous-preemption/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/asynchronous-preemption/</guid><description>Let&amp;rsquo;s Summarize # è¿™é‡Œçš„å¼‚æ­¥æŠ¢å ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„æŠ¢å å¼è°ƒåº¦äº†ï¼Œæ˜¯é€šè¿‡SIGURGä¿¡å·ã€ä¿¡å·å¤„ç†ã€åç¨‹è°ƒåº¦æ¥å…±åŒå®ç°çš„ã€‚
é¦–å…ˆï¼Œæ­£å¦‚å‰é¢ä»‹ç»çš„ï¼Œgoç¨‹åºä¸­æœ‰ä¸€ä¸ªsysmonçº¿ç¨‹ï¼Œå®ƒä¼šå®šæœŸæ£€æŸ¥æ‰€æœ‰çš„Pï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¿è¡Œæ—¶é—´è¶…è¿‡äº†10msï¼Œå¦‚æœè¶…è¿‡äº†åˆ™æ‰§è¡ŒæŠ¢å é€»è¾‘ï¼Œpreemptone(p)ï¼Œå…¶å†…éƒ¨å…¶å®æ˜¯è®¾ç½®Pä¸Šå½“å‰gçš„preemptæ ‡è®°ä½ä¸ºtrueï¼Œç„¶åå†å°è¯•å»æŠ¢å p.mï¼ŒpreemptM(p.m)ï¼Œè¿™ä¸ªpreemptMå†…éƒ¨ä¼šç»™mè¿™ä¸ªçº¿ç¨‹å‘é€ä¸€ä¸ªSIGURGä¿¡å·ã€‚
å‰é¢ä»‹ç»gsignalæ—¶æˆ‘ä»¬æè¿‡äº†ï¼Œsighanlderè¿™é‡Œä¼šåŒºåˆ†ä¿¡å·ç±»å‹å¹¶åšå¤„ç†ï¼Œè¿™é‡Œçš„SIGURGä¿¡å·å°±æ˜¯goä¸­é€‰å®šçš„æŠ¢å å¼ä¿¡å·sigPreemptï¼Œç„¶åæ‰§è¡ŒæŠ¢å é€»è¾‘ï¼Œè¿™ä¸ªé€»è¾‘ä¹Ÿç®€å•ï¼Œå°±æ˜¯ä¿å­˜å½“å‰gä¸Šä¸‹æ–‡ï¼Œå¹¶åˆ‡æ¢åˆ°g0ï¼Œg0é€‰æ‹©ä¸‹ä¸€ä¸ªè¦è°ƒåº¦çš„gå¹¶æ¢å¤å…¶ä¸Šä¸‹æ–‡æ‰§è¡Œã€‚æŠ¢å å°±å®Œæˆäº†ã€‚
å…³äºä¸ºä»€ä¹ˆæŠ¢å ä¿¡å·é€‰æ‹©SIGURGï¼Œä¹Ÿä¸æ˜¯å‡­ç©ºé€‰çš„ï¼Œä¸»è¦æ˜¯è€ƒè™‘äº†ä¸‹é¢å‡ ç‚¹ï¼š It should be a signal thatâ€™s passed-through by debuggers by default.
It shouldnâ€™t be used internally by libc in mixed Go/C binaries [â€¦]. It should be a signal that can happen spuriously without consequences. We need to deal with platforms without real-time signals [â€¦]. å¼‚æ­¥æŠ¢å ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥å…³é—­ï¼ŒGODEBUG=asyncpreemptoff=1.
Source Analysis # SIGURGï¼Œåœ¨ä¿¡å·å¤„ç†å‡½æ•°runtime/signal_unix.go:sighandler(&amp;hellip;)å‡½æ•°ä¸­åˆçœ‹åˆ°å¯¹sigPreemptçš„å¤„ç†ã€‚
SIGURGå®ç°æŠ¢å å¼è°ƒåº¦ï¼š å¯¹åº”è¿™ä¸ªå‡½æ•°doSigPreemptï¼Œæ£€æŸ¥å½“å‰gæ˜¯ä¸æ˜¯wantAsyncPreemptï¼Œokçš„è¯æ£€æŸ¥æ˜¯ä¸æ˜¯isAsyncSafePointï¼Œokçš„è¯ï¼Œsigctxt.pushCall(funcPC(asyncPreempt), newpc)ï¼Œè¿™ä¸ªå‡½æ•°è°ƒæ•´PCå¹¶æ³¨å…¥ä¸€ä¸ªå¯¹asyncPreemptçš„è°ƒç”¨ã€‚
TODO wantAsyncPreemptå¯¹åº”çš„åˆ¤æ–­å‚æ•°æ˜¯è°å»è®¾ç½®çš„ï¼Œä»€ä¹ˆæ—¶å€™è®¾ç½®çš„ï¼Ÿ
TODO isAsyncSafePointï¼Œsafepointçš„å«ä¹‰ï¼Ÿè¿™ä¸ªå‡½æ•°çš„æ³¨é‡Šä»¥åŠä»£ç ä¸­çš„if-elseå·²ç»è¶³å¤Ÿç»“å®æ¸…æ¥šä»€ä¹ˆæ˜¯safepointäº†ï¼Œä»¥åŠsafepointçš„æ„ä¹‰äº†ã€‚
çœ‹ä¸‹asyncPreemptçš„é€»è¾‘ï¼Œè¯¥å‡½æ•°æ˜¯åœ¨æ±‡ç¼–ä¸­å®ç°çš„ï¼Œé¦–å…ˆä¿å­˜å¯„å­˜å™¨çš„å€¼ï¼Œç„¶åè°ƒç”¨asyncPreempt2æ‰§è¡Œå…¶ä»–å¤„ç†ã€‚
g.preemptStopå†³å®šæ˜¯æŒ‚èµ·gè¿˜æ˜¯é‡æ–°è°ƒåº¦gï¼š
å¦‚æœè¢«æŠ¢å çš„gçš„g.</description></item><item><title>Benchmarking in Golang: Improving function performance</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Testing/Benchmarking-in-Golang-Improving-function-performance/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Testing/Benchmarking-in-Golang-Improving-function-performance/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†go benchmarkæµ‹è¯•çš„ä¸€äº›åŸºç¡€çŸ¥è¯†å’Œå®ä¾‹ï¼Œä»¥åŠbenchstatè¿™ä¸ªæ€§èƒ½å¯¹æ¯”å·¥å…·
Source Analysis # References # https://blog.logrocket.com/benchmarking-golang-improve-function-performance/</description></item><item><title>buffered and unbuffered channels</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/chan/buffered-and-unbuffered-channels/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/chan/buffered-and-unbuffered-channels/</guid><description>Let&amp;rsquo;s Summarize # src/runtime/chan.goä¸­hchanï¼ŒbufferedChanå’ŒunbufferedChanéƒ½æ˜¯ç”¨è¿™ä¸ªæ•°æ®ç±»å‹æ¥è¡¨ç¤ºã€‚
1 unbuffered chan
unbufferedChanï¼šåˆ›å»ºchanæ—¶æ²¡æœ‰æŒ‡å®šcapacityæˆ–è€…capacity=0ï¼Œè¿™æ ·çš„chanæ˜¯æ— ç¼“å†²çš„ã€‚chan senderæ‰§è¡Œchan sendæ“ä½œæ—¶ä¼šé˜»å¡ï¼Œç›´åˆ°chan readerè¯»å–äº†è¯¥æ•°æ®ã€‚
chan senderé˜»å¡æ—¶ï¼Œä¼šç”³è¯·ä¸€ä¸ªsudogï¼Œè®°å½•chan senderå¯¹åº”çš„gï¼Œå¹¶è®°å½•chan senderè¦sendçš„valueï¼Œchan readerè¯»å–æ—¶ç›´æ¥é€šè¿‡memmoveç§»åŠ¨sudogä¸­è®°å½•çš„æ•°æ®åˆ°chan readerè¦readåˆ°çš„å˜é‡ä¸­ï¼Œå¹¶resume sudogè®°å½•çš„gã€‚
2 buffered chan
bufferedChanï¼šåˆ›å»ºchanæ—¶æŒ‡å®šäº†capacityâ‰¥1ï¼š
chan senderæ‰§è¡Œsendæ“ä½œæ—¶ï¼Œå¦‚æœchanæ»¡äº†åˆ™ä¼šé˜»å¡ï¼› chan readeræ‰§è¡Œreadæ“ä½œæ—¶ï¼Œå¦‚æœchanç©ºäº†åˆ™ä¼šé˜»å¡ï¼› hchanä¸­æœ‰è®°å½•å½“å‰chanä¸­å…ƒç´ æ•°é‡hchan.qcountï¼Œå¹¶é€šè¿‡hchan.dataqsizè®°å½•capacityï¼Œé€šè¿‡ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—hchan.bufæ¥å­˜å‚¨å­˜å‚¨çš„å…ƒç´ æ•°é‡ï¼Œè¯¥ç¯å½¢é˜Ÿåˆ—é€šè¿‡hchan.sendx/hchan.recvxæ¥è®°å½•ä¸‹æ¬¡chan sendæ“ä½œçš„å†™å…¥ä½ç½®å’Œä¸‹æ¬¡chan readæ“ä½œæ—¶çš„è¯»å–ä½ç½®ã€‚
å’ŒunbufferedChanç±»ä¼¼ï¼Œå¦‚æœchan senderã€chan readerè¦é˜»å¡æ—¶éœ€è¦ç”³è¯·sudogå¹¶è®°å½•åˆ°sendqã€recvqä¸­ã€‚
åç»­chanä¸­æœ‰ç©ºä½å¯å†™å…¥æ—¶ï¼Œå†é€‰æ‹©sendqä¸­çš„æŸä¸ªsudogå¹¶memmoveå…¶sendçš„valueç„¶åresumeå…¶æ‰§è¡Œï¼› æˆ–è€…chanä¸­æœ‰æ•°æ®å¯è¯»å–æ—¶ï¼Œå†é€‰æ‹©recvqä¸­çš„æŸä¸ªsudogå¹¶memmove hchan.buf[recvx]ä¸­æ•°æ®åˆ°è¦è¯»å–åˆ°çš„å˜é‡ç„¶åresumeå…¶æ‰§è¡Œï¼› å¤§è‡´å®ç°è¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ã€‚
3 æ€§èƒ½é—®é¢˜
chan bufferçš„å¤§å°ã€æœ‰æ— ï¼Œchan senderã€receiverçš„æ•°é‡ï¼Œä¼šå½±å“åˆ°chan sendã€recvçš„æ€§èƒ½ï¼Œè¿™ä¸ªbufferå¤§å°ä¸èƒ½å‡­ç©ºè‡†æƒ³ï¼Œè¦ç»“åˆç»éªŒã€benchmarkæ¥æŒ‡å®šä¸€ä¸ªåˆç†çš„å€¼ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-buffered-and-unbuffered-channels-29a107c00268</description></item><item><title>buffered and unbuffered channels</title><link>https://hitzhangjie.pro/go-internals-v2/posts/buffered-and-unbuffered-channels/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/buffered-and-unbuffered-channels/</guid><description>Let&amp;rsquo;s Summarize # src/runtime/chan.goä¸­hchanï¼ŒbufferedChanå’ŒunbufferedChanéƒ½æ˜¯ç”¨è¿™ä¸ªæ•°æ®ç±»å‹æ¥è¡¨ç¤ºã€‚
1 unbuffered chan
unbufferedChanï¼šåˆ›å»ºchanæ—¶æ²¡æœ‰æŒ‡å®šcapacityæˆ–è€…capacity=0ï¼Œè¿™æ ·çš„chanæ˜¯æ— ç¼“å†²çš„ã€‚chan senderæ‰§è¡Œchan sendæ“ä½œæ—¶ä¼šé˜»å¡ï¼Œç›´åˆ°chan readerè¯»å–äº†è¯¥æ•°æ®ã€‚
chan senderé˜»å¡æ—¶ï¼Œä¼šç”³è¯·ä¸€ä¸ªsudogï¼Œè®°å½•chan senderå¯¹åº”çš„gï¼Œå¹¶è®°å½•chan senderè¦sendçš„valueï¼Œchan readerè¯»å–æ—¶ç›´æ¥é€šè¿‡memmoveç§»åŠ¨sudogä¸­è®°å½•çš„æ•°æ®åˆ°chan readerè¦readåˆ°çš„å˜é‡ä¸­ï¼Œå¹¶resume sudogè®°å½•çš„gã€‚
2 buffered chan
bufferedChanï¼šåˆ›å»ºchanæ—¶æŒ‡å®šäº†capacityâ‰¥1ï¼š
chan senderæ‰§è¡Œsendæ“ä½œæ—¶ï¼Œå¦‚æœchanæ»¡äº†åˆ™ä¼šé˜»å¡ï¼› chan readeræ‰§è¡Œreadæ“ä½œæ—¶ï¼Œå¦‚æœchanç©ºäº†åˆ™ä¼šé˜»å¡ï¼› hchanä¸­æœ‰è®°å½•å½“å‰chanä¸­å…ƒç´ æ•°é‡hchan.qcountï¼Œå¹¶é€šè¿‡hchan.dataqsizè®°å½•capacityï¼Œé€šè¿‡ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—hchan.bufæ¥å­˜å‚¨å­˜å‚¨çš„å…ƒç´ æ•°é‡ï¼Œè¯¥ç¯å½¢é˜Ÿåˆ—é€šè¿‡hchan.sendx/hchan.recvxæ¥è®°å½•ä¸‹æ¬¡chan sendæ“ä½œçš„å†™å…¥ä½ç½®å’Œä¸‹æ¬¡chan readæ“ä½œæ—¶çš„è¯»å–ä½ç½®ã€‚
å’ŒunbufferedChanç±»ä¼¼ï¼Œå¦‚æœchan senderã€chan readerè¦é˜»å¡æ—¶éœ€è¦ç”³è¯·sudogå¹¶è®°å½•åˆ°sendqã€recvqä¸­ã€‚
åç»­chanä¸­æœ‰ç©ºä½å¯å†™å…¥æ—¶ï¼Œå†é€‰æ‹©sendqä¸­çš„æŸä¸ªsudogå¹¶memmoveå…¶sendçš„valueç„¶åresumeå…¶æ‰§è¡Œï¼› æˆ–è€…chanä¸­æœ‰æ•°æ®å¯è¯»å–æ—¶ï¼Œå†é€‰æ‹©recvqä¸­çš„æŸä¸ªsudogå¹¶memmove hchan.buf[recvx]ä¸­æ•°æ®åˆ°è¦è¯»å–åˆ°çš„å˜é‡ç„¶åresumeå…¶æ‰§è¡Œï¼› å¤§è‡´å®ç°è¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ã€‚
3 æ€§èƒ½é—®é¢˜
chan bufferçš„å¤§å°ã€æœ‰æ— ï¼Œchan senderã€receiverçš„æ•°é‡ï¼Œä¼šå½±å“åˆ°chan sendã€recvçš„æ€§èƒ½ï¼Œè¿™ä¸ªbufferå¤§å°ä¸èƒ½å‡­ç©ºè‡†æƒ³ï¼Œè¦ç»“åˆç»éªŒã€benchmarkæ¥æŒ‡å®šä¸€ä¸ªåˆç†çš„å€¼ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-buffered-and-unbuffered-channels-29a107c00268</description></item><item><title>build a better linker</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/build-a-better-linker/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/build-a-better-linker/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å½“å‰goç¼–è¯‘å™¨é“¾æ¥å™¨å·¥ä½œè¿‡ç¨‹ä¸­åšçš„ä¸å¤ªå¥½çš„åœ°æ–¹ï¼Œä»¥åŠæå‡ºäº†æ„å»ºä¸€ä¸ªæ›´å¥½çš„é“¾æ¥å™¨çš„æƒ³æ³•ã€‚ç°åœ¨å·²ç»åœ¨è¿™ä¹ˆæ¼”è¿›äº†å§ã€‚
Source Analysis # References # http://golang.org/s/better-linker</description></item><item><title>build a better linker</title><link>https://hitzhangjie.pro/go-internals-v2/posts/build-a-better-linker/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/build-a-better-linker/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å½“å‰goç¼–è¯‘å™¨é“¾æ¥å™¨å·¥ä½œè¿‡ç¨‹ä¸­åšçš„ä¸å¤ªå¥½çš„åœ°æ–¹ï¼Œä»¥åŠæå‡ºäº†æ„å»ºä¸€ä¸ªæ›´å¥½çš„é“¾æ¥å™¨çš„æƒ³æ³•ã€‚ç°åœ¨å·²ç»åœ¨è¿™ä¹ˆæ¼”è¿›äº†å§ã€‚
Source Analysis # References # http://golang.org/s/better-linker</description></item><item><title>builds &amp; linker"s timeline</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/builds-linkers-timeline/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/builds-linkers-timeline/</guid><description>Let&amp;rsquo;s Summarize # go buildæ¶‰åŠåˆ°çš„å·¥ä½œæ­¥éª¤åŒ…æ‹¬ï¼š
åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•ï¼› ç¼–è¯‘å„ä¸ªpackageåŠå…¶ä¾èµ–ï¼› é“¾æ¥å™¨è¿æ¥æˆå¯æ‰§è¡Œç¨‹åºï¼› å°†å¯æ‰§è¡Œç¨‹åºç§»åŠ¨åˆ°å½“å‰ç›®å½•ï¼Œå¹¶åˆ é™¤ä¸´æ—¶å·¥ä½œç›®å½•ï¼› go build -xä¼šæ˜¾ç¤ºæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨ç¼–è¯‘é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œç”±äºç¼–è¯‘å¯èƒ½ä¼šæ¶‰åŠåˆ°åº”ç”¨ç¼–è¯‘ç¼“å­˜ï¼Œé“¾æ¥å™¨é“¾æ¥éƒ¨åˆ†çš„è€—æ—¶åˆ™ä¼šå˜å¾—å¾ˆçªå‡ºï¼Œå¦‚ä½•ä¼˜åŒ–é“¾æ¥å™¨æå‡å…¶æ•ˆç‡å°±å˜å¾—å¾ˆé‡è¦ã€‚
linkerçš„ç›®çš„æ˜¯ä¸ºäº†æ„å»ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œå…¶æ­¥éª¤åŒ…æ‹¬ï¼š
åŠ è½½å·²ç»ç¼–è¯‘å¥½çš„å„ä¸ªpackageåŠå…¶ä¾èµ–ï¼Œå¹¶æ”¶é›†å…¶ä¸­çš„ç¬¦å·ä¿¡æ¯ï¼› ç§»é™¤deadcodeï¼Œå¦‚æ‰€æœ‰æœªä½¿ç”¨çš„å‡½æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆï¼Œå› ä¸ºç¼–è¯‘é˜¶æ®µæ˜¯å„ä¸ªpackageç‹¬ç«‹ç¼–è¯‘çš„ï¼Œä¸çŸ¥é“å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œåªæœ‰é“¾æ¥å™¨çŸ¥é“ï¼› DWARFè°ƒè¯•ä¿¡æ¯ç”Ÿæˆï¼Œå¹¶å°†å…¶å‹ç¼©å­˜å‚¨åˆ°äºŒè¿›åˆ¶ç¨‹åºä¸­ï¼› ç»„ç»‡å¥½pc-valueè¡¨ï¼Œfunctionè¡¨ï¼Œç¬¦å·è¡¨ï¼Œæ–¹ä¾¿å†…éƒ¨ä½¿ç”¨ï¼› é‡å®šä½ï¼Œç¼–è¯‘é˜¶æ®µå› ä¸ºæ˜¯ç‹¬ç«‹ç¼–è¯‘å„packageï¼Œå¼•ç”¨çš„å…¶ä»–packageä¸­çš„å‡½æ•°çš„å…·ä½“ä½ç½®æ˜¯ä¸çŸ¥é“çš„ï¼Œåªæœ‰åœ¨æœ€åè¿™ä¸ªé˜¶æ®µé“¾æ¥å™¨èƒ½çŸ¥é“ï¼Œè¦é é“¾æ¥å™¨æŠŠå‡½æ•°è°ƒç”¨å‡ºæ›¿æ¢ä¸ºå‡†ç¡®çš„å‡½æ•°åœ°å€ã€‚ æœ€åä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå°±ç”Ÿæˆäº†ã€‚ linkerä¹Ÿåˆ†ä¸ºinternal linkerå’Œexternal linkerï¼Œæ¶‰åŠåˆ°cgoè°ƒç”¨ã€ç”Ÿæˆå…±äº«åº“ç­‰çš„æ—¶å€™ä¼šä½¿ç”¨external linkerï¼Œå…¶ä»–æƒ…å†µä¼šé»˜è®¤ä½¿ç”¨internal linkerã€‚
å¯ä»¥ç»™linkerä¼ é€’é€‰é¡¹æ¥å‡è½»é“¾æ¥é˜¶æ®µçš„è€—æ—¶ï¼Œå¦‚go build -ldflags=&amp;quot;-w&amp;quot; or go tool link -w æ¥ç¦ç”¨è°ƒè¯•ä¿¡æ¯ç”Ÿæˆï¼Œinternal linkerè¿˜æ”¯æŒå¯¹ç”Ÿæˆçš„è°ƒè¯•ä¿¡æ¯è¿›è¡Œå‹ç¼©ï¼Œå¦‚go build -ldflags=&amp;quot;dwarfcompress=true&amp;quot;ã€‚
goä¹‹å‰æä¾›çš„linkerå®ç°ä¸èƒ½è¯´å®Œç¾å§ï¼Œæ‰€ä»¥ä¹Ÿæœ‰æ„å»ºæ›´å¥½çš„linkerçš„æƒ³æ³•ï¼Œè¯¦æƒ…å¯è§ï¼šhttp://golang.org/s/better-linkerã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-builds-linkers-timeline-b312084ddf7d</description></item><item><title>builds &amp; linker"s timeline</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/builds-linkers-timeline/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/builds-linkers-timeline/</guid><description>Let&amp;rsquo;s Summarize # go buildæ¶‰åŠåˆ°çš„å·¥ä½œæ­¥éª¤åŒ…æ‹¬ï¼š
åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•ï¼› ç¼–è¯‘å„ä¸ªpackageåŠå…¶ä¾èµ–ï¼› é“¾æ¥å™¨è¿æ¥æˆå¯æ‰§è¡Œç¨‹åºï¼› å°†å¯æ‰§è¡Œç¨‹åºç§»åŠ¨åˆ°å½“å‰ç›®å½•ï¼Œå¹¶åˆ é™¤ä¸´æ—¶å·¥ä½œç›®å½•ï¼› go build -xä¼šæ˜¾ç¤ºæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨ç¼–è¯‘é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œç”±äºç¼–è¯‘å¯èƒ½ä¼šæ¶‰åŠåˆ°åº”ç”¨ç¼–è¯‘ç¼“å­˜ï¼Œé“¾æ¥å™¨é“¾æ¥éƒ¨åˆ†çš„è€—æ—¶åˆ™ä¼šå˜å¾—å¾ˆçªå‡ºï¼Œå¦‚ä½•ä¼˜åŒ–é“¾æ¥å™¨æå‡å…¶æ•ˆç‡å°±å˜å¾—å¾ˆé‡è¦ã€‚
linkerçš„ç›®çš„æ˜¯ä¸ºäº†æ„å»ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œå…¶æ­¥éª¤åŒ…æ‹¬ï¼š
åŠ è½½å·²ç»ç¼–è¯‘å¥½çš„å„ä¸ªpackageåŠå…¶ä¾èµ–ï¼Œå¹¶æ”¶é›†å…¶ä¸­çš„ç¬¦å·ä¿¡æ¯ï¼› ç§»é™¤deadcodeï¼Œå¦‚æ‰€æœ‰æœªä½¿ç”¨çš„å‡½æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆï¼Œå› ä¸ºç¼–è¯‘é˜¶æ®µæ˜¯å„ä¸ªpackageç‹¬ç«‹ç¼–è¯‘çš„ï¼Œä¸çŸ¥é“å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œåªæœ‰é“¾æ¥å™¨çŸ¥é“ï¼› DWARFè°ƒè¯•ä¿¡æ¯ç”Ÿæˆï¼Œå¹¶å°†å…¶å‹ç¼©å­˜å‚¨åˆ°äºŒè¿›åˆ¶ç¨‹åºä¸­ï¼› ç»„ç»‡å¥½pc-valueè¡¨ï¼Œfunctionè¡¨ï¼Œç¬¦å·è¡¨ï¼Œæ–¹ä¾¿å†…éƒ¨ä½¿ç”¨ï¼› é‡å®šä½ï¼Œç¼–è¯‘é˜¶æ®µå› ä¸ºæ˜¯ç‹¬ç«‹ç¼–è¯‘å„packageï¼Œå¼•ç”¨çš„å…¶ä»–packageä¸­çš„å‡½æ•°çš„å…·ä½“ä½ç½®æ˜¯ä¸çŸ¥é“çš„ï¼Œåªæœ‰åœ¨æœ€åè¿™ä¸ªé˜¶æ®µé“¾æ¥å™¨èƒ½çŸ¥é“ï¼Œè¦é é“¾æ¥å™¨æŠŠå‡½æ•°è°ƒç”¨å‡ºæ›¿æ¢ä¸ºå‡†ç¡®çš„å‡½æ•°åœ°å€ã€‚ æœ€åä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå°±ç”Ÿæˆäº†ã€‚ linkerä¹Ÿåˆ†ä¸ºinternal linkerå’Œexternal linkerï¼Œæ¶‰åŠåˆ°cgoè°ƒç”¨ã€ç”Ÿæˆå…±äº«åº“ç­‰çš„æ—¶å€™ä¼šä½¿ç”¨external linkerï¼Œå…¶ä»–æƒ…å†µä¼šé»˜è®¤ä½¿ç”¨internal linkerã€‚
å¯ä»¥ç»™linkerä¼ é€’é€‰é¡¹æ¥å‡è½»é“¾æ¥é˜¶æ®µçš„è€—æ—¶ï¼Œå¦‚go build -ldflags=&amp;quot;-w&amp;quot; or go tool link -w æ¥ç¦ç”¨è°ƒè¯•ä¿¡æ¯ç”Ÿæˆï¼Œinternal linkerè¿˜æ”¯æŒå¯¹ç”Ÿæˆçš„è°ƒè¯•ä¿¡æ¯è¿›è¡Œå‹ç¼©ï¼Œå¦‚go build -ldflags=&amp;quot;dwarfcompress=true&amp;quot;ã€‚
goä¹‹å‰æä¾›çš„linkerå®ç°ä¸èƒ½è¯´å®Œç¾å§ï¼Œæ‰€ä»¥ä¹Ÿæœ‰æ„å»ºæ›´å¥½çš„linkerçš„æƒ³æ³•ï¼Œè¯¦æƒ…å¯è§ï¼šhttp://golang.org/s/better-linkerã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-builds-linkers-timeline-b312084ddf7d</description></item><item><title>builds &amp; linker"s timeline</title><link>https://hitzhangjie.pro/go-internals-v2/posts/builds-linkers-timeline/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/builds-linkers-timeline/</guid><description>Let&amp;rsquo;s Summarize # go buildæ¶‰åŠåˆ°çš„å·¥ä½œæ­¥éª¤åŒ…æ‹¬ï¼š
åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•ï¼› ç¼–è¯‘å„ä¸ªpackageåŠå…¶ä¾èµ–ï¼› é“¾æ¥å™¨è¿æ¥æˆå¯æ‰§è¡Œç¨‹åºï¼› å°†å¯æ‰§è¡Œç¨‹åºç§»åŠ¨åˆ°å½“å‰ç›®å½•ï¼Œå¹¶åˆ é™¤ä¸´æ—¶å·¥ä½œç›®å½•ï¼› go build -xä¼šæ˜¾ç¤ºæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨ç¼–è¯‘é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œç”±äºç¼–è¯‘å¯èƒ½ä¼šæ¶‰åŠåˆ°åº”ç”¨ç¼–è¯‘ç¼“å­˜ï¼Œé“¾æ¥å™¨é“¾æ¥éƒ¨åˆ†çš„è€—æ—¶åˆ™ä¼šå˜å¾—å¾ˆçªå‡ºï¼Œå¦‚ä½•ä¼˜åŒ–é“¾æ¥å™¨æå‡å…¶æ•ˆç‡å°±å˜å¾—å¾ˆé‡è¦ã€‚
linkerçš„ç›®çš„æ˜¯ä¸ºäº†æ„å»ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œå…¶æ­¥éª¤åŒ…æ‹¬ï¼š
åŠ è½½å·²ç»ç¼–è¯‘å¥½çš„å„ä¸ªpackageåŠå…¶ä¾èµ–ï¼Œå¹¶æ”¶é›†å…¶ä¸­çš„ç¬¦å·ä¿¡æ¯ï¼› ç§»é™¤deadcodeï¼Œå¦‚æ‰€æœ‰æœªä½¿ç”¨çš„å‡½æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆï¼Œå› ä¸ºç¼–è¯‘é˜¶æ®µæ˜¯å„ä¸ªpackageç‹¬ç«‹ç¼–è¯‘çš„ï¼Œä¸çŸ¥é“å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œåªæœ‰é“¾æ¥å™¨çŸ¥é“ï¼› DWARFè°ƒè¯•ä¿¡æ¯ç”Ÿæˆï¼Œå¹¶å°†å…¶å‹ç¼©å­˜å‚¨åˆ°äºŒè¿›åˆ¶ç¨‹åºä¸­ï¼› ç»„ç»‡å¥½pc-valueè¡¨ï¼Œfunctionè¡¨ï¼Œç¬¦å·è¡¨ï¼Œæ–¹ä¾¿å†…éƒ¨ä½¿ç”¨ï¼› é‡å®šä½ï¼Œç¼–è¯‘é˜¶æ®µå› ä¸ºæ˜¯ç‹¬ç«‹ç¼–è¯‘å„packageï¼Œå¼•ç”¨çš„å…¶ä»–packageä¸­çš„å‡½æ•°çš„å…·ä½“ä½ç½®æ˜¯ä¸çŸ¥é“çš„ï¼Œåªæœ‰åœ¨æœ€åè¿™ä¸ªé˜¶æ®µé“¾æ¥å™¨èƒ½çŸ¥é“ï¼Œè¦é é“¾æ¥å™¨æŠŠå‡½æ•°è°ƒç”¨å‡ºæ›¿æ¢ä¸ºå‡†ç¡®çš„å‡½æ•°åœ°å€ã€‚ æœ€åä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå°±ç”Ÿæˆäº†ã€‚ linkerä¹Ÿåˆ†ä¸ºinternal linkerå’Œexternal linkerï¼Œæ¶‰åŠåˆ°cgoè°ƒç”¨ã€ç”Ÿæˆå…±äº«åº“ç­‰çš„æ—¶å€™ä¼šä½¿ç”¨external linkerï¼Œå…¶ä»–æƒ…å†µä¼šé»˜è®¤ä½¿ç”¨internal linkerã€‚
å¯ä»¥ç»™linkerä¼ é€’é€‰é¡¹æ¥å‡è½»é“¾æ¥é˜¶æ®µçš„è€—æ—¶ï¼Œå¦‚go build -ldflags=&amp;quot;-w&amp;quot; or go tool link -w æ¥ç¦ç”¨è°ƒè¯•ä¿¡æ¯ç”Ÿæˆï¼Œinternal linkerè¿˜æ”¯æŒå¯¹ç”Ÿæˆçš„è°ƒè¯•ä¿¡æ¯è¿›è¡Œå‹ç¼©ï¼Œå¦‚go build -ldflags=&amp;quot;dwarfcompress=true&amp;quot;ã€‚
goä¹‹å‰æä¾›çš„linkerå®ç°ä¸èƒ½è¯´å®Œç¾å§ï¼Œæ‰€ä»¥ä¹Ÿæœ‰æ„å»ºæ›´å¥½çš„linkerçš„æƒ³æ³•ï¼Œè¯¦æƒ…å¯è§ï¼šhttp://golang.org/s/better-linkerã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-builds-linkers-timeline-b312084ddf7d</description></item><item><title>built-in functions optimizations</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/built-in-functions-optimizations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/built-in-functions-optimizations/</guid><description>Let&amp;rsquo;s Summarize # lenã€capå‡½æ•° sliceå¯¹åº”çš„lenã€capæ“ä½œï¼Œå…¶å®æ˜¯æ²¡æœ‰å¯¹åº”çš„å‡½æ•°ä½“å®ç°çš„ã€‚ç¼–è¯‘å™¨ä¼šè·Ÿè¸ªå¯¹sliceçš„æ“ä½œï¼Œä»è€Œèƒ½å¤Ÿç›´æ¥è·å–åˆ°å…¶lenã€capã€‚å¦‚æœæ˜¯sliceä½œä¸ºå‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æ ¹æ®å†…å­˜ä¸­sliceheaderçš„å­—æ®µlenã€capå­—æ®µæ¥è·å–ï¼›
unsafe.Sizeof\Alignof\Offsetof è¿™å‡ ä¸ªå‡½æ•°ä¹Ÿæ²¡æœ‰å¯¹åº”çš„å‡½æ•°ä½“å®ç°ï¼ŒSizeofè¿”å›çš„æ˜¯æè¿°ç¬¦çš„å¤§å°ï¼Œå¦‚sliceheaderçš„å¤§å°è€Œéå ç”¨çš„æ‰€æœ‰å†…å­˜å¤§å°ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æ˜¯å¯ä»¥ç›´æ¥çŸ¥é“å¤§å°çš„ï¼ŒåŒ…æ‹¬å…¶å¯¹é½æ–¹å¼ã€å†…éƒ¨å­—æ®µçš„åç§»é‡ï¼›
Source Analysis # ç³»ç»Ÿå†…ç½®å‡½æ•°æœ‰ä¸å°‘éƒ½æ˜¯ç¼–è¯‘å™¨å±‚é¢å®ç°çš„ï¼Œbuiltin.goä¸­åªæ˜¯æ·»åŠ ä¸€äº›godocæ³¨é‡Šï¼Œæ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ï¼š https://sourcegraph.com/github.com/golang/go@f24eac47710b0170fd45611ab1867e87701e0a95/-/blob/src/builtin/builtin.go#L6ã€‚
çœŸæ­£çš„å®ç°è¦çœ‹ç¼–è¯‘å™¨é‡Œé¢çš„æ“ä½œï¼Œä¸‹é¢ä»¥capä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚ç¼–è¯‘å™¨ä¼šå°†æºä»£ç è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼Œæœ€ç»ˆç”ŸæˆASTï¼ŒASTä¸­æ¯ä¸ªèŠ‚ç‚¹Nodeä»£è¡¨äº†æºç ä¸­çš„æŸç§ç¨‹åºæ„é€ ï¼Œæ¯”å¦‚cap(x)è¿™é‡Œçš„capå‡½æ•°å¯¹åº”çš„æ˜¯èŠ‚ç‚¹ç±»å‹OpSliceCapï¼Œç¼–è¯‘å™¨å¤„ç†çš„æ—¶å€™ä¼šå°†å…¶è½¬æ¢ä¸ºOpCopy capï¼Œcapå–è‡ªSliceMake ptr len capä¸­çš„capï¼Œè¿˜æœ‰lenã€copyç­‰å‡½æ•°éƒ½æ˜¯æŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼æ¥å®ç°çš„ã€‚
References # https://medium.com/a-journey-with-go/go-built-in-functions-optimizations-70c5abb3a680</description></item><item><title>built-in functions optimizations</title><link>https://hitzhangjie.pro/go-internals-v2/posts/built-in-functions-optimizations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/built-in-functions-optimizations/</guid><description>Let&amp;rsquo;s Summarize # lenã€capå‡½æ•° sliceå¯¹åº”çš„lenã€capæ“ä½œï¼Œå…¶å®æ˜¯æ²¡æœ‰å¯¹åº”çš„å‡½æ•°ä½“å®ç°çš„ã€‚ç¼–è¯‘å™¨ä¼šè·Ÿè¸ªå¯¹sliceçš„æ“ä½œï¼Œä»è€Œèƒ½å¤Ÿç›´æ¥è·å–åˆ°å…¶lenã€capã€‚å¦‚æœæ˜¯sliceä½œä¸ºå‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æ ¹æ®å†…å­˜ä¸­sliceheaderçš„å­—æ®µlenã€capå­—æ®µæ¥è·å–ï¼›
unsafe.Sizeof\Alignof\Offsetof è¿™å‡ ä¸ªå‡½æ•°ä¹Ÿæ²¡æœ‰å¯¹åº”çš„å‡½æ•°ä½“å®ç°ï¼ŒSizeofè¿”å›çš„æ˜¯æè¿°ç¬¦çš„å¤§å°ï¼Œå¦‚sliceheaderçš„å¤§å°è€Œéå ç”¨çš„æ‰€æœ‰å†…å­˜å¤§å°ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æ˜¯å¯ä»¥ç›´æ¥çŸ¥é“å¤§å°çš„ï¼ŒåŒ…æ‹¬å…¶å¯¹é½æ–¹å¼ã€å†…éƒ¨å­—æ®µçš„åç§»é‡ï¼›
Source Analysis # ç³»ç»Ÿå†…ç½®å‡½æ•°æœ‰ä¸å°‘éƒ½æ˜¯ç¼–è¯‘å™¨å±‚é¢å®ç°çš„ï¼Œbuiltin.goä¸­åªæ˜¯æ·»åŠ ä¸€äº›godocæ³¨é‡Šï¼Œæ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ï¼š https://sourcegraph.com/github.com/golang/go@f24eac47710b0170fd45611ab1867e87701e0a95/-/blob/src/builtin/builtin.go#L6ã€‚
çœŸæ­£çš„å®ç°è¦çœ‹ç¼–è¯‘å™¨é‡Œé¢çš„æ“ä½œï¼Œä¸‹é¢ä»¥capä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚ç¼–è¯‘å™¨ä¼šå°†æºä»£ç è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼Œæœ€ç»ˆç”ŸæˆASTï¼ŒASTä¸­æ¯ä¸ªèŠ‚ç‚¹Nodeä»£è¡¨äº†æºç ä¸­çš„æŸç§ç¨‹åºæ„é€ ï¼Œæ¯”å¦‚cap(x)è¿™é‡Œçš„capå‡½æ•°å¯¹åº”çš„æ˜¯èŠ‚ç‚¹ç±»å‹OpSliceCapï¼Œç¼–è¯‘å™¨å¤„ç†çš„æ—¶å€™ä¼šå°†å…¶è½¬æ¢ä¸ºOpCopy capï¼Œcapå–è‡ªSliceMake ptr len capä¸­çš„capï¼Œè¿˜æœ‰lenã€copyç­‰å‡½æ•°éƒ½æ˜¯æŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼æ¥å®ç°çš„ã€‚
References # https://medium.com/a-journey-with-go/go-built-in-functions-optimizations-70c5abb3a680</description></item><item><title>concurrency &amp; scheduler affinity</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/concurrency-scheduler-affinity/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/concurrency-scheduler-affinity/</guid><description>Let&amp;rsquo;s Summarize # GMæ¨¡å‹
go1.1ä¹‹å‰çš„è°ƒåº¦æ¨¡å‹æ˜¯GMæ¨¡å‹ï¼Œæœ‰ä¸€ä¸ªå…¨å±€goroutineé˜Ÿåˆ—global queueï¼Œå®ƒçš„é—®é¢˜æ˜¯ï¼š
è®¿é—®global queueä¸­çš„gï¼Œéœ€è¦é€šè¿‡ä¸€ä¸ªå…¨å±€é”ï¼Œé”ç²’åº¦å¤§ï¼Œé”ç«äº‰ä¸¥é‡ï¼› global queueä¸­çš„gè¢«æ¢å¤æ‰§è¡Œåï¼Œä¸ä¸€å®šåœ¨åŸæ¥çš„çº¿ç¨‹ä¸Šæ¢å¤ï¼Œä¹Ÿä¸ä¸€å®šåœ¨åŸæ¥çš„æ ¸ä¸Šæ‰§è¡Œï¼Œcacheå‘½ä¸­ç‡ä½ï¼› GMPæ¨¡å‹
go1.1å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„è°ƒåº¦å™¨å®ç°GMPæ¨¡å‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªå±€éƒ¨çš„local queueï¼Œè¿™ä¸ªæ”¹è¿›èƒ½å¤Ÿåœ¨P local queueæœ‰gæ—¶é¿å…å»é”å®šglobal queueï¼Œä¹Ÿå°±å‡å°‘äº†é”å®šäº†æ•´ä¸ªschedulerçš„æƒ…å†µã€‚
goroutineè°ƒåº¦ç²˜æ€§
ç ´åäº†è°ƒåº¦ç²˜æ€§
å› ä¸ºå¼•å…¥äº†Pï¼ŒMä¼šä¼˜å…ˆæ‰§è¡ŒPä¸‹çš„local queueä¸­çš„gï¼Œgè°ƒåº¦åˆ°å“ªä¸ªmæ‰§è¡Œå°±æœ‰äº†ä¸€å®šçš„è°ƒåº¦ç²˜æ€§ï¼ˆaffinityï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªè°ƒåº¦ç²˜æ€§ä¹Ÿä¼šåœ¨æŸå‡ ç§æƒ…å†µä¸‹è¢«æ‰“ç ´ï¼Œæ¯”å¦‚ï¼š
GMPæ˜¯ä¸€ä¸ªwork-stealingè°ƒåº¦å™¨ï¼Œmä¼šåœ¨æœ¬åœ°P local queueç©ºæ—¶ï¼Œå°è¯•ä»å…¶ä»–åœ°æ–¹è·å–ä¸€éƒ¨åˆ†gæ¥è¿è¡Œï¼Œæ¯”å¦‚ä»global queueï¼Œè¿™é‡Œæ²¡æœ‰çš„è¯è¿˜ä¼šä»netpollerä¸­è·å–ç½‘ç»œIOäº‹ä»¶å°±ç»ªçš„gï¼Œå†æ²¡æœ‰å°±ä»å…¶ä»–Pçš„local queueä¸­è·å–ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·ç›¸å½“äºå…¶ä»–Pçš„gæ²¡æœ‰åœ¨åŸæ¥På…³è”çš„Mä¸Šæ‰§è¡Œï¼Œæ‰“ç ´äº†è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼›
ç³»ç»Ÿè°ƒç”¨ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‘ç”Ÿæ—¶ï¼ˆæ–‡ä»¶æ“ä½œã€httpè°ƒç”¨ã€æ•°æ®åº“æ“ä½œç­‰ï¼‰ï¼Œgoä¼šå°†å½“å‰æ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ç»™æŒ‚èµ·ï¼ˆä¸å¯ä¸­æ–­ç­‰å¾…çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹Mæ¥å¤„ç†è¿™ä¸ªPä¸Šçš„local queueä¸­çš„gï¼Œåç»­æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„çº¿ç¨‹æ¢å¤åæœ‰å¯èƒ½ä¼šå»å¤„ç†å…¶ä»–Pä¸Šçš„gï¼Œè¿™ä¹Ÿæ‰“ç ´äº†è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼›
ä¿æŠ¤è°ƒåº¦ç²˜æ€§
ä¸ºäº†å‡å°‘æ‰“ç ´è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼Œè¿™ä¸¤ä¸ªé™åˆ¶å¯ä»¥å°½å¯èƒ½å»é¿å…ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½ã€‚
gã€mä¹‹é—´çš„ç²˜æ€§ï¼Œmã€pä¹‹é—´çš„ç²˜æ€§ï¼Œè¯´ç™½äº†éƒ½è·Ÿè¿è¡Œæ—¶ä¾èµ–çš„ç¼“å­˜æ•°æ®æœ‰å…³ç³»ï¼Œå¦‚æœæ‰“ç ´äº†ç²˜æ€§ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ï¼Œæ€§èƒ½å°±ä¼šå—å½±å“ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚æ‰€ä»¥goä¸­ä¹Ÿé’ˆå¯¹ä¸Šè¿°é—®é¢˜åšäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚ä¸€ä¸ªé™·å…¥é˜»å¡ç³»ç»Ÿè°ƒç”¨çš„mæ¢å¤æ‰§è¡Œåå¯ä»¥é€šè¿‡stealæˆ–è€…retakeçš„æ–¹å¼æ¥äº‰å–è·å–åŸæ¥çš„Pï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŠæ³•å§ï¼Œè¿™éƒ¨åˆ†äº†è§£å°±å¯ä»¥äº†ã€‚
å¯¹äºchan send/recvå¼•èµ·çš„goroutineé˜»å¡æ¢å¤é—®é¢˜ï¼Œå¦‚æœgoroutineæ¢å¤åæ’åœ¨Pçš„local queueçš„æœ«å°¾ï¼Œå¦‚æœå‰é¢æœ‰å…¶ä»–goroutineæ‰§è¡Œï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡è¿™ä¸ªgoroutineä¼šè¢«å…¶ä»–çš„Pä¸Šçš„Må·èµ°ï¼Œé‚£ä¹ˆå½“å‰è¿™ä¸ªgå°±è¦å’Œä¹‹å‰çš„Mã€Pè„±ç¦»å…³ç³»äº†ï¼Œä¸€äº›ç¼“å­˜æ•°æ®å°±æ— æ³•å¤ç”¨äº†ï¼Œä¸ºäº†å‡å°‘æ‰“ç ´è¿™é‡Œçš„ç²˜æ€§ï¼Œèµ‹äºˆäº†chané˜»å¡æ¢å¤çš„gæ›´å¤§çš„è°ƒåº¦ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚ä¸å°†å…¶æ”¾åˆ°Pçš„local queueï¼Œè€Œæ˜¯å°†å…¶æ”¾åˆ°Pçš„runnextä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡å°±å¯ä»¥ç«‹å³æ‰§è¡Œäº†ã€‚
è°ƒåº¦ç²˜æ€§çš„ä¼˜åŠ¿
pä¸Šæœ‰mcacheã€gFreeï¼Œmä¸Šæœ‰tlsï¼Œmè¿è¡Œgç”³è¯·å°äº32Kçš„å†…å­˜æ˜¯ä»p.mcacheä¸­åˆ†é…ï¼Œç»´æŒgã€mã€pä¹‹é—´çš„å…³ç³»æœ‰åŠ©äºå¤ç”¨ä¹‹å‰pä¸Šå»ºç«‹çš„mcacheï¼Œä¹Ÿæœ‰åŠ©äºmåˆ›å»ºæ–°çš„gæ—¶å¤ç”¨pä¸Šä¹‹å‰ç»´æŠ¤çš„ç©ºé—²gåˆ—è¡¨ã€‚
å½“ç„¶å¯èƒ½è¿˜æœ‰ä¸€äº›å…¶ä»–çš„åŸå› ï¼Œè¿™é‡Œæš‚æ—¶å…ˆä¸å±•å¼€äº†ï¼Œæƒ³å…¨äº†å†å±•å¼€ã€‚TODO
seeï¼šhttps://sourcegraph.com/github.com/golang/go/-/blob/src/runtime/runtime2.go#L613
Source Analysis # References # https://medium.com/a-journey-with-go/go-concurrency-scheduler-affinity-3b678f490488</description></item><item><title>concurrency &amp; scheduler affinity</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/concurrency-scheduler-affinity/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/concurrency-scheduler-affinity/</guid><description>Let&amp;rsquo;s Summarize # GMæ¨¡å‹
go1.1ä¹‹å‰çš„è°ƒåº¦æ¨¡å‹æ˜¯GMæ¨¡å‹ï¼Œæœ‰ä¸€ä¸ªå…¨å±€goroutineé˜Ÿåˆ—global queueï¼Œå®ƒçš„é—®é¢˜æ˜¯ï¼š
è®¿é—®global queueä¸­çš„gï¼Œéœ€è¦é€šè¿‡ä¸€ä¸ªå…¨å±€é”ï¼Œé”ç²’åº¦å¤§ï¼Œé”ç«äº‰ä¸¥é‡ï¼› global queueä¸­çš„gè¢«æ¢å¤æ‰§è¡Œåï¼Œä¸ä¸€å®šåœ¨åŸæ¥çš„çº¿ç¨‹ä¸Šæ¢å¤ï¼Œä¹Ÿä¸ä¸€å®šåœ¨åŸæ¥çš„æ ¸ä¸Šæ‰§è¡Œï¼Œcacheå‘½ä¸­ç‡ä½ï¼› GMPæ¨¡å‹
go1.1å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„è°ƒåº¦å™¨å®ç°GMPæ¨¡å‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªå±€éƒ¨çš„local queueï¼Œè¿™ä¸ªæ”¹è¿›èƒ½å¤Ÿåœ¨P local queueæœ‰gæ—¶é¿å…å»é”å®šglobal queueï¼Œä¹Ÿå°±å‡å°‘äº†é”å®šäº†æ•´ä¸ªschedulerçš„æƒ…å†µã€‚
goroutineè°ƒåº¦ç²˜æ€§
ç ´åäº†è°ƒåº¦ç²˜æ€§
å› ä¸ºå¼•å…¥äº†Pï¼ŒMä¼šä¼˜å…ˆæ‰§è¡ŒPä¸‹çš„local queueä¸­çš„gï¼Œgè°ƒåº¦åˆ°å“ªä¸ªmæ‰§è¡Œå°±æœ‰äº†ä¸€å®šçš„è°ƒåº¦ç²˜æ€§ï¼ˆaffinityï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªè°ƒåº¦ç²˜æ€§ä¹Ÿä¼šåœ¨æŸå‡ ç§æƒ…å†µä¸‹è¢«æ‰“ç ´ï¼Œæ¯”å¦‚ï¼š
GMPæ˜¯ä¸€ä¸ªwork-stealingè°ƒåº¦å™¨ï¼Œmä¼šåœ¨æœ¬åœ°P local queueç©ºæ—¶ï¼Œå°è¯•ä»å…¶ä»–åœ°æ–¹è·å–ä¸€éƒ¨åˆ†gæ¥è¿è¡Œï¼Œæ¯”å¦‚ä»global queueï¼Œè¿™é‡Œæ²¡æœ‰çš„è¯è¿˜ä¼šä»netpollerä¸­è·å–ç½‘ç»œIOäº‹ä»¶å°±ç»ªçš„gï¼Œå†æ²¡æœ‰å°±ä»å…¶ä»–Pçš„local queueä¸­è·å–ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·ç›¸å½“äºå…¶ä»–Pçš„gæ²¡æœ‰åœ¨åŸæ¥På…³è”çš„Mä¸Šæ‰§è¡Œï¼Œæ‰“ç ´äº†è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼›
ç³»ç»Ÿè°ƒç”¨ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‘ç”Ÿæ—¶ï¼ˆæ–‡ä»¶æ“ä½œã€httpè°ƒç”¨ã€æ•°æ®åº“æ“ä½œç­‰ï¼‰ï¼Œgoä¼šå°†å½“å‰æ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ç»™æŒ‚èµ·ï¼ˆä¸å¯ä¸­æ–­ç­‰å¾…çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹Mæ¥å¤„ç†è¿™ä¸ªPä¸Šçš„local queueä¸­çš„gï¼Œåç»­æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„çº¿ç¨‹æ¢å¤åæœ‰å¯èƒ½ä¼šå»å¤„ç†å…¶ä»–Pä¸Šçš„gï¼Œè¿™ä¹Ÿæ‰“ç ´äº†è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼›
ä¿æŠ¤è°ƒåº¦ç²˜æ€§
ä¸ºäº†å‡å°‘æ‰“ç ´è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼Œè¿™ä¸¤ä¸ªé™åˆ¶å¯ä»¥å°½å¯èƒ½å»é¿å…ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½ã€‚
gã€mä¹‹é—´çš„ç²˜æ€§ï¼Œmã€pä¹‹é—´çš„ç²˜æ€§ï¼Œè¯´ç™½äº†éƒ½è·Ÿè¿è¡Œæ—¶ä¾èµ–çš„ç¼“å­˜æ•°æ®æœ‰å…³ç³»ï¼Œå¦‚æœæ‰“ç ´äº†ç²˜æ€§ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ï¼Œæ€§èƒ½å°±ä¼šå—å½±å“ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚æ‰€ä»¥goä¸­ä¹Ÿé’ˆå¯¹ä¸Šè¿°é—®é¢˜åšäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚ä¸€ä¸ªé™·å…¥é˜»å¡ç³»ç»Ÿè°ƒç”¨çš„mæ¢å¤æ‰§è¡Œåå¯ä»¥é€šè¿‡stealæˆ–è€…retakeçš„æ–¹å¼æ¥äº‰å–è·å–åŸæ¥çš„Pï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŠæ³•å§ï¼Œè¿™éƒ¨åˆ†äº†è§£å°±å¯ä»¥äº†ã€‚
å¯¹äºchan send/recvå¼•èµ·çš„goroutineé˜»å¡æ¢å¤é—®é¢˜ï¼Œå¦‚æœgoroutineæ¢å¤åæ’åœ¨Pçš„local queueçš„æœ«å°¾ï¼Œå¦‚æœå‰é¢æœ‰å…¶ä»–goroutineæ‰§è¡Œï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡è¿™ä¸ªgoroutineä¼šè¢«å…¶ä»–çš„Pä¸Šçš„Må·èµ°ï¼Œé‚£ä¹ˆå½“å‰è¿™ä¸ªgå°±è¦å’Œä¹‹å‰çš„Mã€Pè„±ç¦»å…³ç³»äº†ï¼Œä¸€äº›ç¼“å­˜æ•°æ®å°±æ— æ³•å¤ç”¨äº†ï¼Œä¸ºäº†å‡å°‘æ‰“ç ´è¿™é‡Œçš„ç²˜æ€§ï¼Œèµ‹äºˆäº†chané˜»å¡æ¢å¤çš„gæ›´å¤§çš„è°ƒåº¦ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚ä¸å°†å…¶æ”¾åˆ°Pçš„local queueï¼Œè€Œæ˜¯å°†å…¶æ”¾åˆ°Pçš„runnextä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡å°±å¯ä»¥ç«‹å³æ‰§è¡Œäº†ã€‚
è°ƒåº¦ç²˜æ€§çš„ä¼˜åŠ¿
pä¸Šæœ‰mcacheã€gFreeï¼Œmä¸Šæœ‰tlsï¼Œmè¿è¡Œgç”³è¯·å°äº32Kçš„å†…å­˜æ˜¯ä»p.mcacheä¸­åˆ†é…ï¼Œç»´æŒgã€mã€pä¹‹é—´çš„å…³ç³»æœ‰åŠ©äºå¤ç”¨ä¹‹å‰pä¸Šå»ºç«‹çš„mcacheï¼Œä¹Ÿæœ‰åŠ©äºmåˆ›å»ºæ–°çš„gæ—¶å¤ç”¨pä¸Šä¹‹å‰ç»´æŠ¤çš„ç©ºé—²gåˆ—è¡¨ã€‚
å½“ç„¶å¯èƒ½è¿˜æœ‰ä¸€äº›å…¶ä»–çš„åŸå› ï¼Œè¿™é‡Œæš‚æ—¶å…ˆä¸å±•å¼€äº†ï¼Œæƒ³å…¨äº†å†å±•å¼€ã€‚TODO
seeï¼šhttps://sourcegraph.com/github.com/golang/go/-/blob/src/runtime/runtime2.go#L613
Source Analysis # References # https://medium.com/a-journey-with-go/go-concurrency-scheduler-affinity-3b678f490488</description></item><item><title>concurrency &amp; scheduler affinity</title><link>https://hitzhangjie.pro/go-internals-v2/posts/concurrency-scheduler-affinity/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/concurrency-scheduler-affinity/</guid><description>Let&amp;rsquo;s Summarize # GMæ¨¡å‹
go1.1ä¹‹å‰çš„è°ƒåº¦æ¨¡å‹æ˜¯GMæ¨¡å‹ï¼Œæœ‰ä¸€ä¸ªå…¨å±€goroutineé˜Ÿåˆ—global queueï¼Œå®ƒçš„é—®é¢˜æ˜¯ï¼š
è®¿é—®global queueä¸­çš„gï¼Œéœ€è¦é€šè¿‡ä¸€ä¸ªå…¨å±€é”ï¼Œé”ç²’åº¦å¤§ï¼Œé”ç«äº‰ä¸¥é‡ï¼› global queueä¸­çš„gè¢«æ¢å¤æ‰§è¡Œåï¼Œä¸ä¸€å®šåœ¨åŸæ¥çš„çº¿ç¨‹ä¸Šæ¢å¤ï¼Œä¹Ÿä¸ä¸€å®šåœ¨åŸæ¥çš„æ ¸ä¸Šæ‰§è¡Œï¼Œcacheå‘½ä¸­ç‡ä½ï¼› GMPæ¨¡å‹
go1.1å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„è°ƒåº¦å™¨å®ç°GMPæ¨¡å‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªå±€éƒ¨çš„local queueï¼Œè¿™ä¸ªæ”¹è¿›èƒ½å¤Ÿåœ¨P local queueæœ‰gæ—¶é¿å…å»é”å®šglobal queueï¼Œä¹Ÿå°±å‡å°‘äº†é”å®šäº†æ•´ä¸ªschedulerçš„æƒ…å†µã€‚
goroutineè°ƒåº¦ç²˜æ€§
ç ´åäº†è°ƒåº¦ç²˜æ€§
å› ä¸ºå¼•å…¥äº†Pï¼ŒMä¼šä¼˜å…ˆæ‰§è¡ŒPä¸‹çš„local queueä¸­çš„gï¼Œgè°ƒåº¦åˆ°å“ªä¸ªmæ‰§è¡Œå°±æœ‰äº†ä¸€å®šçš„è°ƒåº¦ç²˜æ€§ï¼ˆaffinityï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªè°ƒåº¦ç²˜æ€§ä¹Ÿä¼šåœ¨æŸå‡ ç§æƒ…å†µä¸‹è¢«æ‰“ç ´ï¼Œæ¯”å¦‚ï¼š
GMPæ˜¯ä¸€ä¸ªwork-stealingè°ƒåº¦å™¨ï¼Œmä¼šåœ¨æœ¬åœ°P local queueç©ºæ—¶ï¼Œå°è¯•ä»å…¶ä»–åœ°æ–¹è·å–ä¸€éƒ¨åˆ†gæ¥è¿è¡Œï¼Œæ¯”å¦‚ä»global queueï¼Œè¿™é‡Œæ²¡æœ‰çš„è¯è¿˜ä¼šä»netpollerä¸­è·å–ç½‘ç»œIOäº‹ä»¶å°±ç»ªçš„gï¼Œå†æ²¡æœ‰å°±ä»å…¶ä»–Pçš„local queueä¸­è·å–ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·ç›¸å½“äºå…¶ä»–Pçš„gæ²¡æœ‰åœ¨åŸæ¥På…³è”çš„Mä¸Šæ‰§è¡Œï¼Œæ‰“ç ´äº†è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼›
ç³»ç»Ÿè°ƒç”¨ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‘ç”Ÿæ—¶ï¼ˆæ–‡ä»¶æ“ä½œã€httpè°ƒç”¨ã€æ•°æ®åº“æ“ä½œç­‰ï¼‰ï¼Œgoä¼šå°†å½“å‰æ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ç»™æŒ‚èµ·ï¼ˆä¸å¯ä¸­æ–­ç­‰å¾…çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹Mæ¥å¤„ç†è¿™ä¸ªPä¸Šçš„local queueä¸­çš„gï¼Œåç»­æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„çº¿ç¨‹æ¢å¤åæœ‰å¯èƒ½ä¼šå»å¤„ç†å…¶ä»–Pä¸Šçš„gï¼Œè¿™ä¹Ÿæ‰“ç ´äº†è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼›
ä¿æŠ¤è°ƒåº¦ç²˜æ€§
ä¸ºäº†å‡å°‘æ‰“ç ´è¿™é‡Œçš„è°ƒåº¦ç²˜æ€§ï¼Œè¿™ä¸¤ä¸ªé™åˆ¶å¯ä»¥å°½å¯èƒ½å»é¿å…ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½ã€‚
gã€mä¹‹é—´çš„ç²˜æ€§ï¼Œmã€pä¹‹é—´çš„ç²˜æ€§ï¼Œè¯´ç™½äº†éƒ½è·Ÿè¿è¡Œæ—¶ä¾èµ–çš„ç¼“å­˜æ•°æ®æœ‰å…³ç³»ï¼Œå¦‚æœæ‰“ç ´äº†ç²˜æ€§ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ï¼Œæ€§èƒ½å°±ä¼šå—å½±å“ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚æ‰€ä»¥goä¸­ä¹Ÿé’ˆå¯¹ä¸Šè¿°é—®é¢˜åšäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚ä¸€ä¸ªé™·å…¥é˜»å¡ç³»ç»Ÿè°ƒç”¨çš„mæ¢å¤æ‰§è¡Œåå¯ä»¥é€šè¿‡stealæˆ–è€…retakeçš„æ–¹å¼æ¥äº‰å–è·å–åŸæ¥çš„Pï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŠæ³•å§ï¼Œè¿™éƒ¨åˆ†äº†è§£å°±å¯ä»¥äº†ã€‚
å¯¹äºchan send/recvå¼•èµ·çš„goroutineé˜»å¡æ¢å¤é—®é¢˜ï¼Œå¦‚æœgoroutineæ¢å¤åæ’åœ¨Pçš„local queueçš„æœ«å°¾ï¼Œå¦‚æœå‰é¢æœ‰å…¶ä»–goroutineæ‰§è¡Œï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡è¿™ä¸ªgoroutineä¼šè¢«å…¶ä»–çš„Pä¸Šçš„Må·èµ°ï¼Œé‚£ä¹ˆå½“å‰è¿™ä¸ªgå°±è¦å’Œä¹‹å‰çš„Mã€Pè„±ç¦»å…³ç³»äº†ï¼Œä¸€äº›ç¼“å­˜æ•°æ®å°±æ— æ³•å¤ç”¨äº†ï¼Œä¸ºäº†å‡å°‘æ‰“ç ´è¿™é‡Œçš„ç²˜æ€§ï¼Œèµ‹äºˆäº†chané˜»å¡æ¢å¤çš„gæ›´å¤§çš„è°ƒåº¦ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚ä¸å°†å…¶æ”¾åˆ°Pçš„local queueï¼Œè€Œæ˜¯å°†å…¶æ”¾åˆ°Pçš„runnextä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡å°±å¯ä»¥ç«‹å³æ‰§è¡Œäº†ã€‚
è°ƒåº¦ç²˜æ€§çš„ä¼˜åŠ¿
pä¸Šæœ‰mcacheã€gFreeï¼Œmä¸Šæœ‰tlsï¼Œmè¿è¡Œgç”³è¯·å°äº32Kçš„å†…å­˜æ˜¯ä»p.mcacheä¸­åˆ†é…ï¼Œç»´æŒgã€mã€pä¹‹é—´çš„å…³ç³»æœ‰åŠ©äºå¤ç”¨ä¹‹å‰pä¸Šå»ºç«‹çš„mcacheï¼Œä¹Ÿæœ‰åŠ©äºmåˆ›å»ºæ–°çš„gæ—¶å¤ç”¨pä¸Šä¹‹å‰ç»´æŠ¤çš„ç©ºé—²gåˆ—è¡¨ã€‚
å½“ç„¶å¯èƒ½è¿˜æœ‰ä¸€äº›å…¶ä»–çš„åŸå› ï¼Œè¿™é‡Œæš‚æ—¶å…ˆä¸å±•å¼€äº†ï¼Œæƒ³å…¨äº†å†å±•å¼€ã€‚TODO
seeï¼šhttps://sourcegraph.com/github.com/golang/go/-/blob/src/runtime/runtime2.go#L613
Source Analysis # References # https://medium.com/a-journey-with-go/go-concurrency-scheduler-affinity-3b678f490488</description></item><item><title>concurrent access with maps - part 3</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/concurrent-access-with-maps-part-3/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/concurrent-access-with-maps-part-3/</guid><description>Let&amp;rsquo;s Summarize # 1 map
mapä¸­çš„å¹¶å‘è¯»å†™é—®é¢˜ï¼Œgoæä¾›äº†å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ£€æŸ¥ï¼š
data race detectionï¼šé€šè¿‡é€‰é¡¹-raceæ¥æ£€æµ‹æ˜¯å¦å­˜åœ¨data raceï¼Œå…³äºdata raceæ£€æµ‹çš„é—®é¢˜ï¼Œkavya joshiçš„åˆ†äº«é‡Œæœ‰ä»‹ç»ï¼›
å¹¶å‘å†™æ“ä½œæ£€æµ‹ï¼šmapå¯¹åº”çš„æ•°æ®ç»“æ„hmapä¸­æœ‰ä¸ªå­—æ®µflagsæ¥è®°å½•å½“å‰çš„mapæ“ä½œï¼Œæ¯”å¦‚å½“å‰æ‰§è¡Œm[1]=1ï¼Œæ˜¯ä¸€ä¸ªkvçš„èµ‹å€¼ï¼Œå¯¹åº”çš„å‡½æ•°æ˜¯mapassign_fast64ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯delete(m, 1)ï¼Œå¯¹åº”çš„å‡½æ•°æ˜¯mapdelete_fast64ï¼Œè¿™é‡Œçš„mapä¿®æ”¹æ“ä½œå¯¹åº”çš„å‡½æ•°å†…éƒ¨ä¼šå°†hmap.flags^=hashWritingï¼Œå¦‚æœå·²ç»æœ‰ä¸€ä¸ªå†™æ“ä½œåœ¨æ‰§è¡Œï¼Œåé¢åˆæœ‰ä¸€ä¸ªå†™æ“ä½œæ‰§è¡Œï¼Œåé¢çš„å†™æ“ä½œå°±æœ‰å¾ˆå¤§æ¦‚ç‡æ£€æµ‹åˆ°flagsçš„hashWritingä½è¢«è®¾ç½®äº†ï¼Œæ­¤æ—¶å°±ä¼šæŠ›å‡ºé”™è¯¯â€œconcurrent map writesâ€é”™è¯¯ï¼›
å…³äºmapä¸ºä»€ä¹ˆä¸ç›´æ¥æä¾›å¹¶å‘å®‰å…¨çš„ç‰ˆæœ¬ï¼ŒåŸå› ä¹Ÿç®€å•ã€‚å¹¶å‘å®‰å…¨çš„ç‰ˆæœ¬æ˜¯æœ‰åŒæ­¥å¼€é”€çš„ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™å¹¶ä¸éœ€è¦å¹¶å‘å®‰å…¨çš„ç‰ˆæœ¬ï¼Œå¦‚æœé»˜è®¤å®ç°æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œæ€§èƒ½ä¸Šå°±è¦å¤§æ‰“æŠ˜æ‰£äº†ã€‚ä¸è€ƒè™‘å¹¶å‘å®‰å…¨é—®é¢˜çš„è¯ï¼Œmapæ¯”sync.Mapè¦å¿«7~10å€ã€‚
2 sync.Map
sync.Mapæ˜¯å¹¶å‘å®‰å…¨çš„å®ç°ï¼Œå®ƒå¯¹æŸäº›åœºæ™¯ä¸‹çš„å¹¶å‘è¯»å†™åšäº†æ€§èƒ½æ–¹é¢çš„ä¼˜åŒ–ï¼š goblogs: &amp;ldquo;The Map type is optimized for two common use cases: (1) when the entry for a given key is only ever written once but read many times, as in caches that only grow, (2) when multiple goroutines read, write and overwrite entries for disjoint sets of keys.</description></item><item><title>concurrent access with maps - part 3</title><link>https://hitzhangjie.pro/go-internals-v2/posts/concurrent-access-with-maps-part-3/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/concurrent-access-with-maps-part-3/</guid><description>Let&amp;rsquo;s Summarize # 1 map
mapä¸­çš„å¹¶å‘è¯»å†™é—®é¢˜ï¼Œgoæä¾›äº†å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ£€æŸ¥ï¼š
data race detectionï¼šé€šè¿‡é€‰é¡¹-raceæ¥æ£€æµ‹æ˜¯å¦å­˜åœ¨data raceï¼Œå…³äºdata raceæ£€æµ‹çš„é—®é¢˜ï¼Œkavya joshiçš„åˆ†äº«é‡Œæœ‰ä»‹ç»ï¼›
å¹¶å‘å†™æ“ä½œæ£€æµ‹ï¼šmapå¯¹åº”çš„æ•°æ®ç»“æ„hmapä¸­æœ‰ä¸ªå­—æ®µflagsæ¥è®°å½•å½“å‰çš„mapæ“ä½œï¼Œæ¯”å¦‚å½“å‰æ‰§è¡Œm[1]=1ï¼Œæ˜¯ä¸€ä¸ªkvçš„èµ‹å€¼ï¼Œå¯¹åº”çš„å‡½æ•°æ˜¯mapassign_fast64ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯delete(m, 1)ï¼Œå¯¹åº”çš„å‡½æ•°æ˜¯mapdelete_fast64ï¼Œè¿™é‡Œçš„mapä¿®æ”¹æ“ä½œå¯¹åº”çš„å‡½æ•°å†…éƒ¨ä¼šå°†hmap.flags^=hashWritingï¼Œå¦‚æœå·²ç»æœ‰ä¸€ä¸ªå†™æ“ä½œåœ¨æ‰§è¡Œï¼Œåé¢åˆæœ‰ä¸€ä¸ªå†™æ“ä½œæ‰§è¡Œï¼Œåé¢çš„å†™æ“ä½œå°±æœ‰å¾ˆå¤§æ¦‚ç‡æ£€æµ‹åˆ°flagsçš„hashWritingä½è¢«è®¾ç½®äº†ï¼Œæ­¤æ—¶å°±ä¼šæŠ›å‡ºé”™è¯¯â€œconcurrent map writesâ€é”™è¯¯ï¼›
å…³äºmapä¸ºä»€ä¹ˆä¸ç›´æ¥æä¾›å¹¶å‘å®‰å…¨çš„ç‰ˆæœ¬ï¼ŒåŸå› ä¹Ÿç®€å•ã€‚å¹¶å‘å®‰å…¨çš„ç‰ˆæœ¬æ˜¯æœ‰åŒæ­¥å¼€é”€çš„ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™å¹¶ä¸éœ€è¦å¹¶å‘å®‰å…¨çš„ç‰ˆæœ¬ï¼Œå¦‚æœé»˜è®¤å®ç°æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œæ€§èƒ½ä¸Šå°±è¦å¤§æ‰“æŠ˜æ‰£äº†ã€‚ä¸è€ƒè™‘å¹¶å‘å®‰å…¨é—®é¢˜çš„è¯ï¼Œmapæ¯”sync.Mapè¦å¿«7~10å€ã€‚
2 sync.Map
sync.Mapæ˜¯å¹¶å‘å®‰å…¨çš„å®ç°ï¼Œå®ƒå¯¹æŸäº›åœºæ™¯ä¸‹çš„å¹¶å‘è¯»å†™åšäº†æ€§èƒ½æ–¹é¢çš„ä¼˜åŒ–ï¼š goblogs: &amp;ldquo;The Map type is optimized for two common use cases: (1) when the entry for a given key is only ever written once but read many times, as in caches that only grow, (2) when multiple goroutines read, write and overwrite entries for disjoint sets of keys.</description></item><item><title>context and cancellation by propagation</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/context/context-and-cancellation-by-propagation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/context/context-and-cancellation-by-propagation/</guid><description>Let&amp;rsquo;s Summarize # contextæœ‰ä¸¤ä¸ªç‰¹æ®Šçš„context.TODO()å’Œcontext.Background()ï¼Œè¿™ä¸¤ä¸ªcontextæ˜¯æ°¸è¿œä¸ä¼šè¶…æ—¶å’Œå–æ¶ˆçš„ï¼Œå®é™…ä¸Šå®ƒä»¬éƒ½æ˜¯emptyCtx{}ã€‚
context treeï¼š
é€šè¿‡ä¸€ä¸ªcontextå¯ä»¥æ´¾ç”Ÿå…¶ä»–å­contextï¼Œä»è€Œå½¢æˆä¸€æ£µcontext treeã€‚æ¯”å¦‚cancelCtxä¸­é€šè¿‡å­—æ®µchildrenç»´æŠ¤äº†parent contextå’Œderived contextsçš„æ´¾ç”Ÿå…³ç³»ã€‚
cancellation propagationï¼š
å–æ¶ˆæŸä¸ªchildCtxå¯¹parentCtxæ²¡å½±å“ï¼Œä½†æ˜¯å–æ¶ˆä¸€ä¸ªparentCtxï¼Œå…¶ä¸‹æ‰€æœ‰çš„childCtxéƒ½ä¼šè¢«å–æ¶ˆã€‚ä¹Ÿç»å¸¸é€šè¿‡è¿™ç§æ–¹å¼æ¥é€šçŸ¥æŸä»¶äº‹æƒ…çš„ç»“æŸï¼Œå¦‚ä¸€ä¸ªserverä¸­åŒ…å«äº†å¤šä¸ªserviceï¼ˆhttpã€kafka consumerã€scheduled tasksâ€¦ï¼‰ï¼Œå¯ä»¥é€šè¿‡å–æ¶ˆserverCtxæ¥é€šçŸ¥å„ä¸ªserviceå–æ¶ˆã€‚
cancelCtxä¸­æœ‰ä¸ªmutexï¼Œé€šè¿‡å®ƒæ¥å®ç°goroutineå¹¶å‘æ“ä½œçš„å®‰å…¨ã€‚
context leakageï¼š
ctx.Cancel()ä¸­ä¼šå°†ctx.childrenè®¾ç½®ä¸ºnilï¼Œè¿˜ä¼šæ–­å¼€parentCtxä¸å½“å‰ctxçš„è¿æ¥ã€‚å¦‚æœä¸æ‰§è¡ŒCancel()æ“ä½œï¼Œé‚£ä¹ˆä¸Šè¿°æœ‰äº›å¼•ç”¨å…³ç³»è¿˜ä¼šè¢«ç»´æŒç€ï¼ŒGCæ— æ³•å›æ”¶å¯¹åº”çš„å†…å­˜ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-context-and-cancellation-by-propagation-7a808bbc889c</description></item><item><title>context and cancellation by propagation</title><link>https://hitzhangjie.pro/go-internals-v2/posts/context-and-cancellation-by-propagation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/context-and-cancellation-by-propagation/</guid><description>Let&amp;rsquo;s Summarize # contextæœ‰ä¸¤ä¸ªç‰¹æ®Šçš„context.TODO()å’Œcontext.Background()ï¼Œè¿™ä¸¤ä¸ªcontextæ˜¯æ°¸è¿œä¸ä¼šè¶…æ—¶å’Œå–æ¶ˆçš„ï¼Œå®é™…ä¸Šå®ƒä»¬éƒ½æ˜¯emptyCtx{}ã€‚
context treeï¼š
é€šè¿‡ä¸€ä¸ªcontextå¯ä»¥æ´¾ç”Ÿå…¶ä»–å­contextï¼Œä»è€Œå½¢æˆä¸€æ£µcontext treeã€‚æ¯”å¦‚cancelCtxä¸­é€šè¿‡å­—æ®µchildrenç»´æŠ¤äº†parent contextå’Œderived contextsçš„æ´¾ç”Ÿå…³ç³»ã€‚
cancellation propagationï¼š
å–æ¶ˆæŸä¸ªchildCtxå¯¹parentCtxæ²¡å½±å“ï¼Œä½†æ˜¯å–æ¶ˆä¸€ä¸ªparentCtxï¼Œå…¶ä¸‹æ‰€æœ‰çš„childCtxéƒ½ä¼šè¢«å–æ¶ˆã€‚ä¹Ÿç»å¸¸é€šè¿‡è¿™ç§æ–¹å¼æ¥é€šçŸ¥æŸä»¶äº‹æƒ…çš„ç»“æŸï¼Œå¦‚ä¸€ä¸ªserverä¸­åŒ…å«äº†å¤šä¸ªserviceï¼ˆhttpã€kafka consumerã€scheduled tasksâ€¦ï¼‰ï¼Œå¯ä»¥é€šè¿‡å–æ¶ˆserverCtxæ¥é€šçŸ¥å„ä¸ªserviceå–æ¶ˆã€‚
cancelCtxä¸­æœ‰ä¸ªmutexï¼Œé€šè¿‡å®ƒæ¥å®ç°goroutineå¹¶å‘æ“ä½œçš„å®‰å…¨ã€‚
context leakageï¼š
ctx.Cancel()ä¸­ä¼šå°†ctx.childrenè®¾ç½®ä¸ºnilï¼Œè¿˜ä¼šæ–­å¼€parentCtxä¸å½“å‰ctxçš„è¿æ¥ã€‚å¦‚æœä¸æ‰§è¡ŒCancel()æ“ä½œï¼Œé‚£ä¹ˆä¸Šè¿°æœ‰äº›å¼•ç”¨å…³ç³»è¿˜ä¼šè¢«ç»´æŒç€ï¼ŒGCæ— æ³•å›æ”¶å¯¹åº”çš„å†…å­˜ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-context-and-cancellation-by-propagation-7a808bbc889c</description></item><item><title>debugging with delve &amp; coredumps</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/Debugging/debugging-with-delve-coredumps/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/Debugging/debugging-with-delve-coredumps/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•å€ŸåŠ©go-delve/delveè°ƒè¯•å™¨å¯¹goç¨‹åºä»¥åŠcoredumpæ–‡ä»¶è¿›è¡Œè°ƒè¯•ã€‚
æˆ‘å¯¹delveçš„ä½¿ç”¨è¿˜æ˜¯å¾ˆç†Ÿç»ƒçš„ï¼Œä¹Ÿé€»è¾‘delveå®ç°åŸç†ã€ç»™delveè´¡çŒ®è¿‡ä»£ç ï¼Œè‡ªå·±ä¹Ÿå†™è¿‡ä¸€ä¸ªç¬¦å·çº§è°ƒè¯•å™¨æ¥è¿›è¡Œç³»ç»Ÿæ€§çš„å­¦ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-debugging-with-delve-core-dumps-384145b2e8d9</description></item><item><title>debugging with delve &amp; coredumps</title><link>https://hitzhangjie.pro/go-internals-v2/posts/debugging-with-delve-coredumps/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/debugging-with-delve-coredumps/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•å€ŸåŠ©go-delve/delveè°ƒè¯•å™¨å¯¹goç¨‹åºä»¥åŠcoredumpæ–‡ä»¶è¿›è¡Œè°ƒè¯•ã€‚
æˆ‘å¯¹delveçš„ä½¿ç”¨è¿˜æ˜¯å¾ˆç†Ÿç»ƒçš„ï¼Œä¹Ÿé€»è¾‘delveå®ç°åŸç†ã€ç»™delveè´¡çŒ®è¿‡ä»£ç ï¼Œè‡ªå·±ä¹Ÿå†™è¿‡ä¸€ä¸ªç¬¦å·çº§è°ƒè¯•å™¨æ¥è¿›è¡Œç³»ç»Ÿæ€§çš„å­¦ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-debugging-with-delve-core-dumps-384145b2e8d9</description></item><item><title>defer internals</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/defer/defer-internals/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/defer/defer-internals/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡å†…å®¹å¾ˆå¤šï¼Œæˆ‘åªå…³æ³¨äº†å…¶å¯¹openDeferçš„è§£é‡Šï¼Œä¸€ä¸ªopenDeferçš„deferï¼Œæˆ–è€…è¯´ä¸€ä¸ªopen-coded deferæŒ‡çš„æ˜¯è¿™æ ·çš„deferï¼Œä¸æ˜¯åœ¨forå¾ªç¯ä¸­è¢«è°ƒç”¨çš„deferã€‚
ä¸¾ä¸ªä¾‹å­ï¼š
func TestOpenAndNonOpenDefers(t *testing.T) { // f() is a more complicated function that is recover()&amp;ldquo;ed for { defer f() // &amp;lt;&amp;ndash; non open-coded defer } defer f() // &amp;lt;&amp;ndash; open-coded defer }
Source Analysis # References # https://tpaschalis.github.io/defer-internals/</description></item><item><title>defer internals</title><link>https://hitzhangjie.pro/go-internals-v2/posts/defer-internals/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/defer-internals/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡å†…å®¹å¾ˆå¤šï¼Œæˆ‘åªå…³æ³¨äº†å…¶å¯¹openDeferçš„è§£é‡Šï¼Œä¸€ä¸ªopenDeferçš„deferï¼Œæˆ–è€…è¯´ä¸€ä¸ªopen-coded deferæŒ‡çš„æ˜¯è¿™æ ·çš„deferï¼Œä¸æ˜¯åœ¨forå¾ªç¯ä¸­è¢«è°ƒç”¨çš„deferã€‚
ä¸¾ä¸ªä¾‹å­ï¼š
func TestOpenAndNonOpenDefers(t *testing.T) { // f() is a more complicated function that is recover()&amp;ldquo;ed for { defer f() // &amp;lt;&amp;ndash; non open-coded defer } defer f() // &amp;lt;&amp;ndash; open-coded defer }
Source Analysis # References # https://tpaschalis.github.io/defer-internals/</description></item><item><title>demystifying memory management in modern programming languages</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/demystifying-memory-management-in-modern-programming-languages/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/demystifying-memory-management-in-modern-programming-languages/</guid><description>Let&amp;rsquo;s Summarize # Source Analysis # References # https://deepu.tech/memory-management-in-programming/</description></item><item><title>demystifying memory management in modern programming languages</title><link>https://hitzhangjie.pro/go-internals-v2/posts/demystifying-memory-management-in-modern-programming-languages/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/demystifying-memory-management-in-modern-programming-languages/</guid><description>Let&amp;rsquo;s Summarize # Source Analysis # References # https://deepu.tech/memory-management-in-programming/</description></item><item><title>design philosophy on data and semantics</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/design-philosophy-on-data-and-semantics/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/design-philosophy-on-data-and-semantics/</guid><description>Let&amp;rsquo;s Summarize # â€œValue semantics keep values on the stack, which reduces pressure on the Garbage Collector (GC). However, value semantics require various copies of any given value to be stored, tracked and maintained. Pointer semantics place values on the heap, which can put pressure on the GC. However, pointer semantics are efficient because only one value needs to be stored, tracked and maintained.â€ - Bill Kennedy
A consistent use of value/pointer semantics, for a given type of data, is critical if you want to maintain integrity and readability throughout your software.</description></item><item><title>design philosophy on data and semantics</title><link>https://hitzhangjie.pro/go-internals-v2/posts/design-philosophy-on-data-and-semantics/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/design-philosophy-on-data-and-semantics/</guid><description>Let&amp;rsquo;s Summarize # â€œValue semantics keep values on the stack, which reduces pressure on the Garbage Collector (GC). However, value semantics require various copies of any given value to be stored, tracked and maintained. Pointer semantics place values on the heap, which can put pressure on the GC. However, pointer semantics are efficient because only one value needs to be stored, tracked and maintained.â€ - Bill Kennedy
A consistent use of value/pointer semantics, for a given type of data, is critical if you want to maintain integrity and readability throughout your software.</description></item><item><title>diagnostics methods</title><link>https://hitzhangjie.pro/go-internals-v2/posts/diagnostics-methods/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/diagnostics-methods/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºå¼€å‘äººå‘˜å¸¸ç”¨çš„é—®é¢˜è¯Šæ–­æ–¹æ³•ï¼š
1 profilingï¼šæ‰§è¡Œgo tool pprofå¯¹cpuã€å†…å­˜ã€çº¿ç¨‹åˆ›å»ºã€é”ä½¿ç”¨é—®é¢˜ç­‰è¿›è¡Œåˆ†æã€é—®é¢˜å®šä½ã€ä¼˜åŒ–ï¼› 2 tracingï¼šç»‡å…¥ä»£ç å¯¹è¿è¡Œè¿‡ç¨‹ä¸­å„é˜¶æ®µè€—æ—¶è¿›è¡Œç»Ÿè®¡ç­‰ç­‰ï¼Œå¦‚golang.org/x/net/traceè¿™ä¸ªåŒ…ï¼Œæ²¡æ€ä¹ˆä½¿ç”¨è¿‡ï¼› 3 debuggingï¼šè°ƒè¯•å™¨è°ƒè¯•ï¼Œæœ‰è°ƒè¯•éœ€æ±‚çš„æ—¶å€™ï¼Œé€šè¿‡-gcflags=&amp;ldquo;all=-N -l&amp;quot;ç¦ç”¨ä¼˜åŒ–ã€å†…è”æ±‡ç¼–ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶å¯¹è°ƒè¯•æ›´å‹å¥½ï¼› 4 runtime statistics and eventsï¼šè¿è¡Œæ—¶ä¿¡æ¯æ”¶é›†ï¼Œå¦‚å†…å­˜ã€gcã€stackã€heapã€goroutinesæ•°é‡ç­‰ä¿¡æ¯ï¼› 5 execution tracerï¼šå¯¹ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­è¿è¡Œæ—¶è¡Œä¸ºã€äº‹ä»¶è¿›è¡Œåˆ†æã€é—®é¢˜å®šä½ã€ä¼˜åŒ–ï¼Œå¦‚gcã€goroutineè°ƒåº¦latencyã€ç³»ç»Ÿè°ƒç”¨ç­‰ç­‰ï¼› 6 GODEBUGï¼šè¯¥ç¯å¢ƒå˜é‡ç”¨æ¥æ§åˆ¶ä¸€äº›è¡Œä¸ºï¼Œå¦‚ï¼š
GODEBUG=gctrace=1ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æ‰“å°gcçš„ä¿¡æ¯ï¼Œå›æ”¶å†…å­˜æ•°ï¼Œä»¥åŠåœé¡¿æ—¶é—´ï¼› GODEBUG=inittrace=1ï¼Œæ‰“å°åŒ…åˆå§‹åŒ–èŠ±è´¹çš„æ—¶é—´ï¼› GODEBUG=schedtrace=Xï¼Œæ¯éš”Xæ¯«ç§’æ‰“å°è°ƒåº¦ç›¸å…³ä¿¡æ¯ï¼› GODEBUGè¿˜å¯ä»¥ç”¨æ¥ç¦ç”¨å…¨éƒ¨æˆ–è€…æŸäº›æŒ‡ä»¤çº§æ‰©å±•ï¼Œè¿™ä¸ªä¸æ€ä¹ˆå¸¸ç”¨ï¼Œå…ˆå¿½ç•¥ã€‚ è¿™é‡Œçš„execution traceræ•°æ®çš„ç”Ÿæˆï¼Œå¯ä»¥å€ŸåŠ©ï¼š
ä»£ç é‡Œé¢import runtime/traceè¿™ä¸ªpackageï¼Œç„¶åmainå‡½æ•°é‡Œtrace.Start(os.Stderr), defer trace.Stop()ï¼Œè¿è¡Œèµ·æ¥go run main.go &amp;amp;&amp;gt; trace.outï¼› é€šè¿‡go test -trace trace.outï¼› ç„¶åé€šè¿‡go tool trace trace.outæŸ¥çœ‹ï¼› å…³äºGODEBUG=schedtrace=Xçš„è¾“å‡ºæ ¼å¼çš„ç†è§£ï¼Œsee https://www.ardanlabs.com/blog/2015/02/scheduler-tracing-in-go.htmlã€‚ä¸¾ä¸ªä¾‹å­ runqueue 0 [4 4]æ˜¯è¯´å…¨å±€queueé‡Œé¢æœ‰0ä¸ªgï¼Œç°åœ¨æœ‰ä¸¤ä¸ªpï¼Œæ¯ä¸ªpä¸Šçš„queueå‡æœ‰4ä¸ªgå¾…è¿è¡Œã€‚
Source Analysis # References # https://golang.org/doc/diagnostics</description></item><item><title>discovery of the trace package</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/Tracing/discovery-of-the-trace-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/Tracing/discovery-of-the-trace-package/</guid><description>Let&amp;rsquo;s Summarize # å¦‚ä½•æ¿€æ´»traceï¼Ÿ
go test -traceï¼Œé€šè¿‡é€‰é¡¹-traceæ¥æ¿€æ´»traceåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡trace packageæä¾›çš„æ–¹æ³•æ¥å¢å¼ºé»˜è®¤çš„traceèƒ½åŠ›ï¼Œä¸‹é¢ç®€å•æ€»ç»“ä¸‹ã€‚
go test -traceï¼Œæˆ–è€…ä»£ç ä¸­é€šè¿‡trace.Start()/defer trace.Stopæ¥è¾“å‡ºtraceæ•°æ®åˆ°æ–‡ä»¶éƒ½å¯ä»¥ã€‚ç„¶åé€šè¿‡go tool trace traceæ–‡ä»¶ï¼Œå³å¯è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚
traceå·¥ä½œè¿‡ç¨‹ï¼Ÿ
è¿™é‡Œçš„traceè¿‡ç¨‹å¤§è‡´æ˜¯ï¼šé¦–å…ˆStop the Worldï¼Œç„¶åæ”¶é›†å„ä¸ªgoroutinesçš„æ ˆå¸§ä¿¡æ¯ï¼Œæ”¶é›†å„ä¸ªgoroutinesçš„snapshotsä¿¡æ¯ï¼Œæœ€å¥½å†Start the Worldã€‚è¿™é‡Œæ”¶é›†çš„è¿™äº›ä¿¡æ¯ä¼šå­˜å‚¨åˆ°ä¸€ä¸ªbufferlistä¸­ã€‚ç„¶ågo runtimeä¼šå¯åŠ¨ä¸€ä¸ªä¸“é—¨çš„goroutineæ¥å¼‚æ­¥åœ°å°†bufferlistä¸­çš„æ•°æ®å†™å…¥åˆ°traceæ•°æ®æ–‡ä»¶ä¸­ã€‚å¦‚æœbufferlistæ²¡æ•°æ®çš„è¯ï¼Œè¿™ä¸ªä¸“é—¨çš„åç¨‹å°±ä¼šè¢«parkedã€‚
ç„¶åä»‹ç»äº†go tool trace å¯è§†åŒ–ä¿¡æ¯çš„ä¸€äº›è§£é‡Šï¼Œæ¯”å¦‚GCå„ä¸ªé˜¶æ®µçš„è§£é‡Šã€è°ƒåº¦é˜¶æ®µçš„startã€stopã€syscallã€unblockçš„è§£é‡Šã€‚
ç”¨æˆ·è‡ªå®šä¹‰traceï¼Ÿ
ä¸»è¦æœ‰ä¸¤ä¸ªå±‚æ¬¡ï¼š
taskå±‚æ¬¡ taskCtx, task := trace.NewTask(ctx, &amp;ldquo;task name&amp;rdquo;) ç»“æŸçš„æ—¶å€™éœ€è¦task.End()ç»“æŸè‡ªå®šä¹‰traceã€‚
regionå±‚æ¬¡ trace.NewRegion(taskCtx, &amp;ldquo;region name&amp;rdquo;) ç»“æŸçš„æ—¶å€™éœ€è¦region.End()æ ‡è®°å½“å‰é˜¶æ®µçš„ç»“æŸã€‚
è¿™é‡Œçš„traceè¿‡ç¨‹å¾ˆç›´è§‚ï¼Œå¦‚æœæœ‰ç”¨è¿‡opentracingçš„è¯ä¼šå®¹æ˜“ç†è§£è¿™é‡Œçš„ç”¨æ³•ã€‚
ç”¨æˆ·è‡ªå®šä¹‰çš„traceï¼Œåœ¨è¾“å‡ºåˆ°traceæ•°æ®æ–‡ä»¶åï¼Œä¹Ÿæ˜¯å¯é€šè¿‡go tool traceæ¥è¿›è¡Œå¯è§†åŒ–å±•ç¤ºçš„ï¼Œåœ¨é€‰é¡¹å¡â€œuser-defined tasksâ€ä¸­ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-discovery-of-the-trace-package-e5a821743c3c</description></item><item><title>discovery of the trace package</title><link>https://hitzhangjie.pro/go-internals-v2/posts/discovery-of-the-trace-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/discovery-of-the-trace-package/</guid><description>Let&amp;rsquo;s Summarize # å¦‚ä½•æ¿€æ´»traceï¼Ÿ
go test -traceï¼Œé€šè¿‡é€‰é¡¹-traceæ¥æ¿€æ´»traceåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡trace packageæä¾›çš„æ–¹æ³•æ¥å¢å¼ºé»˜è®¤çš„traceèƒ½åŠ›ï¼Œä¸‹é¢ç®€å•æ€»ç»“ä¸‹ã€‚
go test -traceï¼Œæˆ–è€…ä»£ç ä¸­é€šè¿‡trace.Start()/defer trace.Stopæ¥è¾“å‡ºtraceæ•°æ®åˆ°æ–‡ä»¶éƒ½å¯ä»¥ã€‚ç„¶åé€šè¿‡go tool trace traceæ–‡ä»¶ï¼Œå³å¯è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚
traceå·¥ä½œè¿‡ç¨‹ï¼Ÿ
è¿™é‡Œçš„traceè¿‡ç¨‹å¤§è‡´æ˜¯ï¼šé¦–å…ˆStop the Worldï¼Œç„¶åæ”¶é›†å„ä¸ªgoroutinesçš„æ ˆå¸§ä¿¡æ¯ï¼Œæ”¶é›†å„ä¸ªgoroutinesçš„snapshotsä¿¡æ¯ï¼Œæœ€å¥½å†Start the Worldã€‚è¿™é‡Œæ”¶é›†çš„è¿™äº›ä¿¡æ¯ä¼šå­˜å‚¨åˆ°ä¸€ä¸ªbufferlistä¸­ã€‚ç„¶ågo runtimeä¼šå¯åŠ¨ä¸€ä¸ªä¸“é—¨çš„goroutineæ¥å¼‚æ­¥åœ°å°†bufferlistä¸­çš„æ•°æ®å†™å…¥åˆ°traceæ•°æ®æ–‡ä»¶ä¸­ã€‚å¦‚æœbufferlistæ²¡æ•°æ®çš„è¯ï¼Œè¿™ä¸ªä¸“é—¨çš„åç¨‹å°±ä¼šè¢«parkedã€‚
ç„¶åä»‹ç»äº†go tool trace å¯è§†åŒ–ä¿¡æ¯çš„ä¸€äº›è§£é‡Šï¼Œæ¯”å¦‚GCå„ä¸ªé˜¶æ®µçš„è§£é‡Šã€è°ƒåº¦é˜¶æ®µçš„startã€stopã€syscallã€unblockçš„è§£é‡Šã€‚
ç”¨æˆ·è‡ªå®šä¹‰traceï¼Ÿ
ä¸»è¦æœ‰ä¸¤ä¸ªå±‚æ¬¡ï¼š
taskå±‚æ¬¡ taskCtx, task := trace.NewTask(ctx, &amp;ldquo;task name&amp;rdquo;) ç»“æŸçš„æ—¶å€™éœ€è¦task.End()ç»“æŸè‡ªå®šä¹‰traceã€‚
regionå±‚æ¬¡ trace.NewRegion(taskCtx, &amp;ldquo;region name&amp;rdquo;) ç»“æŸçš„æ—¶å€™éœ€è¦region.End()æ ‡è®°å½“å‰é˜¶æ®µçš„ç»“æŸã€‚
è¿™é‡Œçš„traceè¿‡ç¨‹å¾ˆç›´è§‚ï¼Œå¦‚æœæœ‰ç”¨è¿‡opentracingçš„è¯ä¼šå®¹æ˜“ç†è§£è¿™é‡Œçš„ç”¨æ³•ã€‚
ç”¨æˆ·è‡ªå®šä¹‰çš„traceï¼Œåœ¨è¾“å‡ºåˆ°traceæ•°æ®æ–‡ä»¶åï¼Œä¹Ÿæ˜¯å¯é€šè¿‡go tool traceæ¥è¿›è¡Œå¯è§†åŒ–å±•ç¤ºçš„ï¼Œåœ¨é€‰é¡¹å¡â€œuser-defined tasksâ€ä¸­ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-discovery-of-the-trace-package-e5a821743c3c</description></item><item><title>duck typing, structural typing, nominal typing</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Types/duck-typing-structural-typing-nominal-typing/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Types/duck-typing-structural-typing-nominal-typing/</guid><description>Let&amp;rsquo;s Summarize # é¦–å…ˆè¯´ç»“è®ºï¼Œgoè¯­è¨€ç±»å‹æ˜¯structural typingï¼Œå¯ä»¥ç†è§£æˆå®ƒæ˜¯ä¸€ç§åœ¨duck typingä¹‹ä¸Šå¢åŠ äº†ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨æ£€æŸ¥çš„typingï¼Œæ‰€ä»¥ä¹Ÿä¼šçœ‹åˆ°æœ‰äººç§°å…¶ä¸ºtype-safe duck typingã€‚ ä¸‹é¢ç®€å•æ€»ç»“ä¸‹è¿™å‡ ç§typingçš„å¼‚åŒç‚¹ï¼š
duck typingï¼Œæœ€çµæ´»ï¼Œä½†æ˜¯ç±»å‹å®‰å…¨æ€§ä¸å¤Ÿï¼Œå®¹æ˜“å¯¼è‡´ç¼–è¯‘æ—¶æ— æ³•å‘ç°çš„è¿è¡Œæ—¶é”™è¯¯ï¼Œå› ä¸ºduck typingæœºåˆ¶ä¸‹ï¼Œobj.callMethod()è¿™é‡Œçš„callMethodæ˜¯å¦æœ‰åœ¨objä¸‹å®šä¹‰æ˜¯æ²¡æœ‰ç¼–è¯‘æ—¶æ£€æŸ¥ä¿è¯çš„ï¼Œåœ¨è¿è¡Œæ—¶æ‰ä¼šå»æ£€æŸ¥ã€‚æ¯”å¦‚pythonã€jsæ˜¯æ”¯æŒduck typingçš„ï¼› norminal typingï¼Œè¿™ç§é€šè¿‡æ˜¾ç¤ºçš„å£°æ˜ç±»å‹å®ç°äº†å“ªä¸ªæ¥å£ï¼Œç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥å™¨å°±å¯ä»¥æ ¹æ®è¿™ä¸ªå£°æ˜çš„ä¾èµ–å…³ç³»å»æ£€æŸ¥ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£æ‰€å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ã€‚è¿™ç§æ–¹å¼èƒ½ä¿è¯ç±»å‹å®‰å…¨ï¼Œä½†æ˜¯å¼€å‘äººå‘˜éœ€è¦æ˜¾ç¤ºå†™çš„ä»£ç ä¹Ÿå˜å¤šäº†ï¼Œè€Œä¸”ç±»å‹ã€æ¥å£ä¹‹é—´çš„å…³ç³»æ˜¯å­˜åœ¨æ¯”è¾ƒå¼ºçš„ç»‘å®šï¼Œæ²¡é‚£ä¹ˆçµæ´»ã€‚ structural typingï¼Œå¯ä»¥ç†è§£æˆduck typingå’Œnominal typingçš„ä¸€ç§æŠ˜ä¸­ã€‚é¦–å…ˆå¼€å‘äººå‘˜åœ¨å†™ä»£ç çš„æ—¶å€™å¯ä»¥åƒduck typingé‚£æ ·å»å†™ä»£ç ï¼Œä¸éœ€è¦æ˜¾ç¤ºå£°æ˜ç±»å‹å®ç°äº†å“ªä¸ªæ¥å£ï¼Œè¿™æ ·å†™ä»£ç å†™èµ·æ¥ç®€å•ã€‚å¦å¤–ï¼Œåœ¨ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥å™¨å¯ä»¥åšäº›ç±»å‹å®‰å…¨æ£€æŸ¥ï¼Œæ£€æŸ¥æŸä¸ªç±»å‹æ˜¯å¦éšå¼å®ç°äº†æŸä¸ªæœŸæœ›çš„æ¥å£ã€‚è¿™æ ·çš„è¯ç›¸å½“äºå¸æ”¶äº†duck typingã€nominal typingå„è‡ªçš„ä¼˜ç‚¹ã€‚ psï¼šå°†goç§°ä¹‹ä¸ºduck typingæ˜¯ä¸å¤Ÿä¸¥è°¨çš„ï¼Œå¦‚æœè¯´æˆæ˜¯type-safe duck typingè¿˜å¯ä»¥ï¼Œå‡†ç¡®åœ°è¯´è¿˜æ˜¯åº”è¯¥ç”¨structural typingæœ€å‡†ç¡®ã€‚
Source Analysis # References # https://medium.com/higher-order-functions/duck-typing-vs-structural-typing-vs-nominal-typing-e0881860bf10</description></item><item><title>finalizers</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/finalizers/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/finalizers/</guid><description>Let&amp;rsquo;s Summarize # runtime.SetFinalizer(p, fn)ï¼Œè¿è¡Œæ—¶æä¾›äº†è¿™ä¸ªå‡½æ•°æ¥åœ¨pè¢«GCæ—¶æ‰§è¡Œå‡½æ•°fnã€‚
åªæœ‰ä¸€ä¸ªä¸“é—¨çš„åç¨‹æ¥æ‰§è¡Œæ‰€æœ‰çš„finalizersï¼Œæ‰€ä»¥finalizersçš„æ‰§è¡Œæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¦‚æœæŸä¸€ä¸ªfinalizerçš„é€»è¾‘æ¯”è¾ƒé‡ï¼Œæˆ–è€…è€—æ—¶æ¯”è¾ƒä¹…ï¼Œåº”è¯¥å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„åç¨‹æ¥æ‰§è¡Œè¯¥é€»è¾‘ã€‚
å½“ä¸€ä¸ªå¯¹è±¡objè¢«åƒåœ¾å›æ”¶å™¨è¯†åˆ«ä¸ºä¸å†è¢«å¼•ç”¨æ—¶ï¼Œå…¶å­˜åœ¨å…³è”çš„finalizerçš„è¯ï¼Œé¦–å…ˆè§£é™¤è¯¥å…³è”å…³ç³»ï¼Œç„¶åå°†è¯¥finalizer(obj)äº¤ç»™ä¸Šé¢æçš„é‚£ä¸ªä¸“é—¨çš„åç¨‹å»æ‰§è¡Œï¼Œè‡³äºä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œæˆï¼Œæ˜¯æ²¡æœ‰ä¿è¯çš„ï¼Œå¯èƒ½ç¨‹åºé€€å‡ºæ—¶ä¹Ÿä¸èƒ½ä¿è¯å·²ç»æ‰§è¡Œå®Œæˆäº†ã€‚
åœ¨objå…³è”ä½ çš„finalizerè¢«æ‰§è¡Œæ—¶ï¼Œfinalizer(obj)åˆé‡æ–°å¼•ç”¨äº†è¯¥å¯¹è±¡objï¼Œä¸å¯è¾¾å¯¹è±¡åˆå˜æˆå¯è¾¾äº†ï¼Œè¿™ä¸ªæ—¶å€™GCä¸èƒ½å°†å…¶å›æ”¶ï¼Œä½†æ˜¯å› ä¸ºå·²ç»å»æ‰äº†objå’Œfinalizerçš„å…³è”ï¼Œä¸‹ä¸€è½®GCæ—¶è¯¥å¯¹è±¡objå°†èƒ½å¤Ÿè¢«å›æ”¶ã€‚
finalizeré€šå¸¸ç”¨æ¥é‡Šæ”¾ä¸€äº›ä¸å†ä½¿ç”¨çš„å†…å­˜èµ„æºã€å…³é—­æ–‡ä»¶ç­‰æ¸…ç†å·¥ä½œï¼Œå› ä¸ºå…¶ä»€ä¹ˆæ—¶å€™æ‰§è¡Œæ˜¯ä¸æ–¹ä¾¿å‡†ç¡®é¢„æµ‹çš„ï¼Œä¹Ÿåªé€‚åˆæ¥åšäº›ç±»ä¼¼ä¸å†ä½¿ç”¨çš„èµ„æºçš„æ¸…ç†å·¥ä½œã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-finalizers-786df8e17687</description></item><item><title>finalizers</title><link>https://hitzhangjie.pro/go-internals-v2/posts/finalizers/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/finalizers/</guid><description>Let&amp;rsquo;s Summarize # runtime.SetFinalizer(p, fn)ï¼Œè¿è¡Œæ—¶æä¾›äº†è¿™ä¸ªå‡½æ•°æ¥åœ¨pè¢«GCæ—¶æ‰§è¡Œå‡½æ•°fnã€‚
åªæœ‰ä¸€ä¸ªä¸“é—¨çš„åç¨‹æ¥æ‰§è¡Œæ‰€æœ‰çš„finalizersï¼Œæ‰€ä»¥finalizersçš„æ‰§è¡Œæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¦‚æœæŸä¸€ä¸ªfinalizerçš„é€»è¾‘æ¯”è¾ƒé‡ï¼Œæˆ–è€…è€—æ—¶æ¯”è¾ƒä¹…ï¼Œåº”è¯¥å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„åç¨‹æ¥æ‰§è¡Œè¯¥é€»è¾‘ã€‚
å½“ä¸€ä¸ªå¯¹è±¡objè¢«åƒåœ¾å›æ”¶å™¨è¯†åˆ«ä¸ºä¸å†è¢«å¼•ç”¨æ—¶ï¼Œå…¶å­˜åœ¨å…³è”çš„finalizerçš„è¯ï¼Œé¦–å…ˆè§£é™¤è¯¥å…³è”å…³ç³»ï¼Œç„¶åå°†è¯¥finalizer(obj)äº¤ç»™ä¸Šé¢æçš„é‚£ä¸ªä¸“é—¨çš„åç¨‹å»æ‰§è¡Œï¼Œè‡³äºä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œæˆï¼Œæ˜¯æ²¡æœ‰ä¿è¯çš„ï¼Œå¯èƒ½ç¨‹åºé€€å‡ºæ—¶ä¹Ÿä¸èƒ½ä¿è¯å·²ç»æ‰§è¡Œå®Œæˆäº†ã€‚
åœ¨objå…³è”ä½ çš„finalizerè¢«æ‰§è¡Œæ—¶ï¼Œfinalizer(obj)åˆé‡æ–°å¼•ç”¨äº†è¯¥å¯¹è±¡objï¼Œä¸å¯è¾¾å¯¹è±¡åˆå˜æˆå¯è¾¾äº†ï¼Œè¿™ä¸ªæ—¶å€™GCä¸èƒ½å°†å…¶å›æ”¶ï¼Œä½†æ˜¯å› ä¸ºå·²ç»å»æ‰äº†objå’Œfinalizerçš„å…³è”ï¼Œä¸‹ä¸€è½®GCæ—¶è¯¥å¯¹è±¡objå°†èƒ½å¤Ÿè¢«å›æ”¶ã€‚
finalizeré€šå¸¸ç”¨æ¥é‡Šæ”¾ä¸€äº›ä¸å†ä½¿ç”¨çš„å†…å­˜èµ„æºã€å…³é—­æ–‡ä»¶ç­‰æ¸…ç†å·¥ä½œï¼Œå› ä¸ºå…¶ä»€ä¹ˆæ—¶å€™æ‰§è¡Œæ˜¯ä¸æ–¹ä¾¿å‡†ç¡®é¢„æµ‹çš„ï¼Œä¹Ÿåªé€‚åˆæ¥åšäº›ç±»ä¼¼ä¸å†ä½¿ç”¨çš„èµ„æºçš„æ¸…ç†å·¥ä½œã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-finalizers-786df8e17687</description></item><item><title>g0, special goroutines</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/g0-special-goroutines/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/g0-special-goroutines/</guid><description>Let&amp;rsquo;s Summarize # goroutinesæ˜¯ç”±go scheduleræ¥è°ƒåº¦çš„ï¼Œgo scheduleråœ¨æŸäº›goroutineå‡ºç°é˜»å¡çš„æ—¶å€™è°ƒåº¦å…¶ä»–goroutinesç»§ç»­æ‰§è¡Œï¼Œä»¥æé«˜cpuçš„åˆ©ç”¨ç‡ã€‚
goroutineså…¶å®æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿçº¿ç¨‹é‡Œé¢çš„ï¼ŒGOMAXPROCSé™åˆ¶äº†æœ€å¤šå¯ä»¥å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ï¼ˆå®é™…çº¿ç¨‹å¯èƒ½æœ‰é˜»å¡çš„ï¼Œçº¿ç¨‹æ€»æ•°ä¼šå¤§äºç­‰äºè¯¥ç¯å¢ƒå˜é‡å€¼ï¼‰ã€‚go schedulerè´Ÿè´£å°†goroutinesè°ƒåº¦åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œåœ¨ç¨‹åºåˆå§‹åŒ–é˜¶æ®µï¼Œä¼šä¸ºæ¯ä¸ªæŒæœ‰Pçš„çº¿ç¨‹Måˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„åç¨‹g0ï¼Œè¿™é‡Œçš„g0å…¶å®å°±æ˜¯ä¼šå¹²go schedulerçš„å·¥ä½œï¼Œg0ä¼šè°ƒåº¦å°±ç»ªçš„goroutinesåœ¨å…³è”çš„çº¿ç¨‹Mä¸Šæ‰§è¡Œã€‚
g0çš„èŒè´£
g0çš„èŒè´£å¹¶ä¸ä»…ä»…æ˜¯schedulerï¼Œå®ƒè¿˜æœ‰å…¶ä»–çš„ç”¨é€”ã€‚g0çš„åç¨‹æ ˆï¼ˆä¸€å¼€å§‹å°±æ˜¯8KBï¼‰æ¯”æ™®é€šçš„åç¨‹çš„æ ˆï¼ˆä¸€å¼€å§‹ä¸º2KBï¼‰è¦å¤§å¾ˆå¤šï¼Œå®ƒé€‚ç”¨äºæ‰§è¡Œä¸€äº›å¯¹æ ˆå®¹é‡è¦æ±‚æ¯”è¾ƒå¤§ã€åˆä¸å¸Œæœ›æ ˆæ‰©å®¹çš„æƒ…å¢ƒä¸‹ã€‚
åˆ—ä¸¾ä¸‹g0çš„èŒè´£ï¼š
goroutineåˆ›å»ºï¼Œå¦‚go func(){}()æ˜¯åœ¨g0ä¸­å®Œæˆçš„ï¼Œå°†å…¶åˆ›å»ºå®Œæ”¾åˆ°Pçš„é˜Ÿåˆ—ä¸­ï¼› defer functionåˆ›å»ºï¼› GCæ“ä½œï¼Œå¦‚STWã€æ‰«æåç¨‹æ ˆã€æ ‡è®°æ•´ç†ç­‰æ“ä½œï¼› æ ˆå¢é•¿ï¼Œåœ¨å‡½æ•°åºè¨€prologueéƒ¨åˆ†æ‰§è¡Œæ ˆå¢é•¿ï¼› åœ¨å…¶ä»–çš„ä¸€äº›æ“ä½œä¸­ï¼ˆæ¯”å¦‚éœ€è¦æ›´å¤§çš„å†…å­˜åˆ†é…çš„cgoæ“ä½œï¼‰ï¼Œè¿™ä¸ªç‰¹æ®Šåç¨‹g0ä½¿æˆ‘ä»¬çš„ç¨‹åºæ›´åŠ é«˜æ•ˆçš„æ‰§è¡Œç®¡ç†æ“ä½œï¼Œè€Œåˆä¸ä¼šå¸¦æ¥è¿‡é«˜çš„å†…å­˜å¼€é”€ã€‚
Source Analysis # TODO ç»“åˆæºç æ¥åˆ†æä¸‹go schedulerçš„è¯¦ç»†è¿‡ç¨‹ï¼Œä»¥åŠg0çš„è¯¦ç»†ç”¨é€”
References # https://medium.com/a-journey-with-go/go-g0-special-goroutine-8c778c6704d8</description></item><item><title>g0, special goroutines</title><link>https://hitzhangjie.pro/go-internals-v2/posts/g0-special-goroutines/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/g0-special-goroutines/</guid><description>Let&amp;rsquo;s Summarize # goroutinesæ˜¯ç”±go scheduleræ¥è°ƒåº¦çš„ï¼Œgo scheduleråœ¨æŸäº›goroutineå‡ºç°é˜»å¡çš„æ—¶å€™è°ƒåº¦å…¶ä»–goroutinesç»§ç»­æ‰§è¡Œï¼Œä»¥æé«˜cpuçš„åˆ©ç”¨ç‡ã€‚
goroutineså…¶å®æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿçº¿ç¨‹é‡Œé¢çš„ï¼ŒGOMAXPROCSé™åˆ¶äº†æœ€å¤šå¯ä»¥å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ï¼ˆå®é™…çº¿ç¨‹å¯èƒ½æœ‰é˜»å¡çš„ï¼Œçº¿ç¨‹æ€»æ•°ä¼šå¤§äºç­‰äºè¯¥ç¯å¢ƒå˜é‡å€¼ï¼‰ã€‚go schedulerè´Ÿè´£å°†goroutinesè°ƒåº¦åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œåœ¨ç¨‹åºåˆå§‹åŒ–é˜¶æ®µï¼Œä¼šä¸ºæ¯ä¸ªæŒæœ‰Pçš„çº¿ç¨‹Måˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„åç¨‹g0ï¼Œè¿™é‡Œçš„g0å…¶å®å°±æ˜¯ä¼šå¹²go schedulerçš„å·¥ä½œï¼Œg0ä¼šè°ƒåº¦å°±ç»ªçš„goroutinesåœ¨å…³è”çš„çº¿ç¨‹Mä¸Šæ‰§è¡Œã€‚
g0çš„èŒè´£
g0çš„èŒè´£å¹¶ä¸ä»…ä»…æ˜¯schedulerï¼Œå®ƒè¿˜æœ‰å…¶ä»–çš„ç”¨é€”ã€‚g0çš„åç¨‹æ ˆï¼ˆä¸€å¼€å§‹å°±æ˜¯8KBï¼‰æ¯”æ™®é€šçš„åç¨‹çš„æ ˆï¼ˆä¸€å¼€å§‹ä¸º2KBï¼‰è¦å¤§å¾ˆå¤šï¼Œå®ƒé€‚ç”¨äºæ‰§è¡Œä¸€äº›å¯¹æ ˆå®¹é‡è¦æ±‚æ¯”è¾ƒå¤§ã€åˆä¸å¸Œæœ›æ ˆæ‰©å®¹çš„æƒ…å¢ƒä¸‹ã€‚
åˆ—ä¸¾ä¸‹g0çš„èŒè´£ï¼š
goroutineåˆ›å»ºï¼Œå¦‚go func(){}()æ˜¯åœ¨g0ä¸­å®Œæˆçš„ï¼Œå°†å…¶åˆ›å»ºå®Œæ”¾åˆ°Pçš„é˜Ÿåˆ—ä¸­ï¼› defer functionåˆ›å»ºï¼› GCæ“ä½œï¼Œå¦‚STWã€æ‰«æåç¨‹æ ˆã€æ ‡è®°æ•´ç†ç­‰æ“ä½œï¼› æ ˆå¢é•¿ï¼Œåœ¨å‡½æ•°åºè¨€prologueéƒ¨åˆ†æ‰§è¡Œæ ˆå¢é•¿ï¼› åœ¨å…¶ä»–çš„ä¸€äº›æ“ä½œä¸­ï¼ˆæ¯”å¦‚éœ€è¦æ›´å¤§çš„å†…å­˜åˆ†é…çš„cgoæ“ä½œï¼‰ï¼Œè¿™ä¸ªç‰¹æ®Šåç¨‹g0ä½¿æˆ‘ä»¬çš„ç¨‹åºæ›´åŠ é«˜æ•ˆçš„æ‰§è¡Œç®¡ç†æ“ä½œï¼Œè€Œåˆä¸ä¼šå¸¦æ¥è¿‡é«˜çš„å†…å­˜å¼€é”€ã€‚
Source Analysis # TODO ç»“åˆæºç æ¥åˆ†æä¸‹go schedulerçš„è¯¦ç»†è¿‡ç¨‹ï¼Œä»¥åŠg0çš„è¯¦ç»†ç”¨é€”
References # https://medium.com/a-journey-with-go/go-g0-special-goroutine-8c778c6704d8</description></item><item><title>go GC: latency problem solved</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/go-GC-latency-problem-solved/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/go-GC-latency-problem-solved/</guid><description>Let&amp;rsquo;s Summarize # è¿™é‡Œåªç»™äº†ä¸€äº›go 1.15å¯¹æ¯”1.14çš„benchmarkæ•°æ®ï¼Œå¹¶æ²¡æœ‰ä»‹ç»å…·ä½“æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚
Source Analysis # References # https://talks.golang.org/2015/go-gc.pdf?utm_medium=twitter&amp;utm_source=twitterfeed</description></item><item><title>go GC: latency problem solved</title><link>https://hitzhangjie.pro/go-internals-v2/posts/go-GC-latency-problem-solved/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/go-GC-latency-problem-solved/</guid><description>Let&amp;rsquo;s Summarize # è¿™é‡Œåªç»™äº†ä¸€äº›go 1.15å¯¹æ¯”1.14çš„benchmarkæ•°æ®ï¼Œå¹¶æ²¡æœ‰ä»‹ç»å…·ä½“æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚
Source Analysis # References # https://talks.golang.org/2015/go-gc.pdf?utm_medium=twitter&amp;utm_source=twitterfeed</description></item><item><title>go GC: prioritizing low latency and simplicity</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/go-GC-prioritizing-low-latency-and-simplicity/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/go-GC-prioritizing-low-latency-and-simplicity/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å½“å‰è½¯ç¡¬ä»¶å¤§è§„æ¨¡å‘å±•çš„è¶‹åŠ¿ä»¥åŠgo GCéœ€è¦ä¼˜å…ˆè§£å†³çš„é—®é¢˜ï¼šä½å»¶è¿Ÿå’Œç®€å•æ€§ï¼ˆé€šè¿‡ä¸€ä¸ªå‚æ•°å°±å¯ä»¥æ§åˆ¶ï¼Œè€ŒéåƒJVMè°ƒå‚é‚£æ ·ï¼‰ã€‚
goå›¢é˜Ÿçš„ç›®æ ‡æ˜¯è®¾è®¡ä¸€ä¸ªé¢å‘æœªæ¥åå¹´çš„åƒåœ¾å›æ”¶å™¨ï¼Œå€Ÿé‰´äº†åå‡ å¹´å‰å‘æ˜çš„ç®—æ³•ã€‚go GCä½¿ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆconcurrent, tri-color, mark-sweep collectorï¼‰ï¼Œç”±Dijkstraåœ¨1978å¹´æå‡ºã€‚è¯¥ç®—æ³•ä¸ç°åœ¨å¤§å¤šæ•°ä¼ä¸šçº§çš„GCå®ç°ä¸åŒï¼Œä½†æ˜¯goå›¢é˜Ÿè®¤ä¸ºè¯¥ç®—æ³•æ›´é€‚åˆäºç°ä»£ç¡¬ä»¶çš„å‘å±•ï¼Œä¹Ÿæ›´æœ‰åŠ©äºå®ç°ç°ä»£è½¯ä»¶çš„GCä½å»¶è¿Ÿç›®æ ‡ã€‚
è¯¥GCç®—æ³•ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡åªèƒ½æ˜¯whiteã€greyã€blackä¸­çš„å…¶ä¸­ä¸€ç§ï¼Œheapå¯ä»¥çœ‹åšæ˜¯äº’ç›¸è¿æ¥çš„å¯¹è±¡æ„æˆçš„ä¸€ä¸ªgraphã€‚GCç®—æ³•æµç¨‹æ˜¯ï¼š
GCå¼€å§‹æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯whiteï¼› GCéå†æ‰€æœ‰çš„rootså¯¹è±¡ï¼ˆæ¯”å¦‚å…¨å±€å˜é‡ã€æ ˆå˜é‡ï¼‰å°†å…¶æ ‡è®°ä¸ºç°è‰²ï¼› ç„¶åGCé€‰æ‹©ä¸€ä¸ªgreyå¯¹è±¡ï¼Œå°†å…¶æ ‡è®°ä¸ºblackï¼Œå¹¶æ‰«æï¼ˆscanï¼‰è¯¥å¯¹è±¡æ£€æŸ¥å®ƒå†…éƒ¨çš„æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆã€‚å¦‚æœå‘ç°æœ‰æŒ‡é’ˆæŒ‡å‘å…¶ä»–whiteå¯¹è±¡ï¼Œå°†whiteå¯¹è±¡æ ‡è®°ä¸ºgreyï¼› è¯¥è¿‡ç¨‹é‡å¤æ‰§è¡Œï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•çš„ç°è‰²å¯¹è±¡ï¼› æœ€åï¼Œå‰©ä¸‹çš„ç™½è‰²å¯¹è±¡å³è®¤ä¸ºæ˜¯ä¸å¯è¾¾å¯¹è±¡ï¼Œå¯ä»¥è¢«å›æ”¶å†åˆ©ç”¨ï¼› GCè¿‡ç¨‹å’Œåº”ç”¨ç¨‹åºæ‰§è¡Œæ˜¯å¹¶å‘è¿›è¡Œçš„ï¼Œåº”ç”¨ç¨‹åºä¹Ÿç§°ä¸ºmutatorï¼Œå®ƒä¼šåœ¨GCè¿è¡ŒæœŸé—´ä¿®æ”¹ä¸€äº›æŒ‡é’ˆçš„å€¼ã€‚mutatorå¿…é¡»éµå¾ªè¿™æ ·ä¸€æ¡è§„åˆ™ï¼Œå°±æ˜¯ä¸å…è®¸å‡ºç°ä¸€ä¸ªé»‘è‰²å¯¹è±¡æŒ‡å‘ä¸€ä¸ªç™½è‰²å¯¹è±¡ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶ã€‚ä¸ºäº†ä¿è¯è¯¥è§„åˆ™æˆç«‹ï¼Œå°±éœ€è¦å¼•å…¥å†™å±éšœï¼ˆwrite barrierï¼‰ï¼Œå®ƒæ˜¯ç¼–è¯‘é˜¶æ®µç”±ç¼–è¯‘å™¨å¯¹mutatoræŒ‡é’ˆæ“ä½œå®‰æ’çš„ä¸€äº›ç‰¹æ®ŠæŒ‡ä»¤ï¼Œç”¨æ¥è·Ÿè¸ªå¯¹æŒ‡é’ˆçš„ä¿®æ”¹ï¼Œwrite barrierå¦‚æœå‘ç°å½“å‰é»‘è‰²å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆå­—æ®µæŒ‡å‘äº†å¤–éƒ¨çš„ä¸€ä¸ªç™½è‰²å¯¹è±¡ï¼Œåˆ™ä¼šå°†ç™½è‰²å¯¹è±¡æŸ“è‰²ä¸ºgreyï¼Œé¿å…å…¶è¢«é”™è¯¯åœ°GCæ‰ï¼Œä¹Ÿä¿è¯å…¶å¯ä»¥è¢«ç»§ç»­æ‰«æã€‚
æœ‰äº›GCç›¸å…³çš„é—®é¢˜ï¼š
ä»€ä¹ˆæ—¶å€™å¯åŠ¨GCï¼Ÿ é€šè¿‡å“ªäº›æŒ‡æ ‡æ¥åˆ¤æ–­è¦å¯åŠ¨GCï¼Ÿ GCåº”è¯¥å¦‚ä½•ä¸schedulerè¿›è¡Œäº¤äº’ï¼Ÿ å¦‚ä½•æš‚åœä¸€ä¸ªmutatorçº¿ç¨‹è¶³å¤Ÿé•¿æ—¶é—´ï¼Œä»¥æ‰«æå™¨stackï¼Ÿ å¦‚ä½•è¡¨ç¤ºwhiteã€greyå’Œblackä¸‰ç§é¢œè‰²æ¥å®ç°é«˜æ•ˆåœ°æŸ¥æ‰¾ã€æ‰«ægreyå¯¹è±¡ï¼Ÿ å¦‚ä½•çŸ¥é“rootså¯¹è±¡åœ¨å“ªé‡Œï¼Ÿ å¦‚ä½•çŸ¥é“ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆçš„ä½ç½®ï¼Ÿ å¦‚ä½•æœ€å°åŒ–å†…å­˜ç¢ç‰‡ï¼Ÿ å¦‚ä½•è§£å†³cacheæ€§èƒ½é—®é¢˜ï¼Ÿ heapåº”è¯¥è®¾ç½®ä¸ºå¤šå¤§ï¼Ÿ ç­‰ç­‰ã€‚ ä¸Šè¿°é—®é¢˜æœ‰äº›ä¸å†…å­˜åˆ†é…æœ‰å…³ï¼Œæœ‰äº›ä¸å¯è¾¾å¯¹è±¡åˆ†ææœ‰å…³ï¼Œæœ‰äº›ä¸goroutineè°ƒåº¦æœ‰å…³ï¼Œæœ‰äº›ä¸æ€§èƒ½æœ‰å…³ï¼Œå…³äºè¿™äº›å†…å®¹çš„è®¨è®ºè¿œè¿œè¶…å‡ºæœ¬æ–‡ç¯‡å¹…ï¼Œå¯ä»¥è‡ªå·±å‚è€ƒç›¸å…³çš„ææ–™ã€‚
ä¸ºäº†è§£å†³GCæ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä¸ºæ¯ä¸€ç§ä¼˜åŒ–åŠ ä¸ªå‚æ•°æ¥æ§åˆ¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥è‡ªå·±è°ƒæ•´è¿™é‡Œçš„å‚æ•°æ¥è¾¾åˆ°æƒ³è¦çš„ä¼˜åŒ–æ•ˆæœã€‚ä½†æ˜¯è¿™ç§åšæ³•æ—¶é—´ä¹…äº†ä¹‹åä¼šå‘ç°æœ‰éå¸¸å¤šçš„å‚æ•°ï¼Œè°ƒä¼˜å°±ä¼šå˜å¾—éå¸¸å›°éš¾ï¼Œæ¯”å¦‚JVMè°ƒä¼˜ã€‚goå›¢é˜Ÿä¸æƒ³èµ°è¿™æ ·çš„è€è·¯ï¼ŒåŠ›æ±‚ç®€å•é«˜æ•ˆã€‚
goé€šè¿‡GOGCè¿™ä¸ªç¯å¢ƒå˜é‡æ¥æ§åˆ¶æ•´ä¸ªå †å¤§å°ç›¸å¯¹äºç°é˜¶æ®µå¯è¾¾å¯¹è±¡å¤§å°çš„æ¯”ä¾‹ã€‚GOGCé»˜è®¤å€¼æ˜¯100%ï¼Œæ„å‘³ç€å½“å †å¤§å°å¢é•¿äº†å½“å‰å¯è¾¾å¯¹è±¡å¤§å°çš„1å€æ—¶ï¼ˆ2å€å¤§å°ï¼‰ï¼Œå°±ä¼šè§¦å‘GCï¼›200%åˆ™æ„å‘³ç€ç»§ç»­å¢é•¿äº†å½“å‰å¯è¾¾å¯¹è±¡çš„2å€æ—¶è§¦å‘GCï¼ˆ3å€å¤§å°ï¼‰ã€‚
å¦‚æœæƒ³é™ä½GCèŠ±è´¹çš„æ—¶é—´ï¼Œå°±æŠŠè¿™ä¸ªå€¼è®¾ç½®çš„å¤§ä¸€ç‚¹ï¼Œå› ä¸ºè¿™æ ·ä¸å®¹æ˜“é¢‘ç¹è§¦å‘GCï¼› å¦‚æœæ„¿æ„èŠ±è´¹æ›´å¤šçš„GCæ—¶é—´æ¥æ¢å–æ›´å°‘çš„å†…å­˜å ç”¨ï¼Œå°±æŠŠè¿™ä¸ªå€¼è®¾ç½®çš„å°ä¸€ç‚¹ï¼Œå› ä¸ºè¿™æ ·èƒ½å¤Ÿæ›´åŠ é¢‘ç¹åœ°GCï¼› å‰é¢æåˆ°goå›¢é˜Ÿè¦è®¾è®¡ä¸€ä¸ªé¢å‘æœªæ¥åå¹´çš„åƒåœ¾å›æ”¶å™¨ï¼Œæœªæ¥åå¹´æœºå™¨å†…å­˜å®¹é‡å¯èƒ½ä¼šç¿»å€æˆ–è€…æˆå€å¢é•¿ï¼Œç®€å•åœ°å°†GOGCè®¾ç½®ä¸ºä¸€å®šå€ç‡ä¹Ÿå¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä¹Ÿä¸ç”¨åƒJVMè°ƒä¼˜é‚£æ ·é‡æ–°è®¾ç½®ä¸€å †åœ°å‚æ•°ï¼Œè°ƒå‚å¤§å†›å¥½æƒ¨ã€‚goå›¢é˜Ÿä¹Ÿå¯ä»¥å€¾å¬ç”¨æˆ·çœŸæ­£åœ°è¯‰æ±‚åœ¨è¿è¡Œæ—¶æ–¹é¢åšæ›´å¤šçš„ä¼˜åŒ–ã€‚
Source Analysis # References # https://blog.golang.org/go15gc</description></item><item><title>go GC: prioritizing low latency and simplicity</title><link>https://hitzhangjie.pro/go-internals-v2/posts/go-GC-prioritizing-low-latency-and-simplicity/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/go-GC-prioritizing-low-latency-and-simplicity/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å½“å‰è½¯ç¡¬ä»¶å¤§è§„æ¨¡å‘å±•çš„è¶‹åŠ¿ä»¥åŠgo GCéœ€è¦ä¼˜å…ˆè§£å†³çš„é—®é¢˜ï¼šä½å»¶è¿Ÿå’Œç®€å•æ€§ï¼ˆé€šè¿‡ä¸€ä¸ªå‚æ•°å°±å¯ä»¥æ§åˆ¶ï¼Œè€ŒéåƒJVMè°ƒå‚é‚£æ ·ï¼‰ã€‚
goå›¢é˜Ÿçš„ç›®æ ‡æ˜¯è®¾è®¡ä¸€ä¸ªé¢å‘æœªæ¥åå¹´çš„åƒåœ¾å›æ”¶å™¨ï¼Œå€Ÿé‰´äº†åå‡ å¹´å‰å‘æ˜çš„ç®—æ³•ã€‚go GCä½¿ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆconcurrent, tri-color, mark-sweep collectorï¼‰ï¼Œç”±Dijkstraåœ¨1978å¹´æå‡ºã€‚è¯¥ç®—æ³•ä¸ç°åœ¨å¤§å¤šæ•°ä¼ä¸šçº§çš„GCå®ç°ä¸åŒï¼Œä½†æ˜¯goå›¢é˜Ÿè®¤ä¸ºè¯¥ç®—æ³•æ›´é€‚åˆäºç°ä»£ç¡¬ä»¶çš„å‘å±•ï¼Œä¹Ÿæ›´æœ‰åŠ©äºå®ç°ç°ä»£è½¯ä»¶çš„GCä½å»¶è¿Ÿç›®æ ‡ã€‚
è¯¥GCç®—æ³•ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡åªèƒ½æ˜¯whiteã€greyã€blackä¸­çš„å…¶ä¸­ä¸€ç§ï¼Œheapå¯ä»¥çœ‹åšæ˜¯äº’ç›¸è¿æ¥çš„å¯¹è±¡æ„æˆçš„ä¸€ä¸ªgraphã€‚GCç®—æ³•æµç¨‹æ˜¯ï¼š
GCå¼€å§‹æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯whiteï¼› GCéå†æ‰€æœ‰çš„rootså¯¹è±¡ï¼ˆæ¯”å¦‚å…¨å±€å˜é‡ã€æ ˆå˜é‡ï¼‰å°†å…¶æ ‡è®°ä¸ºç°è‰²ï¼› ç„¶åGCé€‰æ‹©ä¸€ä¸ªgreyå¯¹è±¡ï¼Œå°†å…¶æ ‡è®°ä¸ºblackï¼Œå¹¶æ‰«æï¼ˆscanï¼‰è¯¥å¯¹è±¡æ£€æŸ¥å®ƒå†…éƒ¨çš„æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆã€‚å¦‚æœå‘ç°æœ‰æŒ‡é’ˆæŒ‡å‘å…¶ä»–whiteå¯¹è±¡ï¼Œå°†whiteå¯¹è±¡æ ‡è®°ä¸ºgreyï¼› è¯¥è¿‡ç¨‹é‡å¤æ‰§è¡Œï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•çš„ç°è‰²å¯¹è±¡ï¼› æœ€åï¼Œå‰©ä¸‹çš„ç™½è‰²å¯¹è±¡å³è®¤ä¸ºæ˜¯ä¸å¯è¾¾å¯¹è±¡ï¼Œå¯ä»¥è¢«å›æ”¶å†åˆ©ç”¨ï¼› GCè¿‡ç¨‹å’Œåº”ç”¨ç¨‹åºæ‰§è¡Œæ˜¯å¹¶å‘è¿›è¡Œçš„ï¼Œåº”ç”¨ç¨‹åºä¹Ÿç§°ä¸ºmutatorï¼Œå®ƒä¼šåœ¨GCè¿è¡ŒæœŸé—´ä¿®æ”¹ä¸€äº›æŒ‡é’ˆçš„å€¼ã€‚mutatorå¿…é¡»éµå¾ªè¿™æ ·ä¸€æ¡è§„åˆ™ï¼Œå°±æ˜¯ä¸å…è®¸å‡ºç°ä¸€ä¸ªé»‘è‰²å¯¹è±¡æŒ‡å‘ä¸€ä¸ªç™½è‰²å¯¹è±¡ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶ã€‚ä¸ºäº†ä¿è¯è¯¥è§„åˆ™æˆç«‹ï¼Œå°±éœ€è¦å¼•å…¥å†™å±éšœï¼ˆwrite barrierï¼‰ï¼Œå®ƒæ˜¯ç¼–è¯‘é˜¶æ®µç”±ç¼–è¯‘å™¨å¯¹mutatoræŒ‡é’ˆæ“ä½œå®‰æ’çš„ä¸€äº›ç‰¹æ®ŠæŒ‡ä»¤ï¼Œç”¨æ¥è·Ÿè¸ªå¯¹æŒ‡é’ˆçš„ä¿®æ”¹ï¼Œwrite barrierå¦‚æœå‘ç°å½“å‰é»‘è‰²å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆå­—æ®µæŒ‡å‘äº†å¤–éƒ¨çš„ä¸€ä¸ªç™½è‰²å¯¹è±¡ï¼Œåˆ™ä¼šå°†ç™½è‰²å¯¹è±¡æŸ“è‰²ä¸ºgreyï¼Œé¿å…å…¶è¢«é”™è¯¯åœ°GCæ‰ï¼Œä¹Ÿä¿è¯å…¶å¯ä»¥è¢«ç»§ç»­æ‰«æã€‚
æœ‰äº›GCç›¸å…³çš„é—®é¢˜ï¼š
ä»€ä¹ˆæ—¶å€™å¯åŠ¨GCï¼Ÿ é€šè¿‡å“ªäº›æŒ‡æ ‡æ¥åˆ¤æ–­è¦å¯åŠ¨GCï¼Ÿ GCåº”è¯¥å¦‚ä½•ä¸schedulerè¿›è¡Œäº¤äº’ï¼Ÿ å¦‚ä½•æš‚åœä¸€ä¸ªmutatorçº¿ç¨‹è¶³å¤Ÿé•¿æ—¶é—´ï¼Œä»¥æ‰«æå™¨stackï¼Ÿ å¦‚ä½•è¡¨ç¤ºwhiteã€greyå’Œblackä¸‰ç§é¢œè‰²æ¥å®ç°é«˜æ•ˆåœ°æŸ¥æ‰¾ã€æ‰«ægreyå¯¹è±¡ï¼Ÿ å¦‚ä½•çŸ¥é“rootså¯¹è±¡åœ¨å“ªé‡Œï¼Ÿ å¦‚ä½•çŸ¥é“ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆçš„ä½ç½®ï¼Ÿ å¦‚ä½•æœ€å°åŒ–å†…å­˜ç¢ç‰‡ï¼Ÿ å¦‚ä½•è§£å†³cacheæ€§èƒ½é—®é¢˜ï¼Ÿ heapåº”è¯¥è®¾ç½®ä¸ºå¤šå¤§ï¼Ÿ ç­‰ç­‰ã€‚ ä¸Šè¿°é—®é¢˜æœ‰äº›ä¸å†…å­˜åˆ†é…æœ‰å…³ï¼Œæœ‰äº›ä¸å¯è¾¾å¯¹è±¡åˆ†ææœ‰å…³ï¼Œæœ‰äº›ä¸goroutineè°ƒåº¦æœ‰å…³ï¼Œæœ‰äº›ä¸æ€§èƒ½æœ‰å…³ï¼Œå…³äºè¿™äº›å†…å®¹çš„è®¨è®ºè¿œè¿œè¶…å‡ºæœ¬æ–‡ç¯‡å¹…ï¼Œå¯ä»¥è‡ªå·±å‚è€ƒç›¸å…³çš„ææ–™ã€‚
ä¸ºäº†è§£å†³GCæ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä¸ºæ¯ä¸€ç§ä¼˜åŒ–åŠ ä¸ªå‚æ•°æ¥æ§åˆ¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥è‡ªå·±è°ƒæ•´è¿™é‡Œçš„å‚æ•°æ¥è¾¾åˆ°æƒ³è¦çš„ä¼˜åŒ–æ•ˆæœã€‚ä½†æ˜¯è¿™ç§åšæ³•æ—¶é—´ä¹…äº†ä¹‹åä¼šå‘ç°æœ‰éå¸¸å¤šçš„å‚æ•°ï¼Œè°ƒä¼˜å°±ä¼šå˜å¾—éå¸¸å›°éš¾ï¼Œæ¯”å¦‚JVMè°ƒä¼˜ã€‚goå›¢é˜Ÿä¸æƒ³èµ°è¿™æ ·çš„è€è·¯ï¼ŒåŠ›æ±‚ç®€å•é«˜æ•ˆã€‚
goé€šè¿‡GOGCè¿™ä¸ªç¯å¢ƒå˜é‡æ¥æ§åˆ¶æ•´ä¸ªå †å¤§å°ç›¸å¯¹äºç°é˜¶æ®µå¯è¾¾å¯¹è±¡å¤§å°çš„æ¯”ä¾‹ã€‚GOGCé»˜è®¤å€¼æ˜¯100%ï¼Œæ„å‘³ç€å½“å †å¤§å°å¢é•¿äº†å½“å‰å¯è¾¾å¯¹è±¡å¤§å°çš„1å€æ—¶ï¼ˆ2å€å¤§å°ï¼‰ï¼Œå°±ä¼šè§¦å‘GCï¼›200%åˆ™æ„å‘³ç€ç»§ç»­å¢é•¿äº†å½“å‰å¯è¾¾å¯¹è±¡çš„2å€æ—¶è§¦å‘GCï¼ˆ3å€å¤§å°ï¼‰ã€‚
å¦‚æœæƒ³é™ä½GCèŠ±è´¹çš„æ—¶é—´ï¼Œå°±æŠŠè¿™ä¸ªå€¼è®¾ç½®çš„å¤§ä¸€ç‚¹ï¼Œå› ä¸ºè¿™æ ·ä¸å®¹æ˜“é¢‘ç¹è§¦å‘GCï¼› å¦‚æœæ„¿æ„èŠ±è´¹æ›´å¤šçš„GCæ—¶é—´æ¥æ¢å–æ›´å°‘çš„å†…å­˜å ç”¨ï¼Œå°±æŠŠè¿™ä¸ªå€¼è®¾ç½®çš„å°ä¸€ç‚¹ï¼Œå› ä¸ºè¿™æ ·èƒ½å¤Ÿæ›´åŠ é¢‘ç¹åœ°GCï¼› å‰é¢æåˆ°goå›¢é˜Ÿè¦è®¾è®¡ä¸€ä¸ªé¢å‘æœªæ¥åå¹´çš„åƒåœ¾å›æ”¶å™¨ï¼Œæœªæ¥åå¹´æœºå™¨å†…å­˜å®¹é‡å¯èƒ½ä¼šç¿»å€æˆ–è€…æˆå€å¢é•¿ï¼Œç®€å•åœ°å°†GOGCè®¾ç½®ä¸ºä¸€å®šå€ç‡ä¹Ÿå¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä¹Ÿä¸ç”¨åƒJVMè°ƒä¼˜é‚£æ ·é‡æ–°è®¾ç½®ä¸€å †åœ°å‚æ•°ï¼Œè°ƒå‚å¤§å†›å¥½æƒ¨ã€‚goå›¢é˜Ÿä¹Ÿå¯ä»¥å€¾å¬ç”¨æˆ·çœŸæ­£åœ°è¯‰æ±‚åœ¨è¿è¡Œæ—¶æ–¹é¢åšæ›´å¤šçš„ä¼˜åŒ–ã€‚
Source Analysis # References # https://blog.golang.org/go15gc</description></item><item><title>go plugin system</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Plugins/go-plugin-system/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Plugins/go-plugin-system/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goçš„æ’ä»¶æœºåˆ¶ï¼š 1ã€ä¸€ç§æ˜¯ç¼–è¯‘æ—¶æ’ä»¶æœºåˆ¶ï¼Œåªéœ€è¦æ˜¾ç¤ºimportï¼Œç„¶åæ’ä»¶å®ç°é‡Œé¢æ˜¾ç¤ºæ³¨å†Œï¼Œè¿™ç§æ¯”è¾ƒå¸¸è§ï¼Œæ¯”å¦‚database/sqlçš„é©±åŠ¨å®ç°mysqlè¿™ç§æ–¹å¼ï¼› 2ã€ä¸€ç§æ˜¯è¿è¡Œæ—¶æ’ä»¶æœºåˆ¶ï¼Œè¿™ç§éœ€è¦åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€åŠ è½½ï¼Œæ¯”å¦‚å°†æ’ä»¶ç¼–è¯‘ä¸ºå…±äº«åº“æ–‡ä»¶*.soï¼Œç„¶åä¸»ç¨‹åºåŠ¨æ€åŠ è½½å¹¶è°ƒç”¨åˆå§‹åŒ–æ’ä»¶æ–¹æ³•å®Œæˆåˆå§‹åŒ–ï¼› 3ã€ä¸€ç§æ˜¯ä¸»ç¨‹åºä¸æ’ä»¶è¿›ç¨‹éš”ç¦»ï¼Œå½¼æ­¤ä¹‹é—´é€šè¿‡è¿›ç¨‹é—´é€šä¿¡æ¥è§£å†³ï¼Œé€šä¿¡æ–¹å¼å¯ä»¥æ˜¯pipeã€fifoã€rpcç­‰ï¼Œhashicorp/go-pluginä¸ºè¿™ç§æ’ä»¶æœºåˆ¶æä¾›äº†æ”¯æŒã€‚
Source Analysis # References # https://eli.thegreenplace.net/2021/plugins-in-go/</description></item><item><title>go register ABI</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/ABI/go-register-ABI/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/ABI/go-register-ABI/</guid><description>Let&amp;rsquo;s Summarize # goä»1.17å¼€å§‹ä½¿ç”¨åŸºäºå¯„å­˜å™¨çš„ABIï¼Œä»¥å‰çš„æ—¶å€™æ˜¯é€šè¿‡æ ˆå˜é‡çš„å½¢å¼æ¥ä¼ é€’å‡½æ•°å‚æ•°ã€è¿”å›å€¼ä¿¡æ¯çš„ï¼Œç°åœ¨æ”¹æˆé€šè¿‡å¯„å­˜å™¨äº†ã€‚go1.17ä¸­åªæœ‰amd64æ¶æ„é‡‡ç”¨äº†åŸºäºå¯„å­˜å™¨çš„ABIï¼Œgo1.18ä¸­æ‰©å±•åˆ°äº†æ›´å¤šçš„æ¶æ„ä¸­ã€‚
Source Analysis # References # https://eli.thegreenplace.net/2022/interface-method-calls-with-the-go-register-abi/</description></item><item><title>go spec</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Specification/go-spec/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Specification/go-spec/</guid><description>Let&amp;rsquo;s Summarize # go specæè¿°äº†goè¯­è¨€æ–‡æ³•ï¼ˆè¯­æ³•ï¼‰ï¼Œé€šè¿‡é˜…è¯»è¿™é‡Œçš„å†…å®¹ï¼Œå¯ä»¥äº†è§£åˆ°æ•´ä¸ªè¯­è¨€åœ¨å¸¸è§„å†™æ³•ä¸Šçš„ä¸€äº›å†…å®¹ï¼Œä¸€äº›å¯èƒ½æ¯”è¾ƒéšæ™¦çš„é—®é¢˜ä¹Ÿèƒ½ææ˜ç™½è¿™èƒŒåçš„åŸå› æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚æ–­è¡Œè§„åˆ™æ€ä¹ˆæ¥çš„ã€iotaå–å€¼æ€ä¹ˆæ¥çš„ç­‰ç­‰çš„å§ã€‚ä¸ªäººæ„Ÿè§‰é€šè¯»ä¸€ä¸‹è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
go specå°±æ˜¯goè¯­è¨€çš„ä¸€äº›è§„èŒƒï¼ŒåŒ…æ‹¬ï¼š
æè¿°äº†goè¯­è¨€æ–‡æ³•ï¼ˆgrammarï¼‰ï¼Œgo specçš„æ–‡æ³•æ˜¯é€šè¿‡EBNFå®šä¹‰çš„ã€‚ ä»è¿™é‡Œå¯ä»¥äº†è§£åˆ°è¿™é—¨ç¼–ç¨‹è¯­è¨€åœ¨æ–‡æ³•å±‚é¢æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œæˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™å†™å‡ºçš„æºä»£ç å¿…é¡»ç¬¦åˆæ–‡æ³•å®šä¹‰ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šä¾ç…§æ­¤æ–‡æ³•å¯¹æºä»£ç è¿›è¡Œæ£€æŸ¥ï¼ˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼‰ã€‚ åœ¨å­¦ä¹ ç¼–è¯‘åŸç†è¯¾ç¨‹æ—¶ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€é—¨è¯­è¨€ï¼Œå‡è®¾è¿™é—¨è¯­è¨€çš„åŠŸèƒ½æ”¯æŒå·²ç»ç¡®å®šäº†ï¼Œæˆ‘ä»¬ç°åœ¨ä¹Ÿå¤§è‡´ç¡®å®šäº†è¿™é—¨ç¼–ç¨‹è¯­è¨€çš„å†™æ³•ï¼Œä¸ºäº†æŒ‡å¯¼åˆ«äººè¿™ä¸ªè¯­è¨€å¯ä»¥æ€ä¹ˆå†™ã€ç¼–è¯‘å™¨è¯¥å¦‚ä½•è§£æï¼Œå°±è¦å®šä¹‰å‡ºæ–‡æ³•ã€‚ æ–‡æ³•å®šä¹‰ä¸€èˆ¬é€šè¿‡BNFæˆ–è€…EBNFï¼Œåè€…ç”¨çš„æ›´å¤šäº›ï¼Œå…¶åœ¨æè¿°ç¼–ç¨‹è¯­è¨€èƒ½åŠ›ä¸Šå¹¶æ²¡æœ‰æ¯”BNFå¼ºå¾ˆå¤šï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”Ÿæˆæ›´ç²¾ç‚¼çš„è§„åˆ™ã€‚è¦æƒ³ç†è§£go specä¸­å®šä¹‰çš„æ–‡æ³•ï¼Œè¿˜æ˜¯éœ€è¦ç†è§£ä¸‹EBNFçš„å¤§è‡´å†…å®¹ï¼Œsee alsoï¼šhttps://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_formã€‚
goæºä»£ç é‡‡ç”¨utf8ç¼–ç ï¼Œå¯¹äºç‰¹æ®Šå­—ç¬¦å¦‚0xfeffï¼ˆbomï¼‰çš„å¿½ç•¥ç­‰ç‰¹æ®Šå¤„ç†ã€‚
goæºç è¡¨ç¤º
charactersï¼šnewlineã€unicode_charã€unicode_letterã€unicode_digitçš„è¡¨ç¤º letters and digitsï¼šletterã€decimal_digitã€binary_digitã€octal_digitã€hex_digitçš„è¡¨ç¤º goè¯æ³•å…ƒç´ ï¼ˆlexical elementsï¼‰
æ³¨é‡Šã€ tokensï¼ˆå››ç±»ï¼šidentifier, keyword, operators å’Œ punctuation, literals)ï¼Œwhitespaceçš„æ„æˆï¼ˆç©ºæ ¼ã€tabã€å›è½¦ã€æ¢è¡Œï¼‰åŠä»€ä¹ˆæƒ…å†µä¸‹å¯å¿½ç•¥ï¼Œæ¢è¡ŒEOLå’Œæ–‡ä»¶ç»“æŸEOFä¼šæ›¿æ¢æˆåˆ†å·â€™;â€™ã€‚ semicolonsï¼ˆåˆ†å·çš„æ–­è¡Œè§„åˆ™ï¼‰ï¼Œè¯æ³•åˆ†ææ—¶ä»€ä¹ˆæ—¶å€™ä¼šè‡ªåŠ¨æ’å…¥åˆ†å·ã€‚è¿™äº›åˆ†å·æ˜¯è‡ªåŠ¨æ’å…¥çš„ä»¥å……å½“è¯­å¥ç»“æŸæ—¶çš„ç»ˆç»“ç¬¦ã€‚ identifiersçš„ç”Ÿæˆè§„åˆ™ keywordsï¼Œä¸èƒ½å®šä¹‰ä¸å…³é”®å­—ã€ä¿ç•™å­—ç›¸åŒçš„æ ‡è¯†ç¬¦ operators and punctruationï¼Œæœ‰å‡ ä¸ªä½è¿ç®—ç¬¦æœ‰ç‚¹å’Œå…¶ä»–è¯­è¨€ä¸ä¸€æ ·ğŸ˜Ÿ integer literalsï¼Œå¦‚ä½•è¡¨ç¤ºä¸€ä¸ªæ•°æ˜¯ä»€ä¹ˆè¿›åˆ¶çš„æ•°å­—å‘¢ï¼Ÿ0b/0Bå‰ç¼€è¡¨ç¤ºäºŒè¿›åˆ¶æ•°ï¼Œ0/0o/0Oè¡¨ç¤ºå…«è¿›åˆ¶æ•°ï¼Œ0x/0Xè¡¨ç¤ºåå…­è¿›åˆ¶æ•°ï¼Œæ²¡æœ‰å‰ç¼€ã€å•ç‹¬ä¸€ä¸ª0è¡¨ç¤ºåè¿›åˆ¶æ•°ã€‚è¿™äº›è¿›åˆ¶æ•°çš„å‰ç¼€åé¢å¯ä»¥é€šè¿‡ä¸‹åˆ’çº¿â€™_â€™å’Œæ•°å­—ç›¸è¿æ¥æé«˜å¯è¯»æ€§ã€‚å¯¹äºåè¿›åˆ¶æ•°è€Œè¨€ï¼Œ1_2 == 12ï¼ˆweired! ğŸ˜Ÿ) floating-point literalsï¼Œç•¥ imaginary literalsï¼Œè™šæ•°ï¼Œç•¥ rune literalsï¼Œä¸»è¦æ˜¯è¿™å‡ ä¸ªï¼š\aï¼ˆalert or bellï¼‰ï¼Œ\f ï¼ˆform feedï¼Œæ•ˆæœç›¸å½“äºå…‰æ ‡ä¸‹ç§»ä¸€è¡Œï¼‰ï¼Œ\rï¼ˆcarriage returnï¼Œæ•ˆæœç›¸å½“äºç§»åˆ°è¡Œé¦–è¦†ç›–å†™ï¼‰ï¼Œ\nï¼ˆnew lineï¼Œæ¢æ–°è¡Œï¼‰ï¼Œ\t ï¼ˆhorizontal tabï¼‰ï¼Œ\vï¼ˆvertical tabï¼‰ï¼Œ\b ï¼ˆbackspaceï¼Œåˆ é™¤å‰é¢çš„è¾“å‡ºå­—ç¬¦ï¼‰ string literalsï¼Œè¿™ä¸ªæ³¨é‡Šä¸¤ç§æ¨¡å¼raw stringå’Œâ€interpreted stringâ€ï¼Œå‰è€…stringä¸­çš„è½¬ç§»å­—ç¬¦â€™\â€™éƒ½æ˜¯æ™®é€šå­—ç¬¦ã€æ²¡æœ‰è½¬ä¹‰åŠ¨ä½œï¼Œè€Œåè€…é‡Œé¢çš„å­—ç¬¦è½¬ä¹‰å­—ç¬¦å°±æœ‰è½¬ä¹‰åŠ¨ä½œã€‚ constantsï¼ŒåŒ…æ‹¬boolã€runeã€integerã€æµ®ç‚¹ã€å¤æ•°ã€å­—ç¬¦ä¸²å¸¸é‡ï¼Œruneã€integerã€æµ®ç‚¹ã€å¤æ•°ç»Ÿä¸€çœ‹åšæ•°å€¼å¸¸é‡ã€‚constantså¯ä»¥æ˜¯æœ‰ç±»å‹çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ— ç±»å‹çš„ã€‚å¯¹äºæ— ç±»å‹æ•°å€¼å¸¸é‡ï¼Œå¯ä»¥ä½¿ç”¨æ›´é«˜çš„ç²¾åº¦ï¼ˆ256bitsç²¾åº¦ï¼‰ï¼Œseeï¼šhttps://blog.</description></item><item><title>GOMAXPROCS &amp; live updates</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/GOMAXPROCS-live-updates/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/GOMAXPROCS-live-updates/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†GOMAXPROCSçš„ä½œç”¨ï¼Œå®ƒæ§åˆ¶äº†æœ€å¤šåŒæ—¶æœ‰å¤šå°‘ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚é™¤äº†è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡runtime.MAXPROCS(n)æ¥è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´å…è®¸live updateï¼ˆå®æ—¶æ›´æ–°ï¼‰ã€‚
è¯¥å€¼é»˜è®¤ç­‰äºå¯è§çš„CPUæ ¸æ•°ï¼Œä½†æ˜¯åœ¨dockerå®¹å™¨é‡Œé¢å¸Œæœ›åšäº›èµ„æºéš”ç¦»ï¼Œæ¯”å¦‚å¸Œæœ›goç¨‹åºå°†æœ€å¤§å¹¶å‘æ‰§è¡Œæ“ä½œç³»ç»Ÿçº¿ç¨‹æ•°è®¾ç½®ä¸ºåˆ†é…ç»™å®¹å™¨çš„CPUæ ¸æ•°ï¼Œè€Œéæ¯æœºçš„CPUæ ¸æ•°ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­æœ‰é‡åˆ°å› ä¸ºå®¹å™¨ä¸­è·å–çš„ä¸æ˜¯åˆ†é…çš„å®é™…æ ¸æ•°å¯¼è‡´çš„è°ƒåº¦é—®é¢˜ã€‚
GOMAXPROCSé€šå¸¸å»ºè®®è®¾ç½®ä¸ºå¯è§CPUæ•°æˆ–è€…æ ¸æ•°ã€‚å¦‚æœè®¾ç½®å€¼åå¤§ï¼Œåˆ™æ›´å¤šçš„çº¿ç¨‹è¢«åˆ›å»ºï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦å¤šçº¿ç¨‹åˆ°æœ‰é™çš„å¤„ç†å™¨æ ¸ä¸Šå°†ä¼šå¼•å…¥æ›´å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œåˆ‡æ¢ååç¨‹ç›¸å…³çš„è°ƒåº¦é—®é¢˜ä¹Ÿå°†å¼•å…¥æ›´å¤šçš„å¼€é”€ã€‚å¦‚æœè®¾ç½®æ›´å°ï¼Œå¹¶å‘åº¦ä½ï¼Œæ˜¾è€Œæ˜“è§ä¸åˆ©äºè·å¾—æ›´é«˜æ€§èƒ½ã€‚
psï¼šuberå¼€æºäº†ä¸€ä¸ªåº“æ¥ä¸“é—¨è·å–ã€è®¾ç½®å®¹å™¨å†…CPUçš„æ•°é‡ã€‚ see https://github.com/uber-go/automaxprocs
Source Analysis # References # https://medium.com/a-journey-with-go/go-gomaxprocs-live-updates-407ad08624e1</description></item><item><title>GOMAXPROCS &amp; live updates</title><link>https://hitzhangjie.pro/go-internals-v2/posts/GOMAXPROCS-live-updates/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/GOMAXPROCS-live-updates/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†GOMAXPROCSçš„ä½œç”¨ï¼Œå®ƒæ§åˆ¶äº†æœ€å¤šåŒæ—¶æœ‰å¤šå°‘ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚é™¤äº†è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡runtime.MAXPROCS(n)æ¥è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´å…è®¸live updateï¼ˆå®æ—¶æ›´æ–°ï¼‰ã€‚
è¯¥å€¼é»˜è®¤ç­‰äºå¯è§çš„CPUæ ¸æ•°ï¼Œä½†æ˜¯åœ¨dockerå®¹å™¨é‡Œé¢å¸Œæœ›åšäº›èµ„æºéš”ç¦»ï¼Œæ¯”å¦‚å¸Œæœ›goç¨‹åºå°†æœ€å¤§å¹¶å‘æ‰§è¡Œæ“ä½œç³»ç»Ÿçº¿ç¨‹æ•°è®¾ç½®ä¸ºåˆ†é…ç»™å®¹å™¨çš„CPUæ ¸æ•°ï¼Œè€Œéæ¯æœºçš„CPUæ ¸æ•°ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­æœ‰é‡åˆ°å› ä¸ºå®¹å™¨ä¸­è·å–çš„ä¸æ˜¯åˆ†é…çš„å®é™…æ ¸æ•°å¯¼è‡´çš„è°ƒåº¦é—®é¢˜ã€‚
GOMAXPROCSé€šå¸¸å»ºè®®è®¾ç½®ä¸ºå¯è§CPUæ•°æˆ–è€…æ ¸æ•°ã€‚å¦‚æœè®¾ç½®å€¼åå¤§ï¼Œåˆ™æ›´å¤šçš„çº¿ç¨‹è¢«åˆ›å»ºï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦å¤šçº¿ç¨‹åˆ°æœ‰é™çš„å¤„ç†å™¨æ ¸ä¸Šå°†ä¼šå¼•å…¥æ›´å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œåˆ‡æ¢ååç¨‹ç›¸å…³çš„è°ƒåº¦é—®é¢˜ä¹Ÿå°†å¼•å…¥æ›´å¤šçš„å¼€é”€ã€‚å¦‚æœè®¾ç½®æ›´å°ï¼Œå¹¶å‘åº¦ä½ï¼Œæ˜¾è€Œæ˜“è§ä¸åˆ©äºè·å¾—æ›´é«˜æ€§èƒ½ã€‚
psï¼šuberå¼€æºäº†ä¸€ä¸ªåº“æ¥ä¸“é—¨è·å–ã€è®¾ç½®å®¹å™¨å†…CPUçš„æ•°é‡ã€‚ see https://github.com/uber-go/automaxprocs
Source Analysis # References # https://medium.com/a-journey-with-go/go-gomaxprocs-live-updates-407ad08624e1</description></item><item><title>goroutine and preemption</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/goroutine-and-preemption/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/goroutine-and-preemption/</guid><description>Let&amp;rsquo;s Summarize # go1.14ä¹‹å‰ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¸€ä¸ªgoroutineå¯ä»¥è¢«æ ‡è®°ä¸ºå¯è¢«æŠ¢å å‘¢ï¼š
åœ¨å‡½æ•°åºè¨€prologueä¸­ä¼šåˆ¤æ–­å½“å‰å‡½æ•°æ˜¯å¦éœ€è¦æ›´å¤§çš„æ ˆç©ºé—´ï¼Œç¼–è¯‘å™¨ä¼šæ’å…¥runtime.morestack_noctxt(SB)æŒ‡ä»¤æ¥å¯¹æ­¤åšæ£€æŸ¥ï¼Œè¿™ä¸ªæ’å…¥çš„å‡½æ•°é‡Œé¢ä¹Ÿä¼šæ£€æŸ¥å½“å‰goroutineè¿è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡10msï¼Œè¶…è¿‡å°±æ ‡è®°ä¸ºå¯è¢«æŠ¢å ï¼› ps: è¿™é‡Œçš„è¯´æ³•å¯èƒ½å¹¶ä¸å‡†ç¡®ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ç”¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸éªŒè¯ï¼Œè¿™ä¸ª10msæ£€æŸ¥åˆ°åº•æ˜¯åœ¨å“ªé‡Œåˆ¤æ–­çš„å‘¢ï¼Ÿä¸çŸ¥é“ TODO
åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œæ¯”å¦‚ç°åœ¨çš„go1.16.3ä¸­ï¼Œsysmonä¸­ä¼šæ£€æŸ¥æ‰€æœ‰çš„Pæ£€æŸ¥å…¶è¿è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡äº†10msæ—¶é—´ï¼Œè¶…è¿‡åˆ™å¼ºåˆ¶æŠ¢å ï¼Œpreemptone(p)ï¼Œå†…éƒ¨ä¼šè®¾ç½®g.preempt=trueã€‚
ä½†æ˜¯æœ‰äº›å¾ªç¯æ˜¯è®¡ç®—å¯†é›†å‹çš„ï¼Œä¼šä¸€ç›´æ‰§è¡Œï¼Œè¿™æ ·å¯èƒ½å¾ˆä¹…ä¹‹åæ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„prologueä¸­æ£€æŸ¥åˆ°æ—©å°±è¯¥æ ‡è®°ä¸ºå¯è¢«æŠ¢å äº†ï¼Œä½†æ˜¯å¤ªè¿Ÿäº†ï¼› go1.14ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å¯ä»¥é€šè¿‡ä¸€äº›åä½œå¼æŠ¢å çš„åŠæ³•æ¥å®ç°goroutineæŠ¢å ï¼Œæ¯”å¦‚åœ¨forå¾ªç¯å†…å¦‚æœæ²¡æœ‰ å‡½æ•°è°ƒç”¨çš„è¯ï¼Œå¯ä»¥ï¼š
å®‰æ’ä¸€äº›æ— ç”¨çš„å‡½æ•°è°ƒç”¨ï¼Œæ¯”è¾ƒå±çš„æ–¹æ³•ï¼› æ˜¾ç¤ºæ‰§è¡Œruntime.Gosched()è§¦å‘è°ƒåº¦ï¼› ç¼–è¯‘çš„æ—¶å€™æ‰“å¼€å®éªŒç‰¹æ€§ï¼Œæ¥å®ç°forå¾ªç¯åä½œå¼æŠ¢å ï¼Œç¼–è¯‘å™¨ä¼šå®‰æ’æŒ‡ä»¤éšæœºå¾—è°ƒç”¨runtime.GoSched()ï¼ŒGOEXPERIMENT=preemptibleloops go buildï¼Œæˆ–è€…go build -gcflags -d=ssa/insert_resched_checks/onï¼› go1.14ä¸­ï¼Œå¼•å…¥äº†æŠ¢å å¼è°ƒåº¦ï¼Œæ¥è§£å†³ä¸Šè¿°æåŠçš„å¾ªç¯ä¸èƒ½æŠ¢å çš„é—®é¢˜ï¼š
æŠ¢å å¼è°ƒåº¦ï¼Œä¸ç”¨å¼•å…¥é‚£ä¹ˆå¤šçš„ä¸å¿…è¦çš„æ£€æŸ¥ï¼Œå¼•å…¥çš„è¿è¡Œæ—¶å¼€é”€æ›´ä½ï¼Œsee https://github.com/golang/proposal/blob/master/design/24543-non-cooperative-preemption.mdã€‚
æˆªæ­¢åˆ°æˆ‘å­¦ä¹ è¿™ç¯‡æ–‡ç« æ—¶ï¼Œgoæ—©å·²ç»å®ç°äº†æŠ¢å å¼è°ƒåº¦ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯go1.16.3ï¼Œæˆ‘å°†åœ¨åé¢æ–‡ç« æˆ–è€…é˜…è¯»æºç æ—¶æ€»ç»“goæŠ¢å å¼è°ƒåº¦çš„ç»†èŠ‚ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-goroutine-and-preemption-d6bc2aa2f4b7</description></item><item><title>goroutine and preemption</title><link>https://hitzhangjie.pro/go-internals-v2/posts/goroutine-and-preemption/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/goroutine-and-preemption/</guid><description>Let&amp;rsquo;s Summarize # go1.14ä¹‹å‰ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¸€ä¸ªgoroutineå¯ä»¥è¢«æ ‡è®°ä¸ºå¯è¢«æŠ¢å å‘¢ï¼š
åœ¨å‡½æ•°åºè¨€prologueä¸­ä¼šåˆ¤æ–­å½“å‰å‡½æ•°æ˜¯å¦éœ€è¦æ›´å¤§çš„æ ˆç©ºé—´ï¼Œç¼–è¯‘å™¨ä¼šæ’å…¥runtime.morestack_noctxt(SB)æŒ‡ä»¤æ¥å¯¹æ­¤åšæ£€æŸ¥ï¼Œè¿™ä¸ªæ’å…¥çš„å‡½æ•°é‡Œé¢ä¹Ÿä¼šæ£€æŸ¥å½“å‰goroutineè¿è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡10msï¼Œè¶…è¿‡å°±æ ‡è®°ä¸ºå¯è¢«æŠ¢å ï¼› ps: è¿™é‡Œçš„è¯´æ³•å¯èƒ½å¹¶ä¸å‡†ç¡®ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ç”¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸éªŒè¯ï¼Œè¿™ä¸ª10msæ£€æŸ¥åˆ°åº•æ˜¯åœ¨å“ªé‡Œåˆ¤æ–­çš„å‘¢ï¼Ÿä¸çŸ¥é“ TODO
åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œæ¯”å¦‚ç°åœ¨çš„go1.16.3ä¸­ï¼Œsysmonä¸­ä¼šæ£€æŸ¥æ‰€æœ‰çš„Pæ£€æŸ¥å…¶è¿è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡äº†10msæ—¶é—´ï¼Œè¶…è¿‡åˆ™å¼ºåˆ¶æŠ¢å ï¼Œpreemptone(p)ï¼Œå†…éƒ¨ä¼šè®¾ç½®g.preempt=trueã€‚
ä½†æ˜¯æœ‰äº›å¾ªç¯æ˜¯è®¡ç®—å¯†é›†å‹çš„ï¼Œä¼šä¸€ç›´æ‰§è¡Œï¼Œè¿™æ ·å¯èƒ½å¾ˆä¹…ä¹‹åæ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„prologueä¸­æ£€æŸ¥åˆ°æ—©å°±è¯¥æ ‡è®°ä¸ºå¯è¢«æŠ¢å äº†ï¼Œä½†æ˜¯å¤ªè¿Ÿäº†ï¼› go1.14ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å¯ä»¥é€šè¿‡ä¸€äº›åä½œå¼æŠ¢å çš„åŠæ³•æ¥å®ç°goroutineæŠ¢å ï¼Œæ¯”å¦‚åœ¨forå¾ªç¯å†…å¦‚æœæ²¡æœ‰ å‡½æ•°è°ƒç”¨çš„è¯ï¼Œå¯ä»¥ï¼š
å®‰æ’ä¸€äº›æ— ç”¨çš„å‡½æ•°è°ƒç”¨ï¼Œæ¯”è¾ƒå±çš„æ–¹æ³•ï¼› æ˜¾ç¤ºæ‰§è¡Œruntime.Gosched()è§¦å‘è°ƒåº¦ï¼› ç¼–è¯‘çš„æ—¶å€™æ‰“å¼€å®éªŒç‰¹æ€§ï¼Œæ¥å®ç°forå¾ªç¯åä½œå¼æŠ¢å ï¼Œç¼–è¯‘å™¨ä¼šå®‰æ’æŒ‡ä»¤éšæœºå¾—è°ƒç”¨runtime.GoSched()ï¼ŒGOEXPERIMENT=preemptibleloops go buildï¼Œæˆ–è€…go build -gcflags -d=ssa/insert_resched_checks/onï¼› go1.14ä¸­ï¼Œå¼•å…¥äº†æŠ¢å å¼è°ƒåº¦ï¼Œæ¥è§£å†³ä¸Šè¿°æåŠçš„å¾ªç¯ä¸èƒ½æŠ¢å çš„é—®é¢˜ï¼š
æŠ¢å å¼è°ƒåº¦ï¼Œä¸ç”¨å¼•å…¥é‚£ä¹ˆå¤šçš„ä¸å¿…è¦çš„æ£€æŸ¥ï¼Œå¼•å…¥çš„è¿è¡Œæ—¶å¼€é”€æ›´ä½ï¼Œsee https://github.com/golang/proposal/blob/master/design/24543-non-cooperative-preemption.mdã€‚
æˆªæ­¢åˆ°æˆ‘å­¦ä¹ è¿™ç¯‡æ–‡ç« æ—¶ï¼Œgoæ—©å·²ç»å®ç°äº†æŠ¢å å¼è°ƒåº¦ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯go1.16.3ï¼Œæˆ‘å°†åœ¨åé¢æ–‡ç« æˆ–è€…é˜…è¯»æºç æ—¶æ€»ç»“goæŠ¢å å¼è°ƒåº¦çš„ç»†èŠ‚ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-goroutine-and-preemption-d6bc2aa2f4b7</description></item><item><title>goroutine, os thread, and cpu management</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/goroutine-os-thread-and-cpu-management/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/goroutine-os-thread-and-cpu-management/</guid><description>Let&amp;rsquo;s Summarize # é¦–å…ˆä»‹ç»äº†GMPè°ƒåº¦æ¨¡å‹ä¸­Gã€Mã€Pçš„æ¦‚å¿µä»¥åŠæ„ä¹‰ï¼Œä»‹ç»äº†å¤§è‡´çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¦‚Méœ€è¦è·å¾—ä¸€ä¸ªPæ¥æ‰§è¡ŒGã€‚
é’ˆå¯¹ä»¥ä¸‹ä¸¤ç§æƒ…å½¢è¿›è¡Œäº†ç®€å•æ€»ç»“ï¼š
ç³»ç»Ÿè°ƒç”¨ï¼šä»‹ç»äº†å¦‚æœMæ‰§è¡Œé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨åçš„æƒ…å†µï¼ŒPè¢«é‡Šæ”¾äº¤ç»™å…¶ä»–Mä½¿ç”¨ï¼ŒMæ¢å¤åå°è¯•è·å–åŸæ¥çš„Pï¼ˆæœ‰çº¿ç¨‹ä¹‹å‰çš„æ•°æ®cacheæ€§èƒ½æ›´å¥½ï¼‰ï¼Œè¢«å ç”¨äº†å°±è·å–ç©ºé—²çš„Pï¼Œæ²¡æœ‰åˆ™å°†å½“å‰goroutineæ”¾åˆ°å…¨å±€ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å½“å‰M parkæ‰æ”¾åˆ°ç©ºé—²mé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è°ƒåº¦å™¨è°ƒåº¦å…¶ä»–goroutineæ—¶å¤ç”¨ã€‚
ç½‘ç»œè°ƒç”¨ï¼šç½‘ç»œåº“åŸºäºIOå¤šè·¯å¤ç”¨+éé˜»å¡è¿›è¡Œäº†å®ç°ï¼Œçº¿ç¨‹è™½ç„¶ä¸ä¼šå› ä¸ºç½‘ç»œIOè¿›è¡Œé˜»å¡äº†ï¼Œä½†æ˜¯æ•°æ®æ²¡å‡†å¤‡å¥½goroutineè¿˜æ˜¯ä¸èƒ½æ‰§è¡Œçš„ã€‚è¿™ä¸ªå·¥ä½œä¸èƒ½äº¤ç»™å†…æ ¸æ¥åšäº†ï¼Œéœ€è¦runtime+netpolleræ¥é…åˆå®Œæˆã€‚runtimeæ‰§è¡Œschedule()å‡½æ•°æŸ¥æ‰¾ä¸€ä¸ªrunnableçš„goroutineæ—¶ï¼Œé™¤äº†ä»global queueã€pçš„local queueã€å…¶ä»–pçš„local queueä¸­è¿›è¡ŒæŸ¥æ‰¾å¤–ï¼Œä¹Ÿä¼šè¯¢é—®netpollerï¼Œå½“å‰æœ‰æ²¡æœ‰IOäº‹ä»¶å°±ç»ªçš„goroutineï¼Œæœ‰å°±ç»™æˆ‘ä¸€ä¸ªåˆ—è¡¨æˆ‘å¥½æ‰§è¡Œã€‚å½“ç„¶å½“å‰MçŸ¥ä¼šæ‰§è¡Œä¸€ä¸ªgoroutineï¼Œnetpollerè¿”å›çš„å°±ç»ªåˆ—è¡¨ä¸­çš„å…¶ä»–goroutineä¼šè¢«åŠ å…¥åˆ°global queueä¸­ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-goroutine-os-thread-and-cpu-management-2f5a5eaf518a</description></item><item><title>goroutine, os thread, and cpu management</title><link>https://hitzhangjie.pro/go-internals-v2/posts/goroutine-os-thread-and-cpu-management/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/goroutine-os-thread-and-cpu-management/</guid><description>Let&amp;rsquo;s Summarize # é¦–å…ˆä»‹ç»äº†GMPè°ƒåº¦æ¨¡å‹ä¸­Gã€Mã€Pçš„æ¦‚å¿µä»¥åŠæ„ä¹‰ï¼Œä»‹ç»äº†å¤§è‡´çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¦‚Méœ€è¦è·å¾—ä¸€ä¸ªPæ¥æ‰§è¡ŒGã€‚
é’ˆå¯¹ä»¥ä¸‹ä¸¤ç§æƒ…å½¢è¿›è¡Œäº†ç®€å•æ€»ç»“ï¼š
ç³»ç»Ÿè°ƒç”¨ï¼šä»‹ç»äº†å¦‚æœMæ‰§è¡Œé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨åçš„æƒ…å†µï¼ŒPè¢«é‡Šæ”¾äº¤ç»™å…¶ä»–Mä½¿ç”¨ï¼ŒMæ¢å¤åå°è¯•è·å–åŸæ¥çš„Pï¼ˆæœ‰çº¿ç¨‹ä¹‹å‰çš„æ•°æ®cacheæ€§èƒ½æ›´å¥½ï¼‰ï¼Œè¢«å ç”¨äº†å°±è·å–ç©ºé—²çš„Pï¼Œæ²¡æœ‰åˆ™å°†å½“å‰goroutineæ”¾åˆ°å…¨å±€ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å½“å‰M parkæ‰æ”¾åˆ°ç©ºé—²mé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è°ƒåº¦å™¨è°ƒåº¦å…¶ä»–goroutineæ—¶å¤ç”¨ã€‚
ç½‘ç»œè°ƒç”¨ï¼šç½‘ç»œåº“åŸºäºIOå¤šè·¯å¤ç”¨+éé˜»å¡è¿›è¡Œäº†å®ç°ï¼Œçº¿ç¨‹è™½ç„¶ä¸ä¼šå› ä¸ºç½‘ç»œIOè¿›è¡Œé˜»å¡äº†ï¼Œä½†æ˜¯æ•°æ®æ²¡å‡†å¤‡å¥½goroutineè¿˜æ˜¯ä¸èƒ½æ‰§è¡Œçš„ã€‚è¿™ä¸ªå·¥ä½œä¸èƒ½äº¤ç»™å†…æ ¸æ¥åšäº†ï¼Œéœ€è¦runtime+netpolleræ¥é…åˆå®Œæˆã€‚runtimeæ‰§è¡Œschedule()å‡½æ•°æŸ¥æ‰¾ä¸€ä¸ªrunnableçš„goroutineæ—¶ï¼Œé™¤äº†ä»global queueã€pçš„local queueã€å…¶ä»–pçš„local queueä¸­è¿›è¡ŒæŸ¥æ‰¾å¤–ï¼Œä¹Ÿä¼šè¯¢é—®netpollerï¼Œå½“å‰æœ‰æ²¡æœ‰IOäº‹ä»¶å°±ç»ªçš„goroutineï¼Œæœ‰å°±ç»™æˆ‘ä¸€ä¸ªåˆ—è¡¨æˆ‘å¥½æ‰§è¡Œã€‚å½“ç„¶å½“å‰MçŸ¥ä¼šæ‰§è¡Œä¸€ä¸ªgoroutineï¼Œnetpollerè¿”å›çš„å°±ç»ªåˆ—è¡¨ä¸­çš„å…¶ä»–goroutineä¼šè¢«åŠ å…¥åˆ°global queueä¸­ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-goroutine-os-thread-and-cpu-management-2f5a5eaf518a</description></item><item><title>gsignal, master of signals</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/gsignal-master-of-signals/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/gsignal-master-of-signals/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºå†…éƒ¨çš„ä¿¡å·å¤„ç†è¿‡ç¨‹ã€‚GMPè°ƒåº¦æ¨¡å‹é‡Œé¢ï¼Œæ¯ä¸ªMéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„gsignal goroutineï¼Œç³»ç»ŸæŠ•é€’ä¿¡å·ç»™è¿›ç¨‹æ—¶å®é™…ä¸Šæ˜¯æœ‰gsignal goroutineæ¥æ¥å—è¿™ä¸ªä¿¡å·ï¼Œç„¶åæ£€æŸ¥ä¸‹æ˜¯å¦å¯å¤„ç†ã€‚å¦‚æœå¯å¤„ç†å°±å°†å…¶pushåˆ°ä¸€ä¸ªä¿¡å·é˜Ÿåˆ—ä¸­ï¼Œç„¶åæœ‰ä¸€ä¸ªä¸“é—¨çš„goroutineæ‰§è¡Œsignal.loopï¼Œè¿™ä¸ªå‡½æ•°ä»ä¸Šè¿°ä¿¡å·é˜Ÿåˆ—ä¸­å–ä¿¡å·ï¼Œå¹¶è½¬ç§»åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„chan os.Signalä¸­ï¼Œå†ç”±æˆ‘ä»¬è‡ªå·±å†™çš„chan readä»£ç æ¶ˆè´¹ï¼Œå¹¶æ‰§è¡Œå¤„ç†ã€‚
å¯¹åº”åˆ°æºç ä¸­ä¸»è¦æœ‰å‡ ä¸ªå‡½æ•°ï¼š
os/signal/signal.goï¼šè¿™ä¸ªå‡½æ•°é‡Œé¢åœ¨func init()çš„æ—¶å€™æœ‰å¯åŠ¨ä¸€ä¸ªloopå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å†…è°ƒç”¨runtime.signal_recvæ¥ä¸åœåœ°æ¥æ”¶ä¿¡å·ï¼Œç„¶åæ£€æŸ¥ç¨‹åºé€šè¿‡os.Notifyä¸ºå“ªäº›chan os.Signalè®¢é˜…äº†è¯¥ä¿¡å·ï¼Œå°±å°†è¯¥ä¿¡å·pushåˆ°å¯¹åº”çš„chanä¸­ï¼Œåé¢åº”ç”¨ç¨‹åºå°±å¯ä»¥è‡ªè¡Œå¤„ç†äº†ï¼› runtime/sigqueue.goï¼šruntime.sigsendã€runtime.signal_recvè¿™ä¸¤ä¸ªå‡½æ•°å¾ˆé‡è¦ï¼Œå‰è€…æ˜¯ç¨‹åºæ”¶åˆ°ç³»ç»Ÿå‘é€æ¥çš„ä¿¡å·æ—¶å°†ä¿¡å·å†™å…¥outgoing sigqueueä¸­ï¼Œå…¶å®å°±æ˜¯sigç»“æ„ä½“çš„maskå­—æ®µï¼Œåé¢signal_recvçš„æ—¶å€™ä¹Ÿæ˜¯ä»è¯¥maskå­—æ®µè¯»å–ï¼Œå¹¶å†™å…¥recvå­—æ®µä¸­ï¼Œrecvä¸­é0çš„åº”è¯¥å°±æ˜¯è¡¨ç¤ºæ”¶åˆ°äº†ä¿¡å·ï¼ˆä¿¡å·ç¼–å·ä¸ºç´¢å¼•å€¼ï¼‰ï¼› runtime/signal_unix.goï¼šæœ‰ä¸ªå‡½æ•°sighandlerï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£å¯¹ä¸åŒçš„ä¿¡å·æ‰§è¡Œä¸åŒçš„å¤„ç†ï¼Œæ¯”å¦‚æŠ¢å å¼è°ƒåº¦SIGURGçš„å¤„ç†ï¼Œæ¯”å¦‚SIGPROFçš„å¤„ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„ä¸€äº›å¼‚æ­¥ä¿¡å·çš„å¤„ç†sigsendã€‚åœ¨goç¨‹åºä¸­ä¸ç®¡æ˜¯ä»€ä¹ˆä¿¡å·ï¼Œè¿™äº›ä¿¡å·æ˜¯åœ¨sighandleråšä¸åŒå¤„ç†ã€‚sighandlerè™½ç„¶åå­—æ˜¯ä¿¡å·å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†é€šè¿‡setsigå°†æ‰€æœ‰ä¿¡å·å…¨éƒ¨è®¾ç½®sighandlerä¸ºä¿¡å·å¤„ç†å‡½æ•°ï¼Œä½†æ˜¯å…¶å®è¿™åªæ˜¯è¡¨ç°ã€‚setsigå‡½æ•°å†…éƒ¨åˆåšäº†ä¸€ä¸ªè½¬æ¢ï¼Œå°†ä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°è®¾ç½®ä¸ºäº†sigtrampæ´»ç€cgosigtrampï¼Œè¿™äº›å‡½æ•°å†…éƒ¨åˆè°ƒç”¨sighandlerã€‚ä¸‹é¢ä¼šæåˆ°sigtrampçš„é€»è¾‘ï¼› runtime/runtime2.goï¼šè¿™é‡Œå®šä¹‰äº†GMPè°ƒåº¦æ¨¡å‹ä¸­çš„mï¼ŒmåŒ…å«ä¸€ä¸ªæˆå‘˜gsignalï¼Œå®ƒè¡¨ç¤ºä¿¡å·å¤„ç†ç”¨çš„goroutineã€‚os_linux.goä¸­mpreinitä¼šä¸ºåˆ›å»ºä¸€ä¸ªgoroutineï¼Œåç¨‹æ ˆè¢«åˆå§‹åŒ–ä¸€ä¸ª32KBå¤§å°çš„ä¿¡å·å¤„ç†æ ˆï¼Œå¾ˆå¤§è¿™æ˜¯ä¸ºäº†å…¼å®¹ä¸åŒæ“ä½œç³»ç»Ÿçš„ä¸€äº›é—®é¢˜ï¼Œlinuxè¦â‰¥2KBï¼ŒOSXè¦â‰¥8KB&amp;hellip; sigtrampæ˜¯æ³¨å†Œåˆ°æ“ä½œç³»ç»Ÿçš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“æ“ä½œç³»ç»Ÿæ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶æ£€æŸ¥è¿›ç¨‹æœ‰æ²¡æœ‰ä¿¡å·åˆ°è¾¾ï¼Œæœ‰å¹¶ä¸”æ²¡æœ‰å±è”½ä¿¡å·åˆ™æ‰§è¡Œå¯¹åº”çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯åˆ‡åˆ°äº†ç”¨æˆ·æ€å»æ‰§è¡Œä¿¡å·å¤„ç†å‡½æ•°ã€‚åœ¨æ‰§è¡Œä¿¡å·å¤„ç†å‡½æ•°çš„æ—¶å€™æ¯”è¾ƒç‰¹æ®Šï¼Œgoéœ€è¦ä¸ºä¿¡å·å¤„ç†å‡½æ•°å‡†å¤‡ä¸€ä¸ªä¸åŒçš„æ ˆå¸§ï¼Œå³ä¿¡å·å¤„ç†æ ˆï¼Œè¿™ä¸ªå‰é¢æè¿‡äº†æ˜¯ä¸€ä¸ª32KBå¤§å°çš„æ ˆï¼Œç„¶åå°†å½“å‰m.gè®¾ç½®ä¸ºgsignalï¼ˆæ ˆå¤§å°ä¸º32KBï¼‰ï¼Œæ ˆå‡†å¤‡å¥½ä¹‹åï¼Œæ‰§è¡Œå‰é¢æè¿‡çš„sighandleræ‰§è¡Œä¿¡å·å¤„ç†ï¼Œå¤„ç†å®Œæˆè¿”å›åï¼Œå†å°†m.gè®¾ç½®ä¸ºåŸæ¥çš„gæ¢å¤æ­£å¸¸æ‰§è¡Œã€‚å…¶å®signhandleræ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œsigsendå‘é€åˆ°outgoing sigqueueï¼Œç„¶åsignal_recvæ”¶ä¿¡å·å‘é€åˆ°os.Notifyè®¢é˜…çš„chanï¼Œå°±å®Œäº‹äº†ï¼Œåé¢å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„chan readå¹¶å¤„ç†é€»è¾‘äº†ã€‚ Source Analysis # go os.signal packageå¯¹ä¿¡å·å¤„ç†åšäº†å°è£…ï¼Œå…¶ä¸­ä¿¡å·SIGKILLã€SIGSTOPæ˜¯æ“ä½œç³»ç»Ÿè§„å®šçš„ä¸å…è®¸æ•è·çš„ä¿¡å·ï¼Œæ˜¯ä¸å—os.signalè¿™ä¸ªpackageå½±å“çš„
goä¸­å°†ä¿¡å·åˆ†ä¸ºä¸¤ç±»ï¼šåŒæ­¥ä¿¡å·å’Œå¼‚æ­¥ä¿¡å·ã€‚
åŒæ­¥ä¿¡å·ï¼šæŒ‡çš„æ˜¯goç¨‹åºè¿è¡Œæ—¶ç¨‹åºå†…éƒ¨é”™è¯¯è§¦å‘çš„ä¸€äº›é—®é¢˜ï¼Œå¦‚SIGBUSã€SIGFPEã€SIGSEGVï¼Œè¿™äº›ä¿¡å·ä¼šè¢«è½¬æ¢æˆè¿è¡Œæ—¶panicä¿¡æ¯ï¼›
å¼‚æ­¥ä¿¡å·ï¼šé™¤äº†ä¸Šè¿°æåŠçš„ä¿¡å·ä¹‹å¤–çš„ä¿¡å·ï¼Œå°±æ˜¯å¼‚æ­¥ä¿¡å·äº†ã€‚å¼‚æ­¥ä¿¡å·ä¸æ˜¯ç¨‹åºå†…éƒ¨é”™è¯¯å¯¼è‡´çš„ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿæˆ–è€…å¤–éƒ¨å…¶ä»–ç¨‹åºå‘é€ç»™å®ƒçš„ã€‚
æœ‰å“ªäº›å¼‚æ­¥ä¿¡å·ï¼Ÿ
å½“ç¨‹åºå¤±å»å¯¹æ§åˆ¶ç»ˆç«¯çš„æ§åˆ¶æ—¶ï¼Œä¼šæ”¶åˆ°SIGHUPä¿¡å·ï¼› åœ¨æ§åˆ¶ç»ˆç«¯ä¸­è¾“å…¥Ctrl+Cæ—¶ä¼šæ”¶åˆ°SIGINTä¿¡å·ï¼› åœ¨æ§åˆ¶ç»ˆç«¯ä¸­è¾“å…¥Ctrl+\æ—¶ä¼šå—åˆ°SIGQUITä¿¡å·ï¼› psï¼šé€šå¸¸æƒ³è®©ç¨‹åºé€€å‡ºçš„è¯ï¼ŒCtrl+Cå°±å¯ä»¥äº†ï¼Œå¦‚æœæƒ³è®©ç¨‹åºé€€å‡ºåŒæ—¶æ‰“å°æ ˆè½¬å‚¨ä¿¡æ¯ï¼Œé‚£å°±ç”¨Ctrl+\ã€‚
é»˜è®¤çš„ä¿¡å·å¤„ç†æ–¹å¼ï¼Ÿ
æ¥æ”¶åˆ°ä¿¡å·ä¹‹åï¼Œè‚¯å®šæœ‰é»˜è®¤çš„å¤„ç†æ–¹å¼ï¼Œè¿™ä¸ªåœ¨å­¦ä¹ linuxä¿¡å·å¤„ç†æ—¶è‚¯å®šæœ‰äº†è§£è¿‡çš„ï¼Œåœ¨goç¨‹åºä¸­å¯èƒ½åªæ˜¯é»˜è®¤å¤„ç†æ–¹å¼æœ‰ç‚¹ä¸åŒï¼Œè¿™ä¸ªæœ‰éœ€è¦çš„æ—¶å€™å»äº†è§£å°±å¯ä»¥äº†ã€‚è¿™é‡Œä¸å±•å¼€äº†ã€‚
å€¼å¾—ä¸€æçš„æ˜¯ä¿¡å·SIGPROFï¼Œè¿™ä¸ªä¿¡å·ç”¨äºå®ç°runtime.CPUProfileã€‚
è‡ªå®šä¹‰ä¿¡å·å¤„ç†æ–¹å¼ï¼Ÿ
è‡ªå®šä¹‰ä¿¡å·å¤„ç†æ–¹å¼ï¼Œåœ¨linux signalå‡½æ•°ä¸­å¯ä»¥æŒ‡å®šä¿¡å·åŠå¯¹åº”å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œgoä¸­ç±»ä¼¼ï¼Œå®ƒå…è®¸é€šè¿‡os.NotifyæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªä¿¡å·chanï¼Œé‡Œé¢å¯ä»¥æ³¨å†Œæ„Ÿå…´è¶£çš„ä¿¡å·ï¼Œå½“æ”¶åˆ°è¿™äº›ä¿¡å·æ—¶ï¼Œå°±å¯ä»¥æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„ä¿¡å·å¤„ç†é€»è¾‘ã€‚
SIGPIPEä¿¡å·å¤„ç†
å½“ç¨‹åºwrite broken pipeæ—¶ï¼Œä¼šæ”¶åˆ°SIGPIPEä¿¡å·ï¼Œæ¯”å¦‚å†™ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œå¦‚æœä¸åšå¤„ç†é»˜è®¤å´©æºƒæ‰é‚£å°±å®Œè›‹äº†ã€‚goç¨‹åºä¸­å¯¹è¿™ä¸ªåšäº†ä¼˜åŒ–å¤„ç†ã€‚
write broken pipeçš„è¡Œä¸ºä¸writeçš„file descriptorçš„fdæœ‰å…³ç³»ï¼š
å¦‚æœfdæ˜¯stdoutã€stderrï¼Œé‚£ä¹ˆç¨‹åºæ”¶åˆ°SIGPIPEä¿¡å·ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ç¨‹åºä¼šé€€å‡ºï¼› å¦‚æœæ˜¯å…¶ä»–fdï¼Œç¨‹åºæ”¶åˆ°SIGPIPEä¿¡å·ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ä¸é‡‡å–ä»»ä½•åŠ¨ä½œï¼Œå¯¹åº”çš„writeæ“ä½œè¿”å›ä¸€ä¸ªEPIPEé”™è¯¯ï¼› psï¼šåè€…å¾ˆé‡è¦ï¼Œå†™ç½‘ç»œè¿æ¥å¤±è´¥æ˜¯å¸¸æœ‰çš„äº‹æƒ…ï¼Œlinux cç¨‹åºå¦‚æœä¸æ˜¾ç¤ºå¤„ç†SIGPIPEä¿¡å·ï¼Œé»˜è®¤è¡Œä¸ºå°†æ˜¯ç¨‹åºç›´æ¥crashï¼Œgoç¨‹åºå¯¹æ­¤ä½œäº†ä¼˜åŒ–ï¼Œè®©writeè¿”å›errorè€Œécrashï¼Œå¯¹äºgoå°†æ„å»ºé«˜æ€§èƒ½ã€ç¨³å®šå¥å£®çš„ç½‘ç»œç¨‹åºçš„åˆè¡·æ¥è¯´æ˜¯æœ‰å¿…è¦çš„ã€‚
cgoç¨‹åºä¿¡å·å¤„ç†ï¼Ÿ
æ¶‰åŠåˆ°cgoå°±è¦åˆ†å‡ ç§æƒ…å†µæ¥è®¨è®ºï¼Œè¿™é‡Œä¼šæœ‰ç‚¹éº»çƒ¦äº†ï¼Œæ¶‰åŠåˆ°ä¿¡å·å¤„ç†å‡½æ•°çš„é‡å¤æ³¨å†Œã€ä¿¡å·æ©ç è®¾ç½®ã€ä¿¡å·å¤„ç†å‡½æ•°çš„æ ˆç­‰é—®é¢˜ï¼Œåœ¨os/signal/doc.goé‡Œé¢æœ‰è¿™æ–¹é¢çš„æè¿°ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚
References # https://medium.</description></item><item><title>gsignal, master of signals</title><link>https://hitzhangjie.pro/go-internals-v2/posts/gsignal-master-of-signals/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/gsignal-master-of-signals/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºå†…éƒ¨çš„ä¿¡å·å¤„ç†è¿‡ç¨‹ã€‚GMPè°ƒåº¦æ¨¡å‹é‡Œé¢ï¼Œæ¯ä¸ªMéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„gsignal goroutineï¼Œç³»ç»ŸæŠ•é€’ä¿¡å·ç»™è¿›ç¨‹æ—¶å®é™…ä¸Šæ˜¯æœ‰gsignal goroutineæ¥æ¥å—è¿™ä¸ªä¿¡å·ï¼Œç„¶åæ£€æŸ¥ä¸‹æ˜¯å¦å¯å¤„ç†ã€‚å¦‚æœå¯å¤„ç†å°±å°†å…¶pushåˆ°ä¸€ä¸ªä¿¡å·é˜Ÿåˆ—ä¸­ï¼Œç„¶åæœ‰ä¸€ä¸ªä¸“é—¨çš„goroutineæ‰§è¡Œsignal.loopï¼Œè¿™ä¸ªå‡½æ•°ä»ä¸Šè¿°ä¿¡å·é˜Ÿåˆ—ä¸­å–ä¿¡å·ï¼Œå¹¶è½¬ç§»åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„chan os.Signalä¸­ï¼Œå†ç”±æˆ‘ä»¬è‡ªå·±å†™çš„chan readä»£ç æ¶ˆè´¹ï¼Œå¹¶æ‰§è¡Œå¤„ç†ã€‚
å¯¹åº”åˆ°æºç ä¸­ä¸»è¦æœ‰å‡ ä¸ªå‡½æ•°ï¼š
os/signal/signal.goï¼šè¿™ä¸ªå‡½æ•°é‡Œé¢åœ¨func init()çš„æ—¶å€™æœ‰å¯åŠ¨ä¸€ä¸ªloopå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å†…è°ƒç”¨runtime.signal_recvæ¥ä¸åœåœ°æ¥æ”¶ä¿¡å·ï¼Œç„¶åæ£€æŸ¥ç¨‹åºé€šè¿‡os.Notifyä¸ºå“ªäº›chan os.Signalè®¢é˜…äº†è¯¥ä¿¡å·ï¼Œå°±å°†è¯¥ä¿¡å·pushåˆ°å¯¹åº”çš„chanä¸­ï¼Œåé¢åº”ç”¨ç¨‹åºå°±å¯ä»¥è‡ªè¡Œå¤„ç†äº†ï¼› runtime/sigqueue.goï¼šruntime.sigsendã€runtime.signal_recvè¿™ä¸¤ä¸ªå‡½æ•°å¾ˆé‡è¦ï¼Œå‰è€…æ˜¯ç¨‹åºæ”¶åˆ°ç³»ç»Ÿå‘é€æ¥çš„ä¿¡å·æ—¶å°†ä¿¡å·å†™å…¥outgoing sigqueueä¸­ï¼Œå…¶å®å°±æ˜¯sigç»“æ„ä½“çš„maskå­—æ®µï¼Œåé¢signal_recvçš„æ—¶å€™ä¹Ÿæ˜¯ä»è¯¥maskå­—æ®µè¯»å–ï¼Œå¹¶å†™å…¥recvå­—æ®µä¸­ï¼Œrecvä¸­é0çš„åº”è¯¥å°±æ˜¯è¡¨ç¤ºæ”¶åˆ°äº†ä¿¡å·ï¼ˆä¿¡å·ç¼–å·ä¸ºç´¢å¼•å€¼ï¼‰ï¼› runtime/signal_unix.goï¼šæœ‰ä¸ªå‡½æ•°sighandlerï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£å¯¹ä¸åŒçš„ä¿¡å·æ‰§è¡Œä¸åŒçš„å¤„ç†ï¼Œæ¯”å¦‚æŠ¢å å¼è°ƒåº¦SIGURGçš„å¤„ç†ï¼Œæ¯”å¦‚SIGPROFçš„å¤„ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„ä¸€äº›å¼‚æ­¥ä¿¡å·çš„å¤„ç†sigsendã€‚åœ¨goç¨‹åºä¸­ä¸ç®¡æ˜¯ä»€ä¹ˆä¿¡å·ï¼Œè¿™äº›ä¿¡å·æ˜¯åœ¨sighandleråšä¸åŒå¤„ç†ã€‚sighandlerè™½ç„¶åå­—æ˜¯ä¿¡å·å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†é€šè¿‡setsigå°†æ‰€æœ‰ä¿¡å·å…¨éƒ¨è®¾ç½®sighandlerä¸ºä¿¡å·å¤„ç†å‡½æ•°ï¼Œä½†æ˜¯å…¶å®è¿™åªæ˜¯è¡¨ç°ã€‚setsigå‡½æ•°å†…éƒ¨åˆåšäº†ä¸€ä¸ªè½¬æ¢ï¼Œå°†ä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°è®¾ç½®ä¸ºäº†sigtrampæ´»ç€cgosigtrampï¼Œè¿™äº›å‡½æ•°å†…éƒ¨åˆè°ƒç”¨sighandlerã€‚ä¸‹é¢ä¼šæåˆ°sigtrampçš„é€»è¾‘ï¼› runtime/runtime2.goï¼šè¿™é‡Œå®šä¹‰äº†GMPè°ƒåº¦æ¨¡å‹ä¸­çš„mï¼ŒmåŒ…å«ä¸€ä¸ªæˆå‘˜gsignalï¼Œå®ƒè¡¨ç¤ºä¿¡å·å¤„ç†ç”¨çš„goroutineã€‚os_linux.goä¸­mpreinitä¼šä¸ºåˆ›å»ºä¸€ä¸ªgoroutineï¼Œåç¨‹æ ˆè¢«åˆå§‹åŒ–ä¸€ä¸ª32KBå¤§å°çš„ä¿¡å·å¤„ç†æ ˆï¼Œå¾ˆå¤§è¿™æ˜¯ä¸ºäº†å…¼å®¹ä¸åŒæ“ä½œç³»ç»Ÿçš„ä¸€äº›é—®é¢˜ï¼Œlinuxè¦â‰¥2KBï¼ŒOSXè¦â‰¥8KB&amp;hellip; sigtrampæ˜¯æ³¨å†Œåˆ°æ“ä½œç³»ç»Ÿçš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“æ“ä½œç³»ç»Ÿæ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶æ£€æŸ¥è¿›ç¨‹æœ‰æ²¡æœ‰ä¿¡å·åˆ°è¾¾ï¼Œæœ‰å¹¶ä¸”æ²¡æœ‰å±è”½ä¿¡å·åˆ™æ‰§è¡Œå¯¹åº”çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯åˆ‡åˆ°äº†ç”¨æˆ·æ€å»æ‰§è¡Œä¿¡å·å¤„ç†å‡½æ•°ã€‚åœ¨æ‰§è¡Œä¿¡å·å¤„ç†å‡½æ•°çš„æ—¶å€™æ¯”è¾ƒç‰¹æ®Šï¼Œgoéœ€è¦ä¸ºä¿¡å·å¤„ç†å‡½æ•°å‡†å¤‡ä¸€ä¸ªä¸åŒçš„æ ˆå¸§ï¼Œå³ä¿¡å·å¤„ç†æ ˆï¼Œè¿™ä¸ªå‰é¢æè¿‡äº†æ˜¯ä¸€ä¸ª32KBå¤§å°çš„æ ˆï¼Œç„¶åå°†å½“å‰m.gè®¾ç½®ä¸ºgsignalï¼ˆæ ˆå¤§å°ä¸º32KBï¼‰ï¼Œæ ˆå‡†å¤‡å¥½ä¹‹åï¼Œæ‰§è¡Œå‰é¢æè¿‡çš„sighandleræ‰§è¡Œä¿¡å·å¤„ç†ï¼Œå¤„ç†å®Œæˆè¿”å›åï¼Œå†å°†m.gè®¾ç½®ä¸ºåŸæ¥çš„gæ¢å¤æ­£å¸¸æ‰§è¡Œã€‚å…¶å®signhandleræ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œsigsendå‘é€åˆ°outgoing sigqueueï¼Œç„¶åsignal_recvæ”¶ä¿¡å·å‘é€åˆ°os.Notifyè®¢é˜…çš„chanï¼Œå°±å®Œäº‹äº†ï¼Œåé¢å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„chan readå¹¶å¤„ç†é€»è¾‘äº†ã€‚ Source Analysis # go os.signal packageå¯¹ä¿¡å·å¤„ç†åšäº†å°è£…ï¼Œå…¶ä¸­ä¿¡å·SIGKILLã€SIGSTOPæ˜¯æ“ä½œç³»ç»Ÿè§„å®šçš„ä¸å…è®¸æ•è·çš„ä¿¡å·ï¼Œæ˜¯ä¸å—os.signalè¿™ä¸ªpackageå½±å“çš„
goä¸­å°†ä¿¡å·åˆ†ä¸ºä¸¤ç±»ï¼šåŒæ­¥ä¿¡å·å’Œå¼‚æ­¥ä¿¡å·ã€‚
åŒæ­¥ä¿¡å·ï¼šæŒ‡çš„æ˜¯goç¨‹åºè¿è¡Œæ—¶ç¨‹åºå†…éƒ¨é”™è¯¯è§¦å‘çš„ä¸€äº›é—®é¢˜ï¼Œå¦‚SIGBUSã€SIGFPEã€SIGSEGVï¼Œè¿™äº›ä¿¡å·ä¼šè¢«è½¬æ¢æˆè¿è¡Œæ—¶panicä¿¡æ¯ï¼›
å¼‚æ­¥ä¿¡å·ï¼šé™¤äº†ä¸Šè¿°æåŠçš„ä¿¡å·ä¹‹å¤–çš„ä¿¡å·ï¼Œå°±æ˜¯å¼‚æ­¥ä¿¡å·äº†ã€‚å¼‚æ­¥ä¿¡å·ä¸æ˜¯ç¨‹åºå†…éƒ¨é”™è¯¯å¯¼è‡´çš„ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿæˆ–è€…å¤–éƒ¨å…¶ä»–ç¨‹åºå‘é€ç»™å®ƒçš„ã€‚
æœ‰å“ªäº›å¼‚æ­¥ä¿¡å·ï¼Ÿ
å½“ç¨‹åºå¤±å»å¯¹æ§åˆ¶ç»ˆç«¯çš„æ§åˆ¶æ—¶ï¼Œä¼šæ”¶åˆ°SIGHUPä¿¡å·ï¼› åœ¨æ§åˆ¶ç»ˆç«¯ä¸­è¾“å…¥Ctrl+Cæ—¶ä¼šæ”¶åˆ°SIGINTä¿¡å·ï¼› åœ¨æ§åˆ¶ç»ˆç«¯ä¸­è¾“å…¥Ctrl+\æ—¶ä¼šå—åˆ°SIGQUITä¿¡å·ï¼› psï¼šé€šå¸¸æƒ³è®©ç¨‹åºé€€å‡ºçš„è¯ï¼ŒCtrl+Cå°±å¯ä»¥äº†ï¼Œå¦‚æœæƒ³è®©ç¨‹åºé€€å‡ºåŒæ—¶æ‰“å°æ ˆè½¬å‚¨ä¿¡æ¯ï¼Œé‚£å°±ç”¨Ctrl+\ã€‚
é»˜è®¤çš„ä¿¡å·å¤„ç†æ–¹å¼ï¼Ÿ
æ¥æ”¶åˆ°ä¿¡å·ä¹‹åï¼Œè‚¯å®šæœ‰é»˜è®¤çš„å¤„ç†æ–¹å¼ï¼Œè¿™ä¸ªåœ¨å­¦ä¹ linuxä¿¡å·å¤„ç†æ—¶è‚¯å®šæœ‰äº†è§£è¿‡çš„ï¼Œåœ¨goç¨‹åºä¸­å¯èƒ½åªæ˜¯é»˜è®¤å¤„ç†æ–¹å¼æœ‰ç‚¹ä¸åŒï¼Œè¿™ä¸ªæœ‰éœ€è¦çš„æ—¶å€™å»äº†è§£å°±å¯ä»¥äº†ã€‚è¿™é‡Œä¸å±•å¼€äº†ã€‚
å€¼å¾—ä¸€æçš„æ˜¯ä¿¡å·SIGPROFï¼Œè¿™ä¸ªä¿¡å·ç”¨äºå®ç°runtime.CPUProfileã€‚
è‡ªå®šä¹‰ä¿¡å·å¤„ç†æ–¹å¼ï¼Ÿ
è‡ªå®šä¹‰ä¿¡å·å¤„ç†æ–¹å¼ï¼Œåœ¨linux signalå‡½æ•°ä¸­å¯ä»¥æŒ‡å®šä¿¡å·åŠå¯¹åº”å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œgoä¸­ç±»ä¼¼ï¼Œå®ƒå…è®¸é€šè¿‡os.NotifyæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªä¿¡å·chanï¼Œé‡Œé¢å¯ä»¥æ³¨å†Œæ„Ÿå…´è¶£çš„ä¿¡å·ï¼Œå½“æ”¶åˆ°è¿™äº›ä¿¡å·æ—¶ï¼Œå°±å¯ä»¥æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„ä¿¡å·å¤„ç†é€»è¾‘ã€‚
SIGPIPEä¿¡å·å¤„ç†
å½“ç¨‹åºwrite broken pipeæ—¶ï¼Œä¼šæ”¶åˆ°SIGPIPEä¿¡å·ï¼Œæ¯”å¦‚å†™ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œå¦‚æœä¸åšå¤„ç†é»˜è®¤å´©æºƒæ‰é‚£å°±å®Œè›‹äº†ã€‚goç¨‹åºä¸­å¯¹è¿™ä¸ªåšäº†ä¼˜åŒ–å¤„ç†ã€‚
write broken pipeçš„è¡Œä¸ºä¸writeçš„file descriptorçš„fdæœ‰å…³ç³»ï¼š
å¦‚æœfdæ˜¯stdoutã€stderrï¼Œé‚£ä¹ˆç¨‹åºæ”¶åˆ°SIGPIPEä¿¡å·ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ç¨‹åºä¼šé€€å‡ºï¼› å¦‚æœæ˜¯å…¶ä»–fdï¼Œç¨‹åºæ”¶åˆ°SIGPIPEä¿¡å·ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ä¸é‡‡å–ä»»ä½•åŠ¨ä½œï¼Œå¯¹åº”çš„writeæ“ä½œè¿”å›ä¸€ä¸ªEPIPEé”™è¯¯ï¼› psï¼šåè€…å¾ˆé‡è¦ï¼Œå†™ç½‘ç»œè¿æ¥å¤±è´¥æ˜¯å¸¸æœ‰çš„äº‹æƒ…ï¼Œlinux cç¨‹åºå¦‚æœä¸æ˜¾ç¤ºå¤„ç†SIGPIPEä¿¡å·ï¼Œé»˜è®¤è¡Œä¸ºå°†æ˜¯ç¨‹åºç›´æ¥crashï¼Œgoç¨‹åºå¯¹æ­¤ä½œäº†ä¼˜åŒ–ï¼Œè®©writeè¿”å›errorè€Œécrashï¼Œå¯¹äºgoå°†æ„å»ºé«˜æ€§èƒ½ã€ç¨³å®šå¥å£®çš„ç½‘ç»œç¨‹åºçš„åˆè¡·æ¥è¯´æ˜¯æœ‰å¿…è¦çš„ã€‚
cgoç¨‹åºä¿¡å·å¤„ç†ï¼Ÿ
æ¶‰åŠåˆ°cgoå°±è¦åˆ†å‡ ç§æƒ…å†µæ¥è®¨è®ºï¼Œè¿™é‡Œä¼šæœ‰ç‚¹éº»çƒ¦äº†ï¼Œæ¶‰åŠåˆ°ä¿¡å·å¤„ç†å‡½æ•°çš„é‡å¤æ³¨å†Œã€ä¿¡å·æ©ç è®¾ç½®ã€ä¿¡å·å¤„ç†å‡½æ•°çš„æ ˆç­‰é—®é¢˜ï¼Œåœ¨os/signal/doc.goé‡Œé¢æœ‰è¿™æ–¹é¢çš„æè¿°ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚
References # https://medium.</description></item><item><title>how "go build" works</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-go-build-works/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-go-build-works/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸€ç³»åˆ—æ­¥éª¤ï¼Œè¿™é‡Œçš„ä»‹ç»ä¸æ˜¯ä»ç¼–è¯‘å™¨ç¼–è¯‘ç»è¿‡å‡ ä¸ªæ­¥éª¤ï¼Œè€Œæ˜¯ä»å·¥å…·è§’åº¦æ¥è¯´ï¼Œé‡ç‚¹åšäº†ä»€ä¹ˆå·¥ä½œï¼š
åˆ›å»ºä¸´æ—¶ç›®å½•$WORKï¼› æ ¹æ®æºç æ„å»ºaction graphï¼Œæ ¹èŠ‚ç‚¹æ˜¯main packageï¼Œå¯¹åº”çš„æ„å»ºå­ç›®å½•æ˜¯b001ï¼Œå…¶ä»–ä¾èµ–ä¹Ÿæœ‰å¯¹åº”çš„èŠ‚ç‚¹ï¼Œä¹Ÿæœ‰å¯¹åº”æ„å»ºç›®å½•ï¼Œç›®å½•ç¼–å·é€šå¸¸æ˜¯é€’å¢çš„ï¼› æ„å»ºè¿‡ç¨‹ä¸­ä»å¶å­èŠ‚ç‚¹å¼€å§‹æ„å»ºï¼Œç„¶åæ„å»ºçˆ¶èŠ‚ç‚¹ï¼ŒæŒç»­ä¸‹å»ç›´åˆ°æ ¹èŠ‚ç‚¹æ„å»ºå®Œæˆï¼› åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç¼–è¯‘å•å…ƒå¯¹åº”çš„*.oæˆ–è€…*.aæ–‡ä»¶åŒ…æ‹¬æœ€åçš„å¯æ‰§è¡Œç¨‹åºéƒ½ä¼šå†™å…¥ä¸€ä¸ªbuildidï¼Œå®ƒåŒ…æ‹¬actionid/contentidä¸¤éƒ¨åˆ†æ„æˆï¼Œå®ƒç”¨äºåˆ›å»ºç´¢å¼•ç¼“å­˜ä¹‹å‰çš„ç¼–è¯‘è¾“å‡ºï¼Œæå‡åç»­ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ•ˆç‡ï¼› Source Analysis # å…³äºactionåŠaction graphï¼Œå¯ä»¥å‚è€ƒï¼šhttps://github.com/golang/go/blob/master/src/cmd/go/internal/work/action.go
æ¯ä¸ªä¾èµ–å¯¹åº”çš„ç¼–è¯‘ç›®å½•ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://github.com/golang/go/blob/master/src/cmd/go/internal/work/action.go#L318
è¿™äº›æ˜¯äº›çç¢çš„ç»†èŠ‚ä¿¡æ¯ï¼Œå¯ä»¥å…ˆå¿½ç•¥ã€‚
References # https://maori.geek.nz/how-go-build-works-750bb2ba6d8e</description></item><item><title>how "go build" works</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/how-go-build-works/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/how-go-build-works/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸€ç³»åˆ—æ­¥éª¤ï¼Œè¿™é‡Œçš„ä»‹ç»ä¸æ˜¯ä»ç¼–è¯‘å™¨ç¼–è¯‘ç»è¿‡å‡ ä¸ªæ­¥éª¤ï¼Œè€Œæ˜¯ä»å·¥å…·è§’åº¦æ¥è¯´ï¼Œé‡ç‚¹åšäº†ä»€ä¹ˆå·¥ä½œï¼š
åˆ›å»ºä¸´æ—¶ç›®å½•$WORKï¼› æ ¹æ®æºç æ„å»ºaction graphï¼Œæ ¹èŠ‚ç‚¹æ˜¯main packageï¼Œå¯¹åº”çš„æ„å»ºå­ç›®å½•æ˜¯b001ï¼Œå…¶ä»–ä¾èµ–ä¹Ÿæœ‰å¯¹åº”çš„èŠ‚ç‚¹ï¼Œä¹Ÿæœ‰å¯¹åº”æ„å»ºç›®å½•ï¼Œç›®å½•ç¼–å·é€šå¸¸æ˜¯é€’å¢çš„ï¼› æ„å»ºè¿‡ç¨‹ä¸­ä»å¶å­èŠ‚ç‚¹å¼€å§‹æ„å»ºï¼Œç„¶åæ„å»ºçˆ¶èŠ‚ç‚¹ï¼ŒæŒç»­ä¸‹å»ç›´åˆ°æ ¹èŠ‚ç‚¹æ„å»ºå®Œæˆï¼› åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç¼–è¯‘å•å…ƒå¯¹åº”çš„*.oæˆ–è€…*.aæ–‡ä»¶åŒ…æ‹¬æœ€åçš„å¯æ‰§è¡Œç¨‹åºéƒ½ä¼šå†™å…¥ä¸€ä¸ªbuildidï¼Œå®ƒåŒ…æ‹¬actionid/contentidä¸¤éƒ¨åˆ†æ„æˆï¼Œå®ƒç”¨äºåˆ›å»ºç´¢å¼•ç¼“å­˜ä¹‹å‰çš„ç¼–è¯‘è¾“å‡ºï¼Œæå‡åç»­ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ•ˆç‡ï¼› Source Analysis # å…³äºactionåŠaction graphï¼Œå¯ä»¥å‚è€ƒï¼šhttps://github.com/golang/go/blob/master/src/cmd/go/internal/work/action.go
æ¯ä¸ªä¾èµ–å¯¹åº”çš„ç¼–è¯‘ç›®å½•ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://github.com/golang/go/blob/master/src/cmd/go/internal/work/action.go#L318
è¿™äº›æ˜¯äº›çç¢çš„ç»†èŠ‚ä¿¡æ¯ï¼Œå¯ä»¥å…ˆå¿½ç•¥ã€‚
References # https://maori.geek.nz/how-go-build-works-750bb2ba6d8e</description></item><item><title>how "go build" works</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-go-build-works/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-go-build-works/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸€ç³»åˆ—æ­¥éª¤ï¼Œè¿™é‡Œçš„ä»‹ç»ä¸æ˜¯ä»ç¼–è¯‘å™¨ç¼–è¯‘ç»è¿‡å‡ ä¸ªæ­¥éª¤ï¼Œè€Œæ˜¯ä»å·¥å…·è§’åº¦æ¥è¯´ï¼Œé‡ç‚¹åšäº†ä»€ä¹ˆå·¥ä½œï¼š
åˆ›å»ºä¸´æ—¶ç›®å½•$WORKï¼› æ ¹æ®æºç æ„å»ºaction graphï¼Œæ ¹èŠ‚ç‚¹æ˜¯main packageï¼Œå¯¹åº”çš„æ„å»ºå­ç›®å½•æ˜¯b001ï¼Œå…¶ä»–ä¾èµ–ä¹Ÿæœ‰å¯¹åº”çš„èŠ‚ç‚¹ï¼Œä¹Ÿæœ‰å¯¹åº”æ„å»ºç›®å½•ï¼Œç›®å½•ç¼–å·é€šå¸¸æ˜¯é€’å¢çš„ï¼› æ„å»ºè¿‡ç¨‹ä¸­ä»å¶å­èŠ‚ç‚¹å¼€å§‹æ„å»ºï¼Œç„¶åæ„å»ºçˆ¶èŠ‚ç‚¹ï¼ŒæŒç»­ä¸‹å»ç›´åˆ°æ ¹èŠ‚ç‚¹æ„å»ºå®Œæˆï¼› åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç¼–è¯‘å•å…ƒå¯¹åº”çš„*.oæˆ–è€…*.aæ–‡ä»¶åŒ…æ‹¬æœ€åçš„å¯æ‰§è¡Œç¨‹åºéƒ½ä¼šå†™å…¥ä¸€ä¸ªbuildidï¼Œå®ƒåŒ…æ‹¬actionid/contentidä¸¤éƒ¨åˆ†æ„æˆï¼Œå®ƒç”¨äºåˆ›å»ºç´¢å¼•ç¼“å­˜ä¹‹å‰çš„ç¼–è¯‘è¾“å‡ºï¼Œæå‡åç»­ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ•ˆç‡ï¼› Source Analysis # å…³äºactionåŠaction graphï¼Œå¯ä»¥å‚è€ƒï¼šhttps://github.com/golang/go/blob/master/src/cmd/go/internal/work/action.go
æ¯ä¸ªä¾èµ–å¯¹åº”çš„ç¼–è¯‘ç›®å½•ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://github.com/golang/go/blob/master/src/cmd/go/internal/work/action.go#L318
è¿™äº›æ˜¯äº›çç¢çš„ç»†èŠ‚ä¿¡æ¯ï¼Œå¯ä»¥å…ˆå¿½ç•¥ã€‚
References # https://maori.geek.nz/how-go-build-works-750bb2ba6d8e</description></item><item><title>how are loops translated to assembly</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-are-loops-translated-to-assembly/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-are-loops-translated-to-assembly/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†forå¾ªç¯å¦‚ä½•è¢«è½¬æ¢æˆæ±‡ç¼–çš„ï¼Œä¸»è¦æ˜¯ç†è§£è½¬æ¢æˆçš„æ±‡ç¼–çš„å«ä¹‰ã€‚æœ¬æ–‡è¿˜æåŠäº†go1.10ä¹‹å‰ç”Ÿæˆforå¾ªç¯æ±‡ç¼–æŒ‡ä»¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸”è¿™ä¸ªæŒ‡é’ˆå­˜åœ¨past-the-endçš„é—®é¢˜ï¼Œä¼šå¯¼è‡´ç¨‹åºéš¾ä»¥è¿›å…¥safepointï¼Œä¸å®¹æ˜“è¢«æŠ¢å ã€‚
åœ¨éåä½œå¼æŠ¢å çš„å»ºè®®è‰æ¡ˆä¸­ä¹Ÿæœ‰æåŠè¿™é‡Œçš„ç”Ÿæˆçš„ä¸´æ—¶æŒ‡é’ˆpast-the-endé—®é¢˜ï¼Œè¯¥é—®é¢˜ä¼šå½±å“åˆ°schedulerï¼Œforå¾ªç¯ä½“ä¸­ä¸å®¹æ˜“è¢«å…¶ä»–goroutineæŠ¢å ï¼Œéåä½œå¼æŠ¢å è®¾è®¡å®ç°ä¸­æåŠäº†æ­¤é—®é¢˜ã€‚
TODOï¼šæˆ‘æ²¡æœ‰çœ‹å¤ªæ˜ç™½è¿™é‡Œç”Ÿæˆçš„ä¸´æ—¶æŒ‡é’ˆpast-the-endé—®é¢˜ï¼Œç©¶ç«Ÿä¼šå¯¼è‡´ä»€ä¹ˆæ ·çš„ä¸å®‰å…¨é—®é¢˜ï¼Ÿ
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-are-loops-translated-to-assembly-835b985309b3</description></item><item><title>how are loops translated to assembly</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-are-loops-translated-to-assembly/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-are-loops-translated-to-assembly/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†forå¾ªç¯å¦‚ä½•è¢«è½¬æ¢æˆæ±‡ç¼–çš„ï¼Œä¸»è¦æ˜¯ç†è§£è½¬æ¢æˆçš„æ±‡ç¼–çš„å«ä¹‰ã€‚æœ¬æ–‡è¿˜æåŠäº†go1.10ä¹‹å‰ç”Ÿæˆforå¾ªç¯æ±‡ç¼–æŒ‡ä»¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸”è¿™ä¸ªæŒ‡é’ˆå­˜åœ¨past-the-endçš„é—®é¢˜ï¼Œä¼šå¯¼è‡´ç¨‹åºéš¾ä»¥è¿›å…¥safepointï¼Œä¸å®¹æ˜“è¢«æŠ¢å ã€‚
åœ¨éåä½œå¼æŠ¢å çš„å»ºè®®è‰æ¡ˆä¸­ä¹Ÿæœ‰æåŠè¿™é‡Œçš„ç”Ÿæˆçš„ä¸´æ—¶æŒ‡é’ˆpast-the-endé—®é¢˜ï¼Œè¯¥é—®é¢˜ä¼šå½±å“åˆ°schedulerï¼Œforå¾ªç¯ä½“ä¸­ä¸å®¹æ˜“è¢«å…¶ä»–goroutineæŠ¢å ï¼Œéåä½œå¼æŠ¢å è®¾è®¡å®ç°ä¸­æåŠäº†æ­¤é—®é¢˜ã€‚
TODOï¼šæˆ‘æ²¡æœ‰çœ‹å¤ªæ˜ç™½è¿™é‡Œç”Ÿæˆçš„ä¸´æ—¶æŒ‡é’ˆpast-the-endé—®é¢˜ï¼Œç©¶ç«Ÿä¼šå¯¼è‡´ä»€ä¹ˆæ ·çš„ä¸å®‰å…¨é—®é¢˜ï¼Ÿ
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-are-loops-translated-to-assembly-835b985309b3</description></item><item><title>how are random numbers generated</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/random/how-are-random-numbers-generated/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/random/how-are-random-numbers-generated/</guid><description>Let&amp;rsquo;s Summarize # goæ ‡å‡†åº“æä¾›äº†ä¸¤ä¸ªpackageæ¥ç”Ÿæˆéšæœºæ•°ï¼šmath/randå’Œcrypto/randã€‚
math/randï¼šç”Ÿæˆçš„æ˜¯ä¼ªéšæœºæ•°ï¼Œå¯ä»¥é€šè¿‡rand.Seed(int)æŒ‡å®šç§å­ï¼Œç„¶åmath/randä¼šæ ¹æ®ç§å­ç”Ÿæˆä¸€ä¸ªsequence sourceï¼Œç„¶årand.Int()ç”Ÿæˆéšæœºæ•°ï¼Œä½†æ˜¯å› ä¸ºè¿™é‡Œçš„sequence sourceæ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ç”Ÿæˆçš„éšæœºæ•°æ˜¯å¯é¢„æµ‹çš„ã€‚
crypto/randï¼šè¿™ç§æ–¹å¼åšäº†æ›´å¤šçš„æ•°å­¦è¿ç®—ï¼Œå¯ä»¥å®ç°æ›´å¥½çš„éšæœºæ€§ï¼›
math/randè¿™ç§æ–¹å¼æ€§èƒ½å¥½ä¸€ç‚¹ï¼Œå¤§çº¦æ˜¯crypto/randæ€§èƒ½çš„10å€+ï¼›ä½†æ˜¯crypto/randç”Ÿæˆçš„éšæœºæ•°çš„éšæœºæ€§è¦å¥½çš„å¤šã€‚
ä¸Šè¿°éƒ½æ˜¯å¹¶å‘å®‰å…¨çš„å®ç°ï¼Œæ¯”å¦‚math/randå®ç°å†…éƒ¨åŒ…å«äº†ä¸€ä¸ªmutexï¼Œå¦‚æœä¸éœ€è¦åœ¨å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå¦‚é€šè¿‡ï¼šrand.New(rand.NewSource(1).(rand.Source64)ï¼Œæ€§èƒ½åˆå¯ä»¥è·å¾—è¾ƒå¤§æå‡ã€‚
ps: rand.NewSource(seed int)è¿”å›çš„sourceæ˜¯égoroutineå¹¶å‘å®‰å…¨çš„ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-are-random-numbers-generated-e58ee8696999</description></item><item><title>how are random numbers generated</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-are-random-numbers-generated/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-are-random-numbers-generated/</guid><description>Let&amp;rsquo;s Summarize # goæ ‡å‡†åº“æä¾›äº†ä¸¤ä¸ªpackageæ¥ç”Ÿæˆéšæœºæ•°ï¼šmath/randå’Œcrypto/randã€‚
math/randï¼šç”Ÿæˆçš„æ˜¯ä¼ªéšæœºæ•°ï¼Œå¯ä»¥é€šè¿‡rand.Seed(int)æŒ‡å®šç§å­ï¼Œç„¶åmath/randä¼šæ ¹æ®ç§å­ç”Ÿæˆä¸€ä¸ªsequence sourceï¼Œç„¶årand.Int()ç”Ÿæˆéšæœºæ•°ï¼Œä½†æ˜¯å› ä¸ºè¿™é‡Œçš„sequence sourceæ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ç”Ÿæˆçš„éšæœºæ•°æ˜¯å¯é¢„æµ‹çš„ã€‚
crypto/randï¼šè¿™ç§æ–¹å¼åšäº†æ›´å¤šçš„æ•°å­¦è¿ç®—ï¼Œå¯ä»¥å®ç°æ›´å¥½çš„éšæœºæ€§ï¼›
math/randè¿™ç§æ–¹å¼æ€§èƒ½å¥½ä¸€ç‚¹ï¼Œå¤§çº¦æ˜¯crypto/randæ€§èƒ½çš„10å€+ï¼›ä½†æ˜¯crypto/randç”Ÿæˆçš„éšæœºæ•°çš„éšæœºæ€§è¦å¥½çš„å¤šã€‚
ä¸Šè¿°éƒ½æ˜¯å¹¶å‘å®‰å…¨çš„å®ç°ï¼Œæ¯”å¦‚math/randå®ç°å†…éƒ¨åŒ…å«äº†ä¸€ä¸ªmutexï¼Œå¦‚æœä¸éœ€è¦åœ¨å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå¦‚é€šè¿‡ï¼šrand.New(rand.NewSource(1).(rand.Source64)ï¼Œæ€§èƒ½åˆå¯ä»¥è·å¾—è¾ƒå¤§æå‡ã€‚
ps: rand.NewSource(seed int)è¿”å›çš„sourceæ˜¯égoroutineå¹¶å‘å®‰å…¨çš„ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-are-random-numbers-generated-e58ee8696999</description></item><item><title>how does a goroutine start and exit</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-does-a-goroutine-start-and-exit/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-does-a-goroutine-start-and-exit/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goroutineæ˜¯å¦‚ä½•åˆ›å»ºã€é€€å‡ºçš„ï¼Œåˆ›å»ºruntime.newprocå‡½æ•°ï¼Œæœ‰æåˆ°goroutineçš„å¤ç”¨é—®é¢˜ï¼Œæœ‰æåˆ°goroutineé€€å‡ºæ—¶çš„goexitå‡½æ•°ã€‚
è¯´å®è¯è¿™ç¯‡æ–‡ç« ä»‹ç»çš„éå¸¸æµ…ï¼Œå¾ˆå¤šç»†èŠ‚éƒ½æ²¡æœ‰æ¶‰åŠï¼Œå¯ä»¥çœ‹çœ‹å³è¾¹æˆ‘ç»“åˆæºç ä¸­å…³é”®å‡½æ•°é€»è¾‘çš„æ€»ç»“ã€‚
Source Analysis # goroutineåˆ›å»ºï¼šruntime.newproc(siz int32, fn *funcval)
go fn()ï¼Œä¼ é€’ç»™fnçš„å‚æ•°å®é™…ä¸Šæ˜¯ç´§è·Ÿç€å­˜åœ¨fnå‹æ ˆåçš„åœ°å€åé¢ï¼Œåœ¨newproc1çš„æ ˆå¸§é‡Œé¢ï¼Œä½†æ˜¯ä¸å‡ºç°åœ¨ç­¾åå‚æ•°åˆ—è¡¨ä¸­ï¼Œå› ä¸ºè¿™äº›å‚æ•°ç±»å‹ã€æ•°é‡ä¸ä¸€æ ·ï¼Œä¹Ÿæ— æ³•å‡ºç°åœ¨ç­¾åå‚æ•°åˆ—è¡¨ä¸­ï¼› newproc1åˆ›å»ºgï¼› getg().m.p.ptr()æ‹¿åˆ°å½“å‰pï¼› runqputå°†å½“å‰gæ”¾å…¥pçš„local queueä¸­ï¼Œå¦‚æœæ»¡åˆ™æ”¾åˆ°global queueä¸­ï¼› gç­‰å¾…è¢«è°ƒåº¦å™¨è°ƒåº¦æ‰§è¡Œï¼› å¤§è‡´åˆ›å»ºæ‰§è¡Œgoroutineçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼Œä¸‹é¢çš„é€»è¾‘éƒ½æ˜¯åˆ‡åˆ°ç³»ç»Ÿæ ˆä¸Šå»æ‰§è¡Œçš„ã€‚
1 newproc1é€»è¾‘
æŸ¥çœ‹æºç å‘ç°ï¼Œgoroutineåˆå§‹åˆ›å»ºæ—¶å¯¹å‡½æ•°å‚æ•°å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¦‚æœå‚æ•°å å†…å­˜ç©ºé—´å¾ˆå¤§ï¼Œæ¯”å¦‚è¶…è¿‡åˆå§‹æ ˆå¸§å¤§å°2KBï¼Œé‚£ä¹ˆgoroutineåˆ›å»ºä¼šå¤±è´¥ï¼š&amp;ldquo;fatal error: newproc: function arguments too large for new goroutine&amp;rdquo;ï¼Œæ¯”å¦‚ï¼Œgo func(a [1024]int) {}([1024]int{})ã€‚
æ¯ä¸ªpå†…éƒ¨éƒ½æœ‰ä¸€ä¸ªç©ºé—²goroutineé˜Ÿåˆ—gFreeï¼Œè¿™ä¸ªå°±æ˜¯ç”¨æ¥æ‰§è¡Œfnçš„goroutineï¼Œæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œä¸ç”¨çš„æ—¶å€™å¯ä»¥ä¸¢ç»™è°ƒåº¦å™¨schedt.gFreeä¾›å…¶ä»–på¤ç”¨ã€‚è¿™é‡Œç©ºé—²çš„goroutinesï¼Œä¸€éƒ¨åˆ†å­˜åœ¨äºp.gFreeï¼Œå¦‚æœgfput(p, gp)æ—¶å‘ç°p.gFreeé˜Ÿåˆ—å¤ªé•¿è¯´æ˜è¿‡å‰©äº†ï¼Œå°±è½¬ç§»ä¸€éƒ¨åˆ†åˆ°è°ƒåº¦å™¨schedt.gFreeä¸­ä¾›å…¶ä»–på¤ç”¨ã€‚
goroutineæ‰§è¡Œå®Œæ¯•åè¿è¡Œæ—¶å¹¶ä¸æ€¥äºå°†å…¶é”€æ¯ï¼Œè€Œæ˜¯ä¼šè€ƒè™‘goroutineçš„å¤ç”¨ï¼Œgfputï¼Œå‰é¢æè¿‡äº†ã€‚å¸Œæœ›go func()é€šè¿‡åç¨‹æ‰§è¡Œæ—¶ï¼Œä¹Ÿä¸å¿…æ¯æ¬¡åˆ›å»ºæ–°çš„goroutineï¼Œgfgetï¼Œå¯ä»¥å¤ç”¨p.gFreeä¸­çš„goroutineï¼Œå¦‚æœp.gFreeç©ºæˆ–è€…è¿‡å°‘ï¼ˆ32ï¼‰ä¸”è°ƒåº¦å™¨schedt.gFreeä¸­æœ‰ç©ºé—²ï¼Œåˆ™è½¬ç§»ä¸€éƒ¨åˆ†è¿‡æ¥ç»™på¤ç”¨ã€‚ä½†æ˜¯goroutineçš„æ ˆæœ‰å¯èƒ½ä¼šè¢«é”€æ¯ï¼Œå¦‚æœå¤ç”¨åˆ°æ ˆè¢«é”€æ¯çš„goroutineå°±éœ€è¦stackallocé‡æ–°ä¸ºå…¶åˆ†é…æ–°æ ˆå¸§ã€‚
å¦‚æœæ²¡æœ‰ç©ºé—²çš„gå¯ä¾›å¤ç”¨ï¼Œé‚£å°±åªèƒ½malgä»å¤´æ–°å»ºä¸€ä¸ªgoroutineäº†ã€‚
goroutineåˆ›å»ºæˆåŠŸã€æ ˆç©ºé—´ä¹Ÿokäº†ä¹‹åï¼Œå°±è¦æŠŠgoroutineè¦æ‰§è¡Œçš„å‡½æ•°å¯¹åº”çš„å‡½æ•°å‚æ•°ç»™æ‹·è´åˆ°è¿™ä¸ªæ ˆç©ºé—´é‡Œé¢æ¥ï¼Œé€šè¿‡memmove(spArg, argp, uintptr(narg))æ¥å®Œæˆã€‚å®Œæˆåè°ƒæ•´newgçš„è°ƒåº¦ä¸Šä¸‹æ–‡ç›¸å…³çš„å¯„å­˜å™¨å€¼ï¼Œç­‰è°ƒåº¦å™¨è°ƒåº¦å®ƒæ—¶ï¼Œè¿˜åŸå…¶ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œpcå°±æŒ‡å‘å…¶å¯¹åº”çš„å‡½æ•°åœ°å€äº†ï¼Œå¯¹åº”çš„æ•°æ®ä¹Ÿä¼šæŒ‡å‘å…¶å¯¹åº”çš„æ ˆç©ºé—´ã€‚
ç„¶åï¼Œé€šè¿‡gostartcallfnâ†’gostartcall(buf, fn, ctxt)ï¼Œä¹‹å‰å·²ç»æ‹·è´äº†å‡½æ•°fnçš„å‚æ•°åˆ°goroutineæ ˆç©ºé—´äº†ï¼Œè¿™é‡Œé¢å†ç»§ç»­åœ¨æ ˆå†…è®¾ç½®fnè¿”å›åœ°å€ã€gobuf.sp+gobuf.pcä¿¡æ¯ã€‚
ä¸Šè¿°è°ƒæ•´å®Œæˆä¹‹åï¼Œå°†goroutineçš„çŠ¶æ€ä»_Gdeadè°ƒæ•´ä¸º_Grunnableï¼Œç­‰å¾…è°ƒåº¦å™¨è°ƒåº¦ã€‚æ–°åˆ›å»ºçš„æ—¶å€™å…¶çŠ¶æ€æ˜¯_Gidleï¼Œä¸€å®šä¼šå°†å…¶è°ƒæ•´ä¸º_Gdeadç„¶åå†è¿›è¡Œä¸Šè¿°å‡†å¤‡å·¥ä½œï¼Œä¸€åˆ‡å°±ç»ªåæ‰è°ƒæ•´ä¸º_Grunnableè®©å…¶å‚ä¸è°ƒåº¦ã€‚
2 runqput(p, gp, next) è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼Œå¸Œæœ›å°†gpæ”¾åˆ°pçš„local queueä¸­ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¤´æ’ã€å°¾æ’ä¸¤ç§æ–¹å¼ã€‚
å¦‚æœnextä¸ºtrueï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å¤´æ’ï¼Œå…¶å®æ˜¯æ”¾åˆ°p.runnextä¸­ï¼Œæ¯”p.queueä¸­çš„å¾—åˆ°ä¼˜å…ˆè°ƒåº¦ã€‚å¦‚æœä¹‹å‰p.runnextæœ‰å€¼ï¼Œè¿˜è¦è¯¥å€¼å¯¹åº”çš„gæ”¾å…¥p.queueä¸­ï¼› å¦‚æœnextä¸ºfalseï¼Œåˆ™å°è¯•å°†å…¶æ”¾ç½®åˆ°p.queueä¸­ï¼Œè¿™é‡Œä¹Ÿæœ‰å¿«æ…¢ä¸¤ç§æƒ…å†µï¼Œå¿«çš„æƒ…å†µå°±æ˜¯ï¼Œå› ä¸ºp.queueè¿™ä¸ªæœ¬åœ°é˜Ÿåˆ—é•¿åº¦æœ€å¤§ä¸º256ï¼Œå¦‚æœæœ‰ç©ºä½™ä½ç½®æ”¾å…¥å°±è¿”å›ï¼Œè¿™æ˜¯å¿«çš„æƒ…å†µã€‚æ…¢çš„æƒ…å†µå°±æ˜¯å¦‚æœp.queueæ»¡äº†å°±è¦å…ˆè½¬ç§»1/2åˆ°è°ƒåº¦å™¨å…¨å±€é˜Ÿåˆ—schedt.queueä¸­ï¼Œç„¶åå†æ”¾å…¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ…¢ä¸€äº›ã€‚ æ”¾ç½®è¿‡ç¨‹ä¸­ï¼Œå¦‚æœp.runqueueæ»¡äº†æ€ä¹ˆåŠï¼Œå°†å…¶æ”¾ç½®åˆ°è°ƒåº¦å™¨schedt.queueè¿™ä¸ªå…¨å±€é˜Ÿåˆ—ä¸­ã€‚
3 wakeup()é€»è¾‘
è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œstartm(p, spinning)ï¼Œæ¥æ‰¾ä¸€ä¸ªmæ¥æ‰§è¡Œgoroutineï¼Œå…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ
å¦‚æœæ²¡æœ‰æŒ‡å®špï¼Œæ¯”å¦‚æ–°å»ºgoroutineæ—¶ï¼Œæ­¤æ—¶ä¼šå°è¯•æ£€æŸ¥æœ‰æ²¡æœ‰ç©ºé—²çš„pï¼Œæ²¡æœ‰çš„è¯å°±ç›´æ¥è¿”å›äº†ï¼Œç›¸å½“äºå½“å‰ä¸€æ¬¡æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆåªèƒ½ä¸‹æ¬¡è°ƒåº¦çš„æ—¶å€™å†æ‰§è¡Œè¿™ä¸ªæ–°å»ºçš„goroutineäº†ï¼›</description></item><item><title>how does a goroutine start and exit</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-a-goroutine-start-and-exit/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-a-goroutine-start-and-exit/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goroutineæ˜¯å¦‚ä½•åˆ›å»ºã€é€€å‡ºçš„ï¼Œåˆ›å»ºruntime.newprocå‡½æ•°ï¼Œæœ‰æåˆ°goroutineçš„å¤ç”¨é—®é¢˜ï¼Œæœ‰æåˆ°goroutineé€€å‡ºæ—¶çš„goexitå‡½æ•°ã€‚
è¯´å®è¯è¿™ç¯‡æ–‡ç« ä»‹ç»çš„éå¸¸æµ…ï¼Œå¾ˆå¤šç»†èŠ‚éƒ½æ²¡æœ‰æ¶‰åŠï¼Œå¯ä»¥çœ‹çœ‹å³è¾¹æˆ‘ç»“åˆæºç ä¸­å…³é”®å‡½æ•°é€»è¾‘çš„æ€»ç»“ã€‚
Source Analysis # goroutineåˆ›å»ºï¼šruntime.newproc(siz int32, fn *funcval)
go fn()ï¼Œä¼ é€’ç»™fnçš„å‚æ•°å®é™…ä¸Šæ˜¯ç´§è·Ÿç€å­˜åœ¨fnå‹æ ˆåçš„åœ°å€åé¢ï¼Œåœ¨newproc1çš„æ ˆå¸§é‡Œé¢ï¼Œä½†æ˜¯ä¸å‡ºç°åœ¨ç­¾åå‚æ•°åˆ—è¡¨ä¸­ï¼Œå› ä¸ºè¿™äº›å‚æ•°ç±»å‹ã€æ•°é‡ä¸ä¸€æ ·ï¼Œä¹Ÿæ— æ³•å‡ºç°åœ¨ç­¾åå‚æ•°åˆ—è¡¨ä¸­ï¼› newproc1åˆ›å»ºgï¼› getg().m.p.ptr()æ‹¿åˆ°å½“å‰pï¼› runqputå°†å½“å‰gæ”¾å…¥pçš„local queueä¸­ï¼Œå¦‚æœæ»¡åˆ™æ”¾åˆ°global queueä¸­ï¼› gç­‰å¾…è¢«è°ƒåº¦å™¨è°ƒåº¦æ‰§è¡Œï¼› å¤§è‡´åˆ›å»ºæ‰§è¡Œgoroutineçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼Œä¸‹é¢çš„é€»è¾‘éƒ½æ˜¯åˆ‡åˆ°ç³»ç»Ÿæ ˆä¸Šå»æ‰§è¡Œçš„ã€‚
1 newproc1é€»è¾‘
æŸ¥çœ‹æºç å‘ç°ï¼Œgoroutineåˆå§‹åˆ›å»ºæ—¶å¯¹å‡½æ•°å‚æ•°å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¦‚æœå‚æ•°å å†…å­˜ç©ºé—´å¾ˆå¤§ï¼Œæ¯”å¦‚è¶…è¿‡åˆå§‹æ ˆå¸§å¤§å°2KBï¼Œé‚£ä¹ˆgoroutineåˆ›å»ºä¼šå¤±è´¥ï¼š&amp;ldquo;fatal error: newproc: function arguments too large for new goroutine&amp;rdquo;ï¼Œæ¯”å¦‚ï¼Œgo func(a [1024]int) {}([1024]int{})ã€‚
æ¯ä¸ªpå†…éƒ¨éƒ½æœ‰ä¸€ä¸ªç©ºé—²goroutineé˜Ÿåˆ—gFreeï¼Œè¿™ä¸ªå°±æ˜¯ç”¨æ¥æ‰§è¡Œfnçš„goroutineï¼Œæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œä¸ç”¨çš„æ—¶å€™å¯ä»¥ä¸¢ç»™è°ƒåº¦å™¨schedt.gFreeä¾›å…¶ä»–på¤ç”¨ã€‚è¿™é‡Œç©ºé—²çš„goroutinesï¼Œä¸€éƒ¨åˆ†å­˜åœ¨äºp.gFreeï¼Œå¦‚æœgfput(p, gp)æ—¶å‘ç°p.gFreeé˜Ÿåˆ—å¤ªé•¿è¯´æ˜è¿‡å‰©äº†ï¼Œå°±è½¬ç§»ä¸€éƒ¨åˆ†åˆ°è°ƒåº¦å™¨schedt.gFreeä¸­ä¾›å…¶ä»–på¤ç”¨ã€‚
goroutineæ‰§è¡Œå®Œæ¯•åè¿è¡Œæ—¶å¹¶ä¸æ€¥äºå°†å…¶é”€æ¯ï¼Œè€Œæ˜¯ä¼šè€ƒè™‘goroutineçš„å¤ç”¨ï¼Œgfputï¼Œå‰é¢æè¿‡äº†ã€‚å¸Œæœ›go func()é€šè¿‡åç¨‹æ‰§è¡Œæ—¶ï¼Œä¹Ÿä¸å¿…æ¯æ¬¡åˆ›å»ºæ–°çš„goroutineï¼Œgfgetï¼Œå¯ä»¥å¤ç”¨p.gFreeä¸­çš„goroutineï¼Œå¦‚æœp.gFreeç©ºæˆ–è€…è¿‡å°‘ï¼ˆ32ï¼‰ä¸”è°ƒåº¦å™¨schedt.gFreeä¸­æœ‰ç©ºé—²ï¼Œåˆ™è½¬ç§»ä¸€éƒ¨åˆ†è¿‡æ¥ç»™på¤ç”¨ã€‚ä½†æ˜¯goroutineçš„æ ˆæœ‰å¯èƒ½ä¼šè¢«é”€æ¯ï¼Œå¦‚æœå¤ç”¨åˆ°æ ˆè¢«é”€æ¯çš„goroutineå°±éœ€è¦stackallocé‡æ–°ä¸ºå…¶åˆ†é…æ–°æ ˆå¸§ã€‚
å¦‚æœæ²¡æœ‰ç©ºé—²çš„gå¯ä¾›å¤ç”¨ï¼Œé‚£å°±åªèƒ½malgä»å¤´æ–°å»ºä¸€ä¸ªgoroutineäº†ã€‚
goroutineåˆ›å»ºæˆåŠŸã€æ ˆç©ºé—´ä¹Ÿokäº†ä¹‹åï¼Œå°±è¦æŠŠgoroutineè¦æ‰§è¡Œçš„å‡½æ•°å¯¹åº”çš„å‡½æ•°å‚æ•°ç»™æ‹·è´åˆ°è¿™ä¸ªæ ˆç©ºé—´é‡Œé¢æ¥ï¼Œé€šè¿‡memmove(spArg, argp, uintptr(narg))æ¥å®Œæˆã€‚å®Œæˆåè°ƒæ•´newgçš„è°ƒåº¦ä¸Šä¸‹æ–‡ç›¸å…³çš„å¯„å­˜å™¨å€¼ï¼Œç­‰è°ƒåº¦å™¨è°ƒåº¦å®ƒæ—¶ï¼Œè¿˜åŸå…¶ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œpcå°±æŒ‡å‘å…¶å¯¹åº”çš„å‡½æ•°åœ°å€äº†ï¼Œå¯¹åº”çš„æ•°æ®ä¹Ÿä¼šæŒ‡å‘å…¶å¯¹åº”çš„æ ˆç©ºé—´ã€‚
ç„¶åï¼Œé€šè¿‡gostartcallfnâ†’gostartcall(buf, fn, ctxt)ï¼Œä¹‹å‰å·²ç»æ‹·è´äº†å‡½æ•°fnçš„å‚æ•°åˆ°goroutineæ ˆç©ºé—´äº†ï¼Œè¿™é‡Œé¢å†ç»§ç»­åœ¨æ ˆå†…è®¾ç½®fnè¿”å›åœ°å€ã€gobuf.sp+gobuf.pcä¿¡æ¯ã€‚
ä¸Šè¿°è°ƒæ•´å®Œæˆä¹‹åï¼Œå°†goroutineçš„çŠ¶æ€ä»_Gdeadè°ƒæ•´ä¸º_Grunnableï¼Œç­‰å¾…è°ƒåº¦å™¨è°ƒåº¦ã€‚æ–°åˆ›å»ºçš„æ—¶å€™å…¶çŠ¶æ€æ˜¯_Gidleï¼Œä¸€å®šä¼šå°†å…¶è°ƒæ•´ä¸º_Gdeadç„¶åå†è¿›è¡Œä¸Šè¿°å‡†å¤‡å·¥ä½œï¼Œä¸€åˆ‡å°±ç»ªåæ‰è°ƒæ•´ä¸º_Grunnableè®©å…¶å‚ä¸è°ƒåº¦ã€‚
2 runqput(p, gp, next) è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼Œå¸Œæœ›å°†gpæ”¾åˆ°pçš„local queueä¸­ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¤´æ’ã€å°¾æ’ä¸¤ç§æ–¹å¼ã€‚
å¦‚æœnextä¸ºtrueï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å¤´æ’ï¼Œå…¶å®æ˜¯æ”¾åˆ°p.runnextä¸­ï¼Œæ¯”p.queueä¸­çš„å¾—åˆ°ä¼˜å…ˆè°ƒåº¦ã€‚å¦‚æœä¹‹å‰p.runnextæœ‰å€¼ï¼Œè¿˜è¦è¯¥å€¼å¯¹åº”çš„gæ”¾å…¥p.queueä¸­ï¼› å¦‚æœnextä¸ºfalseï¼Œåˆ™å°è¯•å°†å…¶æ”¾ç½®åˆ°p.queueä¸­ï¼Œè¿™é‡Œä¹Ÿæœ‰å¿«æ…¢ä¸¤ç§æƒ…å†µï¼Œå¿«çš„æƒ…å†µå°±æ˜¯ï¼Œå› ä¸ºp.queueè¿™ä¸ªæœ¬åœ°é˜Ÿåˆ—é•¿åº¦æœ€å¤§ä¸º256ï¼Œå¦‚æœæœ‰ç©ºä½™ä½ç½®æ”¾å…¥å°±è¿”å›ï¼Œè¿™æ˜¯å¿«çš„æƒ…å†µã€‚æ…¢çš„æƒ…å†µå°±æ˜¯å¦‚æœp.queueæ»¡äº†å°±è¦å…ˆè½¬ç§»1/2åˆ°è°ƒåº¦å™¨å…¨å±€é˜Ÿåˆ—schedt.queueä¸­ï¼Œç„¶åå†æ”¾å…¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ…¢ä¸€äº›ã€‚ æ”¾ç½®è¿‡ç¨‹ä¸­ï¼Œå¦‚æœp.runqueueæ»¡äº†æ€ä¹ˆåŠï¼Œå°†å…¶æ”¾ç½®åˆ°è°ƒåº¦å™¨schedt.queueè¿™ä¸ªå…¨å±€é˜Ÿåˆ—ä¸­ã€‚
3 wakeup()é€»è¾‘
è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œstartm(p, spinning)ï¼Œæ¥æ‰¾ä¸€ä¸ªmæ¥æ‰§è¡Œgoroutineï¼Œå…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ
å¦‚æœæ²¡æœ‰æŒ‡å®špï¼Œæ¯”å¦‚æ–°å»ºgoroutineæ—¶ï¼Œæ­¤æ—¶ä¼šå°è¯•æ£€æŸ¥æœ‰æ²¡æœ‰ç©ºé—²çš„pï¼Œæ²¡æœ‰çš„è¯å°±ç›´æ¥è¿”å›äº†ï¼Œç›¸å½“äºå½“å‰ä¸€æ¬¡æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆåªèƒ½ä¸‹æ¬¡è°ƒåº¦çš„æ—¶å€™å†æ‰§è¡Œè¿™ä¸ªæ–°å»ºçš„goroutineäº†ï¼›</description></item><item><title>how does a program recover</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/panicrecover/how-does-a-program-recover/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/panicrecover/how-does-a-program-recover/</guid><description>Let&amp;rsquo;s Summarize # deferå¯¹åº”newdefer panicå¯¹åº”gopanic recoverå¯¹åº”gorecover
deferç»†èŠ‚ï¼š
deferè°ƒç”¨ä¼šåˆ›å»º_deferå¯¹è±¡å¹¶æ·»åŠ åˆ°g._deferï¼Œ_deferé€šè¿‡å†…éƒ¨çš„_defer.linkæ„æˆäº†ä¸€ä¸ªLIFOçš„deferæ ˆï¼Œå‡½æ•°returnï¼ˆruntime.deferreturnï¼‰æˆ–è€…panicï¼ˆå†…éƒ¨ä¼šéå†g._deferå¹¶æ‰§è¡Œï¼‰æ—¶ï¼Œå°±æŒ‰ç…§æ ˆçš„æ–¹å¼æ¥æ‰§è¡Œæ³¨å†Œçš„deferå‡½æ•°ã€‚
psï¼šdeferå‡½æ•°æ‰§è¡Œçš„æ—¶å€™æ˜¯éœ€è¦è€ƒè™‘æ ˆå¸§åˆ†é…çš„ï¼Œè¿™ä¸ªå¯ä»¥å†é€»è¾‘ä¸€ä¸‹ç»†èŠ‚ï¼Œä¹Ÿæ˜¯go deferæ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªæ–¹é¢ï¼Œå¦‚é¿å…deferå¼•èµ·çš„æ ˆå¢é•¿ï¼›
panicç»†èŠ‚ï¼š
panicçš„æ—¶å€™ï¼Œä¼šåˆ›å»º_panicå¯¹è±¡å¹¶æ·»åŠ åˆ°g._panicï¼Œ_panicä¹Ÿå’Œ_deferç±»ä¼¼é€šè¿‡_panic.linkç»´æŠ¤äº†ä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œä¹Ÿæ˜¯LIFOçš„å½¢å¼ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€å¼€å§‹å‡ºç°äº†panic1ï¼Œg._panicè¢«è®¾ç½®ä¸ºpanic1ï¼Œå‡å¦‚åœ¨åç»­deferçš„æ—¶å€™ï¼Œdeferå‡½æ•°ä¸­åˆpanic2ï¼Œé‚£ä¹ˆg._panicè¢«è®¾ç½®ä¸ºpanic2ä¸”panic2.link==panic1ã€‚å‡å¦‚deferå‡½æ•°ä¸­æ‰§è¡Œäº†recoverï¼Œä¹Ÿæ˜¯å…ˆrecover g._panicï¼Œç„¶åå†å°†g._panicæ›´æ–°ä¸ºg._panic.linkç»§ç»­æ‰§è¡Œdeferã€‚
å¦‚æœæŸä¸ªdeferæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰§è¡Œäº†recoverï¼Œé‚£ä¹ˆg._panic.recoveredè¢«è®¾ç½®ä¸ºtrueï¼Œå‡å¦‚panic chainä¸­è¿˜æœ‰panicï¼Œä¼šè°ƒç”¨mcall(recovery)ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†æ¢å¤gä¸Šä¸‹æ–‡ä¸ºrecover
recoverç»†èŠ‚ï¼š
recoverè°ƒç”¨å¯¹åº”å®ç°å‡½æ•°æ˜¯gorecoverï¼Œrecoverå‡½æ•°å¿…é¡»åœ¨deferå‡½æ•°çš„åº•å±‚è°ƒç”¨æ‰èƒ½æ­£å¸¸recoveråé¢çš„panicã€‚gorecover(argp)è¿™é‡Œçš„å‚æ•°argpæ˜¯è°ƒç”¨recoverå‡½æ•°çš„callerçš„åœ°å€ï¼Œä¼šä¸g._panic.argpæ˜¯defer func(){}è¿™é‡Œå‡½æ•°è°ƒç”¨func(){}çš„åœ°å€ï¼Œå¦‚æœargpå’Œg._panic.argpä¸ç›¸åŒï¼Œè¡¨ç¤ºrecoverä¸æ˜¯åœ¨åˆé€‚çš„ä½ç½®è°ƒç”¨çš„ï¼Œä¹Ÿå°±ä¸èƒ½ä¿®æ”¹g._panic.recovered=trueï¼Œå³ä¸èƒ½recoverå¯¹åº”çš„panicã€‚
recoverå‡½æ•°ä½¿ç”¨çš„ä½ç½®æœ‰è®²ç©¶ï¼Œå°±æ˜¯è¿™ä¹ˆæ¥çš„ã€‚
runtime.Goexit()
è¿™ä¸ªå‡½æ•°çš„è®¾è®¡å®ç°æ˜¯å¤ç”¨äº†panicã€deferå¤„ç†çš„é€»è¾‘ï¼Œä½†æ˜¯å› ä¸ºè¿™é‡Œçš„Goexitå¹¶ä¸æ˜¯çœŸæ­£çš„panicé€»è¾‘ï¼Œæ‰€ä»¥å…¶åœ¨_panicé‡Œé¢åŠ äº†ä¸ªæ–°å­—æ®µgoexit=trueï¼Œä»¥ä¸æ­£å¸¸çš„panicå¤„ç†é€»è¾‘åŒºåˆ†å¼€ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°åœ¨gopanicæ‰§è¡ŒdeferChainä¸­æœ‰å¯¹æ­¤è¿›è¡Œç‰¹æ®Šåˆ¤æ–­ï¼Œå½“é‡åˆ°panic.goexit=trueä¸”panic.aborted=trueæ—¶ï¼Œå…è®¸ç›´æ¥åˆ‡æ¢ä¸Šä¸‹æ–‡ä¸ºGoexitå¤„ç†é€»è¾‘ï¼ˆæ­£å¸¸çš„recoveré€»è¾‘ä¼šç»•è¿‡Goexitï¼‰ã€‚
psï¼šç¯‡å¹…åŸå› ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›è¾¹ç•Œæƒ…å†µè¿™é‡Œæ²¡æœ‰å±•å¼€ç»†è®²ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±æŸ¥çœ‹æºç ã€‚TODO è¿™é‡Œçš„ç†è§£è¿˜éœ€è¦å†åŠ å¼ºä¸€ä¸‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-a-program-recover-fbbbf27cc31e</description></item><item><title>how does a program recover</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-a-program-recover/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-a-program-recover/</guid><description>Let&amp;rsquo;s Summarize # deferå¯¹åº”newdefer panicå¯¹åº”gopanic recoverå¯¹åº”gorecover
deferç»†èŠ‚ï¼š
deferè°ƒç”¨ä¼šåˆ›å»º_deferå¯¹è±¡å¹¶æ·»åŠ åˆ°g._deferï¼Œ_deferé€šè¿‡å†…éƒ¨çš„_defer.linkæ„æˆäº†ä¸€ä¸ªLIFOçš„deferæ ˆï¼Œå‡½æ•°returnï¼ˆruntime.deferreturnï¼‰æˆ–è€…panicï¼ˆå†…éƒ¨ä¼šéå†g._deferå¹¶æ‰§è¡Œï¼‰æ—¶ï¼Œå°±æŒ‰ç…§æ ˆçš„æ–¹å¼æ¥æ‰§è¡Œæ³¨å†Œçš„deferå‡½æ•°ã€‚
psï¼šdeferå‡½æ•°æ‰§è¡Œçš„æ—¶å€™æ˜¯éœ€è¦è€ƒè™‘æ ˆå¸§åˆ†é…çš„ï¼Œè¿™ä¸ªå¯ä»¥å†é€»è¾‘ä¸€ä¸‹ç»†èŠ‚ï¼Œä¹Ÿæ˜¯go deferæ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªæ–¹é¢ï¼Œå¦‚é¿å…deferå¼•èµ·çš„æ ˆå¢é•¿ï¼›
panicç»†èŠ‚ï¼š
panicçš„æ—¶å€™ï¼Œä¼šåˆ›å»º_panicå¯¹è±¡å¹¶æ·»åŠ åˆ°g._panicï¼Œ_panicä¹Ÿå’Œ_deferç±»ä¼¼é€šè¿‡_panic.linkç»´æŠ¤äº†ä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œä¹Ÿæ˜¯LIFOçš„å½¢å¼ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€å¼€å§‹å‡ºç°äº†panic1ï¼Œg._panicè¢«è®¾ç½®ä¸ºpanic1ï¼Œå‡å¦‚åœ¨åç»­deferçš„æ—¶å€™ï¼Œdeferå‡½æ•°ä¸­åˆpanic2ï¼Œé‚£ä¹ˆg._panicè¢«è®¾ç½®ä¸ºpanic2ä¸”panic2.link==panic1ã€‚å‡å¦‚deferå‡½æ•°ä¸­æ‰§è¡Œäº†recoverï¼Œä¹Ÿæ˜¯å…ˆrecover g._panicï¼Œç„¶åå†å°†g._panicæ›´æ–°ä¸ºg._panic.linkç»§ç»­æ‰§è¡Œdeferã€‚
å¦‚æœæŸä¸ªdeferæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰§è¡Œäº†recoverï¼Œé‚£ä¹ˆg._panic.recoveredè¢«è®¾ç½®ä¸ºtrueï¼Œå‡å¦‚panic chainä¸­è¿˜æœ‰panicï¼Œä¼šè°ƒç”¨mcall(recovery)ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†æ¢å¤gä¸Šä¸‹æ–‡ä¸ºrecover
recoverç»†èŠ‚ï¼š
recoverè°ƒç”¨å¯¹åº”å®ç°å‡½æ•°æ˜¯gorecoverï¼Œrecoverå‡½æ•°å¿…é¡»åœ¨deferå‡½æ•°çš„åº•å±‚è°ƒç”¨æ‰èƒ½æ­£å¸¸recoveråé¢çš„panicã€‚gorecover(argp)è¿™é‡Œçš„å‚æ•°argpæ˜¯è°ƒç”¨recoverå‡½æ•°çš„callerçš„åœ°å€ï¼Œä¼šä¸g._panic.argpæ˜¯defer func(){}è¿™é‡Œå‡½æ•°è°ƒç”¨func(){}çš„åœ°å€ï¼Œå¦‚æœargpå’Œg._panic.argpä¸ç›¸åŒï¼Œè¡¨ç¤ºrecoverä¸æ˜¯åœ¨åˆé€‚çš„ä½ç½®è°ƒç”¨çš„ï¼Œä¹Ÿå°±ä¸èƒ½ä¿®æ”¹g._panic.recovered=trueï¼Œå³ä¸èƒ½recoverå¯¹åº”çš„panicã€‚
recoverå‡½æ•°ä½¿ç”¨çš„ä½ç½®æœ‰è®²ç©¶ï¼Œå°±æ˜¯è¿™ä¹ˆæ¥çš„ã€‚
runtime.Goexit()
è¿™ä¸ªå‡½æ•°çš„è®¾è®¡å®ç°æ˜¯å¤ç”¨äº†panicã€deferå¤„ç†çš„é€»è¾‘ï¼Œä½†æ˜¯å› ä¸ºè¿™é‡Œçš„Goexitå¹¶ä¸æ˜¯çœŸæ­£çš„panicé€»è¾‘ï¼Œæ‰€ä»¥å…¶åœ¨_panicé‡Œé¢åŠ äº†ä¸ªæ–°å­—æ®µgoexit=trueï¼Œä»¥ä¸æ­£å¸¸çš„panicå¤„ç†é€»è¾‘åŒºåˆ†å¼€ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°åœ¨gopanicæ‰§è¡ŒdeferChainä¸­æœ‰å¯¹æ­¤è¿›è¡Œç‰¹æ®Šåˆ¤æ–­ï¼Œå½“é‡åˆ°panic.goexit=trueä¸”panic.aborted=trueæ—¶ï¼Œå…è®¸ç›´æ¥åˆ‡æ¢ä¸Šä¸‹æ–‡ä¸ºGoexitå¤„ç†é€»è¾‘ï¼ˆæ­£å¸¸çš„recoveré€»è¾‘ä¼šç»•è¿‡Goexitï¼‰ã€‚
psï¼šç¯‡å¹…åŸå› ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›è¾¹ç•Œæƒ…å†µè¿™é‡Œæ²¡æœ‰å±•å¼€ç»†è®²ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±æŸ¥çœ‹æºç ã€‚TODO è¿™é‡Œçš„ç†è§£è¿˜éœ€è¦å†åŠ å¼ºä¸€ä¸‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-a-program-recover-fbbbf27cc31e</description></item><item><title>how does defer statement work</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/defer/how-does-defer-statement-work/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/defer/how-does-defer-statement-work/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†deferã€panicã€recoverçš„ä½¿ç”¨åŠå®ç°æ–¹å¼ã€‚
gé‡Œé¢æœ‰_deferæˆå‘˜ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ªLIFOçš„æ ˆï¼Œæ¯æ¬¡è°ƒç”¨deferçš„æ—¶å€™ä¼šé€šè¿‡runtime.deferfuncï¼ˆå†…éƒ¨é€šè¿‡newdeferï¼‰æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„deferå¯¹è±¡å¹¶åŠ åˆ°g._deferæ ˆé¡¶ï¼›
gå†…éƒ¨panicçš„æ—¶å€™gopanicä¼šè®¾ç½®g._panicï¼›
è°ƒç”¨recoverçš„æ—¶å€™gorecoverä¼šæ£€æŸ¥å½“å‰gçš„_panicï¼›
æ–‡ä¸­è¿˜ä»‹ç»äº†ä¼˜åŒ–deferæ€§èƒ½çš„CLï¼Œsee https://go-review.googlesource.com/c/go/+/29656/ã€‚è¿™ä¸ªCLçš„æ ¸å¿ƒæ€æƒ³æ˜¯å‡å°‘newdeferæ—¶å¯¼è‡´çš„gè¢«æŠ¢å ã€æ ˆå¢é•¿ã€deferå‡½æ•°å‚æ•°å†…å­˜æ‹·è´é—®é¢˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-defer-statement-work-1a9492689b6e?source=---------48-----------------------</description></item><item><title>how does defer statement work</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-defer-statement-work/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-defer-statement-work/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†deferã€panicã€recoverçš„ä½¿ç”¨åŠå®ç°æ–¹å¼ã€‚
gé‡Œé¢æœ‰_deferæˆå‘˜ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ªLIFOçš„æ ˆï¼Œæ¯æ¬¡è°ƒç”¨deferçš„æ—¶å€™ä¼šé€šè¿‡runtime.deferfuncï¼ˆå†…éƒ¨é€šè¿‡newdeferï¼‰æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„deferå¯¹è±¡å¹¶åŠ åˆ°g._deferæ ˆé¡¶ï¼›
gå†…éƒ¨panicçš„æ—¶å€™gopanicä¼šè®¾ç½®g._panicï¼›
è°ƒç”¨recoverçš„æ—¶å€™gorecoverä¼šæ£€æŸ¥å½“å‰gçš„_panicï¼›
æ–‡ä¸­è¿˜ä»‹ç»äº†ä¼˜åŒ–deferæ€§èƒ½çš„CLï¼Œsee https://go-review.googlesource.com/c/go/+/29656/ã€‚è¿™ä¸ªCLçš„æ ¸å¿ƒæ€æƒ³æ˜¯å‡å°‘newdeferæ—¶å¯¼è‡´çš„gè¢«æŠ¢å ã€æ ˆå¢é•¿ã€deferå‡½æ•°å‚æ•°å†…å­˜æ‹·è´é—®é¢˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-defer-statement-work-1a9492689b6e?source=---------48-----------------------</description></item><item><title>how does GC mark the memory</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-GC-mark-the-memory/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-GC-mark-the-memory/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goçš„åƒåœ¾å›æ”¶å™¨æ˜¯å¦‚ä½•æ ‡è®°æ­£åœ¨ä½¿ç”¨ä¸­çš„å†…å­˜çš„ï¼Œgoä¸­é‡‡ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆconcurrent tricolor mark and sweepï¼‰ï¼Œå…ˆç»“åˆå­—é¢å«ä¹‰è§£é‡Šå‡ ä¸ªäº‹æƒ…ã€‚
åŸºæœ¬æ¦‚å¿µï¼š
å¹¶å‘ï¼Œè¿™é‡Œçš„å¹¶å‘æŒ‡çš„æ˜¯GCé€»è¾‘å’Œæˆ‘ä»¬çš„åº”ç”¨å¤„ç†é€»è¾‘æ˜¯å¹¶å‘è¿›è¡Œçš„ï¼› ä¸‰è‰²ï¼Œä¸ºäº†åŒºåˆ†å“ªäº›å¯¹è±¡æ˜¯å¯è¾¾å¯¹è±¡ï¼ˆæ­£åœ¨è¢«å¼•ç”¨çš„ï¼‰ï¼Œå“ªäº›æ˜¯ä¸å¯è¾¾å¯¹è±¡ï¼ˆæ²¡æœ‰è¢«å¼•ç”¨çš„ï¼‰ï¼Œä½¿ç”¨äº†é»‘è‰²ã€ç™½è‰²æ¥åŒºåˆ†ï¼Œå› ä¸ºè¿™ä¸ªæ ‡è®°è¿‡ç¨‹æ˜¯é€šè¿‡é€’å½’æ¸è¿›å¼çš„æ‰«æï¼Œè¿‡ç¨‹ä¹Ÿéœ€è¦ç”¨åˆ°ç°è‰²ã€‚ mspan &amp;amp; mspan on scanï¼š
GCæ‰«ææ ‡è®°è¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä¸­æ²¡æœ‰ä»»ä½•æŒ‡é’ˆå­—æ®µï¼Œé‚£ä¹ˆå®Œå…¨ä¸éœ€è¦æ‰«æå®ƒï¼Œå¦‚ä½•è¯†åˆ«ä¸€ä¸ªå¯¹è±¡æœ‰æ²¡æœ‰æŒ‡é’ˆå‘¢ï¼Ÿåœ¨å†…å­˜åˆ†é…çš„æ—¶å€™ï¼Œå°±å¯ä»¥æå‰ä»‹å…¥å¤„ç†äº†ã€‚æˆ‘ä»¬çŸ¥é“Pä¸‹æœ‰mcacheï¼Œmcacheæ ¹æ®ä¸åŒå¯¹è±¡å¤§å°å»ºç«‹äº†å¾ˆå¤šä¸åŒå¤§å°çš„spanï¼Œæ¯ä¸ªå°ºå¯¸çš„spanéƒ½æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯æ™®é€šspanï¼Œä¸€ç±»æ˜¯span no scanã€‚åè€…åœ¨GCæ‰«ææ ‡è®°è¿‡ç¨‹ä¸­æ˜¯ä¸éœ€è¦å»æ‰«æçš„ï¼Œå°±æ˜¯è¯´å¦‚æœå½“å‰æ‰«æåˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œå‘ç°å…¶æ˜¯åœ¨mspan no scanä¸­åˆ†é…çš„ï¼Œåˆ™å¯ä»¥ç›´æ¥å°†å…¶æ ‡è®°ä¸ºé»‘è‰²ï¼Œç»“æŸå½“å‰è¿™ä¸ªå¯¹è±¡çš„é€’å½’æ‰«æï¼›è€Œå¦‚æœæ˜¯åˆ†é…åœ¨æ™®é€šmspanä¸­çš„ï¼Œé‚£ä¹ˆå°±åº”è¯¥å°†å…¶æ ‡è®°ä¸ºç°è‰²ï¼Œå¹¶å°†å…¶æ”¾å…¥åˆ°workpoolä¸­ï¼Œä¾›mark workerså–å‡ºå¹¶ç»§ç»­é€’å½’æ‰«æå…¶å†…éƒ¨æŒ‡é’ˆã€‚
write barriersï¼š
è¿™é‡Œçš„å†™å±éšœå¯ä¸æ˜¯å¤„ç†å™¨æä¾›çš„é”å±éšœå“¦ï¼Œå¾ˆå¤šäººä¸€å¬åå­—ä¸€æ ·ä»¥ä¸ºæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚å¤„ç†å™¨æä¾›çš„write memory barriersï¼Œæ˜¯ä¸€ç§å†…å­˜åŒæ­¥åŸè¯­ï¼Œè€Œè¿™é‡Œçš„write barriersæŒ‡çš„æ˜¯ç¼–è¯‘å™¨å®‰æ’çš„ä¸€äº›æŒ‡ä»¤ï¼Œç”¨æ¥è·Ÿè¸ªç¨‹åºå’ŒGCå¹¶å‘æ‰§è¡ŒæœŸé—´å¯¹ä¸€äº›æŒ‡é’ˆæ‰€åšçš„æ›´æ”¹ï¼Œé¿å…æ­£åœ¨è¢«å¼•ç”¨çš„å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶æ‰ã€‚
å¤§è‡´GCè¿‡ç¨‹ï¼š
è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œå°±ä¼šå¯åŠ¨ä¸€äº›mark workerï¼Œç”¨æ¥æ‰§è¡Œä¸€äº›æ ‡è®°å·¥ä½œã€‚è§¦å‘GCæ—¶ï¼Œæ¯”å¦‚æ˜¾ç¤ºåœ°æ‰§è¡Œruntime.GC()ï¼Œé¦–å…ˆä¼šé€šè¿‡æŠ¢å å¼è°ƒåº¦é€šçŸ¥å„ä¸ªGåœä¸‹æ¥ï¼ŒMå’ŒPè§£é™¤å…³ç³»ï¼ŒPè¢«æŠ¢å ï¼ŒMè¢«æ”¾åˆ°ç©ºé—²Måˆ—è¡¨ï¼ŒGæ”¾åˆ°å…¨å±€queueï¼Œæ‰“å¼€write barriersï¼Œå°±æ˜¯ä¸€ä¸ªå¼€å…³ï¼Œå¯¹æŒ‡é’ˆè¿›è¡Œæ“ä½œæ—¶èµ°åˆ°ä¸€ä¸ªè®°å½•æŒ‡é’ˆä¿®æ”¹çš„åˆ†æ”¯è®°å½•ä¸€ä¸‹ã€‚
æ¯ä¸ªPå‡†å¤‡ä¸€ä¸ªmark workerï¼Œmark workerå¼€å§‹æ‰«æGçš„æ ˆä¸Šçš„ä¸€äº›å˜é‡ï¼Œç§°ä¸ºrootså¯¹è±¡ï¼Œç„¶åé€’å½’åœ°è¿›è¡Œæ‰«æã€‚è¿™é‡Œç”¨åˆ°äº†å‰é¢çš„ä¸‰è‰²æ ‡è®°ï¼Œåˆšå¼€å§‹æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½çš„ï¼Œç„¶åè¿™äº›rootså¯¹è±¡å…¨éƒ¨æŸ“æˆç°è‰²çš„ã€‚ç„¶åé‡å¤æ‰§è¡Œä¸‹è¿°è¿‡ç¨‹ï¼š
pick 1ä¸ªç°è‰²çš„ï¼Œå°†å…¶æŸ“æˆé»‘è‰²çš„ï¼› ç„¶åå°†å…¶å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡å…¨éƒ¨æŸ“ä¸ºç°è‰²çš„ï¼› é‡å¤æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œæœ€ååªæœ‰ä¸¤ç§é¢œè‰²çš„å¯¹è±¡ï¼šé»‘è‰²çš„ï¼Œç™½è‰²çš„ã€‚ é»‘è‰²çš„å°±æ˜¯æ­£åœ¨è¢«å¼•ç”¨çš„ï¼Œç™½è‰²çš„å°±æ˜¯æœªè¢«å¼•ç”¨çš„ã€‚
GCè¿‡ç¨‹ä¸­ç¬¬ä¸€æ¬¡STWæ˜¯ä¸ºäº†æ‰“å¼€write barrierï¼Œç„¶åå°±å¼€å§‹markï¼Œè¿™æ ·æ ‡è®°å®Œä¸€éä¹‹åï¼Œå…¶å®ä¸å½»åº•ï¼Œä¼šé€ æˆæŸäº›è¢«å¼•ç”¨çš„å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶ã€‚è§£å†³åŠæ³•å°±æ˜¯å°†write barriersè®°å½•ä¸‹æ¥çš„è¢«ä¿®æ”¹çš„æŒ‡é’ˆï¼Œé‡æ–°é€’å½’æ‰«ææ ‡è®°ä¸€éï¼Œå°±OKäº†ã€‚
è¿™ä¸ªæ‰«æè¿‡ç¨‹æ˜¯å€ŸåŠ©äº†ä¸€ä¸ªworkpool+mark workersæ¥å®ç°çš„ï¼Œå®ç°ä¹Ÿç®—æ¯”è¾ƒä¼˜é›…å§ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-the-garbage-collector-mark-the-memory-72cfc12c6976</description></item><item><title>how does GC mark the memory</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-GC-mark-the-memory/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-GC-mark-the-memory/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goçš„åƒåœ¾å›æ”¶å™¨æ˜¯å¦‚ä½•æ ‡è®°æ­£åœ¨ä½¿ç”¨ä¸­çš„å†…å­˜çš„ï¼Œgoä¸­é‡‡ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆconcurrent tricolor mark and sweepï¼‰ï¼Œå…ˆç»“åˆå­—é¢å«ä¹‰è§£é‡Šå‡ ä¸ªäº‹æƒ…ã€‚
åŸºæœ¬æ¦‚å¿µï¼š
å¹¶å‘ï¼Œè¿™é‡Œçš„å¹¶å‘æŒ‡çš„æ˜¯GCé€»è¾‘å’Œæˆ‘ä»¬çš„åº”ç”¨å¤„ç†é€»è¾‘æ˜¯å¹¶å‘è¿›è¡Œçš„ï¼› ä¸‰è‰²ï¼Œä¸ºäº†åŒºåˆ†å“ªäº›å¯¹è±¡æ˜¯å¯è¾¾å¯¹è±¡ï¼ˆæ­£åœ¨è¢«å¼•ç”¨çš„ï¼‰ï¼Œå“ªäº›æ˜¯ä¸å¯è¾¾å¯¹è±¡ï¼ˆæ²¡æœ‰è¢«å¼•ç”¨çš„ï¼‰ï¼Œä½¿ç”¨äº†é»‘è‰²ã€ç™½è‰²æ¥åŒºåˆ†ï¼Œå› ä¸ºè¿™ä¸ªæ ‡è®°è¿‡ç¨‹æ˜¯é€šè¿‡é€’å½’æ¸è¿›å¼çš„æ‰«æï¼Œè¿‡ç¨‹ä¹Ÿéœ€è¦ç”¨åˆ°ç°è‰²ã€‚ mspan &amp;amp; mspan on scanï¼š
GCæ‰«ææ ‡è®°è¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä¸­æ²¡æœ‰ä»»ä½•æŒ‡é’ˆå­—æ®µï¼Œé‚£ä¹ˆå®Œå…¨ä¸éœ€è¦æ‰«æå®ƒï¼Œå¦‚ä½•è¯†åˆ«ä¸€ä¸ªå¯¹è±¡æœ‰æ²¡æœ‰æŒ‡é’ˆå‘¢ï¼Ÿåœ¨å†…å­˜åˆ†é…çš„æ—¶å€™ï¼Œå°±å¯ä»¥æå‰ä»‹å…¥å¤„ç†äº†ã€‚æˆ‘ä»¬çŸ¥é“Pä¸‹æœ‰mcacheï¼Œmcacheæ ¹æ®ä¸åŒå¯¹è±¡å¤§å°å»ºç«‹äº†å¾ˆå¤šä¸åŒå¤§å°çš„spanï¼Œæ¯ä¸ªå°ºå¯¸çš„spanéƒ½æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯æ™®é€šspanï¼Œä¸€ç±»æ˜¯span no scanã€‚åè€…åœ¨GCæ‰«ææ ‡è®°è¿‡ç¨‹ä¸­æ˜¯ä¸éœ€è¦å»æ‰«æçš„ï¼Œå°±æ˜¯è¯´å¦‚æœå½“å‰æ‰«æåˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œå‘ç°å…¶æ˜¯åœ¨mspan no scanä¸­åˆ†é…çš„ï¼Œåˆ™å¯ä»¥ç›´æ¥å°†å…¶æ ‡è®°ä¸ºé»‘è‰²ï¼Œç»“æŸå½“å‰è¿™ä¸ªå¯¹è±¡çš„é€’å½’æ‰«æï¼›è€Œå¦‚æœæ˜¯åˆ†é…åœ¨æ™®é€šmspanä¸­çš„ï¼Œé‚£ä¹ˆå°±åº”è¯¥å°†å…¶æ ‡è®°ä¸ºç°è‰²ï¼Œå¹¶å°†å…¶æ”¾å…¥åˆ°workpoolä¸­ï¼Œä¾›mark workerså–å‡ºå¹¶ç»§ç»­é€’å½’æ‰«æå…¶å†…éƒ¨æŒ‡é’ˆã€‚
write barriersï¼š
è¿™é‡Œçš„å†™å±éšœå¯ä¸æ˜¯å¤„ç†å™¨æä¾›çš„é”å±éšœå“¦ï¼Œå¾ˆå¤šäººä¸€å¬åå­—ä¸€æ ·ä»¥ä¸ºæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚å¤„ç†å™¨æä¾›çš„write memory barriersï¼Œæ˜¯ä¸€ç§å†…å­˜åŒæ­¥åŸè¯­ï¼Œè€Œè¿™é‡Œçš„write barriersæŒ‡çš„æ˜¯ç¼–è¯‘å™¨å®‰æ’çš„ä¸€äº›æŒ‡ä»¤ï¼Œç”¨æ¥è·Ÿè¸ªç¨‹åºå’ŒGCå¹¶å‘æ‰§è¡ŒæœŸé—´å¯¹ä¸€äº›æŒ‡é’ˆæ‰€åšçš„æ›´æ”¹ï¼Œé¿å…æ­£åœ¨è¢«å¼•ç”¨çš„å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶æ‰ã€‚
å¤§è‡´GCè¿‡ç¨‹ï¼š
è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œå°±ä¼šå¯åŠ¨ä¸€äº›mark workerï¼Œç”¨æ¥æ‰§è¡Œä¸€äº›æ ‡è®°å·¥ä½œã€‚è§¦å‘GCæ—¶ï¼Œæ¯”å¦‚æ˜¾ç¤ºåœ°æ‰§è¡Œruntime.GC()ï¼Œé¦–å…ˆä¼šé€šè¿‡æŠ¢å å¼è°ƒåº¦é€šçŸ¥å„ä¸ªGåœä¸‹æ¥ï¼ŒMå’ŒPè§£é™¤å…³ç³»ï¼ŒPè¢«æŠ¢å ï¼ŒMè¢«æ”¾åˆ°ç©ºé—²Måˆ—è¡¨ï¼ŒGæ”¾åˆ°å…¨å±€queueï¼Œæ‰“å¼€write barriersï¼Œå°±æ˜¯ä¸€ä¸ªå¼€å…³ï¼Œå¯¹æŒ‡é’ˆè¿›è¡Œæ“ä½œæ—¶èµ°åˆ°ä¸€ä¸ªè®°å½•æŒ‡é’ˆä¿®æ”¹çš„åˆ†æ”¯è®°å½•ä¸€ä¸‹ã€‚
æ¯ä¸ªPå‡†å¤‡ä¸€ä¸ªmark workerï¼Œmark workerå¼€å§‹æ‰«æGçš„æ ˆä¸Šçš„ä¸€äº›å˜é‡ï¼Œç§°ä¸ºrootså¯¹è±¡ï¼Œç„¶åé€’å½’åœ°è¿›è¡Œæ‰«æã€‚è¿™é‡Œç”¨åˆ°äº†å‰é¢çš„ä¸‰è‰²æ ‡è®°ï¼Œåˆšå¼€å§‹æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½çš„ï¼Œç„¶åè¿™äº›rootså¯¹è±¡å…¨éƒ¨æŸ“æˆç°è‰²çš„ã€‚ç„¶åé‡å¤æ‰§è¡Œä¸‹è¿°è¿‡ç¨‹ï¼š
pick 1ä¸ªç°è‰²çš„ï¼Œå°†å…¶æŸ“æˆé»‘è‰²çš„ï¼› ç„¶åå°†å…¶å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡å…¨éƒ¨æŸ“ä¸ºç°è‰²çš„ï¼› é‡å¤æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œæœ€ååªæœ‰ä¸¤ç§é¢œè‰²çš„å¯¹è±¡ï¼šé»‘è‰²çš„ï¼Œç™½è‰²çš„ã€‚ é»‘è‰²çš„å°±æ˜¯æ­£åœ¨è¢«å¼•ç”¨çš„ï¼Œç™½è‰²çš„å°±æ˜¯æœªè¢«å¼•ç”¨çš„ã€‚
GCè¿‡ç¨‹ä¸­ç¬¬ä¸€æ¬¡STWæ˜¯ä¸ºäº†æ‰“å¼€write barrierï¼Œç„¶åå°±å¼€å§‹markï¼Œè¿™æ ·æ ‡è®°å®Œä¸€éä¹‹åï¼Œå…¶å®ä¸å½»åº•ï¼Œä¼šé€ æˆæŸäº›è¢«å¼•ç”¨çš„å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶ã€‚è§£å†³åŠæ³•å°±æ˜¯å°†write barriersè®°å½•ä¸‹æ¥çš„è¢«ä¿®æ”¹çš„æŒ‡é’ˆï¼Œé‡æ–°é€’å½’æ‰«ææ ‡è®°ä¸€éï¼Œå°±OKäº†ã€‚
è¿™ä¸ªæ‰«æè¿‡ç¨‹æ˜¯å€ŸåŠ©äº†ä¸€ä¸ªworkpool+mark workersæ¥å®ç°çš„ï¼Œå®ç°ä¹Ÿç®—æ¯”è¾ƒä¼˜é›…å§ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-the-garbage-collector-mark-the-memory-72cfc12c6976</description></item><item><title>how does GC watch your application</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-GC-watch-your-application/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-GC-watch-your-application/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†Goåƒåœ¾å›æ”¶å™¨çš„è®¾è®¡ç›®æ ‡ï¼Œå‡å°‘STWæ—¶é—´ï¼Œä¸€ä¸ªGCå‘¨æœŸä¸è¶…è¿‡10msï¼Œä¸€ä¸ªGCå‘¨æœŸå ç”¨CPUä¸èƒ½è¶…è¿‡25%ã€‚/// è¿™äº›ç›®æ ‡æ˜¯æ¯”è¾ƒæœ‰æŒ‘æˆ˜çš„ï¼Œè¿è¡Œæ—¶åŠ å¼ºå¯¹è¿›ç¨‹å†…å­˜çš„ç›‘æ§å’Œäº†è§£å°†æœ‰åŠ©äºæ”¹å–„åƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚/// goè¿è¡Œæ—¶ç›‘æ§heapä½¿ç”¨æƒ…å†µGOGCï¼Œé»˜è®¤heapä½¿ç”¨ç¿»å€è§¦å‘GCï¼›å¦‚æœ2åˆ†é’Ÿä¹‹å†…æ²¡æœ‰è§¦å‘GCä¼šå¼ºåˆ¶æ‰§è¡Œä¸€æ¬¡ï¼›mark assistï¼Œä¸ºäº†é˜²æ­¢æŸäº›åç¨‹å†…å­˜ç”³è¯·è¿‡å¿«ï¼Œå†…å­˜ç”³è¯·æ—¶ä¹Ÿä¼šä¸ä¸‹ä¸€æ¬¡è§¦å‘GCçš„heapå¤§å°åšæ¯”è¾ƒï¼Œå¦‚æœå·²ç»è¾¾åˆ°äº†è§¦å‘æ¡ä»¶ï¼Œå°†å½“å‰åç¨‹ä»Šå¤©ç”¨äºmark assistå»æ ‡è®°å†…å­˜ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¹²å‘¢ï¼Ÿå°±æ˜¯ä¸ºäº†ä¿è¯åƒåœ¾å›æ”¶å†…å­˜é€Ÿåº¦å°½é‡æ¯”å†…å­˜åˆ†é…é€Ÿåº¦å¿«ï¼›å†å°±æ˜¯GCæ ‡è®°é˜¶æ®µä¸èƒ½ç”³è¯·è¶…è¿‡1/4çš„Pï¼Œæ¯”å¦‚ç¤ºä¾‹ä¸­æœ‰8ä¸ªPåªæœ‰ä¸¤ä¸ªPä¸‹çš„markåç¨‹ä¸ºmark dedicatedï¼ˆä¸èƒ½è¢«æŠ¢å ï¼‰ï¼Œå…¶ä»–çš„ä¸‹çš„markåç¨‹éƒ½æ˜¯GC idleï¼ˆå¯ä»¥è¢«å…¶ä»–åç¨‹æŠ¢å ï¼‰ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-the-garbage-collector-watch-your-application-dbef99be2c35</description></item><item><title>how does GC watch your application</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-GC-watch-your-application/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-GC-watch-your-application/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†Goåƒåœ¾å›æ”¶å™¨çš„è®¾è®¡ç›®æ ‡ï¼Œå‡å°‘STWæ—¶é—´ï¼Œä¸€ä¸ªGCå‘¨æœŸä¸è¶…è¿‡10msï¼Œä¸€ä¸ªGCå‘¨æœŸå ç”¨CPUä¸èƒ½è¶…è¿‡25%ã€‚/// è¿™äº›ç›®æ ‡æ˜¯æ¯”è¾ƒæœ‰æŒ‘æˆ˜çš„ï¼Œè¿è¡Œæ—¶åŠ å¼ºå¯¹è¿›ç¨‹å†…å­˜çš„ç›‘æ§å’Œäº†è§£å°†æœ‰åŠ©äºæ”¹å–„åƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚/// goè¿è¡Œæ—¶ç›‘æ§heapä½¿ç”¨æƒ…å†µGOGCï¼Œé»˜è®¤heapä½¿ç”¨ç¿»å€è§¦å‘GCï¼›å¦‚æœ2åˆ†é’Ÿä¹‹å†…æ²¡æœ‰è§¦å‘GCä¼šå¼ºåˆ¶æ‰§è¡Œä¸€æ¬¡ï¼›mark assistï¼Œä¸ºäº†é˜²æ­¢æŸäº›åç¨‹å†…å­˜ç”³è¯·è¿‡å¿«ï¼Œå†…å­˜ç”³è¯·æ—¶ä¹Ÿä¼šä¸ä¸‹ä¸€æ¬¡è§¦å‘GCçš„heapå¤§å°åšæ¯”è¾ƒï¼Œå¦‚æœå·²ç»è¾¾åˆ°äº†è§¦å‘æ¡ä»¶ï¼Œå°†å½“å‰åç¨‹ä»Šå¤©ç”¨äºmark assistå»æ ‡è®°å†…å­˜ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¹²å‘¢ï¼Ÿå°±æ˜¯ä¸ºäº†ä¿è¯åƒåœ¾å›æ”¶å†…å­˜é€Ÿåº¦å°½é‡æ¯”å†…å­˜åˆ†é…é€Ÿåº¦å¿«ï¼›å†å°±æ˜¯GCæ ‡è®°é˜¶æ®µä¸èƒ½ç”³è¯·è¶…è¿‡1/4çš„Pï¼Œæ¯”å¦‚ç¤ºä¾‹ä¸­æœ‰8ä¸ªPåªæœ‰ä¸¤ä¸ªPä¸‹çš„markåç¨‹ä¸ºmark dedicatedï¼ˆä¸èƒ½è¢«æŠ¢å ï¼‰ï¼Œå…¶ä»–çš„ä¸‹çš„markåç¨‹éƒ½æ˜¯GC idleï¼ˆå¯ä»¥è¢«å…¶ä»–åç¨‹æŠ¢å ï¼‰ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-the-garbage-collector-watch-your-application-dbef99be2c35</description></item><item><title>how does go implement closures</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/closure/how-does-go-implement-closures/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/closure/how-does-go-implement-closures/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goä¸­é—­åŒ…æ˜¯å¦‚ä½•å®ç°çš„ï¼ŒåŒ…æ‹¬é—­åŒ…ä¸­å¼•ç”¨çš„å¤–éƒ¨å˜é‡ä½•æ—¶é‡‡ç”¨å€¼æ•è·ï¼ˆreadonlyä¸”æ•°æ®é‡è¾ƒå°ï¼‰ï¼Œä½•æ—¶é‡‡ç”¨å¼•ç”¨æ•è·ï¼ˆreadwriteï¼Œoræ•°æ®é‡åå¤§ï¼‰ã€‚ç¼–è¯‘å™¨å¯¹é—­åŒ…è¿›è¡Œå¤„ç†æ—¶ï¼Œä¼šè‡ªåŠ¨å®Œæˆä¸Šè¿°åˆ¤æ–­ä¸ä»£ç çš„è½¬æ¢ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2018-05-19-golang-function-closure%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/</description></item><item><title>how does go implement closures</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-implement-closures/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-implement-closures/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goä¸­é—­åŒ…æ˜¯å¦‚ä½•å®ç°çš„ï¼ŒåŒ…æ‹¬é—­åŒ…ä¸­å¼•ç”¨çš„å¤–éƒ¨å˜é‡ä½•æ—¶é‡‡ç”¨å€¼æ•è·ï¼ˆreadonlyä¸”æ•°æ®é‡è¾ƒå°ï¼‰ï¼Œä½•æ—¶é‡‡ç”¨å¼•ç”¨æ•è·ï¼ˆreadwriteï¼Œoræ•°æ®é‡åå¤§ï¼‰ã€‚ç¼–è¯‘å™¨å¯¹é—­åŒ…è¿›è¡Œå¤„ç†æ—¶ï¼Œä¼šè‡ªåŠ¨å®Œæˆä¸Šè¿°åˆ¤æ–­ä¸ä»£ç çš„è½¬æ¢ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2018-05-19-golang-function-closure%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/</description></item><item><title>how does go recycle goroutines</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-does-go-recycle-goroutines/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-does-go-recycle-goroutines/</guid><description>Let&amp;rsquo;s Summarize # go fn()åˆ›å»ºä¸€ä¸ªgoroutineå»æ‰§è¡Œå‡½æ•°fnï¼Œè¿™é‡Œçš„åˆ›å»ºä¸€ä¸ªgoroutineå…¶å®é‡è¦çš„æ˜¯åˆ†é…ä¸€ä¸ªæ ˆç©ºé—´ä»¥åŠä¸€ä¸ªgoroutineæè¿°ä¿¡æ¯gï¼Œç»´æŠ¤ä¸€ä¸‹å‡½æ•°fnçš„æŒ‡ä»¤åœ°å€ç­‰ç­‰ä¿¡æ¯ã€‚
æˆ‘ä»¬è¯´åˆ›å»ºä¸€ä¸ªgï¼Œå…¶å®æ¶‰åŠäº†æ ˆå†…å­˜ç©ºé—´çš„åˆ†é…åŠ¨ä½œï¼Œæ¶‰åŠåˆ°å¯¹è±¡åˆ†é…çš„ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“é€šè¿‡å¯¹è±¡æ± å¯ä»¥ä¼˜åŒ–å†…å­˜åˆ†é…é—®é¢˜ï¼Œgoroutineè¿™é‡Œä¹Ÿä¸ä¾‹å¤–ã€‚
å½“ä¸€ä¸ªgoroutineæ‰§è¡Œå®Œæˆå‡½æ•°fnæ—¶ï¼Œå¹¶ä¸æ„å‘³ç€è¿™ä¸ªgoroutineå°±è¢«å½»åº•é”€æ¯äº†ï¼Œå®ƒä¼šè¢«ä¿å­˜åˆ°Pçš„gFreeå­—æ®µä¸­ï¼Œåç»­å¦‚æœéœ€è¦åˆ›å»ºgoroutineæ—¶å°±å¯ä»¥å¤ç”¨ï¼Œå½“ç„¶äº†gFreeä¸­å¦‚æœgæ¯”è¾ƒå¤šï¼Œä¹Ÿä¼šè¢«è¿ç§»åˆ°è°ƒåº¦å™¨çš„gç©ºé—²é“¾è¡¨ä¸­ï¼Œæ–¹ä¾¿å…¶ä»–På¤ç”¨ã€‚
å› ä¸ºgæ˜¯æœ‰æ ˆç©ºé—´çš„ï¼Œè€Œä¸”æ ˆç©ºé—´ä¼šå¢å¤§ï¼Œå½“gæ‰§è¡Œfnå®Œæˆæ—¶ï¼Œå¯èƒ½æ ˆç©ºé—´ä¸å°äº†ï¼Œæ¯”å¦‚è¶…è¿‡äº†2KBï¼Œè¿™ç§æ—¶å€™å†ä¿ç•™è¿™ä¸ªæ ˆç©ºé—´æ± åŒ–å°±å¤ªæµªè´¹å†…å­˜äº†ï¼Œæ‰€ä»¥è¿™ç§æ ˆç©ºé—´å¤§çš„å°±ä¼šé‡Šæ”¾å…¶æ ˆç©ºé—´ï¼Œæ‰€ä»¥åœ¨è°ƒåº¦å™¨çš„gç©ºé—²é“¾è¡¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š
å¸¦æ ˆç©ºé—´çš„gç©ºé—²é“¾è¡¨ï¼› æ ˆç©ºé—´è¢«é”€æ¯çš„gç©ºé—²é“¾è¡¨ï¼› è¿™é‡Œçš„gè¢«é‡å¤åˆ©ç”¨ï¼Œåªæ˜¯ä¸ºäº†æé«˜gåˆ›å»ºæ•ˆç‡ï¼Œå’Œæˆ‘ä»¬é€šè¿‡ä¸€äº›workerpoolæ¥é™åˆ¶goroutinesæ•°é‡çš„åˆè¡·æ˜¯ä¸é‡å¤çš„ï¼Œworkerpoolä¸€èˆ¬å¹¶ä¸æ˜¯ä¸ºäº†æé«˜gåˆ›å»ºæ•ˆç‡ï¼Œè€Œæ˜¯ä¸ºäº†é™åˆ¶gæ•°é‡ï¼Œé¿å…åƒçˆ†å†…å­˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-go-recycle-goroutines-f047a79ab352</description></item><item><title>how does go recycle goroutines</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-recycle-goroutines/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-recycle-goroutines/</guid><description>Let&amp;rsquo;s Summarize # go fn()åˆ›å»ºä¸€ä¸ªgoroutineå»æ‰§è¡Œå‡½æ•°fnï¼Œè¿™é‡Œçš„åˆ›å»ºä¸€ä¸ªgoroutineå…¶å®é‡è¦çš„æ˜¯åˆ†é…ä¸€ä¸ªæ ˆç©ºé—´ä»¥åŠä¸€ä¸ªgoroutineæè¿°ä¿¡æ¯gï¼Œç»´æŠ¤ä¸€ä¸‹å‡½æ•°fnçš„æŒ‡ä»¤åœ°å€ç­‰ç­‰ä¿¡æ¯ã€‚
æˆ‘ä»¬è¯´åˆ›å»ºä¸€ä¸ªgï¼Œå…¶å®æ¶‰åŠäº†æ ˆå†…å­˜ç©ºé—´çš„åˆ†é…åŠ¨ä½œï¼Œæ¶‰åŠåˆ°å¯¹è±¡åˆ†é…çš„ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“é€šè¿‡å¯¹è±¡æ± å¯ä»¥ä¼˜åŒ–å†…å­˜åˆ†é…é—®é¢˜ï¼Œgoroutineè¿™é‡Œä¹Ÿä¸ä¾‹å¤–ã€‚
å½“ä¸€ä¸ªgoroutineæ‰§è¡Œå®Œæˆå‡½æ•°fnæ—¶ï¼Œå¹¶ä¸æ„å‘³ç€è¿™ä¸ªgoroutineå°±è¢«å½»åº•é”€æ¯äº†ï¼Œå®ƒä¼šè¢«ä¿å­˜åˆ°Pçš„gFreeå­—æ®µä¸­ï¼Œåç»­å¦‚æœéœ€è¦åˆ›å»ºgoroutineæ—¶å°±å¯ä»¥å¤ç”¨ï¼Œå½“ç„¶äº†gFreeä¸­å¦‚æœgæ¯”è¾ƒå¤šï¼Œä¹Ÿä¼šè¢«è¿ç§»åˆ°è°ƒåº¦å™¨çš„gç©ºé—²é“¾è¡¨ä¸­ï¼Œæ–¹ä¾¿å…¶ä»–På¤ç”¨ã€‚
å› ä¸ºgæ˜¯æœ‰æ ˆç©ºé—´çš„ï¼Œè€Œä¸”æ ˆç©ºé—´ä¼šå¢å¤§ï¼Œå½“gæ‰§è¡Œfnå®Œæˆæ—¶ï¼Œå¯èƒ½æ ˆç©ºé—´ä¸å°äº†ï¼Œæ¯”å¦‚è¶…è¿‡äº†2KBï¼Œè¿™ç§æ—¶å€™å†ä¿ç•™è¿™ä¸ªæ ˆç©ºé—´æ± åŒ–å°±å¤ªæµªè´¹å†…å­˜äº†ï¼Œæ‰€ä»¥è¿™ç§æ ˆç©ºé—´å¤§çš„å°±ä¼šé‡Šæ”¾å…¶æ ˆç©ºé—´ï¼Œæ‰€ä»¥åœ¨è°ƒåº¦å™¨çš„gç©ºé—²é“¾è¡¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š
å¸¦æ ˆç©ºé—´çš„gç©ºé—²é“¾è¡¨ï¼› æ ˆç©ºé—´è¢«é”€æ¯çš„gç©ºé—²é“¾è¡¨ï¼› è¿™é‡Œçš„gè¢«é‡å¤åˆ©ç”¨ï¼Œåªæ˜¯ä¸ºäº†æé«˜gåˆ›å»ºæ•ˆç‡ï¼Œå’Œæˆ‘ä»¬é€šè¿‡ä¸€äº›workerpoolæ¥é™åˆ¶goroutinesæ•°é‡çš„åˆè¡·æ˜¯ä¸é‡å¤çš„ï¼Œworkerpoolä¸€èˆ¬å¹¶ä¸æ˜¯ä¸ºäº†æé«˜gåˆ›å»ºæ•ˆç‡ï¼Œè€Œæ˜¯ä¸ºäº†é™åˆ¶gæ•°é‡ï¼Œé¿å…åƒçˆ†å†…å­˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-does-go-recycle-goroutines-f047a79ab352</description></item><item><title>how does go runtime handles syscall</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/syscall/how-does-go-runtime-handles-syscall/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/syscall/how-does-go-runtime-handles-syscall/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†linuxç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§åˆ†ç±»æ–¹å¼ï¼šé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨å’Œéé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨ã€‚
çº¿ç¨‹æ‰§è¡Œé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¸€å®šä¼šé™·å…¥ä¸å¯ä¸­æ–­ç­‰å¾…çŠ¶æ€ï¼Œé™¤äº†å†…æ ¸æœ¬èº«ï¼Œæ²¡æœ‰ä»»ä½•å¤–éƒ¨äº‹ä»¶å¯ä»¥å°†çº¿ç¨‹å”¤é†’ã€‚go runtimeéœ€è¦æ„ŸçŸ¥å¯¹é˜»å¡å‹ç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨ï¼Œé¿å…çº¿ç¨‹è¢«é˜»å¡å¯¼è‡´æ— çº¿ç¨‹è°ƒåº¦goroutinesã€‚
goå¯¹ç³»ç»Ÿè°ƒç”¨è¿›è¡Œäº†åŒ…è£…ï¼Œé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨å¯¹åº”çš„æ˜¯Syscallï¼Œéé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨æ˜¯RawSyscallï¼Œåè€…ä¸ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œæ²¡ä»€ä¹ˆå¥½è®¨è®ºçš„ï¼Œæˆ‘ä»¬åªè®¨è®ºSyscallã€‚
Syscallå†…éƒ¨ä¼šå‘è¿è¡Œæ—¶æŠ¥å‘Šï¼Œå½“å‰çº¿ç¨‹å³å°†è¿›å…¥ä¸€ä¸ªé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶åè¿è¡Œæ—¶ä¼šæ‰§è¡Œä¸€äº›å¯¹åº”çš„å¤„ç†ï¼Œå¦‚å°†Må’ŒPåˆ†ç¦»ï¼ŒæŒ‚èµ·Gï¼Œå¯èƒ½è¿˜ä¼šåˆ›å»ºæ–°çš„Mæ¥è·å¾—Pæ¥æ‰§è¡ŒGã€‚è¿™é‡Œæ¶‰åŠåˆ°è°ƒåº¦äº²å’Œæ€§çš„ä¸€äº›ç»†èŠ‚ï¼Œè¿™é‡Œçš„æ€»ç»“å°±ä¸è¿‡å¤šå±•å¼€äº†ã€‚
æœ¬æ–‡ä¸­çš„å™è¿°é£æ ¼å…³äºæ•…äº‹åŒ–ï¼Œå…³äºä¸ºä»€ä¹ˆè¦å°è¯•è®©Gåœ¨åŸæ¥çš„Mã€Måœ¨åŸæ¥çš„Pä¸Šæ‰§è¡Œï¼Œæ³¨æ„ä¸€ä¸‹è°ƒåº¦äº²å’Œæ€§ï¼Œå°±æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2021-06-06-how-go-handles-syscall/</description></item><item><title>how does go runtime handles syscall</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-runtime-handles-syscall/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-runtime-handles-syscall/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†linuxç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§åˆ†ç±»æ–¹å¼ï¼šé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨å’Œéé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨ã€‚
çº¿ç¨‹æ‰§è¡Œé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¸€å®šä¼šé™·å…¥ä¸å¯ä¸­æ–­ç­‰å¾…çŠ¶æ€ï¼Œé™¤äº†å†…æ ¸æœ¬èº«ï¼Œæ²¡æœ‰ä»»ä½•å¤–éƒ¨äº‹ä»¶å¯ä»¥å°†çº¿ç¨‹å”¤é†’ã€‚go runtimeéœ€è¦æ„ŸçŸ¥å¯¹é˜»å¡å‹ç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨ï¼Œé¿å…çº¿ç¨‹è¢«é˜»å¡å¯¼è‡´æ— çº¿ç¨‹è°ƒåº¦goroutinesã€‚
goå¯¹ç³»ç»Ÿè°ƒç”¨è¿›è¡Œäº†åŒ…è£…ï¼Œé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨å¯¹åº”çš„æ˜¯Syscallï¼Œéé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨æ˜¯RawSyscallï¼Œåè€…ä¸ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œæ²¡ä»€ä¹ˆå¥½è®¨è®ºçš„ï¼Œæˆ‘ä»¬åªè®¨è®ºSyscallã€‚
Syscallå†…éƒ¨ä¼šå‘è¿è¡Œæ—¶æŠ¥å‘Šï¼Œå½“å‰çº¿ç¨‹å³å°†è¿›å…¥ä¸€ä¸ªé˜»å¡å‹ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶åè¿è¡Œæ—¶ä¼šæ‰§è¡Œä¸€äº›å¯¹åº”çš„å¤„ç†ï¼Œå¦‚å°†Må’ŒPåˆ†ç¦»ï¼ŒæŒ‚èµ·Gï¼Œå¯èƒ½è¿˜ä¼šåˆ›å»ºæ–°çš„Mæ¥è·å¾—Pæ¥æ‰§è¡ŒGã€‚è¿™é‡Œæ¶‰åŠåˆ°è°ƒåº¦äº²å’Œæ€§çš„ä¸€äº›ç»†èŠ‚ï¼Œè¿™é‡Œçš„æ€»ç»“å°±ä¸è¿‡å¤šå±•å¼€äº†ã€‚
æœ¬æ–‡ä¸­çš„å™è¿°é£æ ¼å…³äºæ•…äº‹åŒ–ï¼Œå…³äºä¸ºä»€ä¹ˆè¦å°è¯•è®©Gåœ¨åŸæ¥çš„Mã€Måœ¨åŸæ¥çš„Pä¸Šæ‰§è¡Œï¼Œæ³¨æ„ä¸€ä¸‹è°ƒåº¦äº²å’Œæ€§ï¼Œå°±æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2021-06-06-how-go-handles-syscall/</description></item><item><title>how does go stop the world</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-go-stop-the-world/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-go-stop-the-world/</guid><description>Let&amp;rsquo;s Summarize # STWæŒ‡çš„æ˜¯åœæ­¢æ­£åœ¨è¿è¡Œä¸­çš„goroutinesï¼Œä¸€ä¸ªGC cycleä¸­åŒ…å«äº†ä¸¤æ¬¡STWï¼Œç¬¬ä¸€æ¬¡STWæ˜¯ä¸ºäº†æ‰“å¼€write barriersï¼Œç¬¬äºŒæ¬¡STWæ˜¯ä¸ºäº†å°†write barriersè®°å½•ä¸‹æ¥çš„æŒ‡é’ˆä¿®æ”¹é‡æ–°è¿›è¡Œæ‰«ææ ‡è®°ï¼Œé¿å…æ­£è¢«å¼•ç”¨çš„å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶æ‰ã€‚
è¿™é‡Œå…¶å®åªæ˜¯ç®€å•ä»‹ç»äº†ä¸‹STWå‘ç”Ÿåçš„ä¸€äº›æ‰§è¡Œé€»è¾‘ï¼Œæ¯”å¦‚Pè¢«æŠ¢å ï¼ŒPã€Mè§£é™¤å…³è”ï¼ŒMè¢«æ”¾å…¥ç©ºé—²Mé˜Ÿåˆ—ï¼ŒGè¢«æ”¾åˆ°global queueä¸­â€¦â€¦
è‡³äºSTWæ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠä¸Šè¿°è¿‡ç¨‹ä¸­çš„å…·ä½“å®ç°ï¼Œéƒ½æ²¡æœ‰è¯¦ç»†å±•å¼€ï¼Œè¿™é‡Œè¿˜æ˜¯è¦ç»“åˆæºç æ¥è¿›ä¸€æ­¥å­¦ä¹ ä¸€ä¸‹ã€‚
Source Analysis # see runtime/mgc.go
GOGC=off: means no gc
References # https://medium.com/a-journey-with-go/go-how-does-go-stop-the-world-1ffab8bc8846</description></item><item><title>how does go stop the world</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-stop-the-world/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-does-go-stop-the-world/</guid><description>Let&amp;rsquo;s Summarize # STWæŒ‡çš„æ˜¯åœæ­¢æ­£åœ¨è¿è¡Œä¸­çš„goroutinesï¼Œä¸€ä¸ªGC cycleä¸­åŒ…å«äº†ä¸¤æ¬¡STWï¼Œç¬¬ä¸€æ¬¡STWæ˜¯ä¸ºäº†æ‰“å¼€write barriersï¼Œç¬¬äºŒæ¬¡STWæ˜¯ä¸ºäº†å°†write barriersè®°å½•ä¸‹æ¥çš„æŒ‡é’ˆä¿®æ”¹é‡æ–°è¿›è¡Œæ‰«ææ ‡è®°ï¼Œé¿å…æ­£è¢«å¼•ç”¨çš„å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶æ‰ã€‚
è¿™é‡Œå…¶å®åªæ˜¯ç®€å•ä»‹ç»äº†ä¸‹STWå‘ç”Ÿåçš„ä¸€äº›æ‰§è¡Œé€»è¾‘ï¼Œæ¯”å¦‚Pè¢«æŠ¢å ï¼ŒPã€Mè§£é™¤å…³è”ï¼ŒMè¢«æ”¾å…¥ç©ºé—²Mé˜Ÿåˆ—ï¼ŒGè¢«æ”¾åˆ°global queueä¸­â€¦â€¦
è‡³äºSTWæ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠä¸Šè¿°è¿‡ç¨‹ä¸­çš„å…·ä½“å®ç°ï¼Œéƒ½æ²¡æœ‰è¯¦ç»†å±•å¼€ï¼Œè¿™é‡Œè¿˜æ˜¯è¦ç»“åˆæºç æ¥è¿›ä¸€æ­¥å­¦ä¹ ä¸€ä¸‹ã€‚
Source Analysis # see runtime/mgc.go
GOGC=off: means no gc
References # https://medium.com/a-journey-with-go/go-how-does-go-stop-the-world-1ffab8bc8846</description></item><item><title>how goroutine stack size evolve</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-goroutine-stack-size-evolve/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-goroutine-stack-size-evolve/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goroutineçš„æ ˆç©ºé—´çš„æ¼”è¿›ï¼Œä»segmented stackåˆ°continous stackï¼Œä»¥åŠæ ˆç©ºé—´ä»4Kâ†’8Kâ†’2Kçš„å˜åŒ–ï¼š
æ ˆç®¡ç†æœ€åˆæ˜¯åˆ†æ®µæ ˆï¼Œå­˜åœ¨hot splité—®é¢˜ï¼Œå³å¦‚æœåœ¨ä¸€ä¸ªå¾ªç¯å†…å­˜åœ¨å‡½æ•°è°ƒç”¨åˆ‡éœ€è¦æ ˆå¢é•¿ï¼Œé‚£ä¹ˆä¼šé¢‘ç¹å‘ç”Ÿalloc/freeçš„æƒ…å†µï¼Œå½±å“æ€§èƒ½ï¼Œä¸ºäº†å‡è½»hot splitï¼Œæ‰€ä»¥ä»4Kæ”¹ä¸º8Kï¼› åœ¨å®ç°äº†è¿ç»­æ ˆä¹‹åï¼ŒnewStkSize=oldStkSize*2ï¼Œæ ˆç©ºé—´å¤Ÿç”¨ï¼Œå¯ä»¥è§£å†³hot splité—®é¢˜ï¼Œåˆä»8Kæ”¹ä¸ºäº†2Kï¼› æœ¬æ–‡æä¾›äº†ä¸€ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨demoï¼ˆé€šè¿‡å±€éƒ¨æ•°ç»„å¤§å°æ§åˆ¶æ ˆç©ºé—´åˆ†é…ï¼‰ã€ç¦ç”¨å†…è”ã€æ‰“å¼€runtime.stackDebugæ¥è§‚æµ‹æ ˆç©ºé—´å˜åŒ–ã€‚
Source Analysis # copystackï¼šæ‹·è´æ ˆå®ç°é€»è¾‘ https://sourcegraph.com/github.com/golang/go/-/blob/src/runtime/stack.go#L848
adjustpointerï¼šåˆ›å»ºæ–°æ ˆåï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹åŸæ¥goroutineä¸­çš„å¼•ç”¨æŒ‡é’ˆå€¼ï¼ˆoldptr+delta) https://sourcegraph.com/github.com/golang/go/-/blob/src/runtime/stack.go#L529
References # https://medium.com/a-journey-with-go/go-how-does-the-goroutine-stack-size-evolve-447fc02085e5</description></item><item><title>how goroutine stack size evolve</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-goroutine-stack-size-evolve/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-goroutine-stack-size-evolve/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goroutineçš„æ ˆç©ºé—´çš„æ¼”è¿›ï¼Œä»segmented stackåˆ°continous stackï¼Œä»¥åŠæ ˆç©ºé—´ä»4Kâ†’8Kâ†’2Kçš„å˜åŒ–ï¼š
æ ˆç®¡ç†æœ€åˆæ˜¯åˆ†æ®µæ ˆï¼Œå­˜åœ¨hot splité—®é¢˜ï¼Œå³å¦‚æœåœ¨ä¸€ä¸ªå¾ªç¯å†…å­˜åœ¨å‡½æ•°è°ƒç”¨åˆ‡éœ€è¦æ ˆå¢é•¿ï¼Œé‚£ä¹ˆä¼šé¢‘ç¹å‘ç”Ÿalloc/freeçš„æƒ…å†µï¼Œå½±å“æ€§èƒ½ï¼Œä¸ºäº†å‡è½»hot splitï¼Œæ‰€ä»¥ä»4Kæ”¹ä¸º8Kï¼› åœ¨å®ç°äº†è¿ç»­æ ˆä¹‹åï¼ŒnewStkSize=oldStkSize*2ï¼Œæ ˆç©ºé—´å¤Ÿç”¨ï¼Œå¯ä»¥è§£å†³hot splité—®é¢˜ï¼Œåˆä»8Kæ”¹ä¸ºäº†2Kï¼› æœ¬æ–‡æä¾›äº†ä¸€ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨demoï¼ˆé€šè¿‡å±€éƒ¨æ•°ç»„å¤§å°æ§åˆ¶æ ˆç©ºé—´åˆ†é…ï¼‰ã€ç¦ç”¨å†…è”ã€æ‰“å¼€runtime.stackDebugæ¥è§‚æµ‹æ ˆç©ºé—´å˜åŒ–ã€‚
Source Analysis # copystackï¼šæ‹·è´æ ˆå®ç°é€»è¾‘ https://sourcegraph.com/github.com/golang/go/-/blob/src/runtime/stack.go#L848
adjustpointerï¼šåˆ›å»ºæ–°æ ˆåï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹åŸæ¥goroutineä¸­çš„å¼•ç”¨æŒ‡é’ˆå€¼ï¼ˆoldptr+delta) https://sourcegraph.com/github.com/golang/go/-/blob/src/runtime/stack.go#L529
References # https://medium.com/a-journey-with-go/go-how-does-the-goroutine-stack-size-evolve-447fc02085e5</description></item><item><title>how to reduce lock contention with the atomic package</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/how-to-reduce-lock-contention-with-the-atomic-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/how-to-reduce-lock-contention-with-the-atomic-package/</guid><description>Let&amp;rsquo;s Summarize # atomicã€mutexã€rwmutexï¼Œå†™å¤šè¯»å°‘ç›´æ¥ç”¨mutexï¼Œè¯»å¤šå†™å°‘ç”¨rwmutexï¼Œå¦‚æœè¦è€ƒè™‘æå‡æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘atomicã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-to-reduce-lock-contention-with-the-atomic-package-ba3b2664b549</description></item><item><title>how to reduce lock contention with the atomic package</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-to-reduce-lock-contention-with-the-atomic-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-to-reduce-lock-contention-with-the-atomic-package/</guid><description>Let&amp;rsquo;s Summarize # atomicã€mutexã€rwmutexï¼Œå†™å¤šè¯»å°‘ç›´æ¥ç”¨mutexï¼Œè¯»å¤šå†™å°‘ç”¨rwmutexï¼Œå¦‚æœè¦è€ƒè™‘æå‡æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘atomicã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-to-reduce-lock-contention-with-the-atomic-package-ba3b2664b549</description></item><item><title>how to take advantage of symbols tables</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-to-take-advantage-of-symbols-tables/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-to-take-advantage-of-symbols-tables/</guid><description>Let&amp;rsquo;s Summarize # goåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šæ£€æŸ¥ä½¿ç”¨çš„æ ‡è¯†ç¬¦æ˜¯å¦å·²ç»å®šä¹‰è¿‡ï¼Œç¼–è¯‘å™¨é€šè¿‡ç¬¦å·è¡¨æ¥è®°å½•å·²ç»å®šä¹‰çš„æ ‡è¯†ç¬¦ã€‚ç¨‹åºæ„å»ºå®Œæˆä¹‹åï¼Œå…¶å®å°±ä¸å†éœ€è¦ç¬¦å·è¡¨äº†ï¼Œä¸ºäº†ç¨‹åºå°ºå¯¸å¯ä»¥è€ƒè™‘ä»binaryä¸­å‰¥ç¦»ç¬¦å·è¡¨ï¼š
å¯ä»¥é€šè¿‡å…¶ä»–äºŒè¿›åˆ¶å·¥å…·æ¥ä»binaryä¸­å‰”é™¤ç¬¦å·è¡¨ï¼› ä¹Ÿå¯ä»¥è€ƒè™‘åœ¨ç¼–è¯‘æ—¶æŒ‡å®šé€‰é¡¹-ldflags=&amp;quot;-s&amp;quot;åœ¨ç¼–è¯‘é“¾æ¥å®Œæˆåå‰”é™¤ç¬¦å·è¡¨ï¼› æˆ‘ä»¬å¯ä»¥é€šè¿‡nmæˆ–è€…go tool nmæ¥æŸ¥çœ‹binaryä¸­çš„ç¬¦å·è¡¨ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡-ldflags=&amp;quot;-X $pkg.$var=$value&amp;quot;çš„æ–¹å¼æ¥è®¾ç½®ä¸€äº›åŒ…çº§åˆ«çš„å˜é‡å€¼ã€‚
æ ¹æ®ç¨‹åºè§„æ¨¡ä¸åŒï¼Œç¬¦å·è¡¨å¤§å°å¯èƒ½ä¼šå¯¼è‡´binaryå°ºå¯¸å¢åŠ ï¼Œä¸ºäº†åŠ é€Ÿç¨‹åºåŠ è½½å¯åŠ¨å¯ä»¥è€ƒè™‘åˆ æ‰ç¬¦å·è¡¨ã€‚å¦‚æœè€ƒè™‘åˆ°è°ƒè¯•æ–¹ä¾¿ï¼Œåˆ™å¯ä»¥ä¿ç•™ç¬¦å·è¡¨ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-to-take-advantage-of-the-symbols-table-360dd52269e5</description></item><item><title>how to take advantage of symbols tables</title><link>https://hitzhangjie.pro/go-internals-v2/posts/how-to-take-advantage-of-symbols-tables/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/how-to-take-advantage-of-symbols-tables/</guid><description>Let&amp;rsquo;s Summarize # goåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šæ£€æŸ¥ä½¿ç”¨çš„æ ‡è¯†ç¬¦æ˜¯å¦å·²ç»å®šä¹‰è¿‡ï¼Œç¼–è¯‘å™¨é€šè¿‡ç¬¦å·è¡¨æ¥è®°å½•å·²ç»å®šä¹‰çš„æ ‡è¯†ç¬¦ã€‚ç¨‹åºæ„å»ºå®Œæˆä¹‹åï¼Œå…¶å®å°±ä¸å†éœ€è¦ç¬¦å·è¡¨äº†ï¼Œä¸ºäº†ç¨‹åºå°ºå¯¸å¯ä»¥è€ƒè™‘ä»binaryä¸­å‰¥ç¦»ç¬¦å·è¡¨ï¼š
å¯ä»¥é€šè¿‡å…¶ä»–äºŒè¿›åˆ¶å·¥å…·æ¥ä»binaryä¸­å‰”é™¤ç¬¦å·è¡¨ï¼› ä¹Ÿå¯ä»¥è€ƒè™‘åœ¨ç¼–è¯‘æ—¶æŒ‡å®šé€‰é¡¹-ldflags=&amp;quot;-s&amp;quot;åœ¨ç¼–è¯‘é“¾æ¥å®Œæˆåå‰”é™¤ç¬¦å·è¡¨ï¼› æˆ‘ä»¬å¯ä»¥é€šè¿‡nmæˆ–è€…go tool nmæ¥æŸ¥çœ‹binaryä¸­çš„ç¬¦å·è¡¨ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡-ldflags=&amp;quot;-X $pkg.$var=$value&amp;quot;çš„æ–¹å¼æ¥è®¾ç½®ä¸€äº›åŒ…çº§åˆ«çš„å˜é‡å€¼ã€‚
æ ¹æ®ç¨‹åºè§„æ¨¡ä¸åŒï¼Œç¬¦å·è¡¨å¤§å°å¯èƒ½ä¼šå¯¼è‡´binaryå°ºå¯¸å¢åŠ ï¼Œä¸ºäº†åŠ é€Ÿç¨‹åºåŠ è½½å¯åŠ¨å¯ä»¥è€ƒè™‘åˆ æ‰ç¬¦å·è¡¨ã€‚å¦‚æœè€ƒè™‘åˆ°è°ƒè¯•æ–¹ä¾¿ï¼Œåˆ™å¯ä»¥ä¿ç•™ç¬¦å·è¡¨ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-how-to-take-advantage-of-the-symbols-table-360dd52269e5</description></item><item><title>improve the usage of your goroutines with GODEBUG</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/improve-the-usage-of-your-goroutines-with-GODEBUG/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/improve-the-usage-of-your-goroutines-with-GODEBUG/</guid><description>Let&amp;rsquo;s Summarize # è¿™ç¯‡æ–‡ç« ä»‹ç»äº†é€šè¿‡goroutineè°ƒåº¦latencyæ¥åˆ†æç¨‹åºä¸­å¢åŠ æ›´å¤šçš„goroutinesæ•°é‡æ˜¯å¦æœ‰å¿…è¦ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­çš„goroutineå¤§éƒ¨åˆ†ä¼šå› ä¸ºè¯·æ±‚æœåŠ¡ç«¯æ•°æ®è€Œé˜»å¡ï¼Œè¿™ä¸ªé˜»å¡æ—¶é—´æ¯”è¾ƒé•¿ï¼Œä¸¥é‡å½±å“è®¡ç®—ï¼Œè¿™é‡Œå¢åŠ å¾ˆå¤šçš„goroutineså¹¶ä¸èƒ½å……åˆ†åœ°åˆ©ç”¨èµ·è®¡ç®—èµ„æºï¼Œä¸»è¦æ˜¯è¿™é‡Œå¤§éƒ¨åˆ†éƒ½ä¼šé˜»å¡ï¼Œå¹¶ä¸æ˜¯ä¼šåˆ‡æ¥åˆ‡å»åœ°ï¼Œæ— åŠ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚
1 GODEBUG=schedtrace=1 go test 2 runtime/trace, trace.Start(), defer trace.Stop()
è¾“å‡ºä¿¡æ¯çš„è§£é‡Šï¼š see https://github.com/golang/go/wiki/Performance#scheduler-traceï¼š
ä¸‹é¢æ˜¯ä¸ªä¾‹å­ï¼š
SCHED 1004ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=4 runqueue=8 [0 1 0 3] SCHED 2005ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=5 runqueue=6 [1 5 4 0] SCHED 3008ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=4 runqueue=10 [2 2 2 1] The first number (&amp;ldquo;1004ms&amp;rdquo;) is time since program start. Gomaxprocs is the current value of GOMAXPROCS. Idleprocs is the number of idling processors (the rest are executing Go code).</description></item><item><title>improve the usage of your goroutines with GODEBUG</title><link>https://hitzhangjie.pro/go-internals-v2/posts/improve-the-usage-of-your-goroutines-with-GODEBUG/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/improve-the-usage-of-your-goroutines-with-GODEBUG/</guid><description>Let&amp;rsquo;s Summarize # è¿™ç¯‡æ–‡ç« ä»‹ç»äº†é€šè¿‡goroutineè°ƒåº¦latencyæ¥åˆ†æç¨‹åºä¸­å¢åŠ æ›´å¤šçš„goroutinesæ•°é‡æ˜¯å¦æœ‰å¿…è¦ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­çš„goroutineå¤§éƒ¨åˆ†ä¼šå› ä¸ºè¯·æ±‚æœåŠ¡ç«¯æ•°æ®è€Œé˜»å¡ï¼Œè¿™ä¸ªé˜»å¡æ—¶é—´æ¯”è¾ƒé•¿ï¼Œä¸¥é‡å½±å“è®¡ç®—ï¼Œè¿™é‡Œå¢åŠ å¾ˆå¤šçš„goroutineså¹¶ä¸èƒ½å……åˆ†åœ°åˆ©ç”¨èµ·è®¡ç®—èµ„æºï¼Œä¸»è¦æ˜¯è¿™é‡Œå¤§éƒ¨åˆ†éƒ½ä¼šé˜»å¡ï¼Œå¹¶ä¸æ˜¯ä¼šåˆ‡æ¥åˆ‡å»åœ°ï¼Œæ— åŠ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚
1 GODEBUG=schedtrace=1 go test 2 runtime/trace, trace.Start(), defer trace.Stop()
è¾“å‡ºä¿¡æ¯çš„è§£é‡Šï¼š see https://github.com/golang/go/wiki/Performance#scheduler-traceï¼š
ä¸‹é¢æ˜¯ä¸ªä¾‹å­ï¼š
SCHED 1004ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=4 runqueue=8 [0 1 0 3] SCHED 2005ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=5 runqueue=6 [1 5 4 0] SCHED 3008ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=4 runqueue=10 [2 2 2 1] The first number (&amp;ldquo;1004ms&amp;rdquo;) is time since program start. Gomaxprocs is the current value of GOMAXPROCS. Idleprocs is the number of idling processors (the rest are executing Go code).</description></item><item><title>init functions</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/init/init-functions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/init/init-functions/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºä¸­func init()å‡½æ•°çš„è°ƒç”¨æ—¶æœºä»¥åŠå¦‚ä½•é¿å…é‡å¤è°ƒç”¨çš„ã€‚
package aä¾èµ–package bï¼Œé‚£ä¹ˆå…ˆæ‰§è¡Œbä¸­çš„å…¨å±€å˜é‡åˆå§‹åŒ–ã€func initå‡½æ•°ï¼Œå†æ‰§è¡Œaä¸­çš„å…¨å±€å˜é‡åˆå§‹åŒ–ã€func initå‡½æ•°ï¼Œè¿™äº›éƒ½æ˜¯åœ¨æ‰§è¡Œmain.mainä¹‹å‰å®Œæˆçš„ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-init-functions-319dbb12831c</description></item><item><title>init functions</title><link>https://hitzhangjie.pro/go-internals-v2/posts/init-functions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/init-functions/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºä¸­func init()å‡½æ•°çš„è°ƒç”¨æ—¶æœºä»¥åŠå¦‚ä½•é¿å…é‡å¤è°ƒç”¨çš„ã€‚
package aä¾èµ–package bï¼Œé‚£ä¹ˆå…ˆæ‰§è¡Œbä¸­çš„å…¨å±€å˜é‡åˆå§‹åŒ–ã€func initå‡½æ•°ï¼Œå†æ‰§è¡Œaä¸­çš„å…¨å±€å˜é‡åˆå§‹åŒ–ã€func initå‡½æ•°ï¼Œè¿™äº›éƒ½æ˜¯åœ¨æ‰§è¡Œmain.mainä¹‹å‰å®Œæˆçš„ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-init-functions-319dbb12831c</description></item><item><title>inline strategy &amp; limitation</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/inline-strategy-limitation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/inline-strategy-limitation/</guid><description>Let&amp;rsquo;s Summarize # inlineå°±æ˜¯å°†ä¸€äº›çŸ­å°ç®€å•çš„å‡½æ•°ç»™å±•å¼€ï¼Œæ¶ˆé™¤æ ˆå¸§æ„å»ºé”€æ¯çš„å¼€é”€ï¼Œå¤šç®€å•ç®—ç®€å•å‘¢ï¼Ÿ
å‡½æ•°å¯¹åº”çš„ASTè¯­æ³•æ ‘èŠ‚ç‚¹æ•°ä¸èƒ½è¶…è¿‡é¢„ç®—ï¼Œé¢„ç®—æ˜¯80ä¸ªï¼› ä¸èƒ½æœ‰å¤æ‚çš„ç¨‹åºæ„é€ ï¼Œå¦‚for-loopã€closureã€deferã€recoverã€selectç­‰ï¼› å‡½æ•°å‰ä¸èƒ½æœ‰noinline directiveï¼Œç¦æ­¢å†…è”è‚¯å®šä¸èƒ½å†…è”ï¼› å‡½æ•°å‰ä¸èƒ½æœ‰uintptrescapesï¼Œå› ä¸ºå†…è”ä¼šå¯¼è‡´é€ƒé€¸ä¿¡æ¯ä¸¢å¤±ï¼› å…¶ä»–è§„åˆ™ï¼› è¯¦è§ï¼šhttps://github.com/golang/go/wiki/CompilerOptimizations#function-inliningã€‚ å¯ä»¥é€šè¿‡ç¼–è¯‘é€‰é¡¹-gcflags=&amp;quot;-m&amp;quot;æ¥æŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹ä¸­å¯¹å“ªäº›å‡½æ•°è¿›è¡Œäº†å†…è”ï¼Œå¦‚æœä½¿ç”¨ç¼–è¯‘é€‰é¡¹-gcflags=&amp;quot;-m -m&amp;quot;å¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚æ¯ä¸ªå‡½æ•°æ˜¯å¦å†…è”çš„åŸå› ï¼šORANGEä¸èƒ½å¤„ç†ï¼Œæˆ–è€…è¿‡äºå¤æ‚ã€å¼€é”€è¿‡å¤§ç­‰ç­‰ã€‚
å†…è”å¯èƒ½ä¹Ÿä¼šç»™å¼€å‘è€…å¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œè¾ƒæ—©çš„goç‰ˆæœ¬å¯èƒ½ä¼šå¯¹å†…éƒ¨åŒ…å«panicçš„å‡½æ•°åšå†…è”ï¼Œä½†æ˜¯æœ€ç»ˆpanicã€recoveræ—¶æ‰“å°çš„stacktraceæ˜¾ç¤ºçš„panicä½ç½®ä¸å‡†ç¡®ï¼Œå¯¹å¼€å‘è€…å¾ˆä¸å‹å¥½ã€‚åº”è¯¥æ˜¯go1.13åŠåç»­ç‰ˆæœ¬ä¸­åšäº†ä¼˜åŒ–ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè¡¨pc to fileåŠlinenoï¼Œstacktraceä¸­å¯ä»¥è¿˜åŸå‡ºç²¾ç¡®çš„panicä½ç½®ã€‚æˆ‘æµ‹è¯•go1.16ä¸­å¸¦panicçš„ç®€å•å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥å†…è”çš„ï¼Œå¹¶ä¸”stacktraceæŠ¥å‡ºçš„ä½ç½®ä¹Ÿå¾ˆå‡†ç¡®ã€‚
å‡½æ•°åˆ›å»ºè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°æ ˆå¸§åˆ›å»ºã€å¯„å­˜å™¨ä¿å­˜æ¢å¤ã€æ ˆå¸§é”€æ¯ç­‰å·¥ä½œï¼Œå’Œå†…è”åç›´æ¥æ‰§è¡ŒæŒ‡ä»¤ç›¸æ¯”ï¼Œæ˜¯æœ‰å¼€é”€çš„ï¼Œåšäº†éƒ¨åˆ†æ€§èƒ½æµ‹è¯•å‘ç°å†…è”åæ¯”å†…è”å‰æœ‰6%çš„æ€§èƒ½æå‡ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-inlining-strategy-limitation-6b6d7fc3b1be</description></item><item><title>inline strategy &amp; limitation</title><link>https://hitzhangjie.pro/go-internals-v2/posts/inline-strategy-limitation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/inline-strategy-limitation/</guid><description>Let&amp;rsquo;s Summarize # inlineå°±æ˜¯å°†ä¸€äº›çŸ­å°ç®€å•çš„å‡½æ•°ç»™å±•å¼€ï¼Œæ¶ˆé™¤æ ˆå¸§æ„å»ºé”€æ¯çš„å¼€é”€ï¼Œå¤šç®€å•ç®—ç®€å•å‘¢ï¼Ÿ
å‡½æ•°å¯¹åº”çš„ASTè¯­æ³•æ ‘èŠ‚ç‚¹æ•°ä¸èƒ½è¶…è¿‡é¢„ç®—ï¼Œé¢„ç®—æ˜¯80ä¸ªï¼› ä¸èƒ½æœ‰å¤æ‚çš„ç¨‹åºæ„é€ ï¼Œå¦‚for-loopã€closureã€deferã€recoverã€selectç­‰ï¼› å‡½æ•°å‰ä¸èƒ½æœ‰noinline directiveï¼Œç¦æ­¢å†…è”è‚¯å®šä¸èƒ½å†…è”ï¼› å‡½æ•°å‰ä¸èƒ½æœ‰uintptrescapesï¼Œå› ä¸ºå†…è”ä¼šå¯¼è‡´é€ƒé€¸ä¿¡æ¯ä¸¢å¤±ï¼› å…¶ä»–è§„åˆ™ï¼› è¯¦è§ï¼šhttps://github.com/golang/go/wiki/CompilerOptimizations#function-inliningã€‚ å¯ä»¥é€šè¿‡ç¼–è¯‘é€‰é¡¹-gcflags=&amp;quot;-m&amp;quot;æ¥æŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹ä¸­å¯¹å“ªäº›å‡½æ•°è¿›è¡Œäº†å†…è”ï¼Œå¦‚æœä½¿ç”¨ç¼–è¯‘é€‰é¡¹-gcflags=&amp;quot;-m -m&amp;quot;å¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚æ¯ä¸ªå‡½æ•°æ˜¯å¦å†…è”çš„åŸå› ï¼šORANGEä¸èƒ½å¤„ç†ï¼Œæˆ–è€…è¿‡äºå¤æ‚ã€å¼€é”€è¿‡å¤§ç­‰ç­‰ã€‚
å†…è”å¯èƒ½ä¹Ÿä¼šç»™å¼€å‘è€…å¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œè¾ƒæ—©çš„goç‰ˆæœ¬å¯èƒ½ä¼šå¯¹å†…éƒ¨åŒ…å«panicçš„å‡½æ•°åšå†…è”ï¼Œä½†æ˜¯æœ€ç»ˆpanicã€recoveræ—¶æ‰“å°çš„stacktraceæ˜¾ç¤ºçš„panicä½ç½®ä¸å‡†ç¡®ï¼Œå¯¹å¼€å‘è€…å¾ˆä¸å‹å¥½ã€‚åº”è¯¥æ˜¯go1.13åŠåç»­ç‰ˆæœ¬ä¸­åšäº†ä¼˜åŒ–ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè¡¨pc to fileåŠlinenoï¼Œstacktraceä¸­å¯ä»¥è¿˜åŸå‡ºç²¾ç¡®çš„panicä½ç½®ã€‚æˆ‘æµ‹è¯•go1.16ä¸­å¸¦panicçš„ç®€å•å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥å†…è”çš„ï¼Œå¹¶ä¸”stacktraceæŠ¥å‡ºçš„ä½ç½®ä¹Ÿå¾ˆå‡†ç¡®ã€‚
å‡½æ•°åˆ›å»ºè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°æ ˆå¸§åˆ›å»ºã€å¯„å­˜å™¨ä¿å­˜æ¢å¤ã€æ ˆå¸§é”€æ¯ç­‰å·¥ä½œï¼Œå’Œå†…è”åç›´æ¥æ‰§è¡ŒæŒ‡ä»¤ç›¸æ¯”ï¼Œæ˜¯æœ‰å¼€é”€çš„ï¼Œåšäº†éƒ¨åˆ†æ€§èƒ½æµ‹è¯•å‘ç°å†…è”åæ¯”å†…è”å‰æœ‰6%çš„æ€§èƒ½æå‡ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-inlining-strategy-limitation-6b6d7fc3b1be</description></item><item><title>instrumentation in go</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/instrumentation-in-go/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/instrumentation-in-go/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goä¸­ç»‡å…¥ä»£ç çš„åº”ç”¨ï¼Œå¯¹äºgoç¨‹åºçš„æµ‹è¯•è¦†ç›–ç‡ï¼Œå®ƒä¼šåœ¨ç°æœ‰ä»£ç åŸºç¡€ä¸Šç»‡å…¥ä¸€äº›ç»Ÿè®¡æ¯è¡Œè¯­å¥æ‰§è¡Œçš„ä»£ç ï¼Œç”¨æ¥å®ç°è¯­å¥æµ‹è¯•è¦†ç›–ç‡çš„ç»Ÿè®¡ã€‚
å¯¹äºcpu profileï¼Œå…¶å®ä¸æ˜¯é€šè¿‡ä»£ç ç»‡å…¥çš„æ–¹å¼ï¼Œè€Œæ˜¯å®šæœŸåœ°æš‚åœç¨‹åºå¹¶è·å–cpuã€è¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ï¼Œç”¨æ¥æ˜¾ç¤ºå“ªäº›ä»£ç æ®µæ‰§è¡Œcpuæ¯”è¾ƒèŠ±æ—¶é—´ã€‚
å¯¹äºmem profileï¼Œè¿™éƒ¨åˆ†èƒ½åŠ›å…¶æ˜¯å†…ç½®åœ¨å†…å­˜åˆ†é…å™¨é‡Œé¢çš„ï¼Œç›´æ¥æ‰§è¡Œå¯¹åº”çš„profileé€»è¾‘å°±å¯ä»¥å®Œæˆã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-instrumentation-in-go-e845cdae0c51</description></item><item><title>instrumentation in go</title><link>https://hitzhangjie.pro/go-internals-v2/posts/instrumentation-in-go/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/instrumentation-in-go/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goä¸­ç»‡å…¥ä»£ç çš„åº”ç”¨ï¼Œå¯¹äºgoç¨‹åºçš„æµ‹è¯•è¦†ç›–ç‡ï¼Œå®ƒä¼šåœ¨ç°æœ‰ä»£ç åŸºç¡€ä¸Šç»‡å…¥ä¸€äº›ç»Ÿè®¡æ¯è¡Œè¯­å¥æ‰§è¡Œçš„ä»£ç ï¼Œç”¨æ¥å®ç°è¯­å¥æµ‹è¯•è¦†ç›–ç‡çš„ç»Ÿè®¡ã€‚
å¯¹äºcpu profileï¼Œå…¶å®ä¸æ˜¯é€šè¿‡ä»£ç ç»‡å…¥çš„æ–¹å¼ï¼Œè€Œæ˜¯å®šæœŸåœ°æš‚åœç¨‹åºå¹¶è·å–cpuã€è¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ï¼Œç”¨æ¥æ˜¾ç¤ºå“ªäº›ä»£ç æ®µæ‰§è¡Œcpuæ¯”è¾ƒèŠ±æ—¶é—´ã€‚
å¯¹äºmem profileï¼Œè¿™éƒ¨åˆ†èƒ½åŠ›å…¶æ˜¯å†…ç½®åœ¨å†…å­˜åˆ†é…å™¨é‡Œé¢çš„ï¼Œç›´æ¥æ‰§è¡Œå¯¹åº”çš„profileé€»è¾‘å°±å¯ä»¥å®Œæˆã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-instrumentation-in-go-e845cdae0c51</description></item><item><title>introduction to the escape analysis</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-escape-analysis/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-escape-analysis/</guid><description>Let&amp;rsquo;s Summarize # escape analysisä¸åªæ˜¯goä¸­æ‰æœ‰çš„æ¦‚å¿µï¼Œjava se 6u23åŠæ›´æ–°ç‰ˆæœ¬å‡ä¹Ÿæ”¯æŒé€ƒé€¸åˆ†æï¼Œseeï¼š
https://en.wikipedia.org/wiki/Escape_analysis goæŸ¥çœ‹é€ƒé€¸åˆ†æç»“æœï¼Œå¯ä»¥é€šè¿‡ç»™ç¼–è¯‘å™¨ä¼ é€’é€‰é¡¹-mï¼Œå¦‚æºæ–‡ä»¶ä¸ºmain.goï¼Œå¯æ‰§è¡Œï¼š
go build -gcflags=&amp;quot;-m&amp;quot; main.go go tool compile -m main.go goé‡Œé¢æœ‰å‡ ç§æƒ…å†µä¼šå‘ç”Ÿé€ƒé€¸ï¼š
ä¸€ä¸ªå‡½æ•°å†…éƒ¨new(obj)å¹¶è¿”å›æŒ‡é’ˆï¼Œæˆ–è€…å£°æ˜å˜é‡å¹¶è¿”å›æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆåœ¨è¯¥å‡½æ•°å¤–è¢«ç»§ç»­ä½¿ç”¨ï¼Œä¼šå‘ç”Ÿé€ƒé€¸ï¼› ä¸€ä¸ªforå¾ªç¯ä½“å†…new(obj)åˆ›å»ºå¯¹è±¡å¹¶èµ‹å€¼ç»™å¤–éƒ¨æŒ‡é’ˆï¼Œæˆ–è€…ç”¨å…¶ä»–æ–¹å¼å£°æ˜å¦‚var a intç„¶åå–åœ°å€èµ‹å€¼ï¼Œä¼šå‘ç”Ÿé€ƒé€¸ï¼› ä¸€ä¸ªé—­åŒ…å†…é€šè¿‡new(obj)åˆ›å»ºå¯¹è±¡å¹¶èµ‹å€¼ç»™å¤–éƒ¨æŒ‡é’ˆï¼Œæˆ–è€…ç”¨å…¶ä»–æ–¹å¼å£°æ˜å¦‚var a intç„¶åå–åœ°å€èµ‹å€¼ï¼Œä¼šå‘ç”Ÿé€ƒé€¸ï¼› psï¼šåœ¨ä¸€ä¸ªæ™®é€šçš„{}æ„æˆçš„å—ä½œç”¨åŸŸå†…new(obj)æˆ–è€…å¯¹å£°æ˜å˜é‡å–åœ°å€èµ‹å€¼ç»™å¤–éƒ¨æŒ‡é’ˆï¼Œéƒ½æ˜¯ä¸ä¼šå‘ç”Ÿé€ƒé€¸çš„ï¼Œå› ä¸ºåœ¨åŒä¸€ä¸ªæ ˆå¸§å†…ï¼Œå¹¶ä¸å­˜åœ¨outlive the stack frameçš„æƒ…å†µï¼Œæ ¹æœ¬ä¸éœ€è¦è®¨è®ºé€ƒé€¸çš„é—®é¢˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-introduction-to-the-escape-analysis-f7610174e890</description></item><item><title>introduction to the escape analysis</title><link>https://hitzhangjie.pro/go-internals-v2/posts/introduction-to-the-escape-analysis/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/introduction-to-the-escape-analysis/</guid><description>Let&amp;rsquo;s Summarize # escape analysisä¸åªæ˜¯goä¸­æ‰æœ‰çš„æ¦‚å¿µï¼Œjava se 6u23åŠæ›´æ–°ç‰ˆæœ¬å‡ä¹Ÿæ”¯æŒé€ƒé€¸åˆ†æï¼Œseeï¼š
https://en.wikipedia.org/wiki/Escape_analysis goæŸ¥çœ‹é€ƒé€¸åˆ†æç»“æœï¼Œå¯ä»¥é€šè¿‡ç»™ç¼–è¯‘å™¨ä¼ é€’é€‰é¡¹-mï¼Œå¦‚æºæ–‡ä»¶ä¸ºmain.goï¼Œå¯æ‰§è¡Œï¼š
go build -gcflags=&amp;quot;-m&amp;quot; main.go go tool compile -m main.go goé‡Œé¢æœ‰å‡ ç§æƒ…å†µä¼šå‘ç”Ÿé€ƒé€¸ï¼š
ä¸€ä¸ªå‡½æ•°å†…éƒ¨new(obj)å¹¶è¿”å›æŒ‡é’ˆï¼Œæˆ–è€…å£°æ˜å˜é‡å¹¶è¿”å›æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆåœ¨è¯¥å‡½æ•°å¤–è¢«ç»§ç»­ä½¿ç”¨ï¼Œä¼šå‘ç”Ÿé€ƒé€¸ï¼› ä¸€ä¸ªforå¾ªç¯ä½“å†…new(obj)åˆ›å»ºå¯¹è±¡å¹¶èµ‹å€¼ç»™å¤–éƒ¨æŒ‡é’ˆï¼Œæˆ–è€…ç”¨å…¶ä»–æ–¹å¼å£°æ˜å¦‚var a intç„¶åå–åœ°å€èµ‹å€¼ï¼Œä¼šå‘ç”Ÿé€ƒé€¸ï¼› ä¸€ä¸ªé—­åŒ…å†…é€šè¿‡new(obj)åˆ›å»ºå¯¹è±¡å¹¶èµ‹å€¼ç»™å¤–éƒ¨æŒ‡é’ˆï¼Œæˆ–è€…ç”¨å…¶ä»–æ–¹å¼å£°æ˜å¦‚var a intç„¶åå–åœ°å€èµ‹å€¼ï¼Œä¼šå‘ç”Ÿé€ƒé€¸ï¼› psï¼šåœ¨ä¸€ä¸ªæ™®é€šçš„{}æ„æˆçš„å—ä½œç”¨åŸŸå†…new(obj)æˆ–è€…å¯¹å£°æ˜å˜é‡å–åœ°å€èµ‹å€¼ç»™å¤–éƒ¨æŒ‡é’ˆï¼Œéƒ½æ˜¯ä¸ä¼šå‘ç”Ÿé€ƒé€¸çš„ï¼Œå› ä¸ºåœ¨åŒä¸€ä¸ªæ ˆå¸§å†…ï¼Œå¹¶ä¸å­˜åœ¨outlive the stack frameçš„æƒ…å†µï¼Œæ ¹æœ¬ä¸éœ€è¦è®¨è®ºé€ƒé€¸çš„é—®é¢˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-introduction-to-the-escape-analysis-f7610174e890</description></item><item><title>introduction to the go compiler</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-go-compiler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-go-compiler/</guid><description>Let&amp;rsquo;s Summarize # goç¼–è¯‘å™¨å·¥ä½œè¿‡ç¨‹ä¸»è¦åˆ†ä¸ºè¿™ä¹ˆå‡ ä¸ªé˜¶æ®µï¼š
è§£æé˜¶æ®µï¼šå¯¹æ¯ä¸ªæºæ–‡ä»¶è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œå¹¶æ„å»ºå¯¹åº”çš„è¯­æ³•æ ‘ï¼› ç±»å‹æ£€æŸ¥å’Œè¯­æ³•æ ‘è½¬æ¢ï¼šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå¦‚åå­—è§£æã€ç±»å‹æ¨æ–­ã€å‡½æ•°å®šä¹‰æ˜¯å¦ç»“æŸã€æ˜¯å¦å­˜åœ¨ä½†å®šä¹‰æœªä½¿ç”¨çš„é—®é¢˜ã€‚ç„¶åè¿˜ä¼šè½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘ASTï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜ä¼šæ ¹æ®ç±»å‹ä¿¡æ¯åšä¸€ç³»åˆ—è°ƒæ•´ä¼˜åŒ–ï¼Œå¦‚å‡½æ•°å†…è”ã€deadcodeç§»é™¤ç­‰ï¼› ä»¥ä¸Šä¸¤ä¸ªé˜¶æ®µç»å¸¸æˆä¸ºç¼–è¯‘å™¨çš„frontendï¼Œé‚£åç«¯backendæŒ‡çš„æ˜¯å“ªå‡ ä¸ªé˜¶æ®µå‘¢ï¼Ÿ
generic SSAï¼šASTè¢«è½¬æ¢æˆSSAï¼ˆé™æ€å•èµ‹å€¼ï¼‰å½¢å¼ï¼Œå®ƒæ˜¯ä¸€ç§ä¸­é—´ä»£ç è¡¨ç¤ºï¼Œåœ¨å®ƒåŸºç¡€ä¸Šå¯ä»¥æ–¹ä¾¿åšä¼˜åŒ–ï¼Œå¹¶è½¬æ¢ä¸ºæœºå™¨æŒ‡ä»¤ã€‚è¿™ä¸ªé˜¶æ®µæœ‰äº›rewriteè§„åˆ™ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ä¸€äº›é«˜åº¦ä¼˜åŒ–çš„æŒ‡ä»¤æ¥æ›¿æ¢æ‰ä¸€äº›ç‰¹æ®Šçš„å†…ç½®å‡½æ•°ï¼Œå¦‚capã€lenã€copyç­‰ï¼ˆå‰é¢æè¿‡è¿™äº›å‡½æ•°æ˜¯æ²¡æœ‰å‡½æ•°ä½“å®ç°çš„ï¼‰ï¼Œäº†è§£æ›´å¤šsee https://en.wikipedia.org/wiki/Intrinsic_functionã€‚è¿™ä¸ªé˜¶æ®µè¿˜ä¼šæœ‰äº›èŠ‚ç‚¹çš„å½¢å¼è¢«åšè¿›ä¸€æ­¥è½¬æ¢ï¼Œå¦‚copyã€rangeåˆ«è½¬æ¢æˆä¸ºmovã€for-loopç­‰ã€‚ç„¶åä¼šåšæœ‰å¤šéä¸æœºå™¨æ— å…³çš„æ“ä½œå’Œé‡å†™ï¼Œå¦‚deadcodeç§»é™¤ã€nilcheckç­‰ç­‰ï¼› ç”Ÿæˆæœºå™¨æŒ‡ä»¤ï¼šç¼–è¯‘å™¨ä¸­æœºå™¨ç›¸å…³çš„ä¼˜åŒ–ä»ssa lower passå°±å¼€å§‹äº†ï¼Œä¼šä¸æ–­çš„åšå‡ºä¸€äº›æ›´åŠ æ¥è¿‘æœºå™¨ä½çº§ç»†èŠ‚çš„ä¼˜åŒ–ï¼Œç›´åˆ°è¾¾åˆ°æœºå™¨ä½çº§ç‰¹æ€§ä¹‹åï¼Œæœ€ç»ˆä»£ç ä¼˜åŒ–å°±å¼€å§‹äº†ã€‚æ¯”å¦‚deadcodeç§»é™¤ï¼Œå°†valueç§»åˆ°æœ€è¿‘è®¿é—®çš„åœ°æ–¹ï¼Œç§»é™¤æ— ç”¨çš„å±€éƒ¨å˜é‡å’Œä¸å¿…è¦çš„å¯„å­˜å™¨åˆ†é…ã€‚è¿˜æœ‰ä¼šå¯¹æ ˆå¸§ä¸­çš„å˜é‡è®¡ç®—å¥½åç§»é‡ï¼Œè®¿é—®æ›´å¿«ï¼Œå¹¶è®¡ç®—GC safepointå¤„å“ªäº›æ ˆä¸Šçš„æŒ‡é’ˆå¯ä»¥ä¿æŒlivenessã€‚ssaç”Ÿæˆé˜¶æ®µï¼Œgoå‡½æ•°è¢«è½¬æ¢ä¸ºä¸€ç³»åˆ—çš„obj.ProgæŒ‡ä»¤ï¼Œç„¶åå†ç”±æ±‡ç¼–å™¨ç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†åå°„æ•°æ®ã€å¯¼å‡ºæ•°æ®ã€è°ƒè¯•ä¿¡æ¯ã€‚ Source Analysis # References # https://github.com/golang/go/blob/release-branch.go1.13/src/cmd/compile/README.md</description></item><item><title>introduction to the go compiler</title><link>https://hitzhangjie.pro/go-internals-v2/posts/introduction-to-the-go-compiler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/introduction-to-the-go-compiler/</guid><description>Let&amp;rsquo;s Summarize # goç¼–è¯‘å™¨å·¥ä½œè¿‡ç¨‹ä¸»è¦åˆ†ä¸ºè¿™ä¹ˆå‡ ä¸ªé˜¶æ®µï¼š
è§£æé˜¶æ®µï¼šå¯¹æ¯ä¸ªæºæ–‡ä»¶è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œå¹¶æ„å»ºå¯¹åº”çš„è¯­æ³•æ ‘ï¼› ç±»å‹æ£€æŸ¥å’Œè¯­æ³•æ ‘è½¬æ¢ï¼šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå¦‚åå­—è§£æã€ç±»å‹æ¨æ–­ã€å‡½æ•°å®šä¹‰æ˜¯å¦ç»“æŸã€æ˜¯å¦å­˜åœ¨ä½†å®šä¹‰æœªä½¿ç”¨çš„é—®é¢˜ã€‚ç„¶åè¿˜ä¼šè½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘ASTï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜ä¼šæ ¹æ®ç±»å‹ä¿¡æ¯åšä¸€ç³»åˆ—è°ƒæ•´ä¼˜åŒ–ï¼Œå¦‚å‡½æ•°å†…è”ã€deadcodeç§»é™¤ç­‰ï¼› ä»¥ä¸Šä¸¤ä¸ªé˜¶æ®µç»å¸¸æˆä¸ºç¼–è¯‘å™¨çš„frontendï¼Œé‚£åç«¯backendæŒ‡çš„æ˜¯å“ªå‡ ä¸ªé˜¶æ®µå‘¢ï¼Ÿ
generic SSAï¼šASTè¢«è½¬æ¢æˆSSAï¼ˆé™æ€å•èµ‹å€¼ï¼‰å½¢å¼ï¼Œå®ƒæ˜¯ä¸€ç§ä¸­é—´ä»£ç è¡¨ç¤ºï¼Œåœ¨å®ƒåŸºç¡€ä¸Šå¯ä»¥æ–¹ä¾¿åšä¼˜åŒ–ï¼Œå¹¶è½¬æ¢ä¸ºæœºå™¨æŒ‡ä»¤ã€‚è¿™ä¸ªé˜¶æ®µæœ‰äº›rewriteè§„åˆ™ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ä¸€äº›é«˜åº¦ä¼˜åŒ–çš„æŒ‡ä»¤æ¥æ›¿æ¢æ‰ä¸€äº›ç‰¹æ®Šçš„å†…ç½®å‡½æ•°ï¼Œå¦‚capã€lenã€copyç­‰ï¼ˆå‰é¢æè¿‡è¿™äº›å‡½æ•°æ˜¯æ²¡æœ‰å‡½æ•°ä½“å®ç°çš„ï¼‰ï¼Œäº†è§£æ›´å¤šsee https://en.wikipedia.org/wiki/Intrinsic_functionã€‚è¿™ä¸ªé˜¶æ®µè¿˜ä¼šæœ‰äº›èŠ‚ç‚¹çš„å½¢å¼è¢«åšè¿›ä¸€æ­¥è½¬æ¢ï¼Œå¦‚copyã€rangeåˆ«è½¬æ¢æˆä¸ºmovã€for-loopç­‰ã€‚ç„¶åä¼šåšæœ‰å¤šéä¸æœºå™¨æ— å…³çš„æ“ä½œå’Œé‡å†™ï¼Œå¦‚deadcodeç§»é™¤ã€nilcheckç­‰ç­‰ï¼› ç”Ÿæˆæœºå™¨æŒ‡ä»¤ï¼šç¼–è¯‘å™¨ä¸­æœºå™¨ç›¸å…³çš„ä¼˜åŒ–ä»ssa lower passå°±å¼€å§‹äº†ï¼Œä¼šä¸æ–­çš„åšå‡ºä¸€äº›æ›´åŠ æ¥è¿‘æœºå™¨ä½çº§ç»†èŠ‚çš„ä¼˜åŒ–ï¼Œç›´åˆ°è¾¾åˆ°æœºå™¨ä½çº§ç‰¹æ€§ä¹‹åï¼Œæœ€ç»ˆä»£ç ä¼˜åŒ–å°±å¼€å§‹äº†ã€‚æ¯”å¦‚deadcodeç§»é™¤ï¼Œå°†valueç§»åˆ°æœ€è¿‘è®¿é—®çš„åœ°æ–¹ï¼Œç§»é™¤æ— ç”¨çš„å±€éƒ¨å˜é‡å’Œä¸å¿…è¦çš„å¯„å­˜å™¨åˆ†é…ã€‚è¿˜æœ‰ä¼šå¯¹æ ˆå¸§ä¸­çš„å˜é‡è®¡ç®—å¥½åç§»é‡ï¼Œè®¿é—®æ›´å¿«ï¼Œå¹¶è®¡ç®—GC safepointå¤„å“ªäº›æ ˆä¸Šçš„æŒ‡é’ˆå¯ä»¥ä¿æŒlivenessã€‚ssaç”Ÿæˆé˜¶æ®µï¼Œgoå‡½æ•°è¢«è½¬æ¢ä¸ºä¸€ç³»åˆ—çš„obj.ProgæŒ‡ä»¤ï¼Œç„¶åå†ç”±æ±‡ç¼–å™¨ç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†åå°„æ•°æ®ã€å¯¼å‡ºæ•°æ®ã€è°ƒè¯•ä¿¡æ¯ã€‚ Source Analysis # References # https://github.com/golang/go/blob/release-branch.go1.13/src/cmd/compile/README.md</description></item><item><title>introduction to the go compiler ssa backend</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-go-compiler-ssa-backend/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-go-compiler-ssa-backend/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†ssaçš„å…³é”®æ¦‚å¿µï¼Œvalueã€memoryã€blockã€functionã€compiler passï¼Œä»‹ç»äº†æŸ¥çœ‹ä»æºä»£ç åˆ°ssaå„é˜¶æ®µä¼˜åŒ–å†åˆ°æœ€ç»ˆç”Ÿæˆçš„æœºå™¨æŒ‡ä»¤çš„æŸ¥çœ‹æ–¹æ³•ï¼šGOSSAFUNC=${func} go build *.goï¼Œä¼šç”Ÿæˆä¸€ä¸ªssa.htmlæ–‡ä»¶ï¼Œæ‰“å¼€å³å¯æŸ¥çœ‹
Source Analysis # References # https://github.com/golang/go/blob/release-branch.go1.13/src/cmd/compile/internal/ssa/README.md</description></item><item><title>introduction to the go compiler ssa backend</title><link>https://hitzhangjie.pro/go-internals-v2/posts/introduction-to-the-go-compiler-ssa-backend/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/introduction-to-the-go-compiler-ssa-backend/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†ssaçš„å…³é”®æ¦‚å¿µï¼Œvalueã€memoryã€blockã€functionã€compiler passï¼Œä»‹ç»äº†æŸ¥çœ‹ä»æºä»£ç åˆ°ssaå„é˜¶æ®µä¼˜åŒ–å†åˆ°æœ€ç»ˆç”Ÿæˆçš„æœºå™¨æŒ‡ä»¤çš„æŸ¥çœ‹æ–¹æ³•ï¼šGOSSAFUNC=${func} go build *.goï¼Œä¼šç”Ÿæˆä¸€ä¸ªssa.htmlæ–‡ä»¶ï¼Œæ‰“å¼€å³å¯æŸ¥çœ‹
Source Analysis # References # https://github.com/golang/go/blob/release-branch.go1.13/src/cmd/compile/internal/ssa/README.md</description></item><item><title>keeping a variable alive</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/keeping-a-variable-alive/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/keeping-a-variable-alive/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†finalizerçš„ä½¿ç”¨ï¼Œä»‹ç»äº†å¦‚ä½•é€šè¿‡runtime.KeepAlive(pï¼‰æ¥é¿å…pæŒ‡å‘çš„å¯¹è±¡è¢«GCæ‰ï¼Œå…¶å®è¯¥å‡½æ•°çš„å®ç°æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œå°±æ˜¯å¼•ç”¨äº†ä¸€ä¸‹pæŒ‡å‘çš„å¯¹è±¡è€Œå·²ï¼Œåœ¨è¿™ä¸ªå‡½æ•°è°ƒç”¨ä¹‹å‰çš„ä½ç½®æ˜¯ä¸å¯èƒ½è¢«GCæ‰çš„ã€‚é‚£æˆ‘ä»¬è‡ªå·±å¼•ç”¨ä»¥ä¸‹è¡Œä¸è¡Œæ¯”å¦‚ç”¨q := p, _ = qï¼Œå¯èƒ½ä¸è¡Œï¼Œç¼–è¯‘å™¨ä¼˜åŒ–æœ‰å¾ˆå¤šéï¼Œæ¯”å¦‚deadcodeç§»é™¤ã€å‡½æ•°å†…è”ç­‰ï¼Œè¿™æ ·ä¸‹æ¥æˆ‘ä»¬è‡ªå·±çš„å†™æ³•ï¼Œå¯èƒ½ä¼šå› ä¸ºç¼–è¯‘å™¨çš„ä¸€äº›ä¼˜åŒ–ç»™ä¼˜åŒ–äº†ï¼Œå¯¼è‡´æ— æ•ˆï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨goæä¾›çš„æ–¹å¼æ¥æ¥é˜»æ­¢è¢«ä¼˜åŒ–æ‰ã€‚å…³äºè¿™ä¸ªå‡½æ•°çš„å…·ä½“å®ç°ï¼Œseeï¼šhttps://utcc.utoronto.ca/~cks/space/blog/programming/GoRuntimeKeepAliveNotesã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-keeping-a-variable-alive-c28e3633673a</description></item><item><title>keeping a variable alive</title><link>https://hitzhangjie.pro/go-internals-v2/posts/keeping-a-variable-alive/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/keeping-a-variable-alive/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†finalizerçš„ä½¿ç”¨ï¼Œä»‹ç»äº†å¦‚ä½•é€šè¿‡runtime.KeepAlive(pï¼‰æ¥é¿å…pæŒ‡å‘çš„å¯¹è±¡è¢«GCæ‰ï¼Œå…¶å®è¯¥å‡½æ•°çš„å®ç°æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œå°±æ˜¯å¼•ç”¨äº†ä¸€ä¸‹pæŒ‡å‘çš„å¯¹è±¡è€Œå·²ï¼Œåœ¨è¿™ä¸ªå‡½æ•°è°ƒç”¨ä¹‹å‰çš„ä½ç½®æ˜¯ä¸å¯èƒ½è¢«GCæ‰çš„ã€‚é‚£æˆ‘ä»¬è‡ªå·±å¼•ç”¨ä»¥ä¸‹è¡Œä¸è¡Œæ¯”å¦‚ç”¨q := p, _ = qï¼Œå¯èƒ½ä¸è¡Œï¼Œç¼–è¯‘å™¨ä¼˜åŒ–æœ‰å¾ˆå¤šéï¼Œæ¯”å¦‚deadcodeç§»é™¤ã€å‡½æ•°å†…è”ç­‰ï¼Œè¿™æ ·ä¸‹æ¥æˆ‘ä»¬è‡ªå·±çš„å†™æ³•ï¼Œå¯èƒ½ä¼šå› ä¸ºç¼–è¯‘å™¨çš„ä¸€äº›ä¼˜åŒ–ç»™ä¼˜åŒ–äº†ï¼Œå¯¼è‡´æ— æ•ˆï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨goæä¾›çš„æ–¹å¼æ¥æ¥é˜»æ­¢è¢«ä¼˜åŒ–æ‰ã€‚å…³äºè¿™ä¸ªå‡½æ•°çš„å…·ä½“å®ç°ï¼Œseeï¼šhttps://utcc.utoronto.ca/~cks/space/blog/programming/GoRuntimeKeepAliveNotesã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-keeping-a-variable-alive-c28e3633673a</description></item><item><title>language mechanics on stacks and pointers</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/language-mechanics-on-stacks-and-pointers/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/language-mechanics-on-stacks-and-pointers/</guid><description>Let&amp;rsquo;s Summarize # to pass by value, to share by pointers.
Source Analysis # References # https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-stacks-and-pointers.html</description></item><item><title>language mechanics on stacks and pointers</title><link>https://hitzhangjie.pro/go-internals-v2/posts/language-mechanics-on-stacks-and-pointers/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/language-mechanics-on-stacks-and-pointers/</guid><description>Let&amp;rsquo;s Summarize # to pass by value, to share by pointers.
Source Analysis # References # https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-stacks-and-pointers.html</description></item><item><title>language semantics on escape analysis</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/language-semantics-on-escape-analysis/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/language-semantics-on-escape-analysis/</guid><description>Let&amp;rsquo;s Summarize # Anytime a value is shared outside the scope of a functionâ€™s stack frame, it will be placed (or allocated) on the heap.
The construction of a value doesnâ€™t determine where it lives. Only how a value is shared will determine what the compiler will do with that value. Anytime you share a value up the call stack, it is going to escape. There are other reasons for a value to escape which you will explore in the next post.</description></item><item><title>language semantics on escape analysis</title><link>https://hitzhangjie.pro/go-internals-v2/posts/language-semantics-on-escape-analysis/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/language-semantics-on-escape-analysis/</guid><description>Let&amp;rsquo;s Summarize # Anytime a value is shared outside the scope of a functionâ€™s stack frame, it will be placed (or allocated) on the heap.
The construction of a value doesnâ€™t determine where it lives. Only how a value is shared will determine what the compiler will do with that value. Anytime you share a value up the call stack, it is going to escape. There are other reasons for a value to escape which you will explore in the next post.</description></item><item><title>language semantics on memory profiling</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/PProf/language-semantics-on-memory-profiling/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/PProf/language-semantics-on-memory-profiling/</guid><description>Let&amp;rsquo;s Summarize # Go has some amazing tooling that allows you to understand the decisions the compiler is making as it relates to escape analysis. Based on this information, you can refactor code to be sympathetic with keeping values on the stack that donâ€™t need to be on the heap. You are not going to write zero allocation software but you want to minimize allocations when possible.
That being said, never write code with performance as your first priority because you donâ€™t want to be guessing about performance.</description></item><item><title>language semantics on memory profiling</title><link>https://hitzhangjie.pro/go-internals-v2/posts/language-semantics-on-memory-profiling/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/language-semantics-on-memory-profiling/</guid><description>Let&amp;rsquo;s Summarize # Go has some amazing tooling that allows you to understand the decisions the compiler is making as it relates to escape analysis. Based on this information, you can refactor code to be sympathetic with keeping values on the stack that donâ€™t need to be on the heap. You are not going to write zero allocation software but you want to minimize allocations when possible.
That being said, never write code with performance as your first priority because you donâ€™t want to be guessing about performance.</description></item><item><title>learn go constants - a visual guide</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/constants/learn-go-constants-a-visual-guide/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/constants/learn-go-constants-a-visual-guide/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goä¸­çš„å¸¸é‡ï¼Œæœ‰ç±»å‹å¸¸é‡ã€æ— ç±»å‹å¸¸é‡ä¹‹é—´çš„åŒºåˆ«ï¼Œé‡ç‚¹æè¿°äº†æ— ç±»å‹æ•°å€¼å¸¸é‡çš„é«˜ç²¾åº¦ä¼˜åŠ¿ï¼ˆuntyped numerics constantsï¼‰ï¼Œæ¯”å¦‚æµ®ç‚¹é»˜è®¤æ˜¯256ä½ç²¾åº¦çš„ã€‚ gospecä¸­è§„å®šè¿™ç§æ— ç±»å‹æ•°å€¼å¸¸é‡çš„ç²¾åº¦å¯ä»¥æ˜¯ä»»æ„ç²¾åº¦çš„ï¼Œåªä¸è¿‡åœ¨å®ç°çš„æ—¶å€™ç¼–è¯‘å™¨å¯èƒ½ä¼šé‡‡ç”¨æœ‰é™ç²¾åº¦ï¼Œæ¯”å¦‚256bitsï¼Œgospecé‡Œæ˜¯æœ‰å†™æ˜çš„ï¼šhttps://go.dev/ref/spec#:~:text=numeric%20constants%20have%20arbitrary%20precision%20in%20the%20language%2C%20a%20compiler%20may%20implement%20them%20using%20an%20internal%20representation%20with%20limited%20precisionã€‚
Source Analysis # References # https://blog.learngoprogramming.com/learn-golang-typed-untyped-constants-70b4df443b61</description></item><item><title>learn-go-with-tests</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Testing/learn-go-with-tests/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Testing/learn-go-with-tests/</guid><description>Let&amp;rsquo;s Summarize # é€šè¿‡æµ‹è¯•æ¥å­¦ä¹ goçš„ä½¿ç”¨ï¼ŒæŒæ¡tddæµ‹è¯•é©±åŠ¨å¼€å‘æ¨¡å¼ã€‚
tddéµå¾ªå¦‚ä¸‹å¼€å‘æ¨¡å¼ï¼š
write a test make the compiler pass run test, see that it fails and check the error message is meaningful write enough code to make the test pass refactor tddéµå¾ªä¸Šè¿°æµç¨‹çš„æ„ä¹‰ï¼š
write a failing test and see it failÂ so we know we have written aÂ relevantÂ test for our requirements and seen that it produces anÂ easy to understand description of the failure writing the smallest amount of code to make it pass so we know we have working software thenÂ refactor, backed with the safety of our tests to ensure we have well-crafted code that is easy to work with redã€greenã€refactorï¼š throughout this bookï¼Œ we have emphasised the tdd process of:</description></item><item><title>learn-go-with-tests</title><link>https://hitzhangjie.pro/go-internals-v2/posts/learn-go-with-tests/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/learn-go-with-tests/</guid><description>Let&amp;rsquo;s Summarize # é€šè¿‡æµ‹è¯•æ¥å­¦ä¹ goçš„ä½¿ç”¨ï¼ŒæŒæ¡tddæµ‹è¯•é©±åŠ¨å¼€å‘æ¨¡å¼ã€‚
tddéµå¾ªå¦‚ä¸‹å¼€å‘æ¨¡å¼ï¼š
write a test make the compiler pass run test, see that it fails and check the error message is meaningful write enough code to make the test pass refactor tddéµå¾ªä¸Šè¿°æµç¨‹çš„æ„ä¹‰ï¼š
write a failing test and see it failÂ so we know we have written aÂ relevantÂ test for our requirements and seen that it produces anÂ easy to understand description of the failure writing the smallest amount of code to make it pass so we know we have working software thenÂ refactor, backed with the safety of our tests to ensure we have well-crafted code that is easy to work with redã€greenã€refactorï¼š throughout this bookï¼Œ we have emphasised the tdd process of:</description></item><item><title>locks: sync.Mutex internals</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/locks-sync.Mutex-internals/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/locks-sync.Mutex-internals/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å†…å­˜å±éšœçš„ç±»å‹åŠç”±æ¥ï¼Œä»‹ç»äº†CASã€spinlockã€futexçš„å·¥ä½œåŸç†ï¼Œä»‹ç»äº†sync.Mutexçš„è®¾è®¡å®ç°åŠé’ˆå¯¹åç¨‹è°ƒåº¦æ–¹é¢çš„ä¸€äº›ä¼˜åŒ–æªæ–½ã€‚ç®—æ˜¯è®²æ¸…æ¥šäº†é”çš„æ¥é¾™å»è„‰äº†å§ã€‚
psï¼šåœ¨çº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šæ˜¾ç¤ºæ’å…¥å…¨å†…å­˜å±éšœï¼Œæ¥ä¿è¯çº¿ç¨‹åˆ‡æ¢å‰çš„å†™æ“ä½œå¯¹çº¿ç¨‹åˆ‡æ¢åçš„æ“ä½œå¯è§ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2021-04-17-locks%E5%AE%9E%E7%8E%B0%E9%82%A3%E4%BA%9B%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84%E6%95%85%E4%BA%8B/</description></item><item><title>locks: sync.Mutex internals</title><link>https://hitzhangjie.pro/go-internals-v2/posts/locks-sync.Mutex-internals/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/locks-sync.Mutex-internals/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å†…å­˜å±éšœçš„ç±»å‹åŠç”±æ¥ï¼Œä»‹ç»äº†CASã€spinlockã€futexçš„å·¥ä½œåŸç†ï¼Œä»‹ç»äº†sync.Mutexçš„è®¾è®¡å®ç°åŠé’ˆå¯¹åç¨‹è°ƒåº¦æ–¹é¢çš„ä¸€äº›ä¼˜åŒ–æªæ–½ã€‚ç®—æ˜¯è®²æ¸…æ¥šäº†é”çš„æ¥é¾™å»è„‰äº†å§ã€‚
psï¼šåœ¨çº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šæ˜¾ç¤ºæ’å…¥å…¨å†…å­˜å±éšœï¼Œæ¥ä¿è¯çº¿ç¨‹åˆ‡æ¢å‰çš„å†™æ“ä½œå¯¹çº¿ç¨‹åˆ‡æ¢åçš„æ“ä½œå¯è§ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2021-04-17-locks%E5%AE%9E%E7%8E%B0%E9%82%A3%E4%BA%9B%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84%E6%95%85%E4%BA%8B/</description></item><item><title>map design by code - part 1</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/map-design-by-code-part-1/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/map-design-by-code-part-1/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡ä»‹ç»äº†mapçš„å†…éƒ¨æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªæ¡¶8ä¸ªkvpairsï¼Œè¶…è¿‡äº†å¯ä»¥ç”¨æº¢å‡ºæ¡¶ï¼Œä½†æ˜¯æº¢å‡ºæ¡¶ä¼šé™ä½mapæ€§èƒ½ï¼Œæ‰€ä»¥ä¼šåˆ›å»ºæ–°çš„bucketå°†æ•°æ®è¿åˆ°æ–°bucketé‡Œé¢ã€‚/// ä¸€ä¸ªkvpairså­˜å‚¨åœ¨å“ªä¸ªbucketé‡Œé¢å‘¢ï¼Œé¦–å…ˆæ ¹æ®keyè®¡ç®—hashï¼Œç„¶åå¯¹bucketsæ•°é‡å–ä½™ï¼Œå†æ”¾åˆ°å¯¹åº”æ¡¶é‡Œé¢ï¼Œå¦‚æœæœ‰ç©ºä½ç½®å°±æ”¾å…¥ï¼Œæ²¡æœ‰å°±éœ€è¦èµ°å‰é¢æåˆ°çš„æº¢å‡ºæ¡¶çš„é€»è¾‘ã€‚/// æ ¹æ®keyè®¡ç®—å‡ºçš„hashé™¤äº†è®¡ç®—keyåˆ†å¸ƒåœ¨å“ªä¸ªæ¡¶ï¼Œè¿˜æœ‰å…¶ä»–ç”¨é€”ï¼Œæ¯ä¸ªæ¡¶é‡Œéƒ½æœ‰ä¸€ä¸ªtop hashæ„æˆçš„æ•°ç»„ï¼Œæ˜¯ä¸ºäº†mapè®¿é—®æ—¶åŠ å¿«æŸ¥è¯¢keyæ‰€åœ¨çš„æ•°ç»„ç´¢å¼•çš„ï¼Œé€šè¿‡å‡å°‘æ¯”è¾ƒkeyçš„è€—æ—¶æ¥åŠ é€Ÿè®¿é—®ã€‚/// è£…å¡«å› å­ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶mapè£…å¡«çš„å…ƒç´ æ•°é‡ï¼Œå³å…ƒç´ æ•°é‡é™¤ä»¥æ¡¶æ•°é‡ã€‚è£…å¡«å› å­è¿‡å°å®¹æ˜“æµªè´¹å†…å­˜ç©ºé—´ï¼Œè¿‡å¤§å®¹æ˜“å¼•å‘æ›´å¤šçš„ç¢°æ’å†²çªå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-map-design-by-example-part-i-3f78a064a352?source=---------45-----------------------</description></item><item><title>map design by code - part 1</title><link>https://hitzhangjie.pro/go-internals-v2/posts/map-design-by-code-part-1/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/map-design-by-code-part-1/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡ä»‹ç»äº†mapçš„å†…éƒ¨æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªæ¡¶8ä¸ªkvpairsï¼Œè¶…è¿‡äº†å¯ä»¥ç”¨æº¢å‡ºæ¡¶ï¼Œä½†æ˜¯æº¢å‡ºæ¡¶ä¼šé™ä½mapæ€§èƒ½ï¼Œæ‰€ä»¥ä¼šåˆ›å»ºæ–°çš„bucketå°†æ•°æ®è¿åˆ°æ–°bucketé‡Œé¢ã€‚/// ä¸€ä¸ªkvpairså­˜å‚¨åœ¨å“ªä¸ªbucketé‡Œé¢å‘¢ï¼Œé¦–å…ˆæ ¹æ®keyè®¡ç®—hashï¼Œç„¶åå¯¹bucketsæ•°é‡å–ä½™ï¼Œå†æ”¾åˆ°å¯¹åº”æ¡¶é‡Œé¢ï¼Œå¦‚æœæœ‰ç©ºä½ç½®å°±æ”¾å…¥ï¼Œæ²¡æœ‰å°±éœ€è¦èµ°å‰é¢æåˆ°çš„æº¢å‡ºæ¡¶çš„é€»è¾‘ã€‚/// æ ¹æ®keyè®¡ç®—å‡ºçš„hashé™¤äº†è®¡ç®—keyåˆ†å¸ƒåœ¨å“ªä¸ªæ¡¶ï¼Œè¿˜æœ‰å…¶ä»–ç”¨é€”ï¼Œæ¯ä¸ªæ¡¶é‡Œéƒ½æœ‰ä¸€ä¸ªtop hashæ„æˆçš„æ•°ç»„ï¼Œæ˜¯ä¸ºäº†mapè®¿é—®æ—¶åŠ å¿«æŸ¥è¯¢keyæ‰€åœ¨çš„æ•°ç»„ç´¢å¼•çš„ï¼Œé€šè¿‡å‡å°‘æ¯”è¾ƒkeyçš„è€—æ—¶æ¥åŠ é€Ÿè®¿é—®ã€‚/// è£…å¡«å› å­ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶mapè£…å¡«çš„å…ƒç´ æ•°é‡ï¼Œå³å…ƒç´ æ•°é‡é™¤ä»¥æ¡¶æ•°é‡ã€‚è£…å¡«å› å­è¿‡å°å®¹æ˜“æµªè´¹å†…å­˜ç©ºé—´ï¼Œè¿‡å¤§å®¹æ˜“å¼•å‘æ›´å¤šçš„ç¢°æ’å†²çªå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-map-design-by-example-part-i-3f78a064a352?source=---------45-----------------------</description></item><item><title>map design by code - part 2</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/map-design-by-code-part-2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/map-design-by-code-part-2/</guid><description>Let&amp;rsquo;s Summarize # mapaccess_faststr, mapaccess_fast64&amp;hellip;è®¿é—®mapä¸­å…ƒç´ æ—¶ï¼Œæ ¹æ®keyç±»å‹ä¸åŒç¼–è¯‘å™¨æ’å…¥ä¸åŒçš„å‡½æ•°è°ƒç”¨ï¼Œå‡½æ•°ååç¼€è¡¨ç¤ºkeyçš„ç±»å‹ï¼Œä¸ºä»€ä¹ˆæœ‰ä¸åŒçš„å‡½æ•°å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†æé«˜keyçš„hashè®¡ç®—æ•ˆç‡å’Œæ¯”è¾ƒæ•ˆç‡ã€‚/// mapæå‰åˆå§‹åŒ–å†èµ‹å€¼ï¼Œæ¯”lazyåˆå§‹åŒ–åå†èµ‹å€¼æ•ˆç‡é«˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿlazyåˆå§‹åŒ–æ¡¶æ˜¯åé¢åˆ›å»ºçš„æ›´èŠ±æ—¶é—´ã€‚ä½†æ˜¯lazyåˆå§‹åŒ–ç›¸æ¯”è¾ƒè€Œè¨€å®¹æ˜“èŠ‚çœå†…å­˜ã€‚/// mapä¸­kvpairsçš„å­˜å‚¨æœ‰è€ƒè™‘å†…å­˜å ç”¨æ–¹é¢çš„ä¼˜åŒ–ï¼Œkeyçš„ç±»å‹å’Œvalueçš„ç±»å‹å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥åœ¨æ•°æ®å¯¹é½è¿‡ç¨‹ä¸­paddingä¼šæµªè´¹ä¸å°‘å†…å­˜ï¼Œæ‰€ä»¥go mapä¸­çš„keyså’Œvaluesæ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå…ˆå­˜å‚¨keyså†å­˜å‚¨valuesã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-map-design-by-code-part-ii-50d111557c08</description></item><item><title>map design by code - part 2</title><link>https://hitzhangjie.pro/go-internals-v2/posts/map-design-by-code-part-2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/map-design-by-code-part-2/</guid><description>Let&amp;rsquo;s Summarize # mapaccess_faststr, mapaccess_fast64&amp;hellip;è®¿é—®mapä¸­å…ƒç´ æ—¶ï¼Œæ ¹æ®keyç±»å‹ä¸åŒç¼–è¯‘å™¨æ’å…¥ä¸åŒçš„å‡½æ•°è°ƒç”¨ï¼Œå‡½æ•°ååç¼€è¡¨ç¤ºkeyçš„ç±»å‹ï¼Œä¸ºä»€ä¹ˆæœ‰ä¸åŒçš„å‡½æ•°å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†æé«˜keyçš„hashè®¡ç®—æ•ˆç‡å’Œæ¯”è¾ƒæ•ˆç‡ã€‚/// mapæå‰åˆå§‹åŒ–å†èµ‹å€¼ï¼Œæ¯”lazyåˆå§‹åŒ–åå†èµ‹å€¼æ•ˆç‡é«˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿlazyåˆå§‹åŒ–æ¡¶æ˜¯åé¢åˆ›å»ºçš„æ›´èŠ±æ—¶é—´ã€‚ä½†æ˜¯lazyåˆå§‹åŒ–ç›¸æ¯”è¾ƒè€Œè¨€å®¹æ˜“èŠ‚çœå†…å­˜ã€‚/// mapä¸­kvpairsçš„å­˜å‚¨æœ‰è€ƒè™‘å†…å­˜å ç”¨æ–¹é¢çš„ä¼˜åŒ–ï¼Œkeyçš„ç±»å‹å’Œvalueçš„ç±»å‹å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥åœ¨æ•°æ®å¯¹é½è¿‡ç¨‹ä¸­paddingä¼šæµªè´¹ä¸å°‘å†…å­˜ï¼Œæ‰€ä»¥go mapä¸­çš„keyså’Œvaluesæ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå…ˆå­˜å‚¨keyså†å­˜å‚¨valuesã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-map-design-by-code-part-ii-50d111557c08</description></item><item><title>memory management and allocation</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/memory-management-and-allocation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/memory-management-and-allocation/</guid><description>Let&amp;rsquo;s Summarize # runtime.newobject åˆ†é…å†…å­˜å¯¹è±¡ï¼Œruntime.mallocgcç®¡ç†å †å†…å­˜ã€‚/// goä¸­å †å†…å­˜åˆ†é…åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œå°å¯¹è±¡å’Œå¤§å¯¹è±¡ã€‚/// å°å¯¹è±¡ï¼Œå°äº32KBï¼Œåˆ†é…æ—¶ä»å½“å‰Pçš„mcacheä¸­ç”³è¯·ï¼Œmcacheä¸­ç»´æŠ¤äº†å¾ˆå¤šå¤§å°ä¸åŒçš„mspanï¼ˆåˆåˆ†ä¸ºscanå’Œno scanï¼‰ï¼Œç”¨å®Œå†…å­˜åå›æ”¶ä¹Ÿä¸æ˜¯çœŸçš„å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯æ ‡è®°å¯¹åº”mspanæ²¡æœ‰ä½¿ç”¨ï¼Œåé¢å†è®¨è®ºå¦‚ä½•å›æ”¶å½’è¿˜ç»™æ“ä½œç³»ç»Ÿçš„é—®é¢˜ã€‚å¦‚æœmcacheä¸­å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œå°±ä»å…¨å±€å…±äº«çš„mcentralæ¥ç”³è¯·å¯¹åº”çš„ç©ºä½™mspanï¼Œå¦‚æœmcentralä¸­ä¹Ÿæ²¡æœ‰ç©ºä½™çš„äº†ï¼Œåˆ™é€šè¿‡mheapç”³è¯·å†…å­˜ï¼Œmheapæ˜¯å‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œä¸€æ¬¡ç”³è¯·ä¸€ä¸ªarenaï¼ˆ64ä½ç³»ç»Ÿä¸‹ç”³è¯·64MBï¼Œå…¶ä»–4MBï¼‰ï¼Œå¹¶å»ºç«‹pageså’Œmspanä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œç„¶åå°†å…¶ä¸­çš„mspanäº¤ç»™mcentralä½¿ç”¨ã€‚ç»å¤§å¤šæ•°æƒ…å†µå¯ä»¥é€šè¿‡P.mcacheè§£å†³ï¼Œå¹¶ä¸”æ˜¯æ— é”æ“ä½œï¼Œåˆ†é…æ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚mcacheä¸­çš„mspanå¤§å°ä»8B,16B,32Bâ€¦åˆ°æœ€å¤§32Kï¼Œä¸€å…±æœ‰70ä¸ªä¸åŒå°ºå¯¸çš„classï¼Œæ¯ä¸ªclasséƒ½å¯¹åº”ä¸€ä¸ªé“¾è¡¨ï¼Œé‡Œé¢mspanå¤§å°ç›¸åŒï¼Œå¹¶ä¸”åˆ†ä¸ºscanå’Œno scanä¸¤ä¸ªé“¾è¡¨ï¼Œç®€åŒ–äº†GCæ‰«æä»»åŠ¡ã€‚/// å¤§å†…å­˜å¯¹è±¡åˆ†é…ï¼Œè¶…è¿‡32KBï¼Œç›´æ¥åœ¨mheapä¸­åˆ†é…ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-management-and-allocation-a7396d430f44</description></item><item><title>memory management and allocation</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/memory-management-and-allocation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/memory-management-and-allocation/</guid><description>Let&amp;rsquo;s Summarize # runtime.newobject åˆ†é…å†…å­˜å¯¹è±¡ï¼Œruntime.mallocgcç®¡ç†å †å†…å­˜ã€‚/// goä¸­å †å†…å­˜åˆ†é…åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œå°å¯¹è±¡å’Œå¤§å¯¹è±¡ã€‚/// å°å¯¹è±¡ï¼Œå°äº32KBï¼Œåˆ†é…æ—¶ä»å½“å‰Pçš„mcacheä¸­ç”³è¯·ï¼Œmcacheä¸­ç»´æŠ¤äº†å¾ˆå¤šå¤§å°ä¸åŒçš„mspanï¼ˆåˆåˆ†ä¸ºscanå’Œno scanï¼‰ï¼Œç”¨å®Œå†…å­˜åå›æ”¶ä¹Ÿä¸æ˜¯çœŸçš„å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯æ ‡è®°å¯¹åº”mspanæ²¡æœ‰ä½¿ç”¨ï¼Œåé¢å†è®¨è®ºå¦‚ä½•å›æ”¶å½’è¿˜ç»™æ“ä½œç³»ç»Ÿçš„é—®é¢˜ã€‚å¦‚æœmcacheä¸­å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œå°±ä»å…¨å±€å…±äº«çš„mcentralæ¥ç”³è¯·å¯¹åº”çš„ç©ºä½™mspanï¼Œå¦‚æœmcentralä¸­ä¹Ÿæ²¡æœ‰ç©ºä½™çš„äº†ï¼Œåˆ™é€šè¿‡mheapç”³è¯·å†…å­˜ï¼Œmheapæ˜¯å‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œä¸€æ¬¡ç”³è¯·ä¸€ä¸ªarenaï¼ˆ64ä½ç³»ç»Ÿä¸‹ç”³è¯·64MBï¼Œå…¶ä»–4MBï¼‰ï¼Œå¹¶å»ºç«‹pageså’Œmspanä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œç„¶åå°†å…¶ä¸­çš„mspanäº¤ç»™mcentralä½¿ç”¨ã€‚ç»å¤§å¤šæ•°æƒ…å†µå¯ä»¥é€šè¿‡P.mcacheè§£å†³ï¼Œå¹¶ä¸”æ˜¯æ— é”æ“ä½œï¼Œåˆ†é…æ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚mcacheä¸­çš„mspanå¤§å°ä»8B,16B,32Bâ€¦åˆ°æœ€å¤§32Kï¼Œä¸€å…±æœ‰70ä¸ªä¸åŒå°ºå¯¸çš„classï¼Œæ¯ä¸ªclasséƒ½å¯¹åº”ä¸€ä¸ªé“¾è¡¨ï¼Œé‡Œé¢mspanå¤§å°ç›¸åŒï¼Œå¹¶ä¸”åˆ†ä¸ºscanå’Œno scanä¸¤ä¸ªé“¾è¡¨ï¼Œç®€åŒ–äº†GCæ‰«æä»»åŠ¡ã€‚/// å¤§å†…å­˜å¯¹è±¡åˆ†é…ï¼Œè¶…è¿‡32KBï¼Œç›´æ¥åœ¨mheapä¸­åˆ†é…ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-management-and-allocation-a7396d430f44</description></item><item><title>memory management and allocation</title><link>https://hitzhangjie.pro/go-internals-v2/posts/memory-management-and-allocation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/memory-management-and-allocation/</guid><description>Let&amp;rsquo;s Summarize # runtime.newobject åˆ†é…å†…å­˜å¯¹è±¡ï¼Œruntime.mallocgcç®¡ç†å †å†…å­˜ã€‚/// goä¸­å †å†…å­˜åˆ†é…åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œå°å¯¹è±¡å’Œå¤§å¯¹è±¡ã€‚/// å°å¯¹è±¡ï¼Œå°äº32KBï¼Œåˆ†é…æ—¶ä»å½“å‰Pçš„mcacheä¸­ç”³è¯·ï¼Œmcacheä¸­ç»´æŠ¤äº†å¾ˆå¤šå¤§å°ä¸åŒçš„mspanï¼ˆåˆåˆ†ä¸ºscanå’Œno scanï¼‰ï¼Œç”¨å®Œå†…å­˜åå›æ”¶ä¹Ÿä¸æ˜¯çœŸçš„å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯æ ‡è®°å¯¹åº”mspanæ²¡æœ‰ä½¿ç”¨ï¼Œåé¢å†è®¨è®ºå¦‚ä½•å›æ”¶å½’è¿˜ç»™æ“ä½œç³»ç»Ÿçš„é—®é¢˜ã€‚å¦‚æœmcacheä¸­å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œå°±ä»å…¨å±€å…±äº«çš„mcentralæ¥ç”³è¯·å¯¹åº”çš„ç©ºä½™mspanï¼Œå¦‚æœmcentralä¸­ä¹Ÿæ²¡æœ‰ç©ºä½™çš„äº†ï¼Œåˆ™é€šè¿‡mheapç”³è¯·å†…å­˜ï¼Œmheapæ˜¯å‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œä¸€æ¬¡ç”³è¯·ä¸€ä¸ªarenaï¼ˆ64ä½ç³»ç»Ÿä¸‹ç”³è¯·64MBï¼Œå…¶ä»–4MBï¼‰ï¼Œå¹¶å»ºç«‹pageså’Œmspanä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œç„¶åå°†å…¶ä¸­çš„mspanäº¤ç»™mcentralä½¿ç”¨ã€‚ç»å¤§å¤šæ•°æƒ…å†µå¯ä»¥é€šè¿‡P.mcacheè§£å†³ï¼Œå¹¶ä¸”æ˜¯æ— é”æ“ä½œï¼Œåˆ†é…æ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚mcacheä¸­çš„mspanå¤§å°ä»8B,16B,32Bâ€¦åˆ°æœ€å¤§32Kï¼Œä¸€å…±æœ‰70ä¸ªä¸åŒå°ºå¯¸çš„classï¼Œæ¯ä¸ªclasséƒ½å¯¹åº”ä¸€ä¸ªé“¾è¡¨ï¼Œé‡Œé¢mspanå¤§å°ç›¸åŒï¼Œå¹¶ä¸”åˆ†ä¸ºscanå’Œno scanä¸¤ä¸ªé“¾è¡¨ï¼Œç®€åŒ–äº†GCæ‰«æä»»åŠ¡ã€‚/// å¤§å†…å­˜å¯¹è±¡åˆ†é…ï¼Œè¶…è¿‡32KBï¼Œç›´æ¥åœ¨mheapä¸­åˆ†é…ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-management-and-allocation-a7396d430f44</description></item><item><title>memory management and memory sweep</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/memory-management-and-memory-sweep/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/memory-management-and-memory-sweep/</guid><description>Let&amp;rsquo;s Summarize # æœªè¢«å¼•ç”¨çš„å†…å­˜å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶åå¯ä»¥ç”¨äºåç»­åˆ†é…æ–°å¯¹è±¡ï¼Œåœ¨GCè¿‡ç¨‹ä¸­ï¼Œsweepé˜¶æ®µå°±æ˜¯å°†æ ‡è®°ä¸ºæœªä½¿ç”¨çš„å†…å­˜ç©ºé—´è¿›è¡Œæ¸…ç†ï¼Œæ¸…ç†åå¾—åˆ°çš„ç©ºé—²å†…å­˜å¯ä»¥ç”¨æ¥åˆ†é…æ–°çš„å†…å­˜å¯¹è±¡ã€‚/// goåœ¨åˆ†é…å¯¹è±¡æ‰€éœ€å†…å­˜ç©ºé—´æ—¶ï¼Œä¼šè¿›è¡Œå†…å­˜æ¸…é›¶æ“ä½œï¼Œå°†å¯¹åº”bitsæ¸…é›¶ä»¥é¿å…æ®‹ç•™åƒåœ¾å€¼ã€‚/// goå¦‚ä½•å¾—çŸ¥å“ªäº›å†…å­˜æœ‰ä½¿ç”¨å“ªäº›æ²¡æœ‰ä½¿ç”¨å‘¢ï¼Ÿgoåœ¨æ¯ä¸ªspanå†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªallocBitsï¼ŒgcmarkBitsï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ•°æ®ç»“æ„å®Œå…¨ä¸€æ ·ï¼Œå‰è€…è®°å½•å½“å‰mspanå†…å“ªäº›å†…å­˜è¢«åˆ†é…äº†ï¼Œåè€…GCè¿‡ç¨‹ä¸­è®°å½•å“ªäº›å†…å­˜è¢«å¼•ç”¨äº†ï¼Œmark terminationé˜¶æ®µæŠŠallocBitsæŒ‡å‘gcMarkBitså°±å®Œæˆäº†å†…å­˜çš„é‡Šæ”¾ï¼Œå¦™ä¸ï¼
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-management-and-memory-sweep-cc71b484de05</description></item><item><title>memory management and memory sweep</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/memory-management-and-memory-sweep/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/memory-management-and-memory-sweep/</guid><description>Let&amp;rsquo;s Summarize # æœªè¢«å¼•ç”¨çš„å†…å­˜å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶åå¯ä»¥ç”¨äºåç»­åˆ†é…æ–°å¯¹è±¡ï¼Œåœ¨GCè¿‡ç¨‹ä¸­ï¼Œsweepé˜¶æ®µå°±æ˜¯å°†æ ‡è®°ä¸ºæœªä½¿ç”¨çš„å†…å­˜ç©ºé—´è¿›è¡Œæ¸…ç†ï¼Œæ¸…ç†åå¾—åˆ°çš„ç©ºé—²å†…å­˜å¯ä»¥ç”¨æ¥åˆ†é…æ–°çš„å†…å­˜å¯¹è±¡ã€‚/// goåœ¨åˆ†é…å¯¹è±¡æ‰€éœ€å†…å­˜ç©ºé—´æ—¶ï¼Œä¼šè¿›è¡Œå†…å­˜æ¸…é›¶æ“ä½œï¼Œå°†å¯¹åº”bitsæ¸…é›¶ä»¥é¿å…æ®‹ç•™åƒåœ¾å€¼ã€‚/// goå¦‚ä½•å¾—çŸ¥å“ªäº›å†…å­˜æœ‰ä½¿ç”¨å“ªäº›æ²¡æœ‰ä½¿ç”¨å‘¢ï¼Ÿgoåœ¨æ¯ä¸ªspanå†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªallocBitsï¼ŒgcmarkBitsï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ•°æ®ç»“æ„å®Œå…¨ä¸€æ ·ï¼Œå‰è€…è®°å½•å½“å‰mspanå†…å“ªäº›å†…å­˜è¢«åˆ†é…äº†ï¼Œåè€…GCè¿‡ç¨‹ä¸­è®°å½•å“ªäº›å†…å­˜è¢«å¼•ç”¨äº†ï¼Œmark terminationé˜¶æ®µæŠŠallocBitsæŒ‡å‘gcMarkBitså°±å®Œæˆäº†å†…å­˜çš„é‡Šæ”¾ï¼Œå¦™ä¸ï¼
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-management-and-memory-sweep-cc71b484de05</description></item><item><title>memory management and memory sweep</title><link>https://hitzhangjie.pro/go-internals-v2/posts/memory-management-and-memory-sweep/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/memory-management-and-memory-sweep/</guid><description>Let&amp;rsquo;s Summarize # æœªè¢«å¼•ç”¨çš„å†…å­˜å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶åå¯ä»¥ç”¨äºåç»­åˆ†é…æ–°å¯¹è±¡ï¼Œåœ¨GCè¿‡ç¨‹ä¸­ï¼Œsweepé˜¶æ®µå°±æ˜¯å°†æ ‡è®°ä¸ºæœªä½¿ç”¨çš„å†…å­˜ç©ºé—´è¿›è¡Œæ¸…ç†ï¼Œæ¸…ç†åå¾—åˆ°çš„ç©ºé—²å†…å­˜å¯ä»¥ç”¨æ¥åˆ†é…æ–°çš„å†…å­˜å¯¹è±¡ã€‚/// goåœ¨åˆ†é…å¯¹è±¡æ‰€éœ€å†…å­˜ç©ºé—´æ—¶ï¼Œä¼šè¿›è¡Œå†…å­˜æ¸…é›¶æ“ä½œï¼Œå°†å¯¹åº”bitsæ¸…é›¶ä»¥é¿å…æ®‹ç•™åƒåœ¾å€¼ã€‚/// goå¦‚ä½•å¾—çŸ¥å“ªäº›å†…å­˜æœ‰ä½¿ç”¨å“ªäº›æ²¡æœ‰ä½¿ç”¨å‘¢ï¼Ÿgoåœ¨æ¯ä¸ªspanå†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªallocBitsï¼ŒgcmarkBitsï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ•°æ®ç»“æ„å®Œå…¨ä¸€æ ·ï¼Œå‰è€…è®°å½•å½“å‰mspanå†…å“ªäº›å†…å­˜è¢«åˆ†é…äº†ï¼Œåè€…GCè¿‡ç¨‹ä¸­è®°å½•å“ªäº›å†…å­˜è¢«å¼•ç”¨äº†ï¼Œmark terminationé˜¶æ®µæŠŠallocBitsæŒ‡å‘gcMarkBitså°±å®Œæˆäº†å†…å­˜çš„é‡Šæ”¾ï¼Œå¦™ä¸ï¼
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-management-and-memory-sweep-cc71b484de05</description></item><item><title>memory safety with bounds check</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/memory-safety-with-bounds-check/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/memory-safety-with-bounds-check/</guid><description>Let&amp;rsquo;s Summarize # ä¸ºäº†é˜»æ­¢è®¿é—®è¶Šç•Œç±»é—®é¢˜ï¼Œgoä¸­å¼•å…¥äº†bounds checkï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰é¡¹-gcflags=&amp;quot;-B&amp;quot;å…³é—­bounds checkï¼Œæ¥æŸ¥çœ‹ä¸‹è®¿é—®è¶Šç•Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¦ä¹ˆè®¿é—®åˆ°ä¸€äº›åƒåœ¾å€¼ï¼Œè¦ä¹ˆè§¦å‘æ®µé”™è¯¯å´©æºƒã€‚
ç®€å•åœ°è¯´å°±æ˜¯ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æ¶‰åŠsliceä½ç½®è®¿é—®çš„æ—¶å€™ï¼ˆå¦‚nums[100])çš„æ—¶å€™å®‰æ’ä¸€äº›æŒ‡ä»¤ï¼Œç”¨æ¥æ¯”è¾ƒç´¢å¼•ä½ç½®100å’Œcap(nums)çš„å…³ç³»ï¼Œå¦‚æœç´¢å¼•ä½ç½®ä¸åˆæ³•ï¼Œåˆ™ç›´æ¥è·³åˆ°panicIndexå‡½æ•°panicã€‚
å½“ç„¶ç¼–è¯‘å™¨æ›´èªæ˜ä¸€ç‚¹ï¼Œåœ¨ssaå¤šè½®passesä¸­å‡æœ‰ä¼˜åŒ–å¤„ç†ï¼Œå¦‚bceã€proveç­‰ï¼Œä¼šåšä¸€äº›ä¼˜åŒ–ï¼Œé¿å…æ— è„‘åœ°å®‰æ’è¾¹ç•Œæ£€æŸ¥æŒ‡ä»¤ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç»§ç»­æ·±ç©¶ä¸‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-safety-with-bounds-check-1397bef748b5</description></item><item><title>memory safety with bounds check</title><link>https://hitzhangjie.pro/go-internals-v2/posts/memory-safety-with-bounds-check/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/memory-safety-with-bounds-check/</guid><description>Let&amp;rsquo;s Summarize # ä¸ºäº†é˜»æ­¢è®¿é—®è¶Šç•Œç±»é—®é¢˜ï¼Œgoä¸­å¼•å…¥äº†bounds checkï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰é¡¹-gcflags=&amp;quot;-B&amp;quot;å…³é—­bounds checkï¼Œæ¥æŸ¥çœ‹ä¸‹è®¿é—®è¶Šç•Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¦ä¹ˆè®¿é—®åˆ°ä¸€äº›åƒåœ¾å€¼ï¼Œè¦ä¹ˆè§¦å‘æ®µé”™è¯¯å´©æºƒã€‚
ç®€å•åœ°è¯´å°±æ˜¯ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æ¶‰åŠsliceä½ç½®è®¿é—®çš„æ—¶å€™ï¼ˆå¦‚nums[100])çš„æ—¶å€™å®‰æ’ä¸€äº›æŒ‡ä»¤ï¼Œç”¨æ¥æ¯”è¾ƒç´¢å¼•ä½ç½®100å’Œcap(nums)çš„å…³ç³»ï¼Œå¦‚æœç´¢å¼•ä½ç½®ä¸åˆæ³•ï¼Œåˆ™ç›´æ¥è·³åˆ°panicIndexå‡½æ•°panicã€‚
å½“ç„¶ç¼–è¯‘å™¨æ›´èªæ˜ä¸€ç‚¹ï¼Œåœ¨ssaå¤šè½®passesä¸­å‡æœ‰ä¼˜åŒ–å¤„ç†ï¼Œå¦‚bceã€proveç­‰ï¼Œä¼šåšä¸€äº›ä¼˜åŒ–ï¼Œé¿å…æ— è„‘åœ°å®‰æ’è¾¹ç•Œæ£€æŸ¥æŒ‡ä»¤ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç»§ç»­æ·±ç©¶ä¸‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-memory-safety-with-bounds-check-1397bef748b5</description></item><item><title>monitor pattern</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Monitor/monitor-pattern/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Monitor/monitor-pattern/</guid><description>Let&amp;rsquo;s Summarize # ç›‘è§†å™¨æ¨¡å¼ï¼Œå¤§å®¶å¯èƒ½å¬è¯´è¿‡futuresæ¨¡å¼ï¼Œä½†æ˜¯ç›‘è§†å™¨æ¨¡å¼å¯èƒ½å¬çš„æ¯”è¾ƒå°‘ã€‚monitoræ¨¡å¼ã€futuresæ¨¡å¼éƒ½æ˜¯å¾ˆæ—©å°±å‡ºç°çš„å¹¶å‘å¤„ç†æ¨¡å¼ã€‚
æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é€šè¿‡sync.Condã€chanæ¥å®ç°ç›‘è§†å™¨æ¨¡å¼ã€‚sync.Condæœ‰å‡ ä¸ªé‡è¦æ“ä½œï¼šcond.Wait()è®©å½“å‰goroutineé˜»å¡åœ¨å½“å‰æ¡ä»¶å˜é‡ä¸Šï¼Œç­‰åç»­cond.Signal()å”¤é†’ï¼Œæˆ–è€…ç­‰åç»­cond.Broadcast()å¹¿æ’­å”¤é†’ã€‚
sync.Condç®—æ˜¯å¯è¯»æ€§æ¯”è¾ƒå¼ºçš„ä¸€ç§ç›‘è§†å™¨æ¨¡å¼ï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œæœ¬æ–‡ä¸­å°±ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯æš´éœ²äº†ä¸€ä¸ªé—®é¢˜ï¼šå¯èƒ½å¯¼è‡´getMany(3000)çš„goroutineè¿Ÿè¿Ÿè·å–ä¸åˆ°å¯¹åº”æ•°é‡çš„itemsï¼Œå³ä¾¿æ˜¯é¢‘ç¹è¢«å”¤é†’ï¼Œä¹Ÿå±äºspurious wakeupå¾ˆå¿«åˆè¦Waitè€Œé˜»å¡æ‰§è¡Œã€‚
è¿™é‡Œæš´éœ²çš„spurious wakeupé—®é¢˜ï¼Œåº”è¯¥å°½åŠ›å»é¿å…ä»¥æå‡æ€§èƒ½ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿbryan millsåœ¨å®ƒçš„åˆ†äº«â€œrethinking classical concurrency patternsâ€ä¸­ä»‹ç»äº†ä¸€ç§åŸºäºchanå®ç°çš„æ€è·¯ï¼šhttps://play.golang.org/p/rzSXpophC_pã€‚
æœ€åä»‹ç»äº†cond.Signal()ã€cond.Wait()èƒŒåçš„å®ç°ï¼šticket systemï¼Œè¿™éƒ¨åˆ†ç¿»ç¿»æºç å°±å¯ä»¥äº† TODO
Source Analysis # References # https://medium.com/a-journey-with-go/go-monitor-pattern-9decd26fb28</description></item><item><title>monitor pattern</title><link>https://hitzhangjie.pro/go-internals-v2/posts/monitor-pattern/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/monitor-pattern/</guid><description>Let&amp;rsquo;s Summarize # ç›‘è§†å™¨æ¨¡å¼ï¼Œå¤§å®¶å¯èƒ½å¬è¯´è¿‡futuresæ¨¡å¼ï¼Œä½†æ˜¯ç›‘è§†å™¨æ¨¡å¼å¯èƒ½å¬çš„æ¯”è¾ƒå°‘ã€‚monitoræ¨¡å¼ã€futuresæ¨¡å¼éƒ½æ˜¯å¾ˆæ—©å°±å‡ºç°çš„å¹¶å‘å¤„ç†æ¨¡å¼ã€‚
æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é€šè¿‡sync.Condã€chanæ¥å®ç°ç›‘è§†å™¨æ¨¡å¼ã€‚sync.Condæœ‰å‡ ä¸ªé‡è¦æ“ä½œï¼šcond.Wait()è®©å½“å‰goroutineé˜»å¡åœ¨å½“å‰æ¡ä»¶å˜é‡ä¸Šï¼Œç­‰åç»­cond.Signal()å”¤é†’ï¼Œæˆ–è€…ç­‰åç»­cond.Broadcast()å¹¿æ’­å”¤é†’ã€‚
sync.Condç®—æ˜¯å¯è¯»æ€§æ¯”è¾ƒå¼ºçš„ä¸€ç§ç›‘è§†å™¨æ¨¡å¼ï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œæœ¬æ–‡ä¸­å°±ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯æš´éœ²äº†ä¸€ä¸ªé—®é¢˜ï¼šå¯èƒ½å¯¼è‡´getMany(3000)çš„goroutineè¿Ÿè¿Ÿè·å–ä¸åˆ°å¯¹åº”æ•°é‡çš„itemsï¼Œå³ä¾¿æ˜¯é¢‘ç¹è¢«å”¤é†’ï¼Œä¹Ÿå±äºspurious wakeupå¾ˆå¿«åˆè¦Waitè€Œé˜»å¡æ‰§è¡Œã€‚
è¿™é‡Œæš´éœ²çš„spurious wakeupé—®é¢˜ï¼Œåº”è¯¥å°½åŠ›å»é¿å…ä»¥æå‡æ€§èƒ½ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿbryan millsåœ¨å®ƒçš„åˆ†äº«â€œrethinking classical concurrency patternsâ€ä¸­ä»‹ç»äº†ä¸€ç§åŸºäºchanå®ç°çš„æ€è·¯ï¼šhttps://play.golang.org/p/rzSXpophC_pã€‚
æœ€åä»‹ç»äº†cond.Signal()ã€cond.Wait()èƒŒåçš„å®ç°ï¼šticket systemï¼Œè¿™éƒ¨åˆ†ç¿»ç¿»æºç å°±å¯ä»¥äº† TODO
Source Analysis # References # https://medium.com/a-journey-with-go/go-monitor-pattern-9decd26fb28</description></item><item><title>mutex and starvation</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/mutex-and-starvation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/mutex-and-starvation/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†æ–°ç‰ˆæœ¬çš„goå¦‚ä½•ä¼˜åŒ–goroutineè·å–é”å¤±è´¥çš„é¥¿æ­»é—®é¢˜ã€‚
å…¶å®è¿™ä¸ªé—®é¢˜åœ¨æˆ‘çš„åšå®¢ä¸­æœ‰ååˆ†è¯¦ç»†çš„æè¿°ï¼Œé‡ç‚¹çœ‹sync.Mutexåç¨‹è°ƒåº¦ä¼˜åŒ–éƒ¨åˆ†ï¼šhttps://www.hitzhangjie.pro/blog/2021-04-17-locks%E5%AE%9E%E7%8E%B0%E9%82%A3%E4%BA%9B%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84%E6%95%85%E4%BA%8B/%E3%80%82
Source Analysis # References # https://medium.com/a-journey-with-go/go-mutex-and-starvation-3f4f4e75ad50</description></item><item><title>mutex and starvation</title><link>https://hitzhangjie.pro/go-internals-v2/posts/mutex-and-starvation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/mutex-and-starvation/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†æ–°ç‰ˆæœ¬çš„goå¦‚ä½•ä¼˜åŒ–goroutineè·å–é”å¤±è´¥çš„é¥¿æ­»é—®é¢˜ã€‚
å…¶å®è¿™ä¸ªé—®é¢˜åœ¨æˆ‘çš„åšå®¢ä¸­æœ‰ååˆ†è¯¦ç»†çš„æè¿°ï¼Œé‡ç‚¹çœ‹sync.Mutexåç¨‹è°ƒåº¦ä¼˜åŒ–éƒ¨åˆ†ï¼šhttps://www.hitzhangjie.pro/blog/2021-04-17-locks%E5%AE%9E%E7%8E%B0%E9%82%A3%E4%BA%9B%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84%E6%95%85%E4%BA%8B/%E3%80%82
Source Analysis # References # https://medium.com/a-journey-with-go/go-mutex-and-starvation-3f4f4e75ad50</description></item><item><title>object file &amp; relocations</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/object-file-relocations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/object-file-relocations/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¼–è¯‘è¿‡ç¨‹ä¸­ç¬¦å·é“¾æ¥çš„å¤§è‡´è¿‡ç¨‹ï¼š
ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šæŒ‰ç…§ç¼–è¯‘å•å…ƒè¿›è¡Œæ„å»ºï¼Œç”Ÿæˆä¸€ç³»åˆ—çš„*.oæ–‡ä»¶ï¼Œåœ¨å°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œé‡Œé¢æ¶‰åŠåˆ°ä¸€äº›ç¬¦å·çš„å¯é‡å®šä½æ“ä½œï¼› æ¯”å¦‚main.oä¸­æœ‰ä¾èµ–fmt.oï¼Œå…¶ä¸­æœ‰ä¸ªå‡½æ•°è°ƒç”¨fmt.Printlnï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°ä¸æ˜¯åœ¨main.oä¸­å®šä¹‰çš„ï¼Œç¼–è¯‘å™¨æ˜¯ä¸çŸ¥é“åˆ°åº•è¿™ä¸ªç¬¦å·åœ¨å“ªé‡Œçš„ï¼Œå°±éœ€è¦é“¾æ¥å™¨æ¥å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œå¹¶å°†æœ€ç»ˆå‡½æ•°è°ƒç”¨fmt.Printlnå¤„çš„ä½ç½®æ”¹æˆä¸€ä¸ªç›¸å¯¹åœ°å€ï¼Œä»¥ä½¿å¾—å‡½æ•°è°ƒç”¨å¾—ä»¥å®Œæˆï¼› é€šè¿‡go tool compile -S -l main.goå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†ä¸€ä¸ªmain.oæ–‡ä»¶ï¼Œé€šè¿‡go tool nm main.oå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„ä¸€äº›ç¬¦å·ä¿¡æ¯ï¼Œæœ‰äº›ç¬¦å·å‰é¢æœ‰ä¸ªå¤§å†™çš„Uï¼Œè¿™ç§è¡¨ç¤ºç¬¦å·æœªåœ¨å½“å‰ç¼–è¯‘å•å…ƒä¸­å®šä¹‰ï¼Œéœ€è¦é“¾æ¥å™¨åé¢é‡å®šä½ä¸€ä¸‹ã€‚
go tool linkå°±æ˜¯å®Œæˆé“¾æ¥è¿‡ç¨‹äº†ï¼Œæœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡objdump -dS mainå°±å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ±‡ç¼–ä¿¡æ¯ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°fmt.Printlnå‡½æ•°è°ƒç”¨å¤„å·²ç»æ›¿æ¢æˆäº†CALL+ç›¸å¯¹åœ°å€ã€‚ç›¸å¯¹åœ°å€çš„è®¡ç®—ä¹Ÿç®€å•ï¼šcallæŒ‡ä»¤åœ°å€+callæŒ‡ä»¤æœ¬èº«å­—èŠ‚æ•°-fmt.Printlnåœ°å€ã€‚
Source Analysis # ç¼–è¯‘å™¨ç”Ÿæˆçš„å¯¹è±¡æ–‡ä»¶æ ¼å¼ï¼Œæ˜¯goå›¢é˜Ÿæ ¹æ®plan9çš„ä¹ æƒ¯å®šä¹‰çš„å§ï¼Œå’Œæˆ‘ä»¬æ“ä½œç³»ç»Ÿå¹³å°æä¾›çš„*.oæ–‡ä»¶è¿˜ä¸ä¸€æ ·ï¼Œè¯¦ç»†çš„å¯ä»¥å‚è€ƒè¿™ä¸ªï¼šhttps://golang.org/pkg/cmd/internal/objabi/
References # https://medium.com/a-journey-with-go/go-object-file-relocations-804438ec379b</description></item><item><title>object file &amp; relocations</title><link>https://hitzhangjie.pro/go-internals-v2/posts/object-file-relocations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/object-file-relocations/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¼–è¯‘è¿‡ç¨‹ä¸­ç¬¦å·é“¾æ¥çš„å¤§è‡´è¿‡ç¨‹ï¼š
ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šæŒ‰ç…§ç¼–è¯‘å•å…ƒè¿›è¡Œæ„å»ºï¼Œç”Ÿæˆä¸€ç³»åˆ—çš„*.oæ–‡ä»¶ï¼Œåœ¨å°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œé‡Œé¢æ¶‰åŠåˆ°ä¸€äº›ç¬¦å·çš„å¯é‡å®šä½æ“ä½œï¼› æ¯”å¦‚main.oä¸­æœ‰ä¾èµ–fmt.oï¼Œå…¶ä¸­æœ‰ä¸ªå‡½æ•°è°ƒç”¨fmt.Printlnï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°ä¸æ˜¯åœ¨main.oä¸­å®šä¹‰çš„ï¼Œç¼–è¯‘å™¨æ˜¯ä¸çŸ¥é“åˆ°åº•è¿™ä¸ªç¬¦å·åœ¨å“ªé‡Œçš„ï¼Œå°±éœ€è¦é“¾æ¥å™¨æ¥å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œå¹¶å°†æœ€ç»ˆå‡½æ•°è°ƒç”¨fmt.Printlnå¤„çš„ä½ç½®æ”¹æˆä¸€ä¸ªç›¸å¯¹åœ°å€ï¼Œä»¥ä½¿å¾—å‡½æ•°è°ƒç”¨å¾—ä»¥å®Œæˆï¼› é€šè¿‡go tool compile -S -l main.goå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†ä¸€ä¸ªmain.oæ–‡ä»¶ï¼Œé€šè¿‡go tool nm main.oå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„ä¸€äº›ç¬¦å·ä¿¡æ¯ï¼Œæœ‰äº›ç¬¦å·å‰é¢æœ‰ä¸ªå¤§å†™çš„Uï¼Œè¿™ç§è¡¨ç¤ºç¬¦å·æœªåœ¨å½“å‰ç¼–è¯‘å•å…ƒä¸­å®šä¹‰ï¼Œéœ€è¦é“¾æ¥å™¨åé¢é‡å®šä½ä¸€ä¸‹ã€‚
go tool linkå°±æ˜¯å®Œæˆé“¾æ¥è¿‡ç¨‹äº†ï¼Œæœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡objdump -dS mainå°±å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ±‡ç¼–ä¿¡æ¯ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°fmt.Printlnå‡½æ•°è°ƒç”¨å¤„å·²ç»æ›¿æ¢æˆäº†CALL+ç›¸å¯¹åœ°å€ã€‚ç›¸å¯¹åœ°å€çš„è®¡ç®—ä¹Ÿç®€å•ï¼šcallæŒ‡ä»¤åœ°å€+callæŒ‡ä»¤æœ¬èº«å­—èŠ‚æ•°-fmt.Printlnåœ°å€ã€‚
Source Analysis # ç¼–è¯‘å™¨ç”Ÿæˆçš„å¯¹è±¡æ–‡ä»¶æ ¼å¼ï¼Œæ˜¯goå›¢é˜Ÿæ ¹æ®plan9çš„ä¹ æƒ¯å®šä¹‰çš„å§ï¼Œå’Œæˆ‘ä»¬æ“ä½œç³»ç»Ÿå¹³å°æä¾›çš„*.oæ–‡ä»¶è¿˜ä¸ä¸€æ ·ï¼Œè¯¦ç»†çš„å¯ä»¥å‚è€ƒè¿™ä¸ªï¼šhttps://golang.org/pkg/cmd/internal/objabi/
References # https://medium.com/a-journey-with-go/go-object-file-relocations-804438ec379b</description></item><item><title>observing stack grow and shrink</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/observing-stack-grow-and-shrink/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/observing-stack-grow-and-shrink/</guid><description>Let&amp;rsquo;s Summarize # è°ƒè¯•ã€è§‚å¯Ÿstackå¢é•¿ã€ç¼©å‡éœ€è¦æ‰“å¼€ä¸€ä¸ªå˜é‡runtime.stackDebugï¼Œéå¯¼å‡ºå˜é‡ï¼Œéœ€è¦ç›´æ¥ä¿®æ”¹goæºç ç¼–è¯‘å‡ºgoï¼Œç„¶åå†ç¼–è¯‘ç¨‹åºè¿›è¡Œè§‚æµ‹
Source Analysis # References # https://ops.tips/notes/go-observing-stack-grow-and-shrink/</description></item><item><title>observing stack grow and shrink</title><link>https://hitzhangjie.pro/go-internals-v2/posts/observing-stack-grow-and-shrink/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/observing-stack-grow-and-shrink/</guid><description>Let&amp;rsquo;s Summarize # è°ƒè¯•ã€è§‚å¯Ÿstackå¢é•¿ã€ç¼©å‡éœ€è¦æ‰“å¼€ä¸€ä¸ªå˜é‡runtime.stackDebugï¼Œéå¯¼å‡ºå˜é‡ï¼Œéœ€è¦ç›´æ¥ä¿®æ”¹goæºç ç¼–è¯‘å‡ºgoï¼Œç„¶åå†ç¼–è¯‘ç¨‹åºè¿›è¡Œè§‚æµ‹
Source Analysis # References # https://ops.tips/notes/go-observing-stack-grow-and-shrink/</description></item><item><title>ordering in select statements</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/chan/ordering-in-select-statements/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/chan/ordering-in-select-statements/</guid><description>Let&amp;rsquo;s Summarize # selectä¸­å…è®¸é€šè¿‡å¤šä¸ªcaseåˆ†æ”¯å¯¹å¤šä¸ªchanè¿›è¡Œsendã€recvæ“ä½œï¼Œå¦‚æœåŒæ—¶æœ‰å¤šä¸ªcaseåˆ†æ”¯æ»¡è¶³æ—¶ï¼Œåº”è¯¥é€‰æ‹©æ¿€æ´»å“ªä¸€ä¸ªåˆ†æ”¯å‘¢ï¼Ÿ
æ¯æ¬¡æ‰§è¡Œselect-caseæ“ä½œæ—¶ä¼šå…ˆå°†å¤šä¸ªcaseåˆ†æ”¯æ‰“ä¹±é¡ºåºï¼ˆshuffle)ï¼Œç„¶åå†é€ä¸ªæ£€æŸ¥å“ªä¸ªåˆ†æ”¯æ¡ä»¶æ»¡è¶³ã€‚æ³¨æ„ï¼Œselect-caseä¸æ”¯æŒå»é‡ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªcaseåˆ†æ”¯æ˜¯å¯¹chan ch1æ‰§è¡Œæ“ä½œï¼Œæœ‰9ä¸ªåˆ†æ”¯æ˜¯å¯¹chan ch2æ‰§è¡Œæ“ä½œï¼Œé‚£ä¹ˆch2ç›¸å…³çš„caseåˆ†æ”¯æ‰§è¡Œåˆ°çš„æ¦‚ç‡çº¦ä¸º90%ï¼Œè€Œä¸æ˜¯50%ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-ordering-in-select-statements-fd0ff80fd8d6</description></item><item><title>ordering in select statements</title><link>https://hitzhangjie.pro/go-internals-v2/posts/ordering-in-select-statements/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/ordering-in-select-statements/</guid><description>Let&amp;rsquo;s Summarize # selectä¸­å…è®¸é€šè¿‡å¤šä¸ªcaseåˆ†æ”¯å¯¹å¤šä¸ªchanè¿›è¡Œsendã€recvæ“ä½œï¼Œå¦‚æœåŒæ—¶æœ‰å¤šä¸ªcaseåˆ†æ”¯æ»¡è¶³æ—¶ï¼Œåº”è¯¥é€‰æ‹©æ¿€æ´»å“ªä¸€ä¸ªåˆ†æ”¯å‘¢ï¼Ÿ
æ¯æ¬¡æ‰§è¡Œselect-caseæ“ä½œæ—¶ä¼šå…ˆå°†å¤šä¸ªcaseåˆ†æ”¯æ‰“ä¹±é¡ºåºï¼ˆshuffle)ï¼Œç„¶åå†é€ä¸ªæ£€æŸ¥å“ªä¸ªåˆ†æ”¯æ¡ä»¶æ»¡è¶³ã€‚æ³¨æ„ï¼Œselect-caseä¸æ”¯æŒå»é‡ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªcaseåˆ†æ”¯æ˜¯å¯¹chan ch1æ‰§è¡Œæ“ä½œï¼Œæœ‰9ä¸ªåˆ†æ”¯æ˜¯å¯¹chan ch2æ‰§è¡Œæ“ä½œï¼Œé‚£ä¹ˆch2ç›¸å…³çš„caseåˆ†æ”¯æ‰§è¡Œåˆ°çš„æ¦‚ç‡çº¦ä¸º90%ï¼Œè€Œä¸æ˜¯50%ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-ordering-in-select-statements-fd0ff80fd8d6</description></item><item><title>overview of the compiler</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/overview-of-the-compiler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/overview-of-the-compiler/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¼–è¯‘å™¨çš„å¤§è‡´å·¥ä½œè¿‡ç¨‹ï¼Œfrontendã€backendï¼Œä»¥åŠå„è‡ªåŒ…å«çš„å“ªäº›é˜¶æ®µï¼Œä»‹ç»äº†å„ä¸ªé˜¶æ®µçš„å¤§è‡´å·¥ä½œæ•ˆæœï¼Œæ¯”å¦‚è¯æ³•åˆ†æè¾“å‡ºçš„æ•°æ®ï¼Œä»¥åŠssaé˜¶æ®µä¸åŒpassåšäº†å“ªäº›ä¼˜åŒ–ç­‰ï¼Œæœ€åç”Ÿæˆ*.oæ–‡ä»¶ï¼Œä¹ŸæåŠäº†é€šè¿‡go tool linkæ¥æœ€ç»ˆç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-overview-of-the-compiler-4e5a153ca889?source=---------8-----------------------</description></item><item><title>overview of the compiler</title><link>https://hitzhangjie.pro/go-internals-v2/posts/overview-of-the-compiler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/overview-of-the-compiler/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¼–è¯‘å™¨çš„å¤§è‡´å·¥ä½œè¿‡ç¨‹ï¼Œfrontendã€backendï¼Œä»¥åŠå„è‡ªåŒ…å«çš„å“ªäº›é˜¶æ®µï¼Œä»‹ç»äº†å„ä¸ªé˜¶æ®µçš„å¤§è‡´å·¥ä½œæ•ˆæœï¼Œæ¯”å¦‚è¯æ³•åˆ†æè¾“å‡ºçš„æ•°æ®ï¼Œä»¥åŠssaé˜¶æ®µä¸åŒpassåšäº†å“ªäº›ä¼˜åŒ–ç­‰ï¼Œæœ€åç”Ÿæˆ*.oæ–‡ä»¶ï¼Œä¹ŸæåŠäº†é€šè¿‡go tool linkæ¥æœ€ç»ˆç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-overview-of-the-compiler-4e5a153ca889?source=---------8-----------------------</description></item><item><title>playing with go module proxy</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Infrastructure/playing-with-go-module-proxy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Infrastructure/playing-with-go-module-proxy/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goproxyçš„å¤§è‡´å·¥ä½œåŸç†ï¼Œæ ¹æ®goproxy protocolçš„å®˜æ–¹è®¾è®¡è¯´æ˜ï¼Œåªè¦å®ç°go module queryå¿…è¦çš„é‚£äº›æ¥å£å°±å¯ä»¥ç®—ä½œæ˜¯å®ç°äº†goproxyã€‚ å…¶å®æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ç®€å•çš„goproxyï¼Œæœ‰ä¸¤ä¸ªåŠæ³•ï¼š1ï¼‰å› ä¸ºgoproxy protocolæ”¯æŒfile://ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†~/go/pkg/mod/cache/downloadè¿™ä¸ªè·¯å¾„è®¾ç½®ä¸ºGOPROXY=file:///Users//go/pkg/mod/cache/downloadï¼Œè¿™æ ·ä¹Ÿå¯ä»¥ã€‚2ï¼‰å¦ä¸€ç§æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥å¯åŠ¨ä¸€ä¸ªFileServerè¿”å›ä¸Šè¿°ç›®å½•ä¸­çš„ä¸œè¥¿ï¼Œç„¶åå°†GOPROXYæŒ‡å‘è¿™ä¸ªFileServerç›‘å¬åœ°å€ã€‚ è¦ç†è§£ä¸ºä»€ä¹ˆè¿™æ ·èƒ½å·¥ä½œï¼Œå…¶å®åªéœ€è¦çŸ¥é“go mod queryçš„è¿‡ç¨‹å³å¯ï¼Œå¤§è‡´åˆ†ä¸ºè¿™ä¹ˆå‡ æ­¥ï¼Œæ¯”å¦‚è¦æŸ¥è¯¢module github.com/a/b@versionè¿™ä¸ªç‰ˆæœ¬ï¼š
é¦–å…ˆæŸ¥è¯¢è¿™ä¸ªmoduleçš„ç‰ˆæœ¬çš„listè¯·æ±‚ï¼Œè·å–ç‰ˆæœ¬åˆ—è¡¨ï¼› ç„¶åæ ¹æ®è¯·æ±‚çš„ç‰ˆæœ¬ä»listç»“æœä¸­é€‰æ‹©ç‰ˆæœ¬ï¼Œç„¶åæŸ¥è¯¢infoè¯·æ±‚ï¼Œè·å¾—è¯¥ç‰ˆæœ¬çš„ä¿¡æ¯ï¼› ç„¶åæŸ¥è¯¢modè¯·æ±‚å¯èƒ½æ£€æŸ¥ä¸‹æœ‰æ²¡æœ‰æ›´æ–°ä¿¡æ¯ï¼› ç„¶åè¯·æ±‚ä¸‹è½½module-version.zipï¼Œè¿™é‡Œé¢åŒ…å«äº†goæ–‡ä»¶ï¼Œå°†æ¥ä¼šè§£å‹åˆ°~/go/pkg/mod/ä¸‹é¢ã€‚ Source Analysis # References # https://roberto.selbach.ca/go-proxies/</description></item><item><title>practical fuzzing with go</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Testing/practical-fuzzing-with-go/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Testing/practical-fuzzing-with-go/</guid><description>Let&amp;rsquo;s Summarize # fuzzing testï¼Œæ¨¡ç³Šæµ‹è¯•ï¼ŒæŒ‡çš„æ˜¯è‡ªåŠ¨æ„é€ ä¸€äº›æµ‹è¯•ç”¨ä¾‹æ¥è¿›è¡Œæµ‹è¯•ï¼Œæœ‰åŠ©äºèŠ‚çœç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶é—´ï¼Œæœ‰åŠ©äºå‘ç°ç¨‹åºä¸­å­˜åœ¨çš„ä¸€äº›ä¸å¥å£®çš„å¤„ç†é€»è¾‘ã€bugã€‚
goæ–°ç‰ˆæœ¬ä¹Ÿå°†å¼•å…¥fuzzing teståŠŸèƒ½ï¼Œåˆ°æ—¶å€™å¯ä»¥ç›´æ¥ç”¨ã€‚ç°é˜¶æ®µçš„è¯ï¼Œéœ€è¦å€ŸåŠ©ä¸€äº›ç¬¬ä¸‰æ–¹åº“æ¥é’ˆå¯¹å¾…æµ‹è¯•å‡½æ•°çš„å‚æ•°ç±»å‹æ¥è‡ªåŠ¨æ„é€ ç”¨ä¾‹ï¼Œæ¯”å¦‚æœ‰äº›åº“ä¹‹å¤„è‡ªåŠ¨å¡«å……structä¸­çš„å­—æ®µï¼Œç±»ä¼¼çš„åº“æœ‰ï¼š
https://github.com/bxcodec/faker https://github.com/brianvoe/gofakeit https://github.com/google/gofuzz Source Analysis # References # https://docs.google.com/presentation/d/1KkLrzc8O-dkBQ0itVWcqp3gZbtf_IM6MVfy84FndVlM/edit#slide=id.p</description></item><item><title>practical fuzzing with go</title><link>https://hitzhangjie.pro/go-internals-v2/posts/practical-fuzzing-with-go/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/practical-fuzzing-with-go/</guid><description>Let&amp;rsquo;s Summarize # fuzzing testï¼Œæ¨¡ç³Šæµ‹è¯•ï¼ŒæŒ‡çš„æ˜¯è‡ªåŠ¨æ„é€ ä¸€äº›æµ‹è¯•ç”¨ä¾‹æ¥è¿›è¡Œæµ‹è¯•ï¼Œæœ‰åŠ©äºèŠ‚çœç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶é—´ï¼Œæœ‰åŠ©äºå‘ç°ç¨‹åºä¸­å­˜åœ¨çš„ä¸€äº›ä¸å¥å£®çš„å¤„ç†é€»è¾‘ã€bugã€‚
goæ–°ç‰ˆæœ¬ä¹Ÿå°†å¼•å…¥fuzzing teståŠŸèƒ½ï¼Œåˆ°æ—¶å€™å¯ä»¥ç›´æ¥ç”¨ã€‚ç°é˜¶æ®µçš„è¯ï¼Œéœ€è¦å€ŸåŠ©ä¸€äº›ç¬¬ä¸‰æ–¹åº“æ¥é’ˆå¯¹å¾…æµ‹è¯•å‡½æ•°çš„å‚æ•°ç±»å‹æ¥è‡ªåŠ¨æ„é€ ç”¨ä¾‹ï¼Œæ¯”å¦‚æœ‰äº›åº“ä¹‹å¤„è‡ªåŠ¨å¡«å……structä¸­çš„å­—æ®µï¼Œç±»ä¼¼çš„åº“æœ‰ï¼š
https://github.com/bxcodec/faker https://github.com/brianvoe/gofakeit https://github.com/google/gofuzz Source Analysis # References # https://docs.google.com/presentation/d/1KkLrzc8O-dkBQ0itVWcqp3gZbtf_IM6MVfy84FndVlM/edit#slide=id.p</description></item><item><title>race detector with thread sanitizer</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/RaceDetection/race-detector-with-thread-sanitizer/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/RaceDetection/race-detector-with-thread-sanitizer/</guid><description>Let&amp;rsquo;s Summarize # è¿™ç¯‡æ–‡ç« åªå¤§è‡´æè¿°äº†å¦‚ä½•ä½¿ç”¨race detectorï¼ˆ-raceï¼‰ä»¥åŠå¤§è‡´çš„å®ç°åŸç†ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿå‚è€ƒäº†ä¸Šé¢Kavya Joshiçš„åˆ†äº«ï¼Œå¯ä»¥ç›´æ¥çœ‹ä¸Šé¢çš„è§†é¢‘æ¥è¯¦ç»†çš„äº†è§£race detectoræ˜¯å¦‚ä½•å®ç°çš„ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-race-detector-with-threadsanitizer-8e497f9e42db</description></item><item><title>race detector with thread sanitizer</title><link>https://hitzhangjie.pro/go-internals-v2/posts/race-detector-with-thread-sanitizer/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/race-detector-with-thread-sanitizer/</guid><description>Let&amp;rsquo;s Summarize # è¿™ç¯‡æ–‡ç« åªå¤§è‡´æè¿°äº†å¦‚ä½•ä½¿ç”¨race detectorï¼ˆ-raceï¼‰ä»¥åŠå¤§è‡´çš„å®ç°åŸç†ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿå‚è€ƒäº†ä¸Šé¢Kavya Joshiçš„åˆ†äº«ï¼Œå¯ä»¥ç›´æ¥çœ‹ä¸Šé¢çš„è§†é¢‘æ¥è¯¦ç»†çš„äº†è§£race detectoræ˜¯å¦‚ä½•å®ç°çš„ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-race-detector-with-threadsanitizer-8e497f9e42db</description></item><item><title>rethinking classical concurrency patterns</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Patterns/rethinking-classical-concurrency-patterns/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Patterns/rethinking-classical-concurrency-patterns/</guid><description>Let&amp;rsquo;s Summarize # We started with asynchronous patterns, which deal with goroutines. Then, we looked at condition variables, which sometimes deal with resources.
Now, let&amp;quot;s put them together. The Worker Pool is a pattern that treats a set of goroutines as resources.
Just a note on terminology: in other languages the pattern is usually called a â€œthread poolâ€, but in Go we&amp;quot;re working with goroutines, so we just call them workers.</description></item><item><title>rethinking classical concurrency patterns</title><link>https://hitzhangjie.pro/go-internals-v2/posts/rethinking-classical-concurrency-patterns/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/rethinking-classical-concurrency-patterns/</guid><description>Let&amp;rsquo;s Summarize # We started with asynchronous patterns, which deal with goroutines. Then, we looked at condition variables, which sometimes deal with resources.
Now, let&amp;quot;s put them together. The Worker Pool is a pattern that treats a set of goroutines as resources.
Just a note on terminology: in other languages the pattern is usually called a â€œthread poolâ€, but in Go we&amp;quot;re working with goroutines, so we just call them workers.</description></item><item><title>samples collection with pprof</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/PProf/samples-collection-with-pprof/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/PProf/samples-collection-with-pprof/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†pprofä¸­CPU profileçš„å·¥ä½œåŸç†ï¼Œå¤§è‡´è¿‡ç¨‹æ˜¯ï¼ŒæŒ‰ç…§ä¸€å®šçš„é‡‡æ ·é¢‘ç‡æ¥ç”ŸæˆSIGPROFä¿¡å·ï¼Œç”±gsignalåç¨‹æ¥æ”¶å¹¶æ‰§è¡Œå¤„ç†ï¼Œå¤„ç†é€»è¾‘å°±æ˜¯å»æ”¶é›†å¿…è¦çš„æ•°æ®å¹¶å†™å…¥ä¸€ä¸ªbufferï¼Œæœ€å¥½ç”ŸæˆæŠ¥è¡¨ã€‚
TODO å¤§è‡´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼Œç»†èŠ‚è¦çœ‹ä¸‹ä»£ç ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-samples-collection-with-pprof-2a63c3e8a142</description></item><item><title>samples collection with pprof</title><link>https://hitzhangjie.pro/go-internals-v2/posts/samples-collection-with-pprof/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/samples-collection-with-pprof/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†pprofä¸­CPU profileçš„å·¥ä½œåŸç†ï¼Œå¤§è‡´è¿‡ç¨‹æ˜¯ï¼ŒæŒ‰ç…§ä¸€å®šçš„é‡‡æ ·é¢‘ç‡æ¥ç”ŸæˆSIGPROFä¿¡å·ï¼Œç”±gsignalåç¨‹æ¥æ”¶å¹¶æ‰§è¡Œå¤„ç†ï¼Œå¤„ç†é€»è¾‘å°±æ˜¯å»æ”¶é›†å¿…è¦çš„æ•°æ®å¹¶å†™å…¥ä¸€ä¸ªbufferï¼Œæœ€å¥½ç”ŸæˆæŠ¥è¡¨ã€‚
TODO å¤§è‡´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼Œç»†èŠ‚è¦çœ‹ä¸‹ä»£ç ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-samples-collection-with-pprof-2a63c3e8a142</description></item><item><title>scheduling in go: part i - os scheduler</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-i-os-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-i-os-scheduler/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡æ˜¯è¿™ä¸ªæ–‡é›†ä¸­çš„ç¬¬ä¸€ç¯‡ï¼Œä»¥æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨ä¸ºä¾‹ï¼Œä»‹ç»äº†è°ƒåº¦è¿‡ç¨‹ä¸­æ¶‰åŠçš„ä¸€äº›å†…å®¹ï¼š
PCï¼šçº¿ç¨‹åˆ‡æ¢åå¦‚ä½•æ¢å¤ä¸‹ä¸€æ¡å¾…æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼› çº¿ç¨‹çŠ¶æ€ï¼šçº¿ç¨‹æ˜¯runningã€runnableã€waitingçŠ¶æ€çš„ï¼Œè°ƒåº¦å™¨å¯ä»¥è°ƒåº¦å“ªäº›çº¿ç¨‹ï¼Œå“ªäº›ä¸èƒ½ï¼› ä»»åŠ¡ç±»å‹ï¼šè®¡ç®—å¯†é›†å‹ã€IOå¯†é›†å‹ï¼Œé€šå¸¸åè€…æ‰ä¼šç‰µæ‰¯åˆ°ä»»åŠ¡è°ƒåº¦é—®é¢˜ï¼› ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿæœ‰åä½œå¼æˆ–è€…æŠ¢å å¼ä¹‹åˆ†ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æœ‰å¼€é”€çš„ï¼Œå¦‚çº¿ç¨‹åˆ‡æ¢ä¸€æ¬¡å¤§çº¦ä¸º1.4å¾®ç§’å·¦å³ï¼Œè¿™ç‚¹æ—¶é—´ç°ä»£å¤„ç†å™¨å¯ä»¥æ‰§è¡Œ1.2w~1.8wæ¡æŒ‡ä»¤ï¼Œå®é™…å€¼å¯èƒ½ä¼šæ›´é«˜ï¼› å¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Œè¿‡å¤šçš„çº¿ç¨‹ä¼šç»™çº¿ç¨‹è°ƒåº¦å¸¦æ¥å¼€é”€ï¼Œéœ€è¦æ ¹æ®å¤„ç†å™¨æ ¸æ•°ã€çº¿ç¨‹æ•°ã€å¤„ç†ä»»åŠ¡ä¹‹é—´å¯»æ‰¾ä¸€ä¸ªç›¸å¯¹åˆç†çš„å¹³è¡¡å€¼ï¼› cacheä¸€è‡´æ€§é—®é¢˜ï¼Œç°ä»£å¤„ç†å™¨å­˜å‚¨å±‚æ¬¡ä¸­å­˜åœ¨å¤šçº§cacheï¼Œå¤šçº¿ç¨‹ç¨‹åºéœ€è¦è€ƒè™‘cacheä¸€è‡´æ€§é—®é¢˜ã€‚cacheæœ¬èº«ä¼šæé«˜æ€§èƒ½ï¼Œå¤§ç‰›å¸‚å¦‚æœçº¿ç¨‹åˆ‡æ¢åˆ°ä¸åŒæ ¸æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¸¦æ¥cacheå¤±æ•ˆé—®é¢˜ï¼Œä¹Ÿä¼šå¼•å…¥å¼€é”€ï¼› è°ƒåº¦å†³ç­–ï¼Œå¦‚ä½•é€‰æ‹©ä¸‹ä¸€ä¸ªå¾…è°ƒåº¦çš„çº¿ç¨‹æ‰§è¡Œï¼› æœ¬æ–‡ç›¸å½“äºæ˜¯ä»æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„è§’åº¦å‡ºå‘ï¼Œå°†è°ƒåº¦å™¨è®¾è®¡å®ç°è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„ä¸€äº›ä¸»è¦é—®é¢˜éƒ½åšäº†æçº²æŒˆé¢†çš„ä¸€ä¸ªæ¦‚è¿°ï¼Œè¿™äº›é—®é¢˜è™½ç„¶æ˜¯å›´ç»•ç€çº¿ç¨‹æ¥è¯´çš„ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯å®ç°ä¸€ä¸ªä¼˜ç§€çš„åç¨‹è°ƒåº¦å™¨éœ€è¦è€ƒè™‘çš„ã€‚
è¿™ç¯‡æ–‡ç« å°†è¿™äº›ï¼Œéƒ½æ˜¯ä¸ºåæ–‡æ·±å…¥ä»‹ç»goè¿è¡Œæ—¶è°ƒåº¦å™¨åšé“ºå«çš„ã€‚
Source Analysis # References # https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part1.html</description></item><item><title>scheduling in go: part i - os scheduler</title><link>https://hitzhangjie.pro/go-internals-v2/posts/scheduling-in-go-part-i-os-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/scheduling-in-go-part-i-os-scheduler/</guid><description>Let&amp;rsquo;s Summarize # æœ¬æ–‡æ˜¯è¿™ä¸ªæ–‡é›†ä¸­çš„ç¬¬ä¸€ç¯‡ï¼Œä»¥æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨ä¸ºä¾‹ï¼Œä»‹ç»äº†è°ƒåº¦è¿‡ç¨‹ä¸­æ¶‰åŠçš„ä¸€äº›å†…å®¹ï¼š
PCï¼šçº¿ç¨‹åˆ‡æ¢åå¦‚ä½•æ¢å¤ä¸‹ä¸€æ¡å¾…æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼› çº¿ç¨‹çŠ¶æ€ï¼šçº¿ç¨‹æ˜¯runningã€runnableã€waitingçŠ¶æ€çš„ï¼Œè°ƒåº¦å™¨å¯ä»¥è°ƒåº¦å“ªäº›çº¿ç¨‹ï¼Œå“ªäº›ä¸èƒ½ï¼› ä»»åŠ¡ç±»å‹ï¼šè®¡ç®—å¯†é›†å‹ã€IOå¯†é›†å‹ï¼Œé€šå¸¸åè€…æ‰ä¼šç‰µæ‰¯åˆ°ä»»åŠ¡è°ƒåº¦é—®é¢˜ï¼› ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿæœ‰åä½œå¼æˆ–è€…æŠ¢å å¼ä¹‹åˆ†ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æœ‰å¼€é”€çš„ï¼Œå¦‚çº¿ç¨‹åˆ‡æ¢ä¸€æ¬¡å¤§çº¦ä¸º1.4å¾®ç§’å·¦å³ï¼Œè¿™ç‚¹æ—¶é—´ç°ä»£å¤„ç†å™¨å¯ä»¥æ‰§è¡Œ1.2w~1.8wæ¡æŒ‡ä»¤ï¼Œå®é™…å€¼å¯èƒ½ä¼šæ›´é«˜ï¼› å¤šå°‘ä¸ªçº¿ç¨‹åˆé€‚ï¼Œè¿‡å¤šçš„çº¿ç¨‹ä¼šç»™çº¿ç¨‹è°ƒåº¦å¸¦æ¥å¼€é”€ï¼Œéœ€è¦æ ¹æ®å¤„ç†å™¨æ ¸æ•°ã€çº¿ç¨‹æ•°ã€å¤„ç†ä»»åŠ¡ä¹‹é—´å¯»æ‰¾ä¸€ä¸ªç›¸å¯¹åˆç†çš„å¹³è¡¡å€¼ï¼› cacheä¸€è‡´æ€§é—®é¢˜ï¼Œç°ä»£å¤„ç†å™¨å­˜å‚¨å±‚æ¬¡ä¸­å­˜åœ¨å¤šçº§cacheï¼Œå¤šçº¿ç¨‹ç¨‹åºéœ€è¦è€ƒè™‘cacheä¸€è‡´æ€§é—®é¢˜ã€‚cacheæœ¬èº«ä¼šæé«˜æ€§èƒ½ï¼Œå¤§ç‰›å¸‚å¦‚æœçº¿ç¨‹åˆ‡æ¢åˆ°ä¸åŒæ ¸æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¸¦æ¥cacheå¤±æ•ˆé—®é¢˜ï¼Œä¹Ÿä¼šå¼•å…¥å¼€é”€ï¼› è°ƒåº¦å†³ç­–ï¼Œå¦‚ä½•é€‰æ‹©ä¸‹ä¸€ä¸ªå¾…è°ƒåº¦çš„çº¿ç¨‹æ‰§è¡Œï¼› æœ¬æ–‡ç›¸å½“äºæ˜¯ä»æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„è§’åº¦å‡ºå‘ï¼Œå°†è°ƒåº¦å™¨è®¾è®¡å®ç°è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„ä¸€äº›ä¸»è¦é—®é¢˜éƒ½åšäº†æçº²æŒˆé¢†çš„ä¸€ä¸ªæ¦‚è¿°ï¼Œè¿™äº›é—®é¢˜è™½ç„¶æ˜¯å›´ç»•ç€çº¿ç¨‹æ¥è¯´çš„ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯å®ç°ä¸€ä¸ªä¼˜ç§€çš„åç¨‹è°ƒåº¦å™¨éœ€è¦è€ƒè™‘çš„ã€‚
è¿™ç¯‡æ–‡ç« å°†è¿™äº›ï¼Œéƒ½æ˜¯ä¸ºåæ–‡æ·±å…¥ä»‹ç»goè¿è¡Œæ—¶è°ƒåº¦å™¨åšé“ºå«çš„ã€‚
Source Analysis # References # https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part1.html</description></item><item><title>scheduling in go: part ii - go scheduler</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-ii-go-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-ii-go-scheduler/</guid><description>Let&amp;rsquo;s Summarize # GMPè°ƒåº¦æ¨¡å‹ï¼ŒPä»£è¡¨äº†é€»è¾‘æ ¸çš„æ•°é‡ï¼Œæ¯”å¦‚Intelé…·ç¿i7å¤„ç†å™¨æ˜¯æ”¯æŒè¶…çº¿ç¨‹çš„ï¼Œä¸€ä¸ªè¶…çº¿ç¨‹å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè™šæ‹Ÿæ ¸ï¼Œgoè¿è¡Œæ—¶çœ‹åˆ°çš„æ ¸æ•°å®é™…æ˜¯è™šæ‹Ÿæ ¸çš„æ•°é‡ã€‚/// GMPè°ƒåº¦æ¨¡å‹å’Œæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨ç±»æ¯”ï¼Œåè€…æ˜¯å°†çº¿ç¨‹è°ƒåº¦åˆ°ä¸åŒçš„å¤„ç†å™¨æ ¸ä¸Šæ‰§è¡Œï¼Œå‰è€…æ˜¯å°†ä¸åŒçš„goroutinesè°ƒåº¦åˆ°ä¸åŒçš„çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚/// æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨æ˜¯æŠ¢å å¼è°ƒåº¦ï¼Œgoè¿è¡Œæ—¶è°ƒåº¦å™¨åœ¨ä»¥å‰ç‰ˆæœ¬ï¼ˆ1.14ä»¥å‰ï¼‰æ˜¯åä½œå¼è°ƒåº¦ï¼Œåé¢ä¹Ÿæ”¯æŒäº†æŠ¢å å¼è°ƒåº¦ã€‚/// goè°ƒåº¦å™¨ä»€ä¹ˆæ—¶å€™æ£€æŸ¥è¦ä¸è¦æ‰§è¡Œgoroutinesåˆ‡æ¢å‘¢ï¼Ÿæœ‰è¿™ä¹ˆå‡ ä¸ªæ—¶æœºï¼Œä½¿ç”¨go func(){}åˆ›å»ºæ–°çš„åç¨‹ï¼Œæ‰§è¡ŒGCï¼Œæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‰§è¡ŒåŒæ­¥æ“ä½œã€‚/// ä»‹ç»äº†ä¸Šè¿°å‡ ç§æƒ…å†µä¸‹çš„ä¸€äº›è°ƒåº¦ç»†èŠ‚ã€‚/// work stealingè°ƒåº¦å™¨å·¥ä½œæ–¹å¼ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨work sharingï¼Œåè€…éœ€è¦ç”¨æŠŠå…¨å±€é”æˆ–è€…å…¶ä»–åŒæ­¥æªæ–½æ¥åŒæ­¥ï¼Œæ˜¯æœ‰å¼€é”€çš„ï¼Œè€Œä¸”è¿˜æ¯”è¾ƒæ˜æ˜¾ï¼Œå¦å¤–å®¹æ˜“ç ´ågoroutinesçš„è°ƒåº¦ç²˜æ€§ï¼Œå½±å“æ‰§è¡Œæ•ˆç‡ã€‚
Source Analysis # References # https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part2.html</description></item><item><title>scheduling in go: part ii - go scheduler</title><link>https://hitzhangjie.pro/go-internals-v2/posts/scheduling-in-go-part-ii-go-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/scheduling-in-go-part-ii-go-scheduler/</guid><description>Let&amp;rsquo;s Summarize # GMPè°ƒåº¦æ¨¡å‹ï¼ŒPä»£è¡¨äº†é€»è¾‘æ ¸çš„æ•°é‡ï¼Œæ¯”å¦‚Intelé…·ç¿i7å¤„ç†å™¨æ˜¯æ”¯æŒè¶…çº¿ç¨‹çš„ï¼Œä¸€ä¸ªè¶…çº¿ç¨‹å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè™šæ‹Ÿæ ¸ï¼Œgoè¿è¡Œæ—¶çœ‹åˆ°çš„æ ¸æ•°å®é™…æ˜¯è™šæ‹Ÿæ ¸çš„æ•°é‡ã€‚/// GMPè°ƒåº¦æ¨¡å‹å’Œæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨ç±»æ¯”ï¼Œåè€…æ˜¯å°†çº¿ç¨‹è°ƒåº¦åˆ°ä¸åŒçš„å¤„ç†å™¨æ ¸ä¸Šæ‰§è¡Œï¼Œå‰è€…æ˜¯å°†ä¸åŒçš„goroutinesè°ƒåº¦åˆ°ä¸åŒçš„çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚/// æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨æ˜¯æŠ¢å å¼è°ƒåº¦ï¼Œgoè¿è¡Œæ—¶è°ƒåº¦å™¨åœ¨ä»¥å‰ç‰ˆæœ¬ï¼ˆ1.14ä»¥å‰ï¼‰æ˜¯åä½œå¼è°ƒåº¦ï¼Œåé¢ä¹Ÿæ”¯æŒäº†æŠ¢å å¼è°ƒåº¦ã€‚/// goè°ƒåº¦å™¨ä»€ä¹ˆæ—¶å€™æ£€æŸ¥è¦ä¸è¦æ‰§è¡Œgoroutinesåˆ‡æ¢å‘¢ï¼Ÿæœ‰è¿™ä¹ˆå‡ ä¸ªæ—¶æœºï¼Œä½¿ç”¨go func(){}åˆ›å»ºæ–°çš„åç¨‹ï¼Œæ‰§è¡ŒGCï¼Œæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‰§è¡ŒåŒæ­¥æ“ä½œã€‚/// ä»‹ç»äº†ä¸Šè¿°å‡ ç§æƒ…å†µä¸‹çš„ä¸€äº›è°ƒåº¦ç»†èŠ‚ã€‚/// work stealingè°ƒåº¦å™¨å·¥ä½œæ–¹å¼ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨work sharingï¼Œåè€…éœ€è¦ç”¨æŠŠå…¨å±€é”æˆ–è€…å…¶ä»–åŒæ­¥æªæ–½æ¥åŒæ­¥ï¼Œæ˜¯æœ‰å¼€é”€çš„ï¼Œè€Œä¸”è¿˜æ¯”è¾ƒæ˜æ˜¾ï¼Œå¦å¤–å®¹æ˜“ç ´ågoroutinesçš„è°ƒåº¦ç²˜æ€§ï¼Œå½±å“æ‰§è¡Œæ•ˆç‡ã€‚
Source Analysis # References # https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part2.html</description></item><item><title>scheduling in go: part iii - concurrency</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-iii-concurrency/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-iii-concurrency/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Œä»‹ç»äº†å·¥ä½œè´Ÿè½½ç±»å‹çš„å·®åˆ«ä»¥åŠé€‚åˆé‡‡ç”¨çš„æé«˜æ•ˆç‡çš„æ–¹å¼ï¼Œè®¡ç®—å¯†é›†å‹ï¼ˆCPU-boundï¼‰é€‚åˆé€šè¿‡å¹¶è¡Œè®¡ç®—æ¥æé«˜æ•ˆç‡ï¼ŒIOå¯†é›†å‹ï¼ˆIO-boundï¼‰é€‚åˆé€šè¿‡å¹¶å‘æ¥æé«˜è®¡ç®—æ•ˆç‡ã€‚
Source Analysis # References # https://www.ardanlabs.com/blog/2018/12/scheduling-in-go-part3.html</description></item><item><title>scheduling in go: part iii - concurrency</title><link>https://hitzhangjie.pro/go-internals-v2/posts/scheduling-in-go-part-iii-concurrency/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/scheduling-in-go-part-iii-concurrency/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Œä»‹ç»äº†å·¥ä½œè´Ÿè½½ç±»å‹çš„å·®åˆ«ä»¥åŠé€‚åˆé‡‡ç”¨çš„æé«˜æ•ˆç‡çš„æ–¹å¼ï¼Œè®¡ç®—å¯†é›†å‹ï¼ˆCPU-boundï¼‰é€‚åˆé€šè¿‡å¹¶è¡Œè®¡ç®—æ¥æé«˜æ•ˆç‡ï¼ŒIOå¯†é›†å‹ï¼ˆIO-boundï¼‰é€‚åˆé€šè¿‡å¹¶å‘æ¥æé«˜è®¡ç®—æ•ˆç‡ã€‚
Source Analysis # References # https://www.ardanlabs.com/blog/2018/12/scheduling-in-go-part3.html</description></item><item><title>should i use pointer instead of a copy of struct</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/should-i-use-pointer-instead-of-a-copy-of-struct/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/should-i-use-pointer-instead-of-a-copy-of-struct/</guid><description>Let&amp;rsquo;s Summarize # ä»€ä¹ˆæ—¶å€™ä½¿ç”¨pointerï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨value copyï¼Ÿ
å¦‚æœæ¶‰åŠå¯†é›†çš„æ•°æ®åˆ†é…ï¼Œé€‚åˆç”¨value copyè€ŒéæŒ‡é’ˆï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¼•å…¥çš„GCå¼€é”€ï¼› è€Œå¦‚æœæ˜¯æ¶‰åŠå¯†é›†çš„å‡½æ•°è°ƒç”¨ï¼Œä¼ å‚çš„æ—¶å€™é€‚åˆç”¨æŒ‡é’ˆï¼Œå¯ä»¥å‡å°‘å€¼æ‹·è´å¸¦æ¥çš„å¼€é”€ï¼› æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨æ¶‰åŠè‡ªåŠ¨å†…å­˜ç®¡ç†çš„è¯­è¨€ä¸­ï¼Œä½¿ç”¨æŒ‡é’ˆä»£æ›¿å€¼æ‹·è´æ¥æå‡æ€§èƒ½çš„æƒ³æ³•å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå¦‚æœæ¶‰åŠçš„å†…å­˜å¯¹è±¡é€ƒé€¸åˆ°äº†heapå°±ä¼šåŠ é‡GCå¼€é”€ï¼Œå¦‚æœä½œä¸ºå‡½æ•°å‚æ•°çš„è¯ï¼Œä¸€èˆ¬ä¸æ¶‰åŠé€ƒé€¸çš„æƒ…å†µï¼Œä½¿ç”¨æŒ‡é’ˆåˆ™å¯ä»¥å‡å°‘å€¼æ‹·è´å¸¦æ¥çš„å¼€é”€ï¼Œå½“ç„¶è¿™é‡Œè®¨è®ºçš„å¯¹è±¡æ˜¯äº›ç»“æ„ä½“ä¹‹ç±»ç›¸å¯¹è¾ƒå¤§çš„æ•°æ®ç±»å‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-should-i-use-a-pointer-instead-of-a-copy-of-my-struct-44b43b104963</description></item><item><title>should i use pointer instead of a copy of struct</title><link>https://hitzhangjie.pro/go-internals-v2/posts/should-i-use-pointer-instead-of-a-copy-of-struct/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/should-i-use-pointer-instead-of-a-copy-of-struct/</guid><description>Let&amp;rsquo;s Summarize # ä»€ä¹ˆæ—¶å€™ä½¿ç”¨pointerï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨value copyï¼Ÿ
å¦‚æœæ¶‰åŠå¯†é›†çš„æ•°æ®åˆ†é…ï¼Œé€‚åˆç”¨value copyè€ŒéæŒ‡é’ˆï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¼•å…¥çš„GCå¼€é”€ï¼› è€Œå¦‚æœæ˜¯æ¶‰åŠå¯†é›†çš„å‡½æ•°è°ƒç”¨ï¼Œä¼ å‚çš„æ—¶å€™é€‚åˆç”¨æŒ‡é’ˆï¼Œå¯ä»¥å‡å°‘å€¼æ‹·è´å¸¦æ¥çš„å¼€é”€ï¼› æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨æ¶‰åŠè‡ªåŠ¨å†…å­˜ç®¡ç†çš„è¯­è¨€ä¸­ï¼Œä½¿ç”¨æŒ‡é’ˆä»£æ›¿å€¼æ‹·è´æ¥æå‡æ€§èƒ½çš„æƒ³æ³•å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå¦‚æœæ¶‰åŠçš„å†…å­˜å¯¹è±¡é€ƒé€¸åˆ°äº†heapå°±ä¼šåŠ é‡GCå¼€é”€ï¼Œå¦‚æœä½œä¸ºå‡½æ•°å‚æ•°çš„è¯ï¼Œä¸€èˆ¬ä¸æ¶‰åŠé€ƒé€¸çš„æƒ…å†µï¼Œä½¿ç”¨æŒ‡é’ˆåˆ™å¯ä»¥å‡å°‘å€¼æ‹·è´å¸¦æ¥çš„å¼€é”€ï¼Œå½“ç„¶è¿™é‡Œè®¨è®ºçš„å¯¹è±¡æ˜¯äº›ç»“æ„ä½“ä¹‹ç±»ç›¸å¯¹è¾ƒå¤§çš„æ•°æ®ç±»å‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-should-i-use-a-pointer-instead-of-a-copy-of-my-struct-44b43b104963</description></item><item><title>slice and memory management</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/slice-and-memory-management/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/slice-and-memory-management/</guid><description>Let&amp;rsquo;s Summarize # sliceå…¶ç»“æ„ç”¨slice headeræ¥è¡¨ç¤ºï¼ŒåŒ…å«dataã€lenã€cap 3ä¸ªå­—æ®µï¼Œè¿™ä¸ªå¾ˆå¤šæ–‡ç« æè¿‡äº†ï¼Œç°åœ¨æä¸‹sliceæ“ä½œä¸­å¯¹å†…å­˜æ“ä½œæ–¹é¢çš„ä¸€ç‚¹ä¼˜åŒ–ï¼š
Copyï¼šå¦‚æœè¦åˆ é™¤slice numsä¸­ç´¢å¼•ä½ç½®xä¸­çš„å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡copy([x:],[x+1:])ï¼Œç„¶åx=[x:len(x)-1]æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡x = append(x[:x],[x+1:])æ¥å®Œæˆï¼Œè¿™é‡Œä¼šæ¶‰åŠåˆ°ä¸ªåˆ«ç´¢å¼•ä½ç½®overlapçš„é—®é¢˜ï¼Œç¼–è¯‘å™¨ä¼šè½¬æ¢æˆä½¿ç”¨runtime.memmoveæ¥å¤„ç†ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè§£å†³overlapçš„æƒ…å†µï¼Œæ¯”å¦‚ä»å¤´æ‹·è´ä¼šè¦†ç›–çš„è¯å°±ç”¨ä»åé¢æ‹·è´æ¥è§£å†³ï¼Œå®ç°ç¨å¤æ‚ï¼› Resetï¼šæœ‰æ—¶ä¸€ä¸ªsliceè¢«å¤ç”¨ï¼Œå¤ç”¨ä¹‹å‰å¸Œæœ›æ¸…ç©ºå®ƒï¼Œå¯ä»¥å†™ä¸€ä¸ªforå¾ªç¯æŠŠå¯¹åº”å…ƒç´ å…¨éƒ¨æ¸…0ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼Œç¼–è¯‘å™¨1.5ä¹‹åä¼šè¯†åˆ«æ­¤ç±»ä»£ç å¹¶å°†å…¶è½¬æ¢ä¸ºruntime.memclr*å‡½æ•°ï¼Œè¿™ä¸ªæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œåº”è¯¥æ˜¯ç±»ä¼¼äºmemsetä¹‹ç±»çš„å§ã€‚ Allocate &amp;amp; Copyï¼šå…¶å®æ–°åˆ›å»ºå®Œä¸€ä¸ªsliceæ—¶éƒ½ä¼šæ¸…0ä¹Ÿæ˜¯ç”¨çš„memclr*å‡½æ•°ã€‚å¦‚æœæ˜¯æ–°åˆ›å»ºå®Œ(make)ä¹‹åç«‹å³è·Ÿç€ä¸€ä¸ªcopyè¯­å¥æ€ä¹ˆåŠï¼Œé‚£ä¹ˆæ¸…é›¶å°±æœ‰ç‚¹å¤šä½™äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè¯†åˆ«è¿™ç§æƒ…å†µï¼Œè¿™ç§å°±ä¸æ¸…é›¶äº†ã€‚ goç¼–è¯‘å™¨ä¸€ç›´åœ¨æ¼”è¿›ï¼Œè®©è¿™é—¨è¯­è¨€å˜å¾—æ›´åŠ &amp;quot;èªæ˜&amp;quot;ï¼
Source Analysis # References # https://medium.com/a-journey-with-go/go-slice-and-memory-management-670498bb52be?source=---------4-----------------------</description></item><item><title>slice and memory management</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/slice-and-memory-management/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/slice-and-memory-management/</guid><description>Let&amp;rsquo;s Summarize # sliceå…¶ç»“æ„ç”¨slice headeræ¥è¡¨ç¤ºï¼ŒåŒ…å«dataã€lenã€cap 3ä¸ªå­—æ®µï¼Œè¿™ä¸ªå¾ˆå¤šæ–‡ç« æè¿‡äº†ï¼Œç°åœ¨æä¸‹sliceæ“ä½œä¸­å¯¹å†…å­˜æ“ä½œæ–¹é¢çš„ä¸€ç‚¹ä¼˜åŒ–ï¼š
Copyï¼šå¦‚æœè¦åˆ é™¤slice numsä¸­ç´¢å¼•ä½ç½®xä¸­çš„å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡copy([x:],[x+1:])ï¼Œç„¶åx=[x:len(x)-1]æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡x = append(x[:x],[x+1:])æ¥å®Œæˆï¼Œè¿™é‡Œä¼šæ¶‰åŠåˆ°ä¸ªåˆ«ç´¢å¼•ä½ç½®overlapçš„é—®é¢˜ï¼Œç¼–è¯‘å™¨ä¼šè½¬æ¢æˆä½¿ç”¨runtime.memmoveæ¥å¤„ç†ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè§£å†³overlapçš„æƒ…å†µï¼Œæ¯”å¦‚ä»å¤´æ‹·è´ä¼šè¦†ç›–çš„è¯å°±ç”¨ä»åé¢æ‹·è´æ¥è§£å†³ï¼Œå®ç°ç¨å¤æ‚ï¼› Resetï¼šæœ‰æ—¶ä¸€ä¸ªsliceè¢«å¤ç”¨ï¼Œå¤ç”¨ä¹‹å‰å¸Œæœ›æ¸…ç©ºå®ƒï¼Œå¯ä»¥å†™ä¸€ä¸ªforå¾ªç¯æŠŠå¯¹åº”å…ƒç´ å…¨éƒ¨æ¸…0ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼Œç¼–è¯‘å™¨1.5ä¹‹åä¼šè¯†åˆ«æ­¤ç±»ä»£ç å¹¶å°†å…¶è½¬æ¢ä¸ºruntime.memclr*å‡½æ•°ï¼Œè¿™ä¸ªæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œåº”è¯¥æ˜¯ç±»ä¼¼äºmemsetä¹‹ç±»çš„å§ã€‚ Allocate &amp;amp; Copyï¼šå…¶å®æ–°åˆ›å»ºå®Œä¸€ä¸ªsliceæ—¶éƒ½ä¼šæ¸…0ä¹Ÿæ˜¯ç”¨çš„memclr*å‡½æ•°ã€‚å¦‚æœæ˜¯æ–°åˆ›å»ºå®Œ(make)ä¹‹åç«‹å³è·Ÿç€ä¸€ä¸ªcopyè¯­å¥æ€ä¹ˆåŠï¼Œé‚£ä¹ˆæ¸…é›¶å°±æœ‰ç‚¹å¤šä½™äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè¯†åˆ«è¿™ç§æƒ…å†µï¼Œè¿™ç§å°±ä¸æ¸…é›¶äº†ã€‚ goç¼–è¯‘å™¨ä¸€ç›´åœ¨æ¼”è¿›ï¼Œè®©è¿™é—¨è¯­è¨€å˜å¾—æ›´åŠ &amp;quot;èªæ˜&amp;quot;ï¼
Source Analysis # References # https://medium.com/a-journey-with-go/go-slice-and-memory-management-670498bb52be?source=---------4-----------------------</description></item><item><title>slice and memory management</title><link>https://hitzhangjie.pro/go-internals-v2/posts/slice-and-memory-management/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/slice-and-memory-management/</guid><description>Let&amp;rsquo;s Summarize # sliceå…¶ç»“æ„ç”¨slice headeræ¥è¡¨ç¤ºï¼ŒåŒ…å«dataã€lenã€cap 3ä¸ªå­—æ®µï¼Œè¿™ä¸ªå¾ˆå¤šæ–‡ç« æè¿‡äº†ï¼Œç°åœ¨æä¸‹sliceæ“ä½œä¸­å¯¹å†…å­˜æ“ä½œæ–¹é¢çš„ä¸€ç‚¹ä¼˜åŒ–ï¼š
Copyï¼šå¦‚æœè¦åˆ é™¤slice numsä¸­ç´¢å¼•ä½ç½®xä¸­çš„å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡copy([x:],[x+1:])ï¼Œç„¶åx=[x:len(x)-1]æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡x = append(x[:x],[x+1:])æ¥å®Œæˆï¼Œè¿™é‡Œä¼šæ¶‰åŠåˆ°ä¸ªåˆ«ç´¢å¼•ä½ç½®overlapçš„é—®é¢˜ï¼Œç¼–è¯‘å™¨ä¼šè½¬æ¢æˆä½¿ç”¨runtime.memmoveæ¥å¤„ç†ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè§£å†³overlapçš„æƒ…å†µï¼Œæ¯”å¦‚ä»å¤´æ‹·è´ä¼šè¦†ç›–çš„è¯å°±ç”¨ä»åé¢æ‹·è´æ¥è§£å†³ï¼Œå®ç°ç¨å¤æ‚ï¼› Resetï¼šæœ‰æ—¶ä¸€ä¸ªsliceè¢«å¤ç”¨ï¼Œå¤ç”¨ä¹‹å‰å¸Œæœ›æ¸…ç©ºå®ƒï¼Œå¯ä»¥å†™ä¸€ä¸ªforå¾ªç¯æŠŠå¯¹åº”å…ƒç´ å…¨éƒ¨æ¸…0ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼Œç¼–è¯‘å™¨1.5ä¹‹åä¼šè¯†åˆ«æ­¤ç±»ä»£ç å¹¶å°†å…¶è½¬æ¢ä¸ºruntime.memclr*å‡½æ•°ï¼Œè¿™ä¸ªæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œåº”è¯¥æ˜¯ç±»ä¼¼äºmemsetä¹‹ç±»çš„å§ã€‚ Allocate &amp;amp; Copyï¼šå…¶å®æ–°åˆ›å»ºå®Œä¸€ä¸ªsliceæ—¶éƒ½ä¼šæ¸…0ä¹Ÿæ˜¯ç”¨çš„memclr*å‡½æ•°ã€‚å¦‚æœæ˜¯æ–°åˆ›å»ºå®Œ(make)ä¹‹åç«‹å³è·Ÿç€ä¸€ä¸ªcopyè¯­å¥æ€ä¹ˆåŠï¼Œé‚£ä¹ˆæ¸…é›¶å°±æœ‰ç‚¹å¤šä½™äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè¯†åˆ«è¿™ç§æƒ…å†µï¼Œè¿™ç§å°±ä¸æ¸…é›¶äº†ã€‚ goç¼–è¯‘å™¨ä¸€ç›´åœ¨æ¼”è¿›ï¼Œè®©è¿™é—¨è¯­è¨€å˜å¾—æ›´åŠ &amp;quot;èªæ˜&amp;quot;ï¼
Source Analysis # References # https://medium.com/a-journey-with-go/go-slice-and-memory-management-670498bb52be?source=---------4-----------------------</description></item><item><title>string &amp; conversion optimization</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/string/string-conversion-optimization/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/string/string-conversion-optimization/</guid><description>Let&amp;rsquo;s Summarize # b := genBytes() []byte { return []byte{&amp;ldquo;a&amp;rdquo;,&amp;ldquo;b&amp;rdquo;} }
switch string(b) { &amp;hellip; }ï¼šè¿™é‡Œçš„string(b)åšäº†ä¼˜åŒ–ä¸ä¼šæ‰§è¡Œæ‹·è´ï¼Œç›´æ¥ç”¨äº†åŸæ¥bçš„åº•å±‚æ•°ç»„åšä¸ºstringçš„åº•å±‚æ•°ç»„ï¼›
è®¿é—®mapå…ƒç´ æ—¶ï¼šm := map[string]int{}, m[string(b)] è¿™é‡Œçš„keyå¯¹åº”çš„stringåº•å±‚æ•°ç»„ä¹Ÿæ˜¯ç›´æ¥ç”¨çš„bçš„åº•å±‚æ•°ç»„ï¼›
å­—ç¬¦ä¸²è¿æ¥æ—¶ï¼šprintln(&amp;quot;(&amp;quot;+string(b)+&amp;quot;)&amp;quot;)ï¼Œè¿™å­—ç¬¦ä¸²è¿æ¥ç»“æœè‚¯å®šè¦åˆ†é…æ–°ç©ºé—´ï¼Œä½†æ˜¯string(b)è‡ªå·±æ˜¯æ²¡æœ‰å†åˆ†é…æ–°ç©ºé—´çš„ï¼›
å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ï¼šè¿™ç§æƒ…å†µå’Œswitchæ—¶çš„æ¯”è¾ƒç±»ä¼¼ï¼Œå…ˆæ¯”è¾ƒstringé•¿åº¦ï¼Œå†æ¯”è¾ƒåº•å±‚bytesæ•°ç»„é•¿åº¦ï¼Œå†æ¯”è¾ƒstringå†…å®¹æœ¬èº«ï¼›
Source Analysis # References # https://medium.com/a-journey-with-go/go-string-conversion-optimization-767b019b75ef</description></item><item><title>string &amp; conversion optimization</title><link>https://hitzhangjie.pro/go-internals-v2/posts/string-conversion-optimization/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/string-conversion-optimization/</guid><description>Let&amp;rsquo;s Summarize # b := genBytes() []byte { return []byte{&amp;ldquo;a&amp;rdquo;,&amp;ldquo;b&amp;rdquo;} }
switch string(b) { &amp;hellip; }ï¼šè¿™é‡Œçš„string(b)åšäº†ä¼˜åŒ–ä¸ä¼šæ‰§è¡Œæ‹·è´ï¼Œç›´æ¥ç”¨äº†åŸæ¥bçš„åº•å±‚æ•°ç»„åšä¸ºstringçš„åº•å±‚æ•°ç»„ï¼›
è®¿é—®mapå…ƒç´ æ—¶ï¼šm := map[string]int{}, m[string(b)] è¿™é‡Œçš„keyå¯¹åº”çš„stringåº•å±‚æ•°ç»„ä¹Ÿæ˜¯ç›´æ¥ç”¨çš„bçš„åº•å±‚æ•°ç»„ï¼›
å­—ç¬¦ä¸²è¿æ¥æ—¶ï¼šprintln(&amp;quot;(&amp;quot;+string(b)+&amp;quot;)&amp;quot;)ï¼Œè¿™å­—ç¬¦ä¸²è¿æ¥ç»“æœè‚¯å®šè¦åˆ†é…æ–°ç©ºé—´ï¼Œä½†æ˜¯string(b)è‡ªå·±æ˜¯æ²¡æœ‰å†åˆ†é…æ–°ç©ºé—´çš„ï¼›
å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ï¼šè¿™ç§æƒ…å†µå’Œswitchæ—¶çš„æ¯”è¾ƒç±»ä¼¼ï¼Œå…ˆæ¯”è¾ƒstringé•¿åº¦ï¼Œå†æ¯”è¾ƒåº•å±‚bytesæ•°ç»„é•¿åº¦ï¼Œå†æ¯”è¾ƒstringå†…å®¹æœ¬èº«ï¼›
Source Analysis # References # https://medium.com/a-journey-with-go/go-string-conversion-optimization-767b019b75ef</description></item><item><title>structural typing and norminal typing</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Types/structural-typing-and-norminal-typing/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Types/structural-typing-and-norminal-typing/</guid><description>Let&amp;rsquo;s Summarize # ç¼–ç¨‹è¯­è¨€ä¸­çš„ç±»å‹ç³»ç»Ÿï¼Œå¯ä»¥åˆ†ä¸ºstructural typingå’Œnorminal typingã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯ç±»å‹æ£€æŸ¥å™¨åœ¨è¿›è¡Œç±»å‹æ¯”è¾ƒçš„æ—¶å€™ï¼Œå‰è€…æ˜¯é€šè¿‡ç±»å‹çš„ç»“æ„æ¥åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼Œåè€…æ˜¯é€šè¿‡ç±»å‹åè¿›è¡Œæ¯”è¾ƒã€‚åƒc\c++\javaä¸»è¦æ˜¯ä½¿ç”¨çš„norminal typingï¼Œè€Œgoã€ocamaã€haskellä¸»è¦æ˜¯ä½¿ç”¨äº†structural typingã€‚ å…¶å®åœ¨åŒä¸€ç§ç¼–ç¨‹è¯­è¨€é‡Œé¢ï¼Œä¹Ÿæ˜¯å¯ä»¥åŒæ—¶é‡‡ç”¨è¿™ä¸¤ç§ç‰¹æ€§çš„ï¼Œæ¯”å¦‚æœ‰ç§è¯­è¨€é’ˆå¯¹classæ˜¯é‡‡ç”¨çš„norminal typingï¼Œå¯¹äºobjectåˆ™æ˜¯é‡‡ç”¨çš„structural typingã€‚
Source Analysis # References # https://medium.com/@thejameskyle/type-systems-structural-vs-nominal-typing-explained-56511dd969f4#768b</description></item><item><title>the garbage collection handbook</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/the-garbage-collection-handbook/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/the-garbage-collection-handbook/</guid><description>Let&amp;rsquo;s Summarize # Source Analysis # References # http://gchandbook.org/</description></item><item><title>the garbage collection handbook</title><link>https://hitzhangjie.pro/go-internals-v2/posts/the-garbage-collection-handbook/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/the-garbage-collection-handbook/</guid><description>Let&amp;rsquo;s Summarize # Source Analysis # References # http://gchandbook.org/</description></item><item><title>the rules of unsafe.Pointer and uintptr</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/the-rules-of-unsafe.Pointer-and-uintptr/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/the-rules-of-unsafe.Pointer-and-uintptr/</guid><description>Let&amp;rsquo;s Summarize # unsafe.Pointerå’Œuintptrå¯ä»¥äº’è½¬ï¼Œä½†æ˜¯è¦æ³¨æ„è½¬æ¢æ—¶æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ï¼Œæœ‰å¯èƒ½ä¸€ä¸ªuintptrå¯¹åº”çš„å¯¹è±¡å·²ç»è¢«GCæ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™å°†å…¶è½¬æ¢ä¸ºæŒ‡é’ˆå…¶å®æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆã€‚goç¼–è¯‘å™¨æä¾›äº†ä¸€äº›patternsæ¥è¯†åˆ«ä»€ä¹ˆæ—¶å€™unsafe.Pointerè½¬ä¸ºuintptræ—¶ä¸è¦è®©åƒåœ¾å›æ”¶å™¨GCæ‰æŒ‡é’ˆå¯¹åº”çš„å†…å­˜ã€‚
é€šå¸¸å¯ä»¥ç”¨go vetæ¥æ£€æŸ¥ä¸€äº›è¯¯ç”¨æƒ…å†µï¼Œå¦‚æœå­˜åœ¨è¯¯ç”¨ï¼Œä¼šæç¤ºé”™è¯¯ï¼špossible misuse of unsafe.Pointerï¼Œä½†æ˜¯åªæ˜¯possible misuseï¼Œä¸æ˜¯misuseã€‚
go vetä¹Ÿç¡®å®å­˜åœ¨è¯¯æŠ¥çš„æƒ…å†µï¼Œè€Œä¸”å¯èƒ½è¿™ä¸ªè¯¯æŠ¥æ¯”ç‡è¿˜æœ‰ç‚¹é«˜ï¼šhttps://github.com/golang/go/issues/41205.
è¿™é‡Œä¹Ÿæœ‰äººæè¿‡è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ç»•è¿‡go vetæ£€æŸ¥ï¼šhttps://github.com/golang/go/issues/44836#issuecomment-792419407ï¼Œä½†æ˜¯æˆ‘ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›çš„uintptrå¦‚æœæ˜¯égo heapç®¡ç†çš„ï¼Œå¯ä»¥å®Œå…¨ä¸ç”¨care go vetçš„è¯¯æŠ¥ï¼Œæ²¡å¿…è¦ä¸ºäº†ç»•è¿‡go vetçš„è¯¯æŠ¥è€Œåšè¿™ç§çœ‹ä¸Šå»æœ‰æŸå¯è¯»æ€§çš„ç¼–ç ã€‚
Source Analysis # References # https://golang.org/pkg/unsafe/#Pointer</description></item><item><title>the rules of unsafe.Pointer and uintptr</title><link>https://hitzhangjie.pro/go-internals-v2/posts/the-rules-of-unsafe.Pointer-and-uintptr/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/the-rules-of-unsafe.Pointer-and-uintptr/</guid><description>Let&amp;rsquo;s Summarize # unsafe.Pointerå’Œuintptrå¯ä»¥äº’è½¬ï¼Œä½†æ˜¯è¦æ³¨æ„è½¬æ¢æ—¶æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ï¼Œæœ‰å¯èƒ½ä¸€ä¸ªuintptrå¯¹åº”çš„å¯¹è±¡å·²ç»è¢«GCæ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™å°†å…¶è½¬æ¢ä¸ºæŒ‡é’ˆå…¶å®æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆã€‚goç¼–è¯‘å™¨æä¾›äº†ä¸€äº›patternsæ¥è¯†åˆ«ä»€ä¹ˆæ—¶å€™unsafe.Pointerè½¬ä¸ºuintptræ—¶ä¸è¦è®©åƒåœ¾å›æ”¶å™¨GCæ‰æŒ‡é’ˆå¯¹åº”çš„å†…å­˜ã€‚
é€šå¸¸å¯ä»¥ç”¨go vetæ¥æ£€æŸ¥ä¸€äº›è¯¯ç”¨æƒ…å†µï¼Œå¦‚æœå­˜åœ¨è¯¯ç”¨ï¼Œä¼šæç¤ºé”™è¯¯ï¼špossible misuse of unsafe.Pointerï¼Œä½†æ˜¯åªæ˜¯possible misuseï¼Œä¸æ˜¯misuseã€‚
go vetä¹Ÿç¡®å®å­˜åœ¨è¯¯æŠ¥çš„æƒ…å†µï¼Œè€Œä¸”å¯èƒ½è¿™ä¸ªè¯¯æŠ¥æ¯”ç‡è¿˜æœ‰ç‚¹é«˜ï¼šhttps://github.com/golang/go/issues/41205.
è¿™é‡Œä¹Ÿæœ‰äººæè¿‡è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ç»•è¿‡go vetæ£€æŸ¥ï¼šhttps://github.com/golang/go/issues/44836#issuecomment-792419407ï¼Œä½†æ˜¯æˆ‘ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›çš„uintptrå¦‚æœæ˜¯égo heapç®¡ç†çš„ï¼Œå¯ä»¥å®Œå…¨ä¸ç”¨care go vetçš„è¯¯æŠ¥ï¼Œæ²¡å¿…è¦ä¸ºäº†ç»•è¿‡go vetçš„è¯¯æŠ¥è€Œåšè¿™ç§çœ‹ä¸Šå»æœ‰æŸå¯è¯»æ€§çš„ç¼–ç ã€‚
Source Analysis # References # https://golang.org/pkg/unsafe/#Pointer</description></item><item><title>timers" life cycle</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/timer/timers-life-cycle/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/timer/timers-life-cycle/</guid><description>Let&amp;rsquo;s Summarize # time.AfterFunc(time.Second, func() {&amp;hellip;})ï¼Œæ³¨å†Œtimerçš„åŒæ—¶æ³¨å†Œäº†ä¸€ä¸ªcallbackï¼ŒGMPæ¨¡å‹é‡Œé¢ï¼ŒPæœ‰ä¸€ä¸ªtimersé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åˆ›å»ºçš„timerå°±è¢«linkåˆ°å½“å‰g.pçš„timersé˜Ÿåˆ—ä¸­ã€‚
schedulerè°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ£€æŸ¥timerï¼Œå½“timeråˆ°äº†æ‰§è¡Œæ—¶é—´æ—¶ï¼Œéœ€è¦æ‰§è¡Œå¯¹åº”çš„callbackï¼Œè¿™ä¸ªcallbackä¸èƒ½åœ¨schedulerä¸­æ‰§è¡Œï¼Œè¿™ä¼šé˜»ç¢è°ƒåº¦é€»è¾‘çš„æ­£å¸¸æ‰§è¡Œã€‚scheduleræ‰§è¡Œgo callback()åˆ›å»ºä¸€ä¸ªgoroutineæ¥æ‰§è¡Œã€‚è¿™ä¸ªgoroutineä¼šè¢«åŠ å…¥åˆ°å½“å‰g.pçš„localqueueä¸­ï¼Œç­‰å¾…è¢«è°ƒåº¦ã€‚
å› ä¸ºä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥callbackçš„æ‰§è¡Œæœ‰ä¸€å®šçš„delayã€‚å¦‚æœæŸä¸ªgoroutineåœ¨æ­¤goroutineä¹‹å‰æ‰§è¡Œï¼Œä¸”æœ‰å¯†é›†å¾ªç¯ï¼Œä»¥å‰åä½œå¼è°ƒåº¦çš„æ—¶å€™å¯èƒ½callbackæ‰§è¡Œçš„delayä¼šæ¯”è¾ƒæ˜æ˜¾ã€‚ç°åœ¨å¼•å…¥äº†æŠ¢å å¼è°ƒåº¦ï¼Œ10msä¸€æ¬¡æŠ¢å ï¼Œå› ä¸ºå¯†é›†å¾ªç¯å¯¼è‡´çš„delayå°±æ²¡æ²¡é‚£ä¹ˆæ˜æ˜¾äº†ã€‚
ä½†æ˜¯å¦‚æœä¸€ä¸ªPä¸Šçš„timerså¾ˆå¤šæˆ–è€…goroutineå¾ˆå¤šï¼Œå—é™äºg.pçš„localqueueçš„é•¿åº¦ï¼Œtimerä¸Šæ³¨å†Œçš„callbackçš„æ‰§è¡Œè¿˜æ˜¯æœ‰å¯èƒ½ä¼šæœ‰æ˜æ˜¾çš„delayçš„ã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ
timer-stealingæœºåˆ¶ï¼Œä¸€ä¸ªPä¸Šçš„timerså¯ä»¥è¢«å…¶ä»–På·èµ°æ¥æ‰§è¡Œï¼› work-stealingæœºåˆ¶ï¼Œä¸€ä¸ªPä¸Šçš„localqueueä¸Šçš„gå¯ä»¥è¢«å…¶ä»–På·èµ°æ¥æ‰§è¡Œï¼› é€šè¿‡è¿™ä¸¤ç§æ–¹å¼ï¼Œæœ‰åŠ›å‡å°‘äº†timer callbackæ‰§è¡Œæ—¶çš„delayé—®é¢˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-timers-life-cycle-403f3580093a</description></item><item><title>timers" life cycle</title><link>https://hitzhangjie.pro/go-internals-v2/posts/timers-life-cycle/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/timers-life-cycle/</guid><description>Let&amp;rsquo;s Summarize # time.AfterFunc(time.Second, func() {&amp;hellip;})ï¼Œæ³¨å†Œtimerçš„åŒæ—¶æ³¨å†Œäº†ä¸€ä¸ªcallbackï¼ŒGMPæ¨¡å‹é‡Œé¢ï¼ŒPæœ‰ä¸€ä¸ªtimersé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åˆ›å»ºçš„timerå°±è¢«linkåˆ°å½“å‰g.pçš„timersé˜Ÿåˆ—ä¸­ã€‚
schedulerè°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ£€æŸ¥timerï¼Œå½“timeråˆ°äº†æ‰§è¡Œæ—¶é—´æ—¶ï¼Œéœ€è¦æ‰§è¡Œå¯¹åº”çš„callbackï¼Œè¿™ä¸ªcallbackä¸èƒ½åœ¨schedulerä¸­æ‰§è¡Œï¼Œè¿™ä¼šé˜»ç¢è°ƒåº¦é€»è¾‘çš„æ­£å¸¸æ‰§è¡Œã€‚scheduleræ‰§è¡Œgo callback()åˆ›å»ºä¸€ä¸ªgoroutineæ¥æ‰§è¡Œã€‚è¿™ä¸ªgoroutineä¼šè¢«åŠ å…¥åˆ°å½“å‰g.pçš„localqueueä¸­ï¼Œç­‰å¾…è¢«è°ƒåº¦ã€‚
å› ä¸ºä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥callbackçš„æ‰§è¡Œæœ‰ä¸€å®šçš„delayã€‚å¦‚æœæŸä¸ªgoroutineåœ¨æ­¤goroutineä¹‹å‰æ‰§è¡Œï¼Œä¸”æœ‰å¯†é›†å¾ªç¯ï¼Œä»¥å‰åä½œå¼è°ƒåº¦çš„æ—¶å€™å¯èƒ½callbackæ‰§è¡Œçš„delayä¼šæ¯”è¾ƒæ˜æ˜¾ã€‚ç°åœ¨å¼•å…¥äº†æŠ¢å å¼è°ƒåº¦ï¼Œ10msä¸€æ¬¡æŠ¢å ï¼Œå› ä¸ºå¯†é›†å¾ªç¯å¯¼è‡´çš„delayå°±æ²¡æ²¡é‚£ä¹ˆæ˜æ˜¾äº†ã€‚
ä½†æ˜¯å¦‚æœä¸€ä¸ªPä¸Šçš„timerså¾ˆå¤šæˆ–è€…goroutineå¾ˆå¤šï¼Œå—é™äºg.pçš„localqueueçš„é•¿åº¦ï¼Œtimerä¸Šæ³¨å†Œçš„callbackçš„æ‰§è¡Œè¿˜æ˜¯æœ‰å¯èƒ½ä¼šæœ‰æ˜æ˜¾çš„delayçš„ã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ
timer-stealingæœºåˆ¶ï¼Œä¸€ä¸ªPä¸Šçš„timerså¯ä»¥è¢«å…¶ä»–På·èµ°æ¥æ‰§è¡Œï¼› work-stealingæœºåˆ¶ï¼Œä¸€ä¸ªPä¸Šçš„localqueueä¸Šçš„gå¯ä»¥è¢«å…¶ä»–På·èµ°æ¥æ‰§è¡Œï¼› é€šè¿‡è¿™ä¸¤ç§æ–¹å¼ï¼Œæœ‰åŠ›å‡å°‘äº†timer callbackæ‰§è¡Œæ—¶çš„delayé—®é¢˜ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-timers-life-cycle-403f3580093a</description></item><item><title>tracing garbage collection</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/tracing-garbage-collection/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/tracing-garbage-collection/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•åŠä¼˜ç¼ºç‚¹ï¼Œä¹Ÿè¿›è¡Œäº†åˆ†ç±»ã€‚
Source Analysis # References # https://en.wikipedia.org/wiki/Tracing_garbage_collection</description></item><item><title>tracing garbage collection</title><link>https://hitzhangjie.pro/go-internals-v2/posts/tracing-garbage-collection/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/tracing-garbage-collection/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•åŠä¼˜ç¼ºç‚¹ï¼Œä¹Ÿè¿›è¡Œäº†åˆ†ç±»ã€‚
Source Analysis # References # https://en.wikipedia.org/wiki/Tracing_garbage_collection</description></item><item><title>understand the design of sync.pool</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pool/understand-the-design-of-sync.pool/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pool/understand-the-design-of-sync.pool/</guid><description>Let&amp;rsquo;s Summarize # 1 sync.Poolè®¾è®¡
sync.Poolä¸­æœ‰ä¸ªlocal unsafe.Pointerå­—æ®µï¼Œå…¶å®é™…ç±»å‹ä¸º[P]poolLocalï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªsync.Poolçš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯ä¸ºæ¯ä¸ªPåˆ›å»ºäº†ä¸€ä¸ªpoolLocalï¼Œæ¯ä¸ªPåˆ›å»ºã€è·å–å¯¹è±¡æ—¶ä¼˜å…ˆä»Pool.poolLocal[p.id]ä¸­è·å–ï¼Œè¿™ç§ç±»ä¼¼çš„æŒ‰ç…§p.idæ‰§è¡Œshardingçš„æ–¹å¼å¯ä»¥æœ‰æ•ˆå‡å°‘lock intentionï¼Œæé«˜Poolçš„è¯»å†™æ•ˆç‡ã€‚
psï¼šå‡†ç¡®åœ°è¯´ï¼ŒpoolLocal.poolLocalInternalå†…éƒ¨åŒ…å«äº†privateå’Œsharedå­—æ®µï¼Œprivateåªå¯ä»¥è¢«å½“å‰pinned Pè®¿é—®ï¼Œsharedå¯ä»¥è¢«æ‰€æœ‰Pè®¿é—®ã€‚è¿™ç§è®¾è®¡æœ‰æ•ˆå‡å°‘äº†lock intentionã€‚
2 poolCleanup
sync.Poolæœ‰ä¸€ä¸ªé»˜è®¤çš„poolCleanupå‡½æ•°ï¼Œç”¨äºæ¸…ç†æ± å­ä¸­ä¸ç”¨çš„å¯¹è±¡ï¼Œä»¥èŠ‚çœå†…å­˜å ç”¨ï¼Œåœ¨æ‰§è¡Œruntime.GCçš„æ—¶å€™ï¼Œä¹Ÿä¼šæ‰§è¡ŒpoolCleanupå‡½æ•°ï¼Œå½“è§¦å‘GCæ—¶ï¼Œsync.Poolä¸­çš„å¯¹è±¡ä¼šè¢«é‡Šæ”¾æ‰ï¼Œä¸€æ–¹é¢å‡å°‘äº†å†…å­˜å ç”¨ï¼Œä½†æ˜¯å¦ä¸€æ–¹é¢ä¸‹æ¬¡é€šè¿‡æ± å­è·å–å¯¹è±¡æ—¶åˆè¦ç”³è¯·å†…å­˜ï¼Œä¹Ÿä¼šå½±å“æ•ˆç‡ã€‚
3 poolChain
go1.13ä¸­å¼•å…¥äº†ä¸€ä¸ªlock-freeçš„poolChainå®ç°ï¼ˆpoolLocalInternal.sharedï¼‰å’Œvictim cacheã€‚
lock-free poolChainï¼Œpinned Påœ¨å½“å‰poolChainçš„head push/popï¼Œåªæœ‰å½“å‰På¯ä»¥è¿™ä¹ˆå¹²ï¼Œæ‰€ä»¥ä¸éœ€è¦åŒæ­¥æªæ–½ï¼›æ‰€æœ‰Péƒ½å¯ä»¥pop tailï¼Œéœ€è¦åšåŒæ­¥ï¼Œè¿™é‡Œæ˜¯é€šè¿‡CASåŸå­æ“ä½œæ¥å®ç°çš„ã€‚ è¿™é‡Œçš„poolChainç»„ç»‡æ¯”è¾ƒæœ‰æ„æ€ï¼Œç¬¬ä¸€æ¬¡æ˜¯8ä¸ªå…ƒç´ çš„dequeï¼Œä¸å¤Ÿäº†ç”³è¯·16ä¸ªå…ƒç´ çš„dequeï¼Œå¹¶é€šè¿‡prev/nextæŒ‡é’ˆå’Œä¹‹å‰çš„dequeå…³è”èµ·æ¥ï¼Œç¬¬ä¸‰æ¬¡æ˜¯32ä¸ªâ€¦â€¦æ¯æ¬¡ç”³è¯·éƒ½æ˜¯sizeç›´æ¥doubleå¹¶é€šè¿‡æŒ‡é’ˆä¸²èµ·æ¥ã€‚å› ä¸ºpoolChain.headåªæœ‰å½“å‰På¯æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦åŒæ­¥ï¼ŒpoolChain.tailå…è®¸å¤šä¸ªPå¹¶å‘æ“ä½œï¼Œç”¨CASåŸå­æ“ä½œæ¥åŒæ­¥ã€‚
victim cacheï¼Œruntime.GC()è§¦å‘poolCleanupçš„æ—¶å€™ï¼Œä¼šå°†å‰ä¸€è½®ä¸­poolLocalä¸­åˆ†é…çš„çš„å¯¹è±¡èµ‹å€¼ç»™victimè¿™ä¸ªcacheï¼Œæ–¹ä¾¿åé¢å¤ç”¨ï¼Œæ€ä¹ˆå¤ç”¨å‘¢ï¼Ÿ å½“æ‰§è¡Œsync.Pool.Get()çš„æ—¶å€™ï¼š
å…ˆè·å–sync.Pool.localï¼ˆå®é™…æ˜¯[P]poolLocalï¼‰çš„poolLocal[P.id].privateæœ‰æ²¡æœ‰å¯¹è±¡ï¼› æ²¡æœ‰ç»§ç»­æ£€æŸ¥poolLocal[P.id].shared.popTail()æœ‰æ²¡æœ‰å¯¹è±¡ï¼› è¿˜æ²¡æœ‰å°±ä¼šå°è¯•çœ‹çœ‹sync.Pool.victimä¸­æœ‰æ²¡æœ‰ï¼› è¿˜æ²¡æœ‰ï¼Œå°±æ£€æŸ¥sync.Pool.Newå‡½æ•°æœ‰æ²¡æœ‰å®šä¹‰ï¼Œæœ‰åˆ™æ‰§è¡Œåˆ†é…å¯¹è±¡ï¼› å¦‚æœå†ä¸‹ä¸€è½®runtime.GC()è§¦å‘poolCleanupçš„æ—¶å€™ï¼Œvictimå°±ä¼šè¢«å¹²æ‰äº†ã€‚
psï¼šè¿™é‡Œsync.Poolçš„è®¾è®¡æ¯”é¢„æƒ³é‡è¦å¤æ‚äº›ï¼Œå¯ä»¥å†åˆ†æä¸€ä¸‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-understand-the-design-of-sync-pool-2dde3024e277?source=---------50-----------------------</description></item><item><title>understand the design of sync.pool</title><link>https://hitzhangjie.pro/go-internals-v2/posts/understand-the-design-of-sync.pool/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/understand-the-design-of-sync.pool/</guid><description>Let&amp;rsquo;s Summarize # 1 sync.Poolè®¾è®¡
sync.Poolä¸­æœ‰ä¸ªlocal unsafe.Pointerå­—æ®µï¼Œå…¶å®é™…ç±»å‹ä¸º[P]poolLocalï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªsync.Poolçš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯ä¸ºæ¯ä¸ªPåˆ›å»ºäº†ä¸€ä¸ªpoolLocalï¼Œæ¯ä¸ªPåˆ›å»ºã€è·å–å¯¹è±¡æ—¶ä¼˜å…ˆä»Pool.poolLocal[p.id]ä¸­è·å–ï¼Œè¿™ç§ç±»ä¼¼çš„æŒ‰ç…§p.idæ‰§è¡Œshardingçš„æ–¹å¼å¯ä»¥æœ‰æ•ˆå‡å°‘lock intentionï¼Œæé«˜Poolçš„è¯»å†™æ•ˆç‡ã€‚
psï¼šå‡†ç¡®åœ°è¯´ï¼ŒpoolLocal.poolLocalInternalå†…éƒ¨åŒ…å«äº†privateå’Œsharedå­—æ®µï¼Œprivateåªå¯ä»¥è¢«å½“å‰pinned Pè®¿é—®ï¼Œsharedå¯ä»¥è¢«æ‰€æœ‰Pè®¿é—®ã€‚è¿™ç§è®¾è®¡æœ‰æ•ˆå‡å°‘äº†lock intentionã€‚
2 poolCleanup
sync.Poolæœ‰ä¸€ä¸ªé»˜è®¤çš„poolCleanupå‡½æ•°ï¼Œç”¨äºæ¸…ç†æ± å­ä¸­ä¸ç”¨çš„å¯¹è±¡ï¼Œä»¥èŠ‚çœå†…å­˜å ç”¨ï¼Œåœ¨æ‰§è¡Œruntime.GCçš„æ—¶å€™ï¼Œä¹Ÿä¼šæ‰§è¡ŒpoolCleanupå‡½æ•°ï¼Œå½“è§¦å‘GCæ—¶ï¼Œsync.Poolä¸­çš„å¯¹è±¡ä¼šè¢«é‡Šæ”¾æ‰ï¼Œä¸€æ–¹é¢å‡å°‘äº†å†…å­˜å ç”¨ï¼Œä½†æ˜¯å¦ä¸€æ–¹é¢ä¸‹æ¬¡é€šè¿‡æ± å­è·å–å¯¹è±¡æ—¶åˆè¦ç”³è¯·å†…å­˜ï¼Œä¹Ÿä¼šå½±å“æ•ˆç‡ã€‚
3 poolChain
go1.13ä¸­å¼•å…¥äº†ä¸€ä¸ªlock-freeçš„poolChainå®ç°ï¼ˆpoolLocalInternal.sharedï¼‰å’Œvictim cacheã€‚
lock-free poolChainï¼Œpinned Påœ¨å½“å‰poolChainçš„head push/popï¼Œåªæœ‰å½“å‰På¯ä»¥è¿™ä¹ˆå¹²ï¼Œæ‰€ä»¥ä¸éœ€è¦åŒæ­¥æªæ–½ï¼›æ‰€æœ‰Péƒ½å¯ä»¥pop tailï¼Œéœ€è¦åšåŒæ­¥ï¼Œè¿™é‡Œæ˜¯é€šè¿‡CASåŸå­æ“ä½œæ¥å®ç°çš„ã€‚ è¿™é‡Œçš„poolChainç»„ç»‡æ¯”è¾ƒæœ‰æ„æ€ï¼Œç¬¬ä¸€æ¬¡æ˜¯8ä¸ªå…ƒç´ çš„dequeï¼Œä¸å¤Ÿäº†ç”³è¯·16ä¸ªå…ƒç´ çš„dequeï¼Œå¹¶é€šè¿‡prev/nextæŒ‡é’ˆå’Œä¹‹å‰çš„dequeå…³è”èµ·æ¥ï¼Œç¬¬ä¸‰æ¬¡æ˜¯32ä¸ªâ€¦â€¦æ¯æ¬¡ç”³è¯·éƒ½æ˜¯sizeç›´æ¥doubleå¹¶é€šè¿‡æŒ‡é’ˆä¸²èµ·æ¥ã€‚å› ä¸ºpoolChain.headåªæœ‰å½“å‰På¯æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦åŒæ­¥ï¼ŒpoolChain.tailå…è®¸å¤šä¸ªPå¹¶å‘æ“ä½œï¼Œç”¨CASåŸå­æ“ä½œæ¥åŒæ­¥ã€‚
victim cacheï¼Œruntime.GC()è§¦å‘poolCleanupçš„æ—¶å€™ï¼Œä¼šå°†å‰ä¸€è½®ä¸­poolLocalä¸­åˆ†é…çš„çš„å¯¹è±¡èµ‹å€¼ç»™victimè¿™ä¸ªcacheï¼Œæ–¹ä¾¿åé¢å¤ç”¨ï¼Œæ€ä¹ˆå¤ç”¨å‘¢ï¼Ÿ å½“æ‰§è¡Œsync.Pool.Get()çš„æ—¶å€™ï¼š
å…ˆè·å–sync.Pool.localï¼ˆå®é™…æ˜¯[P]poolLocalï¼‰çš„poolLocal[P.id].privateæœ‰æ²¡æœ‰å¯¹è±¡ï¼› æ²¡æœ‰ç»§ç»­æ£€æŸ¥poolLocal[P.id].shared.popTail()æœ‰æ²¡æœ‰å¯¹è±¡ï¼› è¿˜æ²¡æœ‰å°±ä¼šå°è¯•çœ‹çœ‹sync.Pool.victimä¸­æœ‰æ²¡æœ‰ï¼› è¿˜æ²¡æœ‰ï¼Œå°±æ£€æŸ¥sync.Pool.Newå‡½æ•°æœ‰æ²¡æœ‰å®šä¹‰ï¼Œæœ‰åˆ™æ‰§è¡Œåˆ†é…å¯¹è±¡ï¼› å¦‚æœå†ä¸‹ä¸€è½®runtime.GC()è§¦å‘poolCleanupçš„æ—¶å€™ï¼Œvictimå°±ä¼šè¢«å¹²æ‰äº†ã€‚
psï¼šè¿™é‡Œsync.Poolçš„è®¾è®¡æ¯”é¢„æƒ³é‡è¦å¤æ‚äº›ï¼Œå¯ä»¥å†åˆ†æä¸€ä¸‹ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-understand-the-design-of-sync-pool-2dde3024e277?source=---------50-----------------------</description></item><item><title>understand the empty interface</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/interface/understand-the-empty-interface/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/interface/understand-the-empty-interface/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†interfaceçš„å†…éƒ¨è¡¨ç¤ºï¼Œä½†æ˜¯åªä»‹ç»äº†ç©ºæ¥å£ï¼ˆæ–¹æ³•é›†ä¸ºç©ºï¼‰ã€‚
src/runtime/runtime2.goä¸­åŒºåˆ†äº†ç©ºæ¥å£å’Œéç©ºæ¥å£çš„è¡¨ç¤ºï¼Œåˆ†åˆ«æ˜¯efaceå’Œifaceï¼š
å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªåŠ¨æ€å€¼å­—æ®µï¼› å…³äºåŠ¨æ€ç±»å‹å­—æ®µefaceæ¯”è¾ƒç›´æ¥ï¼Œç›´æ¥å°±æ˜¯_typeç±»å‹çš„å­—æ®µï¼› å…³äºåŠ¨æ€ç±»å‹å­—æ®µifaceç”±äºé™¤äº†ç±»å‹è¿˜è¦åŒ…æ‹¬æ–¹æ³•çš„è°ƒç”¨è¡¨ï¼Œä¸efaceç¨æœ‰ä¸åŒï¼Œå…¶ä½¿ç”¨itabç±»å‹ï¼Œè¯¥ç±»å‹å†…éƒ¨æœ‰ä¸€ä¸ªåŠ¨æ€ç±»å‹_typeçš„å­—æ®µï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•è°ƒç”¨è¡¨å­—æ®µfunã€‚ è¿™éƒ¨åˆ†å°±å…ˆä»‹ç»åˆ°è¿™é‡Œï¼Œç†è§£äº†interface{}çš„é•¿ç›¸ï¼Œå¾ˆå¤šä¸œè¥¿å°±å®¹æ˜“ç†è§£ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-understand-the-empty-interface-2d9fc1e5ec72</description></item><item><title>understand the empty interface</title><link>https://hitzhangjie.pro/go-internals-v2/posts/understand-the-empty-interface/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/understand-the-empty-interface/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†interfaceçš„å†…éƒ¨è¡¨ç¤ºï¼Œä½†æ˜¯åªä»‹ç»äº†ç©ºæ¥å£ï¼ˆæ–¹æ³•é›†ä¸ºç©ºï¼‰ã€‚
src/runtime/runtime2.goä¸­åŒºåˆ†äº†ç©ºæ¥å£å’Œéç©ºæ¥å£çš„è¡¨ç¤ºï¼Œåˆ†åˆ«æ˜¯efaceå’Œifaceï¼š
å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªåŠ¨æ€å€¼å­—æ®µï¼› å…³äºåŠ¨æ€ç±»å‹å­—æ®µefaceæ¯”è¾ƒç›´æ¥ï¼Œç›´æ¥å°±æ˜¯_typeç±»å‹çš„å­—æ®µï¼› å…³äºåŠ¨æ€ç±»å‹å­—æ®µifaceç”±äºé™¤äº†ç±»å‹è¿˜è¦åŒ…æ‹¬æ–¹æ³•çš„è°ƒç”¨è¡¨ï¼Œä¸efaceç¨æœ‰ä¸åŒï¼Œå…¶ä½¿ç”¨itabç±»å‹ï¼Œè¯¥ç±»å‹å†…éƒ¨æœ‰ä¸€ä¸ªåŠ¨æ€ç±»å‹_typeçš„å­—æ®µï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•è°ƒç”¨è¡¨å­—æ®µfunã€‚ è¿™éƒ¨åˆ†å°±å…ˆä»‹ç»åˆ°è¿™é‡Œï¼Œç†è§£äº†interface{}çš„é•¿ç›¸ï¼Œå¾ˆå¤šä¸œè¥¿å°±å®¹æ˜“ç†è§£ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-understand-the-empty-interface-2d9fc1e5ec72</description></item><item><title>understanding compiler directives</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/understanding-compiler-directives/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/understanding-compiler-directives/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å¸¸è§çš„ç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œä¸€èˆ¬éµå¾ª//go:$directiveçš„å½¢å¼
noescapeï¼Œç”¨åœ¨å‡½æ•°ç­¾åå‰ï¼ˆéå‡½æ•°å®šä¹‰ï¼Œå®ç°égoè¯­è¨€ï¼‰ï¼Œè¡¨ç¤ºä¸ä¼šå°†æŒ‡é’ˆç”¨ä½œå‚æ•°ï¼Œå‚æ•°ä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼› uintptrescapeï¼Œç”¨åœ¨å‡½æ•°å®šä¹‰å‰ï¼Œæœ‰äº›æŒ‡é’ˆå·²ç»è½¬æˆäº†uintptråšå‚æ•°ï¼Œä½†æ˜¯éœ€è¦åšé€ƒé€¸åˆ†æï¼› noinlineï¼Œç”¨åœ¨å‡½æ•°å®šä¹‰å‰ï¼Œè¡¨ç¤ºç¦æ­¢å†…è”ä¼˜åŒ–ï¼› noraceï¼Œç¦æ­¢åšrace detectoråšå¹¶å‘è¯»å†™åˆ†æï¼› nosplitï¼Œç¦æ­¢åšæ ˆè¶Šç•Œæ£€æŸ¥ï¼› linknameï¼ŒæŒ‡å®šç¼–è¯‘å™¨ä½¿ç”¨importpath.nameä½œä¸ºå½“å‰localnameçš„ç¬¦å·åï¼Œæˆ–è€…çœç•¥importpath.nameåªå°†localnameå¯¼å‡ºç»™å¤–éƒ¨ä½¿ç”¨ï¼› Source Analysis # References # https://golang.org/cmd/compile/</description></item><item><title>understanding compiler directives</title><link>https://hitzhangjie.pro/go-internals-v2/posts/understanding-compiler-directives/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/understanding-compiler-directives/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†å¸¸è§çš„ç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œä¸€èˆ¬éµå¾ª//go:$directiveçš„å½¢å¼
noescapeï¼Œç”¨åœ¨å‡½æ•°ç­¾åå‰ï¼ˆéå‡½æ•°å®šä¹‰ï¼Œå®ç°égoè¯­è¨€ï¼‰ï¼Œè¡¨ç¤ºä¸ä¼šå°†æŒ‡é’ˆç”¨ä½œå‚æ•°ï¼Œå‚æ•°ä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼› uintptrescapeï¼Œç”¨åœ¨å‡½æ•°å®šä¹‰å‰ï¼Œæœ‰äº›æŒ‡é’ˆå·²ç»è½¬æˆäº†uintptråšå‚æ•°ï¼Œä½†æ˜¯éœ€è¦åšé€ƒé€¸åˆ†æï¼› noinlineï¼Œç”¨åœ¨å‡½æ•°å®šä¹‰å‰ï¼Œè¡¨ç¤ºç¦æ­¢å†…è”ä¼˜åŒ–ï¼› noraceï¼Œç¦æ­¢åšrace detectoråšå¹¶å‘è¯»å†™åˆ†æï¼› nosplitï¼Œç¦æ­¢åšæ ˆè¶Šç•Œæ£€æŸ¥ï¼› linknameï¼ŒæŒ‡å®šç¼–è¯‘å™¨ä½¿ç”¨importpath.nameä½œä¸ºå½“å‰localnameçš„ç¬¦å·åï¼Œæˆ–è€…çœç•¥importpath.nameåªå°†localnameå¯¼å‡ºç»™å¤–éƒ¨ä½¿ç”¨ï¼› Source Analysis # References # https://golang.org/cmd/compile/</description></item><item><title>unknown parts of the test package</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Testing/unknown-parts-of-the-test-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Testing/unknown-parts-of-the-test-package/</guid><description>Let&amp;rsquo;s Summarize # 1 go testçš„cacheæœºåˆ¶
go testå¼•å…¥äº†cacheç³»ç»Ÿï¼Œå¯¹äºæ²¡æœ‰æ”¹å˜çš„ä»£ç ä¸ä¼šé‡å¤æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ˜¯ä¼šç”¨ç¼“å­˜çš„ä¸Šæ¬¡çš„æµ‹è¯•ç»“æœã€‚
go testä½•æ—¶ä½¿ç”¨cacheå‘¢ï¼Ÿä¸åªæ˜¯æ£€æŸ¥æµ‹è¯•çš„å†…å®¹æœ‰æ²¡æœ‰å˜æ›´ï¼Œä¹Ÿä¼šæ£€æŸ¥æœ‰æ²¡æœ‰æ›´æ–°ç¯å¢ƒå˜é‡ï¼Œæœ‰æ²¡æœ‰ä½¿ç”¨ä¸åŒçš„flagï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¸ä¼šä½¿ç”¨ç¼“å­˜çš„ç»“æœã€‚
å¦‚ä½•å­˜å‚¨æµ‹è¯•ç»“æœä»¥åŠæŸ¥è¯¢åº”ç”¨ç¼“å­˜çš„æµ‹è¯•ç»“æœå‘¢ï¼Ÿgo testå¯¹contentã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œflagsè®¡ç®—hashï¼Œè®¡ç®—å®Œæˆåï¼Œå­˜å‚¨åˆ°$GOCACHEç›®å½•ä¸‹ï¼Œæ¯ä¸ªhashå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡hexdump -CæŸ¥çœ‹ç¼“å­˜æ•°æ®ã€‚
go testæ‰§è¡Œæ—¶å¦‚ä½•ç»•è¿‡cacheç³»ç»Ÿå‘¢ï¼Œæ‰§è¡ŒGOCACHE=off go testã€‚
2 go testçš„é»‘ç™½ç›’æµ‹è¯•
é»‘ç›’æµ‹è¯•ï¼šåªå…³å¿ƒå¯¼å‡ºå‡½æ•°çš„æµ‹è¯•ï¼Œä¸å…³å¿ƒå†…éƒ¨å®ç°ï¼› ç™½ç›’æµ‹è¯•ï¼šå…³å¿ƒå†…éƒ¨å®ç°ï¼Œå¯ä»¥æµ‹è¯•å¯¼å‡ºã€éå¯¼å‡ºå‡½æ•°ï¼› æ¯”å¦‚hello.goå¯¹åº”packageåä¸ºhelloï¼š
é»‘ç›’æµ‹è¯•ï¼šå®šä¹‰æ–‡ä»¶hello_test.goï¼Œpackageå®šä¹‰ä¸ºhello_testï¼› ç™½ç›’æµ‹è¯•ï¼šå®šä¹‰æ–‡ä»¶hello_test.goï¼Œpackageå®šä¹‰ä¸ºhelloï¼› 3 go test -benchè‡ªå®šä¹‰metrics
go testçš„æ—¶å€™ï¼Œä¼šè¾“å‡ºä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œæ¯”å¦‚benchmarkçš„æ—¶å€™å¯ä»¥è¾“å‡ºopå¹³å‡æ—¶é—´ã€mem allocsçš„ä¸€äº›æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡b.ReportMetric(value float64, desc string)æ¥è‡ªå®šä¹‰ç»Ÿè®¡æ•°æ®å±•ç¤ºã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-unknown-parts-of-the-test-package-df8988b2ef7f</description></item><item><title>unknown parts of the test package</title><link>https://hitzhangjie.pro/go-internals-v2/posts/unknown-parts-of-the-test-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/unknown-parts-of-the-test-package/</guid><description>Let&amp;rsquo;s Summarize # 1 go testçš„cacheæœºåˆ¶
go testå¼•å…¥äº†cacheç³»ç»Ÿï¼Œå¯¹äºæ²¡æœ‰æ”¹å˜çš„ä»£ç ä¸ä¼šé‡å¤æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ˜¯ä¼šç”¨ç¼“å­˜çš„ä¸Šæ¬¡çš„æµ‹è¯•ç»“æœã€‚
go testä½•æ—¶ä½¿ç”¨cacheå‘¢ï¼Ÿä¸åªæ˜¯æ£€æŸ¥æµ‹è¯•çš„å†…å®¹æœ‰æ²¡æœ‰å˜æ›´ï¼Œä¹Ÿä¼šæ£€æŸ¥æœ‰æ²¡æœ‰æ›´æ–°ç¯å¢ƒå˜é‡ï¼Œæœ‰æ²¡æœ‰ä½¿ç”¨ä¸åŒçš„flagï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¸ä¼šä½¿ç”¨ç¼“å­˜çš„ç»“æœã€‚
å¦‚ä½•å­˜å‚¨æµ‹è¯•ç»“æœä»¥åŠæŸ¥è¯¢åº”ç”¨ç¼“å­˜çš„æµ‹è¯•ç»“æœå‘¢ï¼Ÿgo testå¯¹contentã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œflagsè®¡ç®—hashï¼Œè®¡ç®—å®Œæˆåï¼Œå­˜å‚¨åˆ°$GOCACHEç›®å½•ä¸‹ï¼Œæ¯ä¸ªhashå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡hexdump -CæŸ¥çœ‹ç¼“å­˜æ•°æ®ã€‚
go testæ‰§è¡Œæ—¶å¦‚ä½•ç»•è¿‡cacheç³»ç»Ÿå‘¢ï¼Œæ‰§è¡ŒGOCACHE=off go testã€‚
2 go testçš„é»‘ç™½ç›’æµ‹è¯•
é»‘ç›’æµ‹è¯•ï¼šåªå…³å¿ƒå¯¼å‡ºå‡½æ•°çš„æµ‹è¯•ï¼Œä¸å…³å¿ƒå†…éƒ¨å®ç°ï¼› ç™½ç›’æµ‹è¯•ï¼šå…³å¿ƒå†…éƒ¨å®ç°ï¼Œå¯ä»¥æµ‹è¯•å¯¼å‡ºã€éå¯¼å‡ºå‡½æ•°ï¼› æ¯”å¦‚hello.goå¯¹åº”packageåä¸ºhelloï¼š
é»‘ç›’æµ‹è¯•ï¼šå®šä¹‰æ–‡ä»¶hello_test.goï¼Œpackageå®šä¹‰ä¸ºhello_testï¼› ç™½ç›’æµ‹è¯•ï¼šå®šä¹‰æ–‡ä»¶hello_test.goï¼Œpackageå®šä¹‰ä¸ºhelloï¼› 3 go test -benchè‡ªå®šä¹‰metrics
go testçš„æ—¶å€™ï¼Œä¼šè¾“å‡ºä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œæ¯”å¦‚benchmarkçš„æ—¶å€™å¯ä»¥è¾“å‡ºopå¹³å‡æ—¶é—´ã€mem allocsçš„ä¸€äº›æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡b.ReportMetric(value float64, desc string)æ¥è‡ªå®šä¹‰ç»Ÿè®¡æ•°æ®å±•ç¤ºã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-unknown-parts-of-the-test-package-df8988b2ef7f</description></item><item><title>visualize your go code</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/AST/visualize-your-go-code/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/AST/visualize-your-go-code/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†ä¸€ç§é€šè¿‡go astæ¥å¯¹ä»£ç è¿›è¡Œåˆ†æå¹¶è¿›è¡Œå¯è§†åŒ–å±•ç¤ºçš„æ–¹æ³•ï¼Œæœ‰åŠ©äºæå‡ä»£ç å¯è¯»æ€§ï¼Œä¹Ÿæœ‰åŠ©äºå®ç°å¯è§†åŒ–ä»£ç ç¼–è¾‘èƒ½åŠ›æ”¯æŒï¼ˆå¦‚ballerinaæ¡†æ¶çš„vscodeæ’ä»¶æ”¯æŒå¯è§†åŒ–ç¼–è¾‘ï¼‰ï¼Œä¹Ÿæœ‰åŠ©äºå®ç°é«˜çº§å¯è§†åŒ–è°ƒè¯•ã€æµ‹è¯•ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2020-10-06-visualizing-your-go-code/</description></item><item><title>visualize your go code</title><link>https://hitzhangjie.pro/go-internals-v2/posts/visualize-your-go-code/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/visualize-your-go-code/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†ä¸€ç§é€šè¿‡go astæ¥å¯¹ä»£ç è¿›è¡Œåˆ†æå¹¶è¿›è¡Œå¯è§†åŒ–å±•ç¤ºçš„æ–¹æ³•ï¼Œæœ‰åŠ©äºæå‡ä»£ç å¯è¯»æ€§ï¼Œä¹Ÿæœ‰åŠ©äºå®ç°å¯è§†åŒ–ä»£ç ç¼–è¾‘èƒ½åŠ›æ”¯æŒï¼ˆå¦‚ballerinaæ¡†æ¶çš„vscodeæ’ä»¶æ”¯æŒå¯è§†åŒ–ç¼–è¾‘ï¼‰ï¼Œä¹Ÿæœ‰åŠ©äºå®ç°é«˜çº§å¯è§†åŒ–è°ƒè¯•ã€æµ‹è¯•ã€‚
Source Analysis # References # https://www.hitzhangjie.pro/blog/2020-10-06-visualizing-your-go-code/</description></item><item><title>visualizing memory management in go</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/visualizing-memory-management-in-go/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/visualizing-memory-management-in-go/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goå†…å­˜ç»„ç»‡ã€åˆ†é…ã€åƒåœ¾å›æ”¶æ–¹å¼ï¼Œå¹¶æä¾›äº†æ¯”è¾ƒå¥½çš„é…å›¾ä»¥åŠGIFåŠ¨ç”»æ¥ç›´è§‚è§£é‡Šè¿™äº›è¿‡ç¨‹ã€‚
Source Analysis # References # https://deepu.tech/memory-management-in-golang/</description></item><item><title>visualizing memory management in go</title><link>https://hitzhangjie.pro/go-internals-v2/posts/visualizing-memory-management-in-go/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/visualizing-memory-management-in-go/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goå†…å­˜ç»„ç»‡ã€åˆ†é…ã€åƒåœ¾å›æ”¶æ–¹å¼ï¼Œå¹¶æä¾›äº†æ¯”è¾ƒå¥½çš„é…å›¾ä»¥åŠGIFåŠ¨ç”»æ¥ç›´è§‚è§£é‡Šè¿™äº›è¿‡ç¨‹ã€‚
Source Analysis # References # https://deepu.tech/memory-management-in-golang/</description></item><item><title>what does a goroutine switch actually involve</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/what-does-a-goroutine-switch-actually-involve/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/what-does-a-goroutine-switch-actually-involve/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºä¸­goroutineåˆ‡æ¢çš„æ—¶æœºã€åˆ‡æ¢çš„æ–¹å¼ã€åˆ‡æ¢çš„å¼€é”€ã€‚
1 åˆ‡æ¢æ—¶æœº
æˆ‘ä»¬ç±»æ¯”ä¸€ä¸‹åŠ æ·±å¯¹goroutineåˆ‡æ¢æ—¶æœºçš„ç†è§£ã€‚
å¤„ç†å™¨æ˜¯åœ¨æŒ‡ä»¤å‘¨æœŸç»“æŸæ—¶ï¼Œæ£€æŸ¥æœ‰æ²¡æœ‰ä¸­æ–­ä¿¡å·åˆ°è¾¾ï¼Œæœ‰åˆ™åˆ‡æ¢åˆ°å¯¹åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºå»æ‰§è¡Œï¼› æ“ä½œç³»ç»Ÿæ˜¯åœ¨ç³»ç»Ÿè°ƒç”¨ç»“æŸè¿”å›æ—¶æ£€æŸ¥è¿›ç¨‹æ˜¯å¦åº”è¯¥åˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹å»æ‰§è¡Œï¼ˆæˆ–è€…æ‰§è¡Œä¿¡å·å¤„ç†ç¨‹åºï¼‰ï¼› è¿›ç¨‹ä¸­åˆ‡æ¢åç¨‹ï¼Œä¸€èˆ¬æ˜¯åœ¨åç¨‹å‡ºç°ç½‘ç»œIOç­‰æ•°æ®æœªå°±ç»ªã€sync/*æ“ä½œå¯¼è‡´é˜»å¡ã€chanæ“ä½œå¯¼è‡´é˜»å¡ã€è¿›å…¥é˜»å¡ç³»ç»Ÿè°ƒç”¨æ—¶å¯¼è‡´ï¼Œéœ€è¦è°ƒåº¦å™¨è°ƒåº¦å…¶ä»–åç¨‹æ¥ç»§ç»­æ‰§è¡Œï¼Œé«˜æ•ˆåˆ©ç”¨CPUã€‚è¿˜æœ‰å°±æ˜¯åœ¨å‡½æ•°prologueçš„æ—¶å€™ã€æˆ–è€…æ”¶åˆ°SIGURGæ‰§è¡ŒæŠ¢å è°ƒåº¦çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ¶‰åŠåˆ°åç¨‹çš„åˆ‡æ¢ï¼› 2 åˆ‡æ¢æ–¹å¼
åˆ‡æ¢çš„æ–¹å¼ï¼Œå¯¹äºgo schedulerè€Œè¨€ï¼Œå°±æ˜¯éœ€è¦é€šè¿‡ç‰¹æ®Šçš„åç¨‹g0æ¥ä¸­è½¬ï¼Œæ¯”å¦‚ç°åœ¨è¿è¡Œçš„æ˜¯g1ï¼Œç°åœ¨g1å› ä¸ºchanæ“ä½œé˜»å¡äº†ï¼Œå°±éœ€è¦å…ˆä¿å­˜å½“å‰ä¸Šä¸‹æ–‡ï¼Œç„¶ååˆ‡æ¢åˆ°g0ï¼Œg0æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè¦è°ƒåº¦çš„åç¨‹g2ï¼Œæ¢å¤å…¶ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªæ—¶å€™å°±æ‰§è¡Œåˆ°g2åç¨‹å»äº†ã€‚
3 åˆ‡æ¢å¼€é”€
goroutineåˆ‡æ¢çš„å¼€é”€ï¼Œä»¥g1åˆ‡æ¢åˆ°g2ä¸ºä¾‹ï¼Œä¸»è¦åŒ…æ‹¬3ä¸ªé˜¶æ®µï¼š
ä¿å­˜g1å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬pcã€spï¼Œç„¶ååˆ‡æ¢åˆ°g0ï¼Œè€—æ—¶10å¾®ç§’å·¦å³ï¼› g0æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå¾…è°ƒåº¦çš„åç¨‹g2ï¼Œè¿™ä¸ªæ¯”è¾ƒè€—æ—¶ï¼Œå¯èƒ½è¦100å¾®ç§’å·¦å³ï¼› ä¿å­˜g0å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬pcã€spï¼Œå¹¶æ¢å¤g2çš„ä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œg2ï¼Œè€—æ—¶10å¾®ç§’å·¦å³ï¼› è¿™é‡Œçš„æ€§èƒ½æµ‹é‡ç»“æœå¯èƒ½å¹¶ä¸ç²¾å‡†ï¼Œæˆ‘ä»¬äº†è§£ä¸‹å°±å¯ä»¥äº†ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-what-does-a-goroutine-switch-actually-involve-394c202dddb7</description></item><item><title>what does a goroutine switch actually involve</title><link>https://hitzhangjie.pro/go-internals-v2/posts/what-does-a-goroutine-switch-actually-involve/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/what-does-a-goroutine-switch-actually-involve/</guid><description>Let&amp;rsquo;s Summarize # ä»‹ç»äº†goç¨‹åºä¸­goroutineåˆ‡æ¢çš„æ—¶æœºã€åˆ‡æ¢çš„æ–¹å¼ã€åˆ‡æ¢çš„å¼€é”€ã€‚
1 åˆ‡æ¢æ—¶æœº
æˆ‘ä»¬ç±»æ¯”ä¸€ä¸‹åŠ æ·±å¯¹goroutineåˆ‡æ¢æ—¶æœºçš„ç†è§£ã€‚
å¤„ç†å™¨æ˜¯åœ¨æŒ‡ä»¤å‘¨æœŸç»“æŸæ—¶ï¼Œæ£€æŸ¥æœ‰æ²¡æœ‰ä¸­æ–­ä¿¡å·åˆ°è¾¾ï¼Œæœ‰åˆ™åˆ‡æ¢åˆ°å¯¹åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºå»æ‰§è¡Œï¼› æ“ä½œç³»ç»Ÿæ˜¯åœ¨ç³»ç»Ÿè°ƒç”¨ç»“æŸè¿”å›æ—¶æ£€æŸ¥è¿›ç¨‹æ˜¯å¦åº”è¯¥åˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹å»æ‰§è¡Œï¼ˆæˆ–è€…æ‰§è¡Œä¿¡å·å¤„ç†ç¨‹åºï¼‰ï¼› è¿›ç¨‹ä¸­åˆ‡æ¢åç¨‹ï¼Œä¸€èˆ¬æ˜¯åœ¨åç¨‹å‡ºç°ç½‘ç»œIOç­‰æ•°æ®æœªå°±ç»ªã€sync/*æ“ä½œå¯¼è‡´é˜»å¡ã€chanæ“ä½œå¯¼è‡´é˜»å¡ã€è¿›å…¥é˜»å¡ç³»ç»Ÿè°ƒç”¨æ—¶å¯¼è‡´ï¼Œéœ€è¦è°ƒåº¦å™¨è°ƒåº¦å…¶ä»–åç¨‹æ¥ç»§ç»­æ‰§è¡Œï¼Œé«˜æ•ˆåˆ©ç”¨CPUã€‚è¿˜æœ‰å°±æ˜¯åœ¨å‡½æ•°prologueçš„æ—¶å€™ã€æˆ–è€…æ”¶åˆ°SIGURGæ‰§è¡ŒæŠ¢å è°ƒåº¦çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ¶‰åŠåˆ°åç¨‹çš„åˆ‡æ¢ï¼› 2 åˆ‡æ¢æ–¹å¼
åˆ‡æ¢çš„æ–¹å¼ï¼Œå¯¹äºgo schedulerè€Œè¨€ï¼Œå°±æ˜¯éœ€è¦é€šè¿‡ç‰¹æ®Šçš„åç¨‹g0æ¥ä¸­è½¬ï¼Œæ¯”å¦‚ç°åœ¨è¿è¡Œçš„æ˜¯g1ï¼Œç°åœ¨g1å› ä¸ºchanæ“ä½œé˜»å¡äº†ï¼Œå°±éœ€è¦å…ˆä¿å­˜å½“å‰ä¸Šä¸‹æ–‡ï¼Œç„¶ååˆ‡æ¢åˆ°g0ï¼Œg0æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè¦è°ƒåº¦çš„åç¨‹g2ï¼Œæ¢å¤å…¶ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªæ—¶å€™å°±æ‰§è¡Œåˆ°g2åç¨‹å»äº†ã€‚
3 åˆ‡æ¢å¼€é”€
goroutineåˆ‡æ¢çš„å¼€é”€ï¼Œä»¥g1åˆ‡æ¢åˆ°g2ä¸ºä¾‹ï¼Œä¸»è¦åŒ…æ‹¬3ä¸ªé˜¶æ®µï¼š
ä¿å­˜g1å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬pcã€spï¼Œç„¶ååˆ‡æ¢åˆ°g0ï¼Œè€—æ—¶10å¾®ç§’å·¦å³ï¼› g0æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå¾…è°ƒåº¦çš„åç¨‹g2ï¼Œè¿™ä¸ªæ¯”è¾ƒè€—æ—¶ï¼Œå¯èƒ½è¦100å¾®ç§’å·¦å³ï¼› ä¿å­˜g0å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬pcã€spï¼Œå¹¶æ¢å¤g2çš„ä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œg2ï¼Œè€—æ—¶10å¾®ç§’å·¦å³ï¼› è¿™é‡Œçš„æ€§èƒ½æµ‹é‡ç»“æœå¯èƒ½å¹¶ä¸ç²¾å‡†ï¼Œæˆ‘ä»¬äº†è§£ä¸‹å°±å¯ä»¥äº†ã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-what-does-a-goroutine-switch-actually-involve-394c202dddb7</description></item><item><title>what is the unsafe package</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/unsafe/what-is-the-unsafe-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Builtins/unsafe/what-is-the-unsafe-package/</guid><description>Let&amp;rsquo;s Summarize # package unsafeï¼Œè§åçŸ¥æ„ï¼Œå°±æ˜¯ä¸å®‰å…¨ï¼Œè€Œä¸”æœ‰å¯èƒ½ä»£ç åç»­ä¼šä¸å…¼å®¹ï¼Œå› ä¸ºunsafeçš„å®ç°ä¾èµ–goå†…éƒ¨å®ç°ï¼Œæ¯”å¦‚æ•°æ®ç±»å‹çš„å†…éƒ¨è¡¨ç¤ºã€‚
goæ–‡æ¡£ä¸­æœ‰æ˜ç¡®æŒ‡å‡ºï¼š
package unsafeåŒ…å«äº†ä¸€äº›å¯èƒ½ç ´ågoç±»å‹å®‰å…¨çš„æ“ä½œï¼› å¼•ç”¨package unsafeçš„ä»£ç å…¼å®¹æ€§å·®ï¼Œå¹¶ä¸”ä¸å—Go 1 å…¼å®¹æ€§æŒ‡å¼•ä¿æŠ¤ï¼› 1 ç±»å‹å®‰å…¨
æˆ‘ä»¬å¯ä¸é€šè¿‡uint8(int8(1))è¿™ç§æ–¹å¼è¿›è¡Œæ˜¾ç¤ºçš„ç±»å‹è½¬æ¢æ“ä½œï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªå¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå¦‚type A struct{ a int}ï¼Œtype B struct { b int}ï¼Œè™½ç„¶å…¶å†…å­˜æ•°æ®è¡¨ç¤ºå®Œå…¨ç›¸åŒï¼Œä½†æ˜¯å…¶ä»ç„¶æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ä¸Šè¿°çš„ç±»å‹è½¬æ¢å°†ä¸€ä¸ªBå¯¹è±¡è½¬æ¢ä¸ºä¸ºAå¯¹è±¡ã€‚
package unsafeå…è®¸æˆ‘ä»¬ç›´æ¥è®¿é—®åŸå§‹çš„å†…å­˜ï¼Œåªè¦å†…å­˜åº•å±‚æ•°æ®è¡¨ç¤ºç›¸åŒï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚var a = A{a:1}ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡var b = *((*B)(unsafe.Pointer(&amp;amp;a)))ã€‚
æˆ‘ä»¬å¦‚æœæƒ³æŸ¥çœ‹stringã€sliceã€arrayç­‰æ•°æ®ç±»å‹çš„è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°ã€‚
2 Go 1 å…¼å®¹æ€§æŒ‡å¼•
æŒ‡å¼•ä¸­æ˜ç¡®å‘ŠçŸ¥unsafeçš„ä½¿ç”¨å¯èƒ½ä¼šç ´åä»£ç å…¼å®¹æ€§ï¼Œå› ä¸ºunsafeè¿™ä¸ªåŒ…çš„å®ç°ä¾èµ–äº†è¯­è¨€çš„å†…éƒ¨å®ç°ï¼Œå¦‚æœè¯­è¨€å†…éƒ¨å®ç°å‘ç”Ÿäº†å˜åŒ–ï¼Œunsafeçš„ä½¿ç”¨å°±å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œä¸¾ä¸ªæç«¯çš„ä¾‹å­ï¼Œæ¯”å¦‚SliceHeader{data,cap,len}ä¸­å­—æ®µé¡ºåºè°ƒæ•´ä¸ºSliceHeader{cap,len,data}ã€‚
ç†è§£è¿™ç‚¹å°±å¥½äº†ï¼Œåº”ç”¨å¼€å‘ä¸­åº”è¯¥å°½é‡é¿å…unsafeåŒ…ä½¿ç”¨ï¼Œå¦‚æœå¯ä»¥çš„è¯ã€‚
è¯¦ç»†æŒ‡å¼•ï¼Œseeï¼šhttps://golang.org/doc/go1compat#expectationsã€‚
3 reflection &amp;amp; sync &amp;amp; runtime
è¿™ä¸¤ä¸ªpackageä¸‹éƒ½å¤§é‡ä½¿ç”¨äº†unsafeï¼š
åå°„éœ€è¦ç›´æ¥æ“ä½œå†…å­˜ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼› syncä¸­sync.Poolä¸­ç”¨åˆ°äº†å¯¹æŒ‡é’ˆçš„æ“ä½œï¼Œä¹Ÿéœ€è¦ç”¨åˆ°unsafeï¼› runtimeä¸­goroutine stackæ“ä½œï¼Œä¹Ÿæ¶‰åŠåˆ°å¯¹å†…å­˜çš„ç›´æ¥æ“ä½œï¼› æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹ä¸‹æºç ã€‚
4 Usage as a developer
å‰é¢æåŠçš„æ•°æ®ç±»å‹type A structå’Œtype B structçš„äº’è½¬ï¼Œæˆ–è€…æ¶‰åŠåˆ°cgoç±»çš„æ“ä½œè¦å¤§é‡ç”¨åˆ°unsafe.Pointerï¼Œgo:linknameå¯¼å‡ºä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸ç»‘å®šä¸€ä¸ªå‡½æ•°ï¼Œç­‰ç­‰å§ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šåœºæ™¯å¯ä»¥ä½¿ç”¨çš„ã€‚
æ…¢æ…¢ç§¯ç´¯å§ã€‚
Source Analysis # References # https://medium.</description></item><item><title>what is the unsafe package</title><link>https://hitzhangjie.pro/go-internals-v2/posts/what-is-the-unsafe-package/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/what-is-the-unsafe-package/</guid><description>Let&amp;rsquo;s Summarize # package unsafeï¼Œè§åçŸ¥æ„ï¼Œå°±æ˜¯ä¸å®‰å…¨ï¼Œè€Œä¸”æœ‰å¯èƒ½ä»£ç åç»­ä¼šä¸å…¼å®¹ï¼Œå› ä¸ºunsafeçš„å®ç°ä¾èµ–goå†…éƒ¨å®ç°ï¼Œæ¯”å¦‚æ•°æ®ç±»å‹çš„å†…éƒ¨è¡¨ç¤ºã€‚
goæ–‡æ¡£ä¸­æœ‰æ˜ç¡®æŒ‡å‡ºï¼š
package unsafeåŒ…å«äº†ä¸€äº›å¯èƒ½ç ´ågoç±»å‹å®‰å…¨çš„æ“ä½œï¼› å¼•ç”¨package unsafeçš„ä»£ç å…¼å®¹æ€§å·®ï¼Œå¹¶ä¸”ä¸å—Go 1 å…¼å®¹æ€§æŒ‡å¼•ä¿æŠ¤ï¼› 1 ç±»å‹å®‰å…¨
æˆ‘ä»¬å¯ä¸é€šè¿‡uint8(int8(1))è¿™ç§æ–¹å¼è¿›è¡Œæ˜¾ç¤ºçš„ç±»å‹è½¬æ¢æ“ä½œï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªå¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå¦‚type A struct{ a int}ï¼Œtype B struct { b int}ï¼Œè™½ç„¶å…¶å†…å­˜æ•°æ®è¡¨ç¤ºå®Œå…¨ç›¸åŒï¼Œä½†æ˜¯å…¶ä»ç„¶æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ä¸Šè¿°çš„ç±»å‹è½¬æ¢å°†ä¸€ä¸ªBå¯¹è±¡è½¬æ¢ä¸ºä¸ºAå¯¹è±¡ã€‚
package unsafeå…è®¸æˆ‘ä»¬ç›´æ¥è®¿é—®åŸå§‹çš„å†…å­˜ï¼Œåªè¦å†…å­˜åº•å±‚æ•°æ®è¡¨ç¤ºç›¸åŒï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œæˆå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚var a = A{a:1}ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡var b = *((*B)(unsafe.Pointer(&amp;amp;a)))ã€‚
æˆ‘ä»¬å¦‚æœæƒ³æŸ¥çœ‹stringã€sliceã€arrayç­‰æ•°æ®ç±»å‹çš„è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°ã€‚
2 Go 1 å…¼å®¹æ€§æŒ‡å¼•
æŒ‡å¼•ä¸­æ˜ç¡®å‘ŠçŸ¥unsafeçš„ä½¿ç”¨å¯èƒ½ä¼šç ´åä»£ç å…¼å®¹æ€§ï¼Œå› ä¸ºunsafeè¿™ä¸ªåŒ…çš„å®ç°ä¾èµ–äº†è¯­è¨€çš„å†…éƒ¨å®ç°ï¼Œå¦‚æœè¯­è¨€å†…éƒ¨å®ç°å‘ç”Ÿäº†å˜åŒ–ï¼Œunsafeçš„ä½¿ç”¨å°±å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œä¸¾ä¸ªæç«¯çš„ä¾‹å­ï¼Œæ¯”å¦‚SliceHeader{data,cap,len}ä¸­å­—æ®µé¡ºåºè°ƒæ•´ä¸ºSliceHeader{cap,len,data}ã€‚
ç†è§£è¿™ç‚¹å°±å¥½äº†ï¼Œåº”ç”¨å¼€å‘ä¸­åº”è¯¥å°½é‡é¿å…unsafeåŒ…ä½¿ç”¨ï¼Œå¦‚æœå¯ä»¥çš„è¯ã€‚
è¯¦ç»†æŒ‡å¼•ï¼Œseeï¼šhttps://golang.org/doc/go1compat#expectationsã€‚
3 reflection &amp;amp; sync &amp;amp; runtime
è¿™ä¸¤ä¸ªpackageä¸‹éƒ½å¤§é‡ä½¿ç”¨äº†unsafeï¼š
åå°„éœ€è¦ç›´æ¥æ“ä½œå†…å­˜ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼› syncä¸­sync.Poolä¸­ç”¨åˆ°äº†å¯¹æŒ‡é’ˆçš„æ“ä½œï¼Œä¹Ÿéœ€è¦ç”¨åˆ°unsafeï¼› runtimeä¸­goroutine stackæ“ä½œï¼Œä¹Ÿæ¶‰åŠåˆ°å¯¹å†…å­˜çš„ç›´æ¥æ“ä½œï¼› æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹ä¸‹æºç ã€‚
4 Usage as a developer
å‰é¢æåŠçš„æ•°æ®ç±»å‹type A structå’Œtype B structçš„äº’è½¬ï¼Œæˆ–è€…æ¶‰åŠåˆ°cgoç±»çš„æ“ä½œè¦å¤§é‡ç”¨åˆ°unsafe.Pointerï¼Œgo:linknameå¯¼å‡ºä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸ç»‘å®šä¸€ä¸ªå‡½æ•°ï¼Œç­‰ç­‰å§ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šåœºæ™¯å¯ä»¥ä½¿ç”¨çš„ã€‚
æ…¢æ…¢ç§¯ç´¯å§ã€‚
Source Analysis # References # https://medium.</description></item><item><title>work-stealing in go scheduler</title><link>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/work-stealing-in-go-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/work-stealing-in-go-scheduler/</guid><description>Let&amp;rsquo;s Summarize # GMPè°ƒåº¦æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªPçš„local queueé•¿åº¦ä¸º256ï¼Œåˆ›å»ºgæ—¶ï¼Œå¦‚æœpçš„local queueæ»¡äº†ï¼Œå°±ä¼šå¾€global queueé‡Œé¢æ”¾äº†ã€‚
ä¸ºäº†ä¿è¯å„ä¸ªPçš„è´Ÿè½½å‡è¡¡ï¼Œé‡‡ç”¨work-stealingè°ƒåº¦æ–¹å¼ï¼Œå½“ä¸€ä¸ªPä¸Šçš„Mè¦æ‰§è¡Œä¸€ä¸ªGæ—¶ï¼ŒGä»å“ªé‡Œè·å–å‘¢ï¼Ÿ
å°è¯•ä»Pçš„local queueè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»global queueè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»netpollerè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»å…¶ä»–Pçš„local queueä¸­è·å–ï¼Œæ²¡æœ‰å°±çœŸçš„æ²¡æœ‰äº†ï¼› å¦‚æœçœŸçš„æ²¡æœ‰ï¼Œå°±è¦è€ƒè™‘idleMã€idlePçš„å¤„ç†äº†ã€‚
psï¼šç³»ç»Ÿè°ƒç”¨é˜»å¡çš„goroutineæ¢å¤æ‰§è¡Œæ—¶ï¼Œä¼šå°†å…¶åŠ å…¥åˆ°global queueä¸­ï¼Œå› æ­¤å…¶å¯èƒ½ç ´åäº†åŸæ¥çš„GMPä¹‹é—´çš„è°ƒåº¦ç²˜æ€§ï¼Œå¯èƒ½åœ¨ä¸åŒçš„Pä¸Šç”±ä¸åŒçš„Mæ¥æ‰§è¡Œã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-work-stealing-in-go-scheduler-d439231be64d</description></item><item><title>work-stealing in go scheduler</title><link>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/work-stealing-in-go-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/work-stealing-in-go-scheduler/</guid><description>Let&amp;rsquo;s Summarize # GMPè°ƒåº¦æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªPçš„local queueé•¿åº¦ä¸º256ï¼Œåˆ›å»ºgæ—¶ï¼Œå¦‚æœpçš„local queueæ»¡äº†ï¼Œå°±ä¼šå¾€global queueé‡Œé¢æ”¾äº†ã€‚
ä¸ºäº†ä¿è¯å„ä¸ªPçš„è´Ÿè½½å‡è¡¡ï¼Œé‡‡ç”¨work-stealingè°ƒåº¦æ–¹å¼ï¼Œå½“ä¸€ä¸ªPä¸Šçš„Mè¦æ‰§è¡Œä¸€ä¸ªGæ—¶ï¼ŒGä»å“ªé‡Œè·å–å‘¢ï¼Ÿ
å°è¯•ä»Pçš„local queueè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»global queueè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»netpollerè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»å…¶ä»–Pçš„local queueä¸­è·å–ï¼Œæ²¡æœ‰å°±çœŸçš„æ²¡æœ‰äº†ï¼› å¦‚æœçœŸçš„æ²¡æœ‰ï¼Œå°±è¦è€ƒè™‘idleMã€idlePçš„å¤„ç†äº†ã€‚
psï¼šç³»ç»Ÿè°ƒç”¨é˜»å¡çš„goroutineæ¢å¤æ‰§è¡Œæ—¶ï¼Œä¼šå°†å…¶åŠ å…¥åˆ°global queueä¸­ï¼Œå› æ­¤å…¶å¯èƒ½ç ´åäº†åŸæ¥çš„GMPä¹‹é—´çš„è°ƒåº¦ç²˜æ€§ï¼Œå¯èƒ½åœ¨ä¸åŒçš„Pä¸Šç”±ä¸åŒçš„Mæ¥æ‰§è¡Œã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-work-stealing-in-go-scheduler-d439231be64d</description></item><item><title>work-stealing in go scheduler</title><link>https://hitzhangjie.pro/go-internals-v2/posts/work-stealing-in-go-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://hitzhangjie.pro/go-internals-v2/posts/work-stealing-in-go-scheduler/</guid><description>Let&amp;rsquo;s Summarize # GMPè°ƒåº¦æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªPçš„local queueé•¿åº¦ä¸º256ï¼Œåˆ›å»ºgæ—¶ï¼Œå¦‚æœpçš„local queueæ»¡äº†ï¼Œå°±ä¼šå¾€global queueé‡Œé¢æ”¾äº†ã€‚
ä¸ºäº†ä¿è¯å„ä¸ªPçš„è´Ÿè½½å‡è¡¡ï¼Œé‡‡ç”¨work-stealingè°ƒåº¦æ–¹å¼ï¼Œå½“ä¸€ä¸ªPä¸Šçš„Mè¦æ‰§è¡Œä¸€ä¸ªGæ—¶ï¼ŒGä»å“ªé‡Œè·å–å‘¢ï¼Ÿ
å°è¯•ä»Pçš„local queueè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»global queueè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»netpollerè·å–ï¼Œæ²¡æœ‰åˆ™èµ°ä¸‹ä¸€æ­¥ï¼› å°è¯•ä»å…¶ä»–Pçš„local queueä¸­è·å–ï¼Œæ²¡æœ‰å°±çœŸçš„æ²¡æœ‰äº†ï¼› å¦‚æœçœŸçš„æ²¡æœ‰ï¼Œå°±è¦è€ƒè™‘idleMã€idlePçš„å¤„ç†äº†ã€‚
psï¼šç³»ç»Ÿè°ƒç”¨é˜»å¡çš„goroutineæ¢å¤æ‰§è¡Œæ—¶ï¼Œä¼šå°†å…¶åŠ å…¥åˆ°global queueä¸­ï¼Œå› æ­¤å…¶å¯èƒ½ç ´åäº†åŸæ¥çš„GMPä¹‹é—´çš„è°ƒåº¦ç²˜æ€§ï¼Œå¯èƒ½åœ¨ä¸åŒçš„Pä¸Šç”±ä¸åŒçš„Mæ¥æ‰§è¡Œã€‚
Source Analysis # References # https://medium.com/a-journey-with-go/go-work-stealing-in-go-scheduler-d439231be64d</description></item></channel></rss>
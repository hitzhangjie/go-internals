<!DOCTYPE html>
<html lang="zh" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.82.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Posts" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://hitzhangjie.pro/go-internals-v2/posts/" />

<title>Posts | Go设计实现内幕</title>
<link rel="manifest" href="/go-internals-v2/manifest.json">
<link rel="icon" href="/go-internals-v2/favicon.png" type="image/x-icon">
<link rel="alternate" hreflang="en" href="https://hitzhangjie.pro/go-internals-v2/en/posts/" title="Notes">

<link rel="stylesheet" href="/go-internals-v2/book.min.5ac6c2989f0943405962be6800b442aef429ef26ade26545ecf0617a21d1197a.css" integrity="sha256-WsbCmJ8JQ0BZYr5oALRCrvQp7yat4mVF7PBheiHRGXo=">
<script defer src="/go-internals-v2/zh.search.min.11c7f9052a0367999d4ad7c1d4a6e855fff004ebbb45683eed1b2e9995a0bd03.js" integrity="sha256-Ecf5BSoDZ5mdStfB1KboVf/wBOu7RWg&#43;7RsumZWgvQM="></script>

<script defer src="/go-internals-v2/sw.min.e3f8d329ac7f45d9b3ff588e83620122ab38761b68b73d194944ff43613a3b8d.js" integrity="sha256-4/jTKax/Rdmz/1iOg2IBIqs4dhtotz0ZSUT/Q2E6O40="></script>
<link rel="alternate" type="application/rss+xml" href="https://hitzhangjie.pro/go-internals-v2/posts/index.xml" title="Go设计实现内幕" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/go-internals-v2"><img src="/go-internals-v2/logo.png" alt="Logo" /><span>Go设计实现内幕</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="搜索" aria-label="搜索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/preface/" class="">前言</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/introduction/" class="">简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/table-of-contents/" class="">Table of Contents</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/table-of-contents/with-toc/" class="">With ToC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/table-of-contents/without-toc/" class="">Without ToC</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e95c4460caffb600f4fbaa5e481c2b3b" class="toggle"  />
    <label for="section-e95c4460caffb600f4fbaa5e481c2b3b" class="flex justify-between">
      <a  class="">Collapsed</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/collapsed/3rd-level/" class="">3rd Level</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/collapsed/3rd-level/4th-level/" class="">4th Level</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d4bb91610a9265767097cfd2097f9869" class="toggle"  />
    <label for="section-d4bb91610a9265767097cfd2097f9869" class="flex justify-between">
      <a  class="">Compiler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/aliases-simple-and-efficient/" class="">aliases, simple and efficient</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/builds-linkers-timeline/" class="">builds &amp; linker&#34;s timeline</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/built-in-functions-optimizations/" class="">built-in functions optimizations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/how-go-build-works/" class="">how &#34;go build&#34; works</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/how-are-loops-translated-to-assembly/" class="">how are loops translated to assembly</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/how-to-take-advantage-of-symbols-tables/" class="">how to take advantage of symbols tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/inline-strategy-limitation/" class="">inline strategy &amp; limitation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/introduction-to-the-escape-analysis/" class="">introduction to the escape analysis</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/introduction-to-the-go-compiler/" class="">introduction to the go compiler</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/introduction-to-the-go-compiler-ssa-backend/" class="">introduction to the go compiler ssa backend</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/memory-safety-with-bounds-check/" class="">memory safety with bounds check</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/overview-of-the-compiler/" class="">overview of the compiler</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/slice-and-memory-management/" class="">slice and memory management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://hitzhangjie.pro/go-internals-v2/docs/compiler/understanding-compiler-directives/" class="">understanding compiler directives</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f31e09d220fe3252a0eb99bdea817893" class="toggle"  />
    <label for="section-f31e09d220fe3252a0eb99bdea817893" class="flex justify-between">
      <a  class="">Runtime</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>











<hr>


  
<ul>
  
  <li>
    <a href="/go-internals-v2/posts/" >
        Posts
      </a>
  </li>
  
  <li>
    <a href="https://github.com/hitzhangjie/go-internals-v2" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://hitzhangjie.pro" target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/go-internals-v2/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Posts</strong>

  <label for="toc-control">
    
    <img src="/go-internals-v2/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav>
  <ul>
  
    
    <li class="book-section-flat">
      <strong>Categories</strong>
      <ul>
      
      </ul>
    </li>
    
  
    
    <li class="book-section-flat">
      <strong>Tags</strong>
      <ul>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/ast/">ast</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/chan/">chan</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/chan-select-case/">chan, select-case</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/closure/">closure</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/compiler/">compiler</a>
          <span>24</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/compiler-linker/">compiler, linker</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/concurrency/">concurrency</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/context/">context</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/debug/">debug</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/defer/">defer</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/defer-panic/">defer, panic</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/defer-panic-recover/">defer, panic, recover</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/diagnostics/">diagnostics</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/fuzzy-test/">fuzzy, test</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/garbage-collector/">garbage collector</a>
          <span>11</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/goroutine/">goroutine</a>
          <span>11</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/goroutine-gpm-scheduler/">goroutine, gpm scheduler</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/goroutine-select-case/">goroutine, select-case</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/gpm-scheduler/">gpm scheduler</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/init/">init</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/instrumentation/">instrumentation</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/interface/">interface</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/linker/">linker</a>
          <span>2</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/locks/">locks</a>
          <span>3</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/map/">map</a>
          <span>2</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/map-race-detector/">map, race detector</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/mechanics/">mechanics</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/memory-management/">memory management</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/monitor/">monitor</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/pointer/">pointer</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/pprof/">pprof</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/race-detector/">race detector</a>
          <span>2</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/random/">random</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/string/">string</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/sync.pool/">sync.pool</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/syscall/">syscall</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/tdd-test/">tdd, test</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/test/">test</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/timer/">timer</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/trace/">trace</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/unsafe/">unsafe</a>
          <span>1</span>
        </li>
      
      </ul>
    </li>
    
  
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/improve-the-usage-of-your-goroutines-with-GODEBUG/">improve the usage of your goroutines with GODEBUG</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/goroutine/">goroutine</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  这篇文章介绍了通过goroutine调度latency来分析程序中增加更多的goroutines数量是否有必要，这个示例中的goroutine大部分会因为请求服务端数据而阻塞，这个阻塞时间比较长，严重影响计算，这里增加很多的goroutines并不能充分地利用起计算资源，主要是这里大部分都会阻塞，并不是会切来切去地，无助于提高并发效率。
1 GODEBUG=schedtrace=1 go test 2 runtime/trace, trace.Start(), defer trace.Stop()
输出信息的解释： see https://github.com/golang/go/wiki/Performance#scheduler-trace：
下面是个例子：
SCHED 1004ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=4 runqueue=8 [0 1 0 3] SCHED 2005ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=5 runqueue=6 [1 5 4 0] SCHED 3008ms: gomaxprocs=4 idleprocs=0 threads=11 idlethreads=4 runqueue=10 [2 2 2 1]  The first number (&ldquo;1004ms&rdquo;) is time since program start. Gomaxprocs is the current value of GOMAXPROCS. Idleprocs is the number of idling processors (the rest are executing Go code).
        <a href="/go-internals-v2/posts/improve-the-usage-of-your-goroutines-with-GODEBUG/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/init-functions/">init functions</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/init/">init</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  介绍了go程序中func init()函数的调用时机以及如何避免重复调用的。
package a依赖package b，那么先执行b中的全局变量初始化、func init函数，再执行a中的全局变量初始化、func init函数，这些都是在执行main.main之前完成的。
Source Analysis #  References #   https://medium.com/a-journey-with-go/go-init-functions-319dbb12831c  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/inline-strategy-limitation/">inline strategy &amp; limitation</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/compiler/">compiler</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  inline就是将一些短小简单的函数给展开，消除栈帧构建销毁的开销，多简单算简单呢？
 函数对应的AST语法树节点数不能超过预算，预算是80个； 不能有复杂的程序构造，如for-loop、closure、defer、recover、select等； 函数前不能有noinline directive，禁止内联肯定不能内联； 函数前不能有uintptrescapes，因为内联会导致逃逸信息丢失； 其他规则； 详见：https://github.com/golang/go/wiki/CompilerOptimizations#function-inlining。  可以通过编译选项-gcflags=&quot;-m&quot;来查看编译过程中对哪些函数进行了内联，如果使用编译选项-gcflags=&quot;-m -m&quot;可以看到更详细的信息，如每个函数是否内联的原因：ORANGE不能处理，或者过于复杂、开销过大等等。
内联可能也会给开发者带来一些问题，较早的go版本可能会对内部包含panic的函数做内联，但是最终panic、recover时打印的stacktrace显示的panic位置不准确，对开发者很不友好。应该是go1.13及后续版本中做了优化，内部维护了一个表pc to file及lineno，stacktrace中可以还原出精确的panic位置。我测试go1.16中带panic的简单函数也是可以内联的，并且stacktrace报出的位置也很准确。
函数创建过程中涉及到栈帧创建、寄存器保存恢复、栈帧销毁等工作，和内联后直接执行指令相比，是有开销的，做了部分性能测试发现内联后比内联前有6%的性能提升。
Source Analysis #  References #   https://medium.com/a-journey-with-go/go-inlining-strategy-limitation-6b6d7fc3b1be  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/instrumentation-in-go/">instrumentation in go</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/instrumentation/">instrumentation</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  介绍了go中织入代码的应用，对于go程序的测试覆盖率，它会在现有代码基础上织入一些统计每行语句执行的代码，用来实现语句测试覆盖率的统计。
对于cpu profile，其实不是通过代码织入的方式，而是定期地暂停程序并获取cpu、运行时状态信息，用来显示哪些代码段执行cpu比较花时间。
对于mem profile，这部分能力其是内置在内存分配器里面的，直接执行对应的profile逻辑就可以完成。
Source Analysis #  References #   https://medium.com/a-journey-with-go/go-instrumentation-in-go-e845cdae0c51  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/introduction-to-the-escape-analysis/">introduction to the escape analysis</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/compiler/">compiler</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  escape analysis不只是go中才有的概念，java se 6u23及更新版本均也支持逃逸分析，see：
 https://en.wikipedia.org/wiki/Escape_analysis  go查看逃逸分析结果，可以通过给编译器传递选项-m，如源文件为main.go，可执行：
 go build -gcflags=&quot;-m&quot; main.go go tool compile -m main.go  go里面有几种情况会发生逃逸：
 一个函数内部new(obj)并返回指针，或者声明变量并返回指针，该指针在该函数外被继续使用，会发生逃逸； 一个for循环体内new(obj)创建对象并赋值给外部指针，或者用其他方式声明如var a int然后取地址赋值，会发生逃逸； 一个闭包内通过new(obj)创建对象并赋值给外部指针，或者用其他方式声明如var a int然后取地址赋值，会发生逃逸；  ps：在一个普通的{}构成的块作用域内new(obj)或者对声明变量取地址赋值给外部指针，都是不会发生逃逸的，因为在同一个栈帧内，并不存在outlive the stack frame的情况，根本不需要讨论逃逸的问题。
Source Analysis #  References #   https://medium.com/a-journey-with-go/go-introduction-to-the-escape-analysis-f7610174e890  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/introduction-to-the-go-compiler/">introduction to the go compiler</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/compiler/">compiler</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  go编译器工作过程主要分为这么几个阶段：
 解析阶段：对每个源文件进行词法分析、语法分析，并构建对应的语法树； 类型检查和语法树转换：进行类型检查，如名字解析、类型推断、函数定义是否结束、是否存在但定义未使用的问题。然后还会转换为抽象语法树AST，这个过程中还会根据类型信息做一系列调整优化，如函数内联、deadcode移除等；  以上两个阶段经常成为编译器的frontend，那后端backend指的是哪几个阶段呢？
 generic SSA：AST被转换成SSA（静态单赋值）形式，它是一种中间代码表示，在它基础上可以方便做优化，并转换为机器指令。这个阶段有些rewrite规则，编译器会使用一些高度优化的指令来替换掉一些特殊的内置函数，如cap、len、copy等（前面提过这些函数是没有函数体实现的），了解更多see https://en.wikipedia.org/wiki/Intrinsic_function。这个阶段还会有些节点的形式被做进一步转换，如copy、range别转换成为mov、for-loop等。然后会做有多遍与机器无关的操作和重写，如deadcode移除、nilcheck等等； 生成机器指令：编译器中机器相关的优化从ssa lower pass就开始了，会不断的做出一些更加接近机器低级细节的优化，直到达到机器低级特性之后，最终代码优化就开始了。比如deadcode移除，将value移到最近访问的地方，移除无用的局部变量和不必要的寄存器分配。还有会对栈帧中的变量计算好偏移量，访问更快，并计算GC safepoint处哪些栈上的指针可以保持liveness。ssa生成阶段，go函数被转换为一系列的obj.Prog指令，然后再由汇编器生成目标文件，其中包含了反射数据、导出数据、调试信息。  Source Analysis #  References #   https://github.com/golang/go/blob/release-branch.go1.13/src/cmd/compile/README.md  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/introduction-to-the-go-compiler-ssa-backend/">introduction to the go compiler ssa backend</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/compiler/">compiler</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  介绍了ssa的关键概念，value、memory、block、function、compiler pass，介绍了查看从源代码到ssa各阶段优化再到最终生成的机器指令的查看方法：GOSSAFUNC=${func} go build *.go，会生成一个ssa.html文件，打开即可查看
Source Analysis #  References #   https://github.com/golang/go/blob/release-branch.go1.13/src/cmd/compile/internal/ssa/README.md  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/keeping-a-variable-alive/">keeping a variable alive</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/garbage-collector/">garbage collector</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  介绍了finalizer的使用，介绍了如何通过runtime.KeepAlive(p）来避免p指向的对象被GC掉，其实该函数的实现没有什么特殊的，就是引用了一下p指向的对象而已，在这个函数调用之前的位置是不可能被GC掉的。那我们自己引用以下行不行比如用q := p, _ = q，可能不行，编译器优化有很多遍，比如deadcode移除、函数内联等，这样下来我们自己的写法，可能会因为编译器的一些优化给优化了，导致无效，建议还是使用go提供的方式来来阻止被优化掉。关于这个函数的具体实现，see：https://utcc.utoronto.ca/~cks/space/blog/programming/GoRuntimeKeepAliveNotes。
Source Analysis #  References #   https://medium.com/a-journey-with-go/go-keeping-a-variable-alive-c28e3633673a  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/language-mechanics-on-stacks-and-pointers/">language mechanics on stacks and pointers</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/mechanics/">mechanics</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  to pass by value, to share by pointers.
Source Analysis #  References #   https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-stacks-and-pointers.html  
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/go-internals-v2/posts/language-semantics-on-escape-analysis/">language semantics on escape analysis</a>
    </h2>
    


  

  
  <div>
    
      <a href="/go-internals-v2/tags/mechanics/">mechanics</a>
  </div>
  




    <p>Let&rsquo;s Summarize #  Anytime a value is shared outside the scope of a function’s stack frame, it will be placed (or allocated) on the heap.
The construction of a value doesn’t determine where it lives. Only how a value is shared will determine what the compiler will do with that value. Anytime you share a value up the call stack, it is going to escape. There are other reasons for a value to escape which you will explore in the next post.
        <a href="/go-internals-v2/posts/language-semantics-on-escape-analysis/">...</a>
      
    </p>
  </article>
  

  
<ul class="pagination">
  <li class="page-item">
    <a href="/go-internals-v2/posts/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
  </li>
  <li class="page-item">
    <a href="/go-internals-v2/posts/page/4/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/go-internals-v2/posts/">1</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/go-internals-v2/posts/page/2/">2</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/go-internals-v2/posts/page/3/">3</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/go-internals-v2/posts/page/4/">4</a>
  </li>
  <li class="page-item active">
    <a class="page-link" href="/go-internals-v2/posts/page/5/">5</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/go-internals-v2/posts/page/6/">6</a>
  </li>
  <li class="page-item disabled">
    <span aria-hidden="true">&nbsp;&hellip;&nbsp;</span>
  </li>
  <li class="page-item">
    <a class="page-link" href="/go-internals-v2/posts/page/9/">9</a>
  </li>
  <li class="page-item">
    <a href="/go-internals-v2/posts/page/6/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
  </li>
  <li class="page-item">
    <a href="/go-internals-v2/posts/page/9/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
  </li>
</ul>


 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

  



  
    
  
    
  


  


<div class="book-languages" tabindex="0" aria-haspopup="true">
  <ul>
    <li class="flex align-center">
      <img src="/go-internals-v2/svg/translate.svg" class="book-icon" alt="Languages" />
      Chinese
    </li> 
  </ul>

  <ul class="book-languages-list">
    
    <li class="active">
      <a href="https://hitzhangjie.pro/go-internals-v2/" class="flex align-center">
        <img src="/go-internals-v2/svg/translate.svg" class="book-icon" alt="Languages" />
        Chinese
      </a>
    </li>
    
    <li class="">
      <a href="https://hitzhangjie.pro/go-internals-v2/en/posts/" class="flex align-center">
        <img src="/go-internals-v2/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </li>
    
  </ul>
</div>






  <div>
    <a class="flex align-center" href="https://github.com/hitzhangjie/go-internals/edit/master//content/posts/_index.md" target="_blank" rel="noopener">
      <img src="/go-internals-v2/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>编辑本页</span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  <nav>
  <ul>
  
    
    <li class="book-section-flat">
      <strong>Categories</strong>
      <ul>
      
      </ul>
    </li>
    
  
    
    <li class="book-section-flat">
      <strong>Tags</strong>
      <ul>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/ast/">ast</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/chan/">chan</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/chan-select-case/">chan, select-case</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/closure/">closure</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/compiler/">compiler</a>
          <span>24</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/compiler-linker/">compiler, linker</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/concurrency/">concurrency</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/context/">context</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/debug/">debug</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/defer/">defer</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/defer-panic/">defer, panic</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/defer-panic-recover/">defer, panic, recover</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/diagnostics/">diagnostics</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/fuzzy-test/">fuzzy, test</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/garbage-collector/">garbage collector</a>
          <span>11</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/goroutine/">goroutine</a>
          <span>11</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/goroutine-gpm-scheduler/">goroutine, gpm scheduler</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/goroutine-select-case/">goroutine, select-case</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/gpm-scheduler/">gpm scheduler</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/init/">init</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/instrumentation/">instrumentation</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/interface/">interface</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/linker/">linker</a>
          <span>2</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/locks/">locks</a>
          <span>3</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/map/">map</a>
          <span>2</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/map-race-detector/">map, race detector</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/mechanics/">mechanics</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/memory-management/">memory management</a>
          <span>4</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/monitor/">monitor</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/pointer/">pointer</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/pprof/">pprof</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/race-detector/">race detector</a>
          <span>2</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/random/">random</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/string/">string</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/sync.pool/">sync.pool</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/syscall/">syscall</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/tdd-test/">tdd, test</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/test/">test</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/timer/">timer</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/trace/">trace</a>
          <span>1</span>
        </li>
      
        <li class="flex justify-between">
          <a href="/go-internals-v2/tags/unsafe/">unsafe</a>
          <span>1</span>
        </li>
      
      </ul>
    </li>
    
  
  </ul>
</nav>

 
      </div>
    </aside>
    
  </main>

  
</body>

</html>













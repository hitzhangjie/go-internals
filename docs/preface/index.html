<!doctype html><html lang=zh dir=ltr>
<head>
<meta name=generator content="Hugo 0.91.2">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="前言 #  我们准备做什么 如今，go语言被广泛地应用，相关的分享、书籍也越来越多，从基础到实现细节，《go programming language》、《go语言101》、《go语言设计实现》等。对于高质量的知识分享，“feed me more”可能是很多技术人的同感。当有了一定的沉淀后，是可以靠自己钻研来解惑或答疑的，但能不能系统性地沉淀、由点及面来帮助更多的开发者呢？比如goroutine如何应用、为什么协程好用呢、协程有哪些实现思路、go为何采用现在的方案？融会贯通、给大脑做减法，这就是我们的初衷。  为什么要这么做 钻研计算机技术，需要大量的沉淀积累，学习工作中深刻理解了一点“了解的越多，认识到不懂的也越多”。当尝试了解一个不熟悉的领域时，无异于“跨界”，即便是go test -race这种常见操作，如果不了解并发冲突检测的实现细节，其实也不能算是真的了解的，要理解这些，我们还需要了解点分布式原理的知识（如向量时钟及应用），还有并发冲突检测的框架（如Thread Sanitizer）。当我们能简明扼要地解答一个复杂问题时，就算是真理解了，这样也可以帮助更多人。  准备怎么落地 “一只穿云箭，千军万马来相见”，开源让我感受到了协作分享的力量。我认同凭自身努力深入钻研的过程，但个体时间终究有限，借助高质量的协同能让我们走的更快更远。所以不准备从零到一来写本电子书，日常学习工作中也收集了一些质量很高的文章（当然也有自己写的），这些有价值的信息就这么散落在各个角落，非常有必要将其“串”起来。另外出版书籍更新慢、知识覆盖受限，很多书推敲起来内容会略显单薄，协作、有经验甚至“跨界”的协作者能参与进来，有助于知识由点及面。   和Go语言的相识 #  go语言并不是我接触的第一门编程语言，当我第一次了解这门语言还是在2016年，和c语言比较起来其“怪异”的语法让我很不习惯，工作之后，使用的服务框架对协程支持的局限性让我重新开始接触go语言，那个时候我还是倾向于c/c++/java开发的，对go甚至有种抵触。我宁可去钻研libmill、libdill、boost coroutine、kilim、qusar等，也不想去琢磨go？原因仅仅是觉得它的语法有点怪异 😂
这个过程持续了一段时间，直到踩的坑越来越多，直到再也不想听“口耳相传”的经验：
 服务框架spp有3大件，proxy收包、worker处理、ctrl健康检查，我在worker里加了点可能导致阻塞的系统调用（非网络io），嘿，因为worker阻塞失去心跳被ctrl杀掉了。 服务框架spp协程栈固定大小128k，有个小伙伴在协程处理逻辑内创建了个比较大的局部变量，导致超出协程栈上限，嘿，段错误崩溃了。 服务框架jungle配合kilim字节码织入实现协程，偶尔忘记加@Pausable导致出问题，出了问题排查起来还费劲，嘿，每次被高工指导。 服务框架jungle使用的kilim字节码织入，只支持jdk 1.7字节码，嘿，jdk没法升级了。 这些框架中的微线程实现、字节码织入方案，基本上只是处理了网络io（connect、send、receive、read、write）之类的操作，但是可能导致阻塞的操作远远不止网络io啊，比如锁lock、unlock…嘿，难道用到啥都要hook下？ ……  在我看了spp框架、jungle框架以及字节码织入方案等的局限性之后，我不想再折腾这些了，我开始花更多时间去了解go，这就是我和go语言美好关系的开始。工作中遇到的开发效率的问题、依赖管理的问题、编译构建的问题、代码风格的问题等，最终导致我们团队下定决心转go语言。
我眼中的Go语言 #  在评价go语言之前，想先提下对c语言的评价，曾经有人这样评价c语言：“任何比c语言更低级的语言，都不足以抽象一个完整的计算机系统；任何比c语言更高级的语言，都可以用c语言来实现”。结合我学习过的编程语言来看，汇编、c、c++、java、swift、go、rust、python、php、javascript，仔细琢磨下我认为这样的评价实至名归。
学习软件工程时，我们系统性学习了过程式、面向对象的方法，结合不同编程语言对上虞思想的支持，开始时经验肤浅的我像很多开发者一样，天真的认为缺少某些oo支持的语言是难以架构大型软件的，直到我读了linux内核代码，我才认识到自己的认知多么肤浅。原来，在大佬的世界里，编程思想一直存在，语言只是实现思想的工具而已（linux内核中有非常多oo思想的实践，也有很多对c++ smartpointer的模拟，等等）。
时至今日，再看go语言我已经客观地多，它确实是一门工程化不错的语言：
  和c\c++比，它有较好的依赖管理，基本开箱即用的标准库，经得起推敲的代码风格规范，较完整的编译构建、测试、代码分析、性能分析工具，还有更简便易用的并发控制（chan、sync.*、goroutine），其符合大家认知的happens-before关系建立，即便有可能认识不够到位、代码出错的概率也大大下降。
  和java比，它不强制面向对象的招式，却也有面向对象思想的支持，组合优于继承，interface的类型断言、转换，以及后续范型支持（尽管现在go1.18版本还有待完善）。另外，同为自动内存管理的语言，和java jvm调优的数不尽的参数比起来，go的GC pacer仅依靠一个变量设置GOGC，如何在一堆参数中获得一个全局最优解的组合，java可能比go调优时控制粒度更细，但是很明显go可以在内存不是什么硬伤的情况下调优更简单。
  和rust比，rust的描述性非常强，编译器能力也非常强，如果能忍受编译器的毒打，并深刻理解rust的设计思想之后，rust确实也是不错的，编译器说对那将来跑起来也会对。和服务跑起来后再排查一些难跟踪的错误，rust的优势就会让人觉得很值。但是我们并不是什么开发小白、我们可能要维护的对象也没那么复杂，不否定rust的价值，但是rust和go相比，目前go的能力是我们团队更希望拥有的。
ps：腾讯内部trpc微服务框架实例数，go版本的有2w+，rust版本的只有个位数。
  在合适的场景下go非常有价值，如果非要将其用到一些它不擅长的地方，就需要注意了：
 嵌入式开发领域，go有GC机制，可能要做类似tinygo的编译器调整、特性裁剪； 超大规模长连接管理，go的默认实现是goroutine per connection模型，连接数多了goroutine数也上来了，goroutine stack、为连接分配的resizable buffer、连接上事件的polling都会成为不可忽略的问题。业界比较好的方案是两级reactor的实现思路，类似地go版本实现gnet； 密集计算的问题，go比较大的优势在于goroutine并发处理，但是goroutine切换有固定的切换时机（网络IO等等），密集计算场景下goroutine切换不符合“预期”，并发处理效率跟不上，可能需要考虑多进程+taskset绑核处理； 其他问题；  在不合适的场景下就需要多考虑、多钻研透一些，需要综合投入产出比慎重考虑，这种情况下其他语言是否更有优势就很值得考虑了。">
<meta name=theme-color content="#FFFFFF"><meta property="og:title" content="前言">
<meta property="og:description" content="前言 #  我们准备做什么 如今，go语言被广泛地应用，相关的分享、书籍也越来越多，从基础到实现细节，《go programming language》、《go语言101》、《go语言设计实现》等。对于高质量的知识分享，“feed me more”可能是很多技术人的同感。当有了一定的沉淀后，是可以靠自己钻研来解惑或答疑的，但能不能系统性地沉淀、由点及面来帮助更多的开发者呢？比如goroutine如何应用、为什么协程好用呢、协程有哪些实现思路、go为何采用现在的方案？融会贯通、给大脑做减法，这就是我们的初衷。  为什么要这么做 钻研计算机技术，需要大量的沉淀积累，学习工作中深刻理解了一点“了解的越多，认识到不懂的也越多”。当尝试了解一个不熟悉的领域时，无异于“跨界”，即便是go test -race这种常见操作，如果不了解并发冲突检测的实现细节，其实也不能算是真的了解的，要理解这些，我们还需要了解点分布式原理的知识（如向量时钟及应用），还有并发冲突检测的框架（如Thread Sanitizer）。当我们能简明扼要地解答一个复杂问题时，就算是真理解了，这样也可以帮助更多人。  准备怎么落地 “一只穿云箭，千军万马来相见”，开源让我感受到了协作分享的力量。我认同凭自身努力深入钻研的过程，但个体时间终究有限，借助高质量的协同能让我们走的更快更远。所以不准备从零到一来写本电子书，日常学习工作中也收集了一些质量很高的文章（当然也有自己写的），这些有价值的信息就这么散落在各个角落，非常有必要将其“串”起来。另外出版书籍更新慢、知识覆盖受限，很多书推敲起来内容会略显单薄，协作、有经验甚至“跨界”的协作者能参与进来，有助于知识由点及面。   和Go语言的相识 #  go语言并不是我接触的第一门编程语言，当我第一次了解这门语言还是在2016年，和c语言比较起来其“怪异”的语法让我很不习惯，工作之后，使用的服务框架对协程支持的局限性让我重新开始接触go语言，那个时候我还是倾向于c/c++/java开发的，对go甚至有种抵触。我宁可去钻研libmill、libdill、boost coroutine、kilim、qusar等，也不想去琢磨go？原因仅仅是觉得它的语法有点怪异 😂
这个过程持续了一段时间，直到踩的坑越来越多，直到再也不想听“口耳相传”的经验：
 服务框架spp有3大件，proxy收包、worker处理、ctrl健康检查，我在worker里加了点可能导致阻塞的系统调用（非网络io），嘿，因为worker阻塞失去心跳被ctrl杀掉了。 服务框架spp协程栈固定大小128k，有个小伙伴在协程处理逻辑内创建了个比较大的局部变量，导致超出协程栈上限，嘿，段错误崩溃了。 服务框架jungle配合kilim字节码织入实现协程，偶尔忘记加@Pausable导致出问题，出了问题排查起来还费劲，嘿，每次被高工指导。 服务框架jungle使用的kilim字节码织入，只支持jdk 1.7字节码，嘿，jdk没法升级了。 这些框架中的微线程实现、字节码织入方案，基本上只是处理了网络io（connect、send、receive、read、write）之类的操作，但是可能导致阻塞的操作远远不止网络io啊，比如锁lock、unlock…嘿，难道用到啥都要hook下？ ……  在我看了spp框架、jungle框架以及字节码织入方案等的局限性之后，我不想再折腾这些了，我开始花更多时间去了解go，这就是我和go语言美好关系的开始。工作中遇到的开发效率的问题、依赖管理的问题、编译构建的问题、代码风格的问题等，最终导致我们团队下定决心转go语言。
我眼中的Go语言 #  在评价go语言之前，想先提下对c语言的评价，曾经有人这样评价c语言：“任何比c语言更低级的语言，都不足以抽象一个完整的计算机系统；任何比c语言更高级的语言，都可以用c语言来实现”。结合我学习过的编程语言来看，汇编、c、c++、java、swift、go、rust、python、php、javascript，仔细琢磨下我认为这样的评价实至名归。
学习软件工程时，我们系统性学习了过程式、面向对象的方法，结合不同编程语言对上虞思想的支持，开始时经验肤浅的我像很多开发者一样，天真的认为缺少某些oo支持的语言是难以架构大型软件的，直到我读了linux内核代码，我才认识到自己的认知多么肤浅。原来，在大佬的世界里，编程思想一直存在，语言只是实现思想的工具而已（linux内核中有非常多oo思想的实践，也有很多对c++ smartpointer的模拟，等等）。
时至今日，再看go语言我已经客观地多，它确实是一门工程化不错的语言：
  和c\c++比，它有较好的依赖管理，基本开箱即用的标准库，经得起推敲的代码风格规范，较完整的编译构建、测试、代码分析、性能分析工具，还有更简便易用的并发控制（chan、sync.*、goroutine），其符合大家认知的happens-before关系建立，即便有可能认识不够到位、代码出错的概率也大大下降。
  和java比，它不强制面向对象的招式，却也有面向对象思想的支持，组合优于继承，interface的类型断言、转换，以及后续范型支持（尽管现在go1.18版本还有待完善）。另外，同为自动内存管理的语言，和java jvm调优的数不尽的参数比起来，go的GC pacer仅依靠一个变量设置GOGC，如何在一堆参数中获得一个全局最优解的组合，java可能比go调优时控制粒度更细，但是很明显go可以在内存不是什么硬伤的情况下调优更简单。
  和rust比，rust的描述性非常强，编译器能力也非常强，如果能忍受编译器的毒打，并深刻理解rust的设计思想之后，rust确实也是不错的，编译器说对那将来跑起来也会对。和服务跑起来后再排查一些难跟踪的错误，rust的优势就会让人觉得很值。但是我们并不是什么开发小白、我们可能要维护的对象也没那么复杂，不否定rust的价值，但是rust和go相比，目前go的能力是我们团队更希望拥有的。
ps：腾讯内部trpc微服务框架实例数，go版本的有2w+，rust版本的只有个位数。
  在合适的场景下go非常有价值，如果非要将其用到一些它不擅长的地方，就需要注意了：
 嵌入式开发领域，go有GC机制，可能要做类似tinygo的编译器调整、特性裁剪； 超大规模长连接管理，go的默认实现是goroutine per connection模型，连接数多了goroutine数也上来了，goroutine stack、为连接分配的resizable buffer、连接上事件的polling都会成为不可忽略的问题。业界比较好的方案是两级reactor的实现思路，类似地go版本实现gnet； 密集计算的问题，go比较大的优势在于goroutine并发处理，但是goroutine切换有固定的切换时机（网络IO等等），密集计算场景下goroutine切换不符合“预期”，并发处理效率跟不上，可能需要考虑多进程+taskset绑核处理； 其他问题；  在不合适的场景下就需要多考虑、多钻研透一些，需要综合投入产出比慎重考虑，这种情况下其他语言是否更有优势就很值得考虑了。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://hitzhangjie.pro/go-internals/docs/preface/"><meta property="article:section" content="docs">
<title>前言 | Go设计实现内幕</title>
<link rel=manifest href=/go-internals/manifest.json>
<link rel=icon href=/go-internals/favicon.png type=image/x-icon>
<link rel=stylesheet href=/go-internals/book.min.68be0b7a9674f2a612ce0e9b2e9447ff4b7ac96546e06b642bfd3ded0ca490ef.css integrity="sha256-aL4LepZ08qYSzg6bLpRH/0t6yWVG4GtkK/097QykkO8=">
<script defer src=/go-internals/zh.search.min.cfc57077e74bf0a2fbf89809c2492fb8c2bce07336cb937d6a566a463ee48590.js integrity="sha256-z8Vwd+dL8KL7+JgJwkkvuMK84HM2y5N9alZqRj7khZA="></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a href=/go-internals><img src=/go-internals/logo.png alt=Logo><span>Go设计实现内幕</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/preface/ class=active>前言</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/introduction/>简介</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/setup/>准备</a>
</li>
<li>
<input type=checkbox id=section-a0d8d71f426b3018d3ea2b0d39cb80dd class=toggle>
<label for=section-a0d8d71f426b3018d3ea2b0d39cb80dd class="flex justify-between">
<a>Specification</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Specification/go-spec/>go spec</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-5b4c35c78aaa50e4262cf5f000ff643f class=toggle>
<label for=section-5b4c35c78aaa50e4262cf5f000ff643f class="flex justify-between">
<a>Toolchain</a>
</label>
<ul>
<li>
<input type=checkbox id=section-1478ad0225f3c1062830d9c09d8b93f3 class=toggle>
<label for=section-1478ad0225f3c1062830d9c09d8b93f3 class="flex justify-between">
<a>Compiler</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/aliases-simple-and-efficient/>aliases, simple and efficient</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/builds-linkers-timeline/>builds & linker"s timeline</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/built-in-functions-optimizations/>built-in functions optimizations</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/how-go-build-works/>how "go build" works</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/how-are-loops-translated-to-assembly/>how are loops translated to assembly</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/how-to-take-advantage-of-symbols-tables/>how to take advantage of symbols tables</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/inline-strategy-limitation/>inline strategy & limitation</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/introduction-to-the-escape-analysis/>introduction to the escape analysis</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/introduction-to-the-go-compiler/>introduction to the go compiler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/introduction-to-the-go-compiler-ssa-backend/>introduction to the go compiler ssa backend</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/language-semantics-on-escape-analysis/>language semantics on escape analysis</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/memory-safety-with-bounds-check/>memory safety with bounds check</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/overview-of-the-compiler/>overview of the compiler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/slice-and-memory-management/>slice and memory management</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Compiler/understanding-compiler-directives/>understanding compiler directives</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-7e4c79944057f12c630cadb7f66ae71d class=toggle>
<label for=section-7e4c79944057f12c630cadb7f66ae71d class="flex justify-between">
<a>Linker</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Linker/build-a-better-linker/>build a better linker</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Linker/builds-linkers-timeline/>builds & linker"s timeline</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Linker/how-go-build-works/>how "go build" works</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/Linker/object-file-relocations/>object file & relocations</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ff16c11cae45273096ca6b9016ad8f91 class=toggle>
<label for=section-ff16c11cae45273096ca6b9016ad8f91 class="flex justify-between">
<a>Abi</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/ABI/go-register-ABI/>go register ABI</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-92155f78ab2fea96864dc8e5f605cf23 class=toggle>
<label for=section-92155f78ab2fea96864dc8e5f605cf23 class="flex justify-between">
<a>Ast</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/AST/visualize-your-go-code/>visualize your go code</a>
</li>
</ul>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Toolchain/instrumentation-in-go/>instrumentation in go</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-2cf4e97d00d6e0846a455aed8f898520 class=toggle>
<label for=section-2cf4e97d00d6e0846a455aed8f898520 class="flex justify-between">
<a>Memory</a>
</label>
<ul>
<li>
<input type=checkbox id=section-93dba9f40586c2c35d783752f434d3fe class=toggle>
<label for=section-93dba9f40586c2c35d783752f434d3fe class="flex justify-between">
<a>Memory Allocation</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/MemoryAllocation/demystifying-memory-management-in-modern-programming-languages/>demystifying memory management in modern programming languages</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/MemoryAllocation/memory-management-and-allocation/>memory management and allocation</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/MemoryAllocation/memory-management-and-memory-sweep/>memory management and memory sweep</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/MemoryAllocation/slice-and-memory-management/>slice and memory management</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/MemoryAllocation/visualizing-memory-management-in-go/>visualizing memory management in go</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-c7a4c22522235f51a39ce7f70ed7225e class=toggle>
<label for=section-c7a4c22522235f51a39ce7f70ed7225e class="flex justify-between">
<a>Garbage Collection</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/an-insight-into-go-garbage-collector/>an insight into go garbage collector</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/finalizers/>finalizers</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/go-GC-latency-problem-solved/>go GC: latency problem solved</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/go-GC-prioritizing-low-latency-and-simplicity/>go GC: prioritizing low latency and simplicity</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/how-does-GC-mark-the-memory/>how does GC mark the memory</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/how-does-GC-watch-your-application/>how does GC watch your application</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/how-does-go-stop-the-world/>how does go stop the world</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/keeping-a-variable-alive/>keeping a variable alive</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/memory-management-and-allocation/>memory management and allocation</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/memory-management-and-memory-sweep/>memory management and memory sweep</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/the-garbage-collection-handbook/>the garbage collection handbook</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/the-rules-of-unsafe.Pointer-and-uintptr/>the rules of unsafe.Pointer and uintptr</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Memory/GarbageCollection/tracing-garbage-collection/>tracing garbage collection</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-52225bc65f7b2a78999589b1479ab0c3 class=toggle>
<label for=section-52225bc65f7b2a78999589b1479ab0c3 class="flex justify-between">
<a>Goroutine</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/asynchronous-preemption/>asynchronous preemption</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/concurrency-scheduler-affinity/>concurrency & scheduler affinity</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/g0-special-goroutines/>g0, special goroutines</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/goroutine-and-preemption/>goroutine and preemption</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/goroutine-os-thread-and-cpu-management/>goroutine, os thread, and cpu management</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/gsignal-master-of-signals/>gsignal, master of signals</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/how-does-a-goroutine-start-and-exit/>how does a goroutine start and exit</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/how-does-go-recycle-goroutines/>how does go recycle goroutines</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/how-goroutine-stack-size-evolve/>how goroutine stack size evolve</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/improve-the-usage-of-your-goroutines-with-GODEBUG/>improve the usage of your goroutines with GODEBUG</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/observing-stack-grow-and-shrink/>observing stack grow and shrink</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/what-does-a-goroutine-switch-actually-involve/>what does a goroutine switch actually involve</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Goroutine/work-stealing-in-go-scheduler/>work-stealing in go scheduler</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-f31e09d220fe3252a0eb99bdea817893 class=toggle>
<label for=section-f31e09d220fe3252a0eb99bdea817893 class="flex justify-between">
<a>Runtime</a>
</label>
<ul>
<li>
<input type=checkbox id=section-6af4e9ddadfe05b53d5ba165c38f1e3e class=toggle>
<label for=section-6af4e9ddadfe05b53d5ba165c38f1e3e class="flex justify-between">
<a>Scheduler</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/Scheduler/concurrency-scheduler-affinity/>concurrency & scheduler affinity</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/Scheduler/GOMAXPROCS-live-updates/>GOMAXPROCS & live updates</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/Scheduler/scheduling-in-go-part-i-os-scheduler/>scheduling in go: part i - os scheduler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/Scheduler/scheduling-in-go-part-ii-go-scheduler/>scheduling in go: part ii - go scheduler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/Scheduler/scheduling-in-go-part-iii-concurrency/>scheduling in go: part iii - concurrency</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/Scheduler/work-stealing-in-go-scheduler/>work-stealing in go scheduler</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-825adbd2b838041eea46d2a10adc5f9a class=toggle>
<label for=section-825adbd2b838041eea46d2a10adc5f9a class="flex justify-between">
<a>Monitor</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/Monitor/monitor-pattern/>monitor pattern</a>
</li>
</ul>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/runtime/a-whirlwind-tour-of-Gos-runtime-environment-variables/>a whirlwind tour of Go’s runtime environment variables</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-93d588918944a298d3f4270e6df9e968 class=toggle>
<label for=section-93d588918944a298d3f4270e6df9e968 class="flex justify-between">
<a>Synchronization</a>
</label>
<ul>
<li>
<input type=checkbox id=section-e4f56fa00191ca8306d1438c969bef3e class=toggle>
<label for=section-e4f56fa00191ca8306d1438c969bef3e class="flex justify-between">
<a>Locks</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Synchronization/Locks/how-to-reduce-lock-contention-with-the-atomic-package/>how to reduce lock contention with the atomic package</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Synchronization/Locks/locks-sync.Mutex-internals/>locks: sync.Mutex internals</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Synchronization/Locks/mutex-and-starvation/>mutex and starvation</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-d90698102847b301cf3137d159da1529 class=toggle>
<label for=section-d90698102847b301cf3137d159da1529 class="flex justify-between">
<a>Race Detection</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Synchronization/RaceDetection/a-race-detector-unfurled/>a race detector unfurled</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Synchronization/RaceDetection/race-detector-with-thread-sanitizer/>race detector with thread sanitizer</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-8c09d3d57dd5ee0090220d9bf96ec092 class=toggle>
<label for=section-8c09d3d57dd5ee0090220d9bf96ec092 class="flex justify-between">
<a>Diagnostics</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Diagnostics/diagnostics-methods/>Diagnostics Methods</a>
</li>
<li>
<input type=checkbox id=section-1c55d6e534f174d1a9d86e1f0d27011e class=toggle>
<label for=section-1c55d6e534f174d1a9d86e1f0d27011e class="flex justify-between">
<a>Debugging</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Diagnostics/Debugging/debugging-with-delve-coredumps/>debugging with delve & coredumps</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-25c014c40c4708b8f9b278eab857403a class=toggle>
<label for=section-25c014c40c4708b8f9b278eab857403a class="flex justify-between">
<a>PProf</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Diagnostics/PProf/language-semantics-on-memory-profiling/>language semantics on memory profiling</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Diagnostics/PProf/samples-collection-with-pprof/>samples collection with pprof</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ef57056641f9c66c69d93a6c9fc4c689 class=toggle>
<label for=section-ef57056641f9c66c69d93a6c9fc4c689 class="flex justify-between">
<a>Tracing</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Diagnostics/Tracing/discovery-of-the-trace-package/>discovery of the trace package</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-51db080d4a3f95e2e371c478fda59b4e class=toggle>
<label for=section-51db080d4a3f95e2e371c478fda59b4e class="flex justify-between">
<a>Testing</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Testing/Benchmarking-in-Golang-Improving-function-performance/>Benchmarking in Golang: Improving function performance</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Testing/learn-go-with-tests/>learn-go-with-tests</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Testing/practical-fuzzing-with-go/>practical fuzzing with go</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Testing/unknown-parts-of-the-test-package/>unknown parts of the test package</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-129195bb7d4d59f2206f00e863a8ebdb class=toggle>
<label for=section-129195bb7d4d59f2206f00e863a8ebdb class="flex justify-between">
<a>Builtins</a>
</label>
<ul>
<li>
<input type=checkbox id=section-651c7afe116c240343430442fd77600a class=toggle>
<label for=section-651c7afe116c240343430442fd77600a class="flex justify-between">
<a>Chan</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/chan/buffered-and-unbuffered-channels/>buffered and unbuffered channels</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/chan/ordering-in-select-statements/>ordering in select statements</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-8e712e14ba6fe05a22de8ae756efc620 class=toggle>
<label for=section-8e712e14ba6fe05a22de8ae756efc620 class="flex justify-between">
<a>Map</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/map/concurrent-access-with-maps-part-3/>concurrent access with maps - part 3</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/map/map-design-by-code-part-1/>map design by code - part 1</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/map/map-design-by-code-part-2/>map design by code - part 2</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-631a92c08b04d863b1a494f36d547be5 class=toggle>
<label for=section-631a92c08b04d863b1a494f36d547be5 class="flex justify-between">
<a>Unsafe</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/unsafe/what-is-the-unsafe-package/>what is the unsafe package</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-a30ce872f66ddfa47ddd53e71fd3fd9b class=toggle>
<label for=section-a30ce872f66ddfa47ddd53e71fd3fd9b class="flex justify-between">
<a>Closure</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/closure/how-does-go-implement-closures/>how does go implement closures</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-89e63630549fc7d7179c5ff90b10c96f class=toggle>
<label for=section-89e63630549fc7d7179c5ff90b10c96f class="flex justify-between">
<a>Constants</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/constants/learn-go-constants-a-visual-guide/>learn go constants - a visual guide</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-09774e50ad4b214a713fa8f577f26533 class=toggle>
<label for=section-09774e50ad4b214a713fa8f577f26533 class="flex justify-between">
<a>Context</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/context/context-and-cancellation-by-propagation/>context and cancellation by propagation</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-e85e2a8e1719b54415998cfeaa4c64c5 class=toggle>
<label for=section-e85e2a8e1719b54415998cfeaa4c64c5 class="flex justify-between">
<a>Defer</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/defer/defer-internals/>defer internals</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/defer/how-does-defer-statement-work/>how does defer statement work</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-48164f93f23fb4774ca384e9dc84f94d class=toggle>
<label for=section-48164f93f23fb4774ca384e9dc84f94d class="flex justify-between">
<a>Init</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/init/init-functions/>init functions</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-982535b748a0cf94fc4e363a4220c45e class=toggle>
<label for=section-982535b748a0cf94fc4e363a4220c45e class="flex justify-between">
<a>Interface</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/interface/understand-the-empty-interface/>understand the empty interface</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-95d1523b99d14914e1c43fbb32ebdfa3 class=toggle>
<label for=section-95d1523b99d14914e1c43fbb32ebdfa3 class="flex justify-between">
<a>Panic&Recover</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/panicrecover/how-does-a-program-recover/>how does a program recover</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-41006be660761bf1634dc3afef87d119 class=toggle>
<label for=section-41006be660761bf1634dc3afef87d119 class="flex justify-between">
<a>Pointer</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/pointer/design-philosophy-on-data-and-semantics/>design philosophy on data and semantics</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/pointer/language-mechanics-on-stacks-and-pointers/>language mechanics on stacks and pointers</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/pointer/should-i-use-pointer-instead-of-a-copy-of-struct/>should i use pointer instead of a copy of struct</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-518237b5864e05a88795053dc0aadf7a class=toggle>
<label for=section-518237b5864e05a88795053dc0aadf7a class="flex justify-between">
<a>Pool</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/pool/understand-the-design-of-sync.pool/>understand the design of sync.pool</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-02c17940ee18fd0e28da376b638e2d61 class=toggle>
<label for=section-02c17940ee18fd0e28da376b638e2d61 class="flex justify-between">
<a>Random</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/random/how-are-random-numbers-generated/>how are random numbers generated</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-9eb4f02a7524818c4c71d8579f485a0a class=toggle>
<label for=section-9eb4f02a7524818c4c71d8579f485a0a class="flex justify-between">
<a>String</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/string/string-conversion-optimization/>string & conversion optimization</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-5fd51849c5efc7c80caa0bfef5a0f76f class=toggle>
<label for=section-5fd51849c5efc7c80caa0bfef5a0f76f class="flex justify-between">
<a>Syscall</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/syscall/how-does-go-runtime-handles-syscall/>how does go runtime handles syscall</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-dc98d3d867181a4b7f4594d457e17777 class=toggle>
<label for=section-dc98d3d867181a4b7f4594d457e17777 class="flex justify-between">
<a>Timer</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Builtins/timer/timers-life-cycle/>timers" life cycle</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-54ff0ab7dec4280864e76f3fd0b3d0c8 class=toggle>
<label for=section-54ff0ab7dec4280864e76f3fd0b3d0c8 class="flex justify-between">
<a>Patterns</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Patterns/rethinking-classical-concurrency-patterns/>rethinking classical concurrency patterns</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-9e07a1bfbe561ed3f6806c311a77856d class=toggle>
<label for=section-9e07a1bfbe561ed3f6806c311a77856d class="flex justify-between">
<a>Infrastructure</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Infrastructure/what-is-a-goproxy/>what is a goproxy</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Infrastructure/playing-with-go-module-proxy/>playing with go module proxy</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ce52ab5a3ea7b9d335993e1906973892 class=toggle>
<label for=section-ce52ab5a3ea7b9d335993e1906973892 class="flex justify-between">
<a>Plugins</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Plugins/go-plugin-system/>go plugin system</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-f126f3c1abfdb1f388f4aa1d63bf636e class=toggle>
<label for=section-f126f3c1abfdb1f388f4aa1d63bf636e class="flex justify-between">
<a>Types</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Types/duck-typing-structural-typing-nominal-typing/>duck typing, structural typing, nominal typing</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/Types/structural-typing-and-norminal-typing/>structural typing and norminal typing</a>
</li>
</ul>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals/docs/SUMMARY/>Summary</a>
</li>
</ul>
<hr>
<ul>
<li>
<a href=/go-internals/posts/>
Posts
</a>
</li>
<li>
<a href=https://github.com/hitzhangjie/go-internals target=_blank rel=noopener>
Github
</a>
</li>
<li>
<a href=https://hitzhangjie.pro target=_blank rel=noopener>
Blog
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/go-internals/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>前言</strong>
<label for=toc-control>
<img src=/go-internals/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#前言>前言</a>
<ul>
<li><a href=#和go语言的相识>和Go语言的相识</a></li>
<li><a href=#我眼中的go语言>我眼中的Go语言</a></li>
<li><a href=#go入门教程推荐>Go入门教程推荐</a></li>
<li><a href=#本书存在的意义>本书存在的意义</a></li>
<li><a href=#联系方式>联系方式</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=前言>
前言
<a class=anchor href=#%e5%89%8d%e8%a8%80>#</a>
</h1>
<div class="book-columns flex flex-wrap">
<div class="flex-even markdown-inner">
<h2 id=我们准备做什么>我们准备做什么</h2>
<p>如今，go语言被广泛地应用，相关的分享、书籍也越来越多，从基础到实现细节，《go programming language》、《go语言101》、《go语言设计实现》等。对于高质量的知识分享，“feed me more”可能是很多技术人的同感。当有了一定的沉淀后，是可以靠自己钻研来解惑或答疑的，但能不能系统性地沉淀、由点及面来帮助更多的开发者呢？比如goroutine如何应用、为什么协程好用呢、协程有哪些实现思路、go为何采用现在的方案？融会贯通、给大脑做减法，这就是我们的初衷。
</div>
<div class="flex-even markdown-inner">
<h2 id=为什么要这么做>为什么要这么做</h2>
<p>钻研计算机技术，需要大量的沉淀积累，学习工作中深刻理解了一点“了解的越多，认识到不懂的也越多”。当尝试了解一个不熟悉的领域时，无异于“跨界”，即便是<code>go test -race</code>这种常见操作，如果不了解并发冲突检测的实现细节，其实也不能算是真的了解的，要理解这些，我们还需要了解点分布式原理的知识（如向量时钟及应用），还有并发冲突检测的框架（如Thread Sanitizer）。当我们能简明扼要地解答一个复杂问题时，就算是真理解了，这样也可以帮助更多人。
</div>
<div class="flex-even markdown-inner">
<h2 id=准备怎么落地>准备怎么落地</h2>
<p>“一只穿云箭，千军万马来相见”，开源让我感受到了协作分享的力量。我认同凭自身努力深入钻研的过程，但个体时间终究有限，借助高质量的协同能让我们走的更快更远。所以不准备从零到一来写本电子书，日常学习工作中也收集了一些质量很高的文章（当然也有自己写的），这些有价值的信息就这么散落在各个角落，非常有必要将其“串”起来。另外出版书籍更新慢、知识覆盖受限，很多书推敲起来内容会略显单薄，协作、有经验甚至“跨界”的协作者能参与进来，有助于知识由点及面。
</div>
</div>
<h2 id=和go语言的相识>
和Go语言的相识
<a class=anchor href=#%e5%92%8cgo%e8%af%ad%e8%a8%80%e7%9a%84%e7%9b%b8%e8%af%86>#</a>
</h2>
<p>go语言并不是我接触的第一门编程语言，当我第一次了解这门语言还是在2016年，和c语言比较起来其“怪异”的语法让我很不习惯，工作之后，使用的服务框架对协程支持的局限性让我重新开始接触go语言，那个时候我还是倾向于c/c++/java开发的，对go甚至有种抵触。我宁可去钻研libmill、libdill、boost coroutine、kilim、qusar等，也不想去琢磨go？原因仅仅是觉得它的语法有点怪异 😂</p>
<p>这个过程持续了一段时间，直到踩的坑越来越多，直到再也不想听“口耳相传”的经验：</p>
<ul>
<li>服务框架spp有3大件，proxy收包、worker处理、ctrl健康检查，我在worker里加了点可能导致阻塞的系统调用（非网络io），嘿，因为worker阻塞失去心跳被ctrl杀掉了。</li>
<li>服务框架spp协程栈固定大小128k，有个小伙伴在协程处理逻辑内创建了个比较大的局部变量，导致超出协程栈上限，嘿，段错误崩溃了。</li>
<li>服务框架jungle配合kilim字节码织入实现协程，偶尔忘记加@Pausable导致出问题，出了问题排查起来还费劲，嘿，每次被高工指导。</li>
<li>服务框架jungle使用的kilim字节码织入，只支持jdk 1.7字节码，嘿，jdk没法升级了。</li>
<li>这些框架中的微线程实现、字节码织入方案，基本上只是处理了网络io（connect、send、receive、read、write）之类的操作，但是可能导致阻塞的操作远远不止网络io啊，比如锁lock、unlock…嘿，难道用到啥都要hook下？</li>
<li>……</li>
</ul>
<p>在我看了spp框架、jungle框架以及字节码织入方案等的局限性之后，我不想再折腾这些了，我开始花更多时间去了解go，这就是我和go语言美好关系的开始。工作中遇到的开发效率的问题、依赖管理的问题、编译构建的问题、代码风格的问题等，最终导致我们团队下定决心转go语言。</p>
<h2 id=我眼中的go语言>
我眼中的Go语言
<a class=anchor href=#%e6%88%91%e7%9c%bc%e4%b8%ad%e7%9a%84go%e8%af%ad%e8%a8%80>#</a>
</h2>
<p>在评价go语言之前，想先提下对c语言的评价，曾经有人这样评价c语言：“任何比c语言更低级的语言，都不足以抽象一个完整的计算机系统；任何比c语言更高级的语言，都可以用c语言来实现”。结合我学习过的编程语言来看，汇编、c、c++、java、swift、go、rust、python、php、javascript，仔细琢磨下我认为这样的评价实至名归。</p>
<p>学习软件工程时，我们系统性学习了过程式、面向对象的方法，结合不同编程语言对上虞思想的支持，开始时经验肤浅的我像很多开发者一样，天真的认为缺少某些oo支持的语言是难以架构大型软件的，直到我读了linux内核代码，我才认识到自己的认知多么肤浅。原来，在大佬的世界里，编程思想一直存在，语言只是实现思想的工具而已（linux内核中有非常多oo思想的实践，也有很多对c++ smartpointer的模拟，等等）。</p>
<p>时至今日，再看go语言我已经客观地多，它确实是一门工程化不错的语言：</p>
<ul>
<li>
<p>和c\c++比，它有较好的依赖管理，基本开箱即用的标准库，经得起推敲的代码风格规范，较完整的编译构建、测试、代码分析、性能分析工具，还有更简便易用的并发控制（chan、sync.*、goroutine），其符合大家认知的happens-before关系建立，即便有可能认识不够到位、代码出错的概率也大大下降。</p>
</li>
<li>
<p>和java比，它不强制面向对象的招式，却也有面向对象思想的支持，组合优于继承，interface的类型断言、转换，以及后续范型支持（尽管现在go1.18版本还有待完善）。另外，同为自动内存管理的语言，和java jvm调优的数不尽的参数比起来，go的GC pacer仅依靠一个变量设置GOGC，如何在一堆参数中获得一个全局最优解的组合，java可能比go调优时控制粒度更细，但是很明显go可以在内存不是什么硬伤的情况下调优更简单。</p>
</li>
<li>
<p>和rust比，rust的描述性非常强，编译器能力也非常强，如果能忍受编译器的毒打，并深刻理解rust的设计思想之后，rust确实也是不错的，编译器说对那将来跑起来也会对。和服务跑起来后再排查一些难跟踪的错误，rust的优势就会让人觉得很值。但是我们并不是什么开发小白、我们可能要维护的对象也没那么复杂，不否定rust的价值，但是rust和go相比，目前go的能力是我们团队更希望拥有的。</p>
<p>ps：腾讯内部trpc微服务框架实例数，go版本的有2w+，rust版本的只有个位数。</p>
</li>
</ul>
<p>在合适的场景下go非常有价值，如果非要将其用到一些它不擅长的地方，就需要注意了：</p>
<ul>
<li>嵌入式开发领域，go有GC机制，可能要做类似tinygo的编译器调整、特性裁剪；</li>
<li>超大规模长连接管理，go的默认实现是goroutine per connection模型，连接数多了goroutine数也上来了，goroutine stack、为连接分配的resizable buffer、连接上事件的polling都会成为不可忽略的问题。业界比较好的方案是两级reactor的实现思路，类似地go版本实现gnet；</li>
<li>密集计算的问题，go比较大的优势在于goroutine并发处理，但是goroutine切换有固定的切换时机（网络IO等等），密集计算场景下goroutine切换不符合“预期”，并发处理效率跟不上，可能需要考虑多进程+taskset绑核处理；</li>
<li>其他问题；</li>
</ul>
<p>在不合适的场景下就需要多考虑、多钻研透一些，需要综合投入产出比慎重考虑，这种情况下其他语言是否更有优势就很值得考虑了。</p>
<p>我的工作领域主要在后台微服务，go就是一门（至少）在工程化方面做的很好的语言。</p>
<h2 id=go入门教程推荐>
Go入门教程推荐
<a class=anchor href=#go%e5%85%a5%e9%97%a8%e6%95%99%e7%a8%8b%e6%8e%a8%e8%8d%90>#</a>
</h2>
<p>本书的定位明显是更加倾向于语言设计思想、实现细节类的一些方面，对于一些希望掌握一些语言基础情况的初学者，可能并不是很符合的目标读者 :)，当然我相信也能在本书中找到相关的知识点，也有可能会帮助更透彻地理解想检索、想掌握的问题。</p>
<p>这里，不妨也列举我认为写的不错的go语言的书籍，仅供参考：</p>
<ul>
<li>
<a href="https://books.google.com.hk/books/about/The_Go_Programming_Language.html?id=SJHvCgAAQBAJ&printsec=frontcover&source=kp_read_button&hl=en&redir_esc=y#v=onepage&q&f=false">go programming language</a>，这是我学习go时完整阅读的第一本书，内容讲解比较全面，对于初学者系统性认识这门语言我认为还是比较重要的。</li>
<li>
<a href=https://go101.org/article/101.html>go 101</a>，现在也有中文版的资料，这里的内容讲了很多实现细节的东西，到什么程度呢，不会到源码的程度，属于对源码之上的认识、总结性的。</li>
<li>
<a href=https://draveness.me/golang/>go语言设计实现</a>，这本书中的内容就更加倾向于实现细节了，内容也覆盖也比较周全，算是go相关书籍中不可多得的好书。如果不是因为我对这些细节也有研究，我一定会买一本来收藏的好书，书中的配图、文笔都非常不错。</li>
</ul>
<h2 id=本书存在的意义>
本书存在的意义
<a class=anchor href=#%e6%9c%ac%e4%b9%a6%e5%ad%98%e5%9c%a8%e7%9a%84%e6%84%8f%e4%b9%89>#</a>
</h2>
<p>已经有这么多好书了，为什么我还要写这本电子书？定位不同，我不想单单解释go是怎么做的，我想解释为什么go决定这样做，方案上有哪些变体。</p>
<p>甚至，我的定位不是想让读者成为一名go语言的高手，而是想让读者在认识这些语言特性时有更加全方位的认识，它现在是什么样的，它以前是什么样的，为什么要变成这样，其他语言是怎么做的，为什么go要这样做。</p>
<p>当我们认识并理解了go及其他语言的方案之后，兴许我们会机会给大脑减负，我们不需要记住那么多的细节，因为它们的思想是相通的。</p>
<h2 id=联系方式>
联系方式
<a class=anchor href=#%e8%81%94%e7%b3%bb%e6%96%b9%e5%bc%8f>#</a>
</h2>
<p>您可以通过邮件方式和我交流，邮件标题请注明“go语言交流”（方便邮件rules归类）。</p>
<p>我的邮箱：hit.zhangjie@gmail.com</p>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div>
<a class="flex align-center" href=https://github.com/hitzhangjie/go-internals/edit/master//content/docs/preface.md target=_blank rel=noopener>
<img src=/go-internals/svg/edit.svg class=book-icon alt=Edit>
<span>编辑本页</span>
</a>
</div>
</div>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#前言>前言</a>
<ul>
<li><a href=#和go语言的相识>和Go语言的相识</a></li>
<li><a href=#我眼中的go语言>我眼中的Go语言</a></li>
<li><a href=#go入门教程推荐>Go入门教程推荐</a></li>
<li><a href=#本书存在的意义>本书存在的意义</a></li>
<li><a href=#联系方式>联系方式</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>
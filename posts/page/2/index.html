<!doctype html><html lang=zh dir=ltr>
<head>
<meta name=generator content="Hugo 0.91.2">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Posts">
<meta property="og:description" content>
<meta property="og:type" content="website">
<meta property="og:url" content="https://hitzhangjie.pro/go-internals-v2/posts/">
<title>Posts | Go设计实现内幕</title>
<link rel=manifest href=/go-internals-v2/manifest.json>
<link rel=icon href=/go-internals-v2/favicon.png type=image/x-icon>
<link rel=alternate hreflang=en href=https://hitzhangjie.pro/go-internals-v2/en/posts/ title=Notes>
<link rel=stylesheet href=/go-internals-v2/book.min.68be0b7a9674f2a612ce0e9b2e9447ff4b7ac96546e06b642bfd3ded0ca490ef.css integrity="sha256-aL4LepZ08qYSzg6bLpRH/0t6yWVG4GtkK/097QykkO8=">
<script defer src=/go-internals-v2/zh.search.min.a65d548d7619ec593a22d67d548a8fa06c89f7824ecd49878b5b03ec33ca241f.js integrity="sha256-pl1UjXYZ7Fk6ItZ9VIqPoGyJ94JOzUmHi1sD7DPKJB8="></script>
<script defer src=/go-internals-v2/sw.min.e3f8d329ac7f45d9b3ff588e83620122ab38761b68b73d194944ff43613a3b8d.js integrity="sha256-4/jTKax/Rdmz/1iOg2IBIqs4dhtotz0ZSUT/Q2E6O40="></script>
<link rel=alternate type=application/rss+xml href=https://hitzhangjie.pro/go-internals-v2/posts/index.xml title=Go设计实现内幕>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a href=/go-internals-v2><img src=/go-internals-v2/logo.png alt=Logo><span>Go设计实现内幕</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/preface/>前言</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/introduction/>简介</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/setup/>准备</a>
</li>
<li>
<input type=checkbox id=section-a0d8d71f426b3018d3ea2b0d39cb80dd class=toggle>
<label for=section-a0d8d71f426b3018d3ea2b0d39cb80dd class="flex justify-between">
<a>Specification</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Specification/go-spec/>go spec</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-5b4c35c78aaa50e4262cf5f000ff643f class=toggle>
<label for=section-5b4c35c78aaa50e4262cf5f000ff643f class="flex justify-between">
<a>Toolchain</a>
</label>
<ul>
<li>
<input type=checkbox id=section-1478ad0225f3c1062830d9c09d8b93f3 class=toggle>
<label for=section-1478ad0225f3c1062830d9c09d8b93f3 class="flex justify-between">
<a>Compiler</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/aliases-simple-and-efficient/>aliases, simple and efficient</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/builds-linkers-timeline/>builds & linker"s timeline</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/built-in-functions-optimizations/>built-in functions optimizations</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-go-build-works/>how "go build" works</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-are-loops-translated-to-assembly/>how are loops translated to assembly</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/how-to-take-advantage-of-symbols-tables/>how to take advantage of symbols tables</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/inline-strategy-limitation/>inline strategy & limitation</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-escape-analysis/>introduction to the escape analysis</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-go-compiler/>introduction to the go compiler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/introduction-to-the-go-compiler-ssa-backend/>introduction to the go compiler ssa backend</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/language-semantics-on-escape-analysis/>language semantics on escape analysis</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/memory-safety-with-bounds-check/>memory safety with bounds check</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/overview-of-the-compiler/>overview of the compiler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/slice-and-memory-management/>slice and memory management</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Compiler/understanding-compiler-directives/>understanding compiler directives</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-7e4c79944057f12c630cadb7f66ae71d class=toggle>
<label for=section-7e4c79944057f12c630cadb7f66ae71d class="flex justify-between">
<a>Linker</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/build-a-better-linker/>build a better linker</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/builds-linkers-timeline/>builds & linker"s timeline</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/how-go-build-works/>how "go build" works</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/Linker/object-file-relocations/>object file & relocations</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ff16c11cae45273096ca6b9016ad8f91 class=toggle>
<label for=section-ff16c11cae45273096ca6b9016ad8f91 class="flex justify-between">
<a>Abi</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/ABI/go-register-ABI/>go register ABI</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-92155f78ab2fea96864dc8e5f605cf23 class=toggle>
<label for=section-92155f78ab2fea96864dc8e5f605cf23 class="flex justify-between">
<a>Ast</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/AST/visualize-your-go-code/>visualize your go code</a>
</li>
</ul>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Toolchain/instrumentation-in-go/>instrumentation in go</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-2cf4e97d00d6e0846a455aed8f898520 class=toggle>
<label for=section-2cf4e97d00d6e0846a455aed8f898520 class="flex justify-between">
<a>Memory</a>
</label>
<ul>
<li>
<input type=checkbox id=section-93dba9f40586c2c35d783752f434d3fe class=toggle>
<label for=section-93dba9f40586c2c35d783752f434d3fe class="flex justify-between">
<a>Memory Allocation</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/demystifying-memory-management-in-modern-programming-languages/>demystifying memory management in modern programming languages</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/memory-management-and-allocation/>memory management and allocation</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/memory-management-and-memory-sweep/>memory management and memory sweep</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/slice-and-memory-management/>slice and memory management</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/MemoryAllocation/visualizing-memory-management-in-go/>visualizing memory management in go</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-c7a4c22522235f51a39ce7f70ed7225e class=toggle>
<label for=section-c7a4c22522235f51a39ce7f70ed7225e class="flex justify-between">
<a>Garbage Collection</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/an-insight-into-go-garbage-collector/>an insight into go garbage collector</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/finalizers/>finalizers</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/go-GC-latency-problem-solved/>go GC: latency problem solved</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/go-GC-prioritizing-low-latency-and-simplicity/>go GC: prioritizing low latency and simplicity</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-GC-mark-the-memory/>how does GC mark the memory</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-GC-watch-your-application/>how does GC watch your application</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/how-does-go-stop-the-world/>how does go stop the world</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/keeping-a-variable-alive/>keeping a variable alive</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/memory-management-and-allocation/>memory management and allocation</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/memory-management-and-memory-sweep/>memory management and memory sweep</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/the-garbage-collection-handbook/>the garbage collection handbook</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/the-rules-of-unsafe.Pointer-and-uintptr/>the rules of unsafe.Pointer and uintptr</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Memory/GarbageCollection/tracing-garbage-collection/>tracing garbage collection</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-52225bc65f7b2a78999589b1479ab0c3 class=toggle>
<label for=section-52225bc65f7b2a78999589b1479ab0c3 class="flex justify-between">
<a>Goroutine</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/asynchronous-preemption/>asynchronous preemption</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/concurrency-scheduler-affinity/>concurrency & scheduler affinity</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/g0-special-goroutines/>g0, special goroutines</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/goroutine-and-preemption/>goroutine and preemption</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/goroutine-os-thread-and-cpu-management/>goroutine, os thread, and cpu management</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/gsignal-master-of-signals/>gsignal, master of signals</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-does-a-goroutine-start-and-exit/>how does a goroutine start and exit</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-does-go-recycle-goroutines/>how does go recycle goroutines</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/how-goroutine-stack-size-evolve/>how goroutine stack size evolve</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/improve-the-usage-of-your-goroutines-with-GODEBUG/>improve the usage of your goroutines with GODEBUG</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/observing-stack-grow-and-shrink/>observing stack grow and shrink</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/what-does-a-goroutine-switch-actually-involve/>what does a goroutine switch actually involve</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Goroutine/work-stealing-in-go-scheduler/>work-stealing in go scheduler</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-f31e09d220fe3252a0eb99bdea817893 class=toggle>
<label for=section-f31e09d220fe3252a0eb99bdea817893 class="flex justify-between">
<a>Runtime</a>
</label>
<ul>
<li>
<input type=checkbox id=section-6af4e9ddadfe05b53d5ba165c38f1e3e class=toggle>
<label for=section-6af4e9ddadfe05b53d5ba165c38f1e3e class="flex justify-between">
<a>Scheduler</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/concurrency-scheduler-affinity/>concurrency & scheduler affinity</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/GOMAXPROCS-live-updates/>GOMAXPROCS & live updates</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-i-os-scheduler/>scheduling in go: part i - os scheduler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-ii-go-scheduler/>scheduling in go: part ii - go scheduler</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/scheduling-in-go-part-iii-concurrency/>scheduling in go: part iii - concurrency</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/Scheduler/work-stealing-in-go-scheduler/>work-stealing in go scheduler</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-825adbd2b838041eea46d2a10adc5f9a class=toggle>
<label for=section-825adbd2b838041eea46d2a10adc5f9a class="flex justify-between">
<a>Monitor</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/Monitor/monitor-pattern/>monitor pattern</a>
</li>
</ul>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/runtime/a-whirlwind-tour-of-Gos-runtime-environment-variables/>a whirlwind tour of Go’s runtime environment variables</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-93d588918944a298d3f4270e6df9e968 class=toggle>
<label for=section-93d588918944a298d3f4270e6df9e968 class="flex justify-between">
<a>Synchronization</a>
</label>
<ul>
<li>
<input type=checkbox id=section-e4f56fa00191ca8306d1438c969bef3e class=toggle>
<label for=section-e4f56fa00191ca8306d1438c969bef3e class="flex justify-between">
<a>Locks</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/how-to-reduce-lock-contention-with-the-atomic-package/>how to reduce lock contention with the atomic package</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/locks-sync.Mutex-internals/>locks: sync.Mutex internals</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/Locks/mutex-and-starvation/>mutex and starvation</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-d90698102847b301cf3137d159da1529 class=toggle>
<label for=section-d90698102847b301cf3137d159da1529 class="flex justify-between">
<a>Race Detection</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/RaceDetection/a-race-detector-unfurled/>a race detector unfurled</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Synchronization/RaceDetection/race-detector-with-thread-sanitizer/>race detector with thread sanitizer</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-8c09d3d57dd5ee0090220d9bf96ec092 class=toggle>
<label for=section-8c09d3d57dd5ee0090220d9bf96ec092 class="flex justify-between">
<a>Diagnostics</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/diagnostics-methods/>Diagnostics Methods</a>
</li>
<li>
<input type=checkbox id=section-1c55d6e534f174d1a9d86e1f0d27011e class=toggle>
<label for=section-1c55d6e534f174d1a9d86e1f0d27011e class="flex justify-between">
<a>Debugging</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/Debugging/debugging-with-delve-coredumps/>debugging with delve & coredumps</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-25c014c40c4708b8f9b278eab857403a class=toggle>
<label for=section-25c014c40c4708b8f9b278eab857403a class="flex justify-between">
<a>PProf</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/PProf/language-semantics-on-memory-profiling/>language semantics on memory profiling</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/PProf/samples-collection-with-pprof/>samples collection with pprof</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ef57056641f9c66c69d93a6c9fc4c689 class=toggle>
<label for=section-ef57056641f9c66c69d93a6c9fc4c689 class="flex justify-between">
<a>Tracing</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Diagnostics/Tracing/discovery-of-the-trace-package/>discovery of the trace package</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-51db080d4a3f95e2e371c478fda59b4e class=toggle>
<label for=section-51db080d4a3f95e2e371c478fda59b4e class="flex justify-between">
<a>Testing</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Testing/Benchmarking-in-Golang-Improving-function-performance/>Benchmarking in Golang: Improving function performance</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Testing/learn-go-with-tests/>learn-go-with-tests</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Testing/practical-fuzzing-with-go/>practical fuzzing with go</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Testing/unknown-parts-of-the-test-package/>unknown parts of the test package</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-129195bb7d4d59f2206f00e863a8ebdb class=toggle>
<label for=section-129195bb7d4d59f2206f00e863a8ebdb class="flex justify-between">
<a>Builtins</a>
</label>
<ul>
<li>
<input type=checkbox id=section-651c7afe116c240343430442fd77600a class=toggle>
<label for=section-651c7afe116c240343430442fd77600a class="flex justify-between">
<a>Chan</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/chan/buffered-and-unbuffered-channels/>buffered and unbuffered channels</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/chan/ordering-in-select-statements/>ordering in select statements</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-8e712e14ba6fe05a22de8ae756efc620 class=toggle>
<label for=section-8e712e14ba6fe05a22de8ae756efc620 class="flex justify-between">
<a>Map</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/concurrent-access-with-maps-part-3/>concurrent access with maps - part 3</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/map-design-by-code-part-1/>map design by code - part 1</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/map/map-design-by-code-part-2/>map design by code - part 2</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-631a92c08b04d863b1a494f36d547be5 class=toggle>
<label for=section-631a92c08b04d863b1a494f36d547be5 class="flex justify-between">
<a>Unsafe</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/unsafe/what-is-the-unsafe-package/>what is the unsafe package</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-a30ce872f66ddfa47ddd53e71fd3fd9b class=toggle>
<label for=section-a30ce872f66ddfa47ddd53e71fd3fd9b class="flex justify-between">
<a>Closure</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/closure/how-does-go-implement-closures/>how does go implement closures</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-89e63630549fc7d7179c5ff90b10c96f class=toggle>
<label for=section-89e63630549fc7d7179c5ff90b10c96f class="flex justify-between">
<a>Constants</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/constants/learn-go-constants-a-visual-guide/>learn go constants - a visual guide</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-09774e50ad4b214a713fa8f577f26533 class=toggle>
<label for=section-09774e50ad4b214a713fa8f577f26533 class="flex justify-between">
<a>Context</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/context/context-and-cancellation-by-propagation/>context and cancellation by propagation</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-e85e2a8e1719b54415998cfeaa4c64c5 class=toggle>
<label for=section-e85e2a8e1719b54415998cfeaa4c64c5 class="flex justify-between">
<a>Defer</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/defer/defer-internals/>defer internals</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/defer/how-does-defer-statement-work/>how does defer statement work</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-48164f93f23fb4774ca384e9dc84f94d class=toggle>
<label for=section-48164f93f23fb4774ca384e9dc84f94d class="flex justify-between">
<a>Init</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/init/init-functions/>init functions</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-982535b748a0cf94fc4e363a4220c45e class=toggle>
<label for=section-982535b748a0cf94fc4e363a4220c45e class="flex justify-between">
<a>Interface</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/interface/understand-the-empty-interface/>understand the empty interface</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-95d1523b99d14914e1c43fbb32ebdfa3 class=toggle>
<label for=section-95d1523b99d14914e1c43fbb32ebdfa3 class="flex justify-between">
<a>Panic&Recover</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/panicrecover/how-does-a-program-recover/>how does a program recover</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-41006be660761bf1634dc3afef87d119 class=toggle>
<label for=section-41006be660761bf1634dc3afef87d119 class="flex justify-between">
<a>Pointer</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/design-philosophy-on-data-and-semantics/>design philosophy on data and semantics</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/language-mechanics-on-stacks-and-pointers/>language mechanics on stacks and pointers</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pointer/should-i-use-pointer-instead-of-a-copy-of-struct/>should i use pointer instead of a copy of struct</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-518237b5864e05a88795053dc0aadf7a class=toggle>
<label for=section-518237b5864e05a88795053dc0aadf7a class="flex justify-between">
<a>Pool</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/pool/understand-the-design-of-sync.pool/>understand the design of sync.pool</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-02c17940ee18fd0e28da376b638e2d61 class=toggle>
<label for=section-02c17940ee18fd0e28da376b638e2d61 class="flex justify-between">
<a>Random</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/random/how-are-random-numbers-generated/>how are random numbers generated</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-9eb4f02a7524818c4c71d8579f485a0a class=toggle>
<label for=section-9eb4f02a7524818c4c71d8579f485a0a class="flex justify-between">
<a>String</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/string/string-conversion-optimization/>string & conversion optimization</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-5fd51849c5efc7c80caa0bfef5a0f76f class=toggle>
<label for=section-5fd51849c5efc7c80caa0bfef5a0f76f class="flex justify-between">
<a>Syscall</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/syscall/how-does-go-runtime-handles-syscall/>how does go runtime handles syscall</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-dc98d3d867181a4b7f4594d457e17777 class=toggle>
<label for=section-dc98d3d867181a4b7f4594d457e17777 class="flex justify-between">
<a>Timer</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Builtins/timer/timers-life-cycle/>timers" life cycle</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-54ff0ab7dec4280864e76f3fd0b3d0c8 class=toggle>
<label for=section-54ff0ab7dec4280864e76f3fd0b3d0c8 class="flex justify-between">
<a>Patterns</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Patterns/rethinking-classical-concurrency-patterns/>rethinking classical concurrency patterns</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-9e07a1bfbe561ed3f6806c311a77856d class=toggle>
<label for=section-9e07a1bfbe561ed3f6806c311a77856d class="flex justify-between">
<a>Infrastructure</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Infrastructure/what-is-a-goproxy/>what is a goproxy</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Infrastructure/playing-with-go-module-proxy/>playing with go module proxy</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ce52ab5a3ea7b9d335993e1906973892 class=toggle>
<label for=section-ce52ab5a3ea7b9d335993e1906973892 class="flex justify-between">
<a>Plugins</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Plugins/go-plugin-system/>go plugin system</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-f126f3c1abfdb1f388f4aa1d63bf636e class=toggle>
<label for=section-f126f3c1abfdb1f388f4aa1d63bf636e class="flex justify-between">
<a>Types</a>
</label>
<ul>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Types/duck-typing-structural-typing-nominal-typing/>duck typing, structural typing, nominal typing</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/Types/structural-typing-and-norminal-typing/>structural typing and norminal typing</a>
</li>
</ul>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/docs/SUMMARY/>Summary</a>
</li>
</ul>
<hr>
<ul>
<li>
<a href=/go-internals-v2/posts/>
Posts
</a>
</li>
<li>
<a href=https://github.com/hitzhangjie/go-internals-v2 target=_blank rel=noopener>
Github
</a>
</li>
<li>
<a href=https://hitzhangjie.pro target=_blank rel=noopener>
Blog
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/go-internals-v2/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Posts</strong>
<label for=toc-control>
<img src=/go-internals-v2/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav>
<ul>
<li class=book-section-flat>
<strong>Categories</strong>
<ul>
</ul>
</li>
<li class=book-section-flat>
<strong>Tags</strong>
<ul>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/abi/>abi</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/ast/>ast</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/chan/>chan</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/chan-select-case/>chan, select-case</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/closure/>closure</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/compiler/>compiler</a>
<span>25</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/compiler-linker/>compiler, linker</a>
<span>6</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/concurrency/>concurrency</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/context/>context</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/debug/>debug</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/defer/>defer</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/defer-panic/>defer, panic</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/defer-panic-recover/>defer, panic, recover</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/design/>design</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/diagnostics/>diagnostics</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/fuzzy-test/>fuzzy, test</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/garbage-collector/>garbage collector</a>
<span>23</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goproxy/>goproxy</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goroutine/>goroutine</a>
<span>23</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goroutine-gpm-scheduler/>goroutine, gpm scheduler</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goroutine-select-case/>goroutine, select-case</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/gpm-scheduler/>gpm scheduler</a>
<span>8</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/init/>init</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/install/>install</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/instrumentation/>instrumentation</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/interface/>interface</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/linker/>linker</a>
<span>4</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/locks/>locks</a>
<span>6</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/map/>map</a>
<span>4</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/map-race-detector/>map, race detector</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/mechanics/>mechanics</a>
<span>8</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/memory-management/>memory management</a>
<span>9</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/monitor/>monitor</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/plugin/>plugin</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/pointer/>pointer</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/pprof/>pprof</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/race-detector/>race detector</a>
<span>4</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/random/>random</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/runtime/>runtime</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/string/>string</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/sync.pool/>sync.pool</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/syscall/>syscall</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/tdd-test/>tdd, test</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/test/>test</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/timer/>timer</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/trace/>trace</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/types/>types</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/unsafe/>unsafe</a>
<span>2</span>
</li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/concurrent-access-with-maps-part-3/>concurrent access with maps - part 3</a>
</h2>
<div>
<a href=/go-internals-v2/tags/map-race-detector/>map, race detector</a>
</div>
<p>Let&rsquo;s Summarize # 1 map
map中的并发读写问题，go提供了如下方式进行检查：
data race detection：通过选项-race来检测是否存在data race，关于data race检测的问题，kavya joshi的分享里有介绍；
并发写操作检测：map对应的数据结构hmap中有个字段flags来记录当前的map操作，比如当前执行m[1]=1，是一个kv的赋值，对应的函数是mapassign_fast64，如果执行的是delete(m, 1)，对应的函数是mapdelete_fast64，这里的map修改操作对应的函数内部会将hmap.flags^=hashWriting，如果已经有一个写操作在执行，后面又有一个写操作执行，后面的写操作就有很大概率检测到flags的hashWriting位被设置了，此时就会抛出错误“concurrent map writes”错误；
关于map为什么不直接提供并发安全的版本，原因也简单。并发安全的版本是有同步开销的，但是很多时候并不需要并发安全的版本，如果默认实现是并发安全的，性能上就要大打折扣了。不考虑并发安全问题的话，map比sync.Map要快7~10倍。
2 sync.Map
sync.Map是并发安全的实现，它对某些场景下的并发读写做了性能方面的优化： goblogs: &ldquo;The Map type is optimized for two common use cases: (1) when the entry for a given key is only ever written once but read many times, as in caches that only grow, (2) when multiple goroutines read, write and overwrite entries for disjoint sets of keys.
<a href=/go-internals-v2/posts/concurrent-access-with-maps-part-3/>...</a>
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/context-and-cancellation-by-propagation/>context and cancellation by propagation</a>
</h2>
<div>
<a href=/go-internals-v2/tags/context/>context</a>
</div>
<p>Let&rsquo;s Summarize # context有两个特殊的context.TODO()和context.Background()，这两个context是永远不会超时和取消的，实际上它们都是emptyCtx{}。
context tree：
通过一个context可以派生其他子context，从而形成一棵context tree。比如cancelCtx中通过字段children维护了parent context和derived contexts的派生关系。
cancellation propagation：
取消某个childCtx对parentCtx没影响，但是取消一个parentCtx，其下所有的childCtx都会被取消。也经常通过这种方式来通知某件事情的结束，如一个server中包含了多个service（http、kafka consumer、scheduled tasks…），可以通过取消serverCtx来通知各个service取消。
cancelCtx中有个mutex，通过它来实现goroutine并发操作的安全。
context leakage：
ctx.Cancel()中会将ctx.children设置为nil，还会断开parentCtx与当前ctx的连接。如果不执行Cancel()操作，那么上述有些引用关系还会被维持着，GC无法回收对应的内存，会导致内存泄漏。
Source Analysis # References # https://medium.com/a-journey-with-go/go-context-and-cancellation-by-propagation-7a808bbc889c
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/debugging-with-delve-coredumps/>debugging with delve & coredumps</a>
</h2>
<div>
<a href=/go-internals-v2/tags/debug/>debug</a>
</div>
<p>Let&rsquo;s Summarize # 本文介绍了如何借助go-delve/delve调试器对go程序以及coredump文件进行调试。
我对delve的使用还是很熟练的，也逻辑delve实现原理、给delve贡献过代码，自己也写过一个符号级调试器来进行系统性的学。
Source Analysis # References # https://medium.com/a-journey-with-go/go-debugging-with-delve-core-dumps-384145b2e8d9
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/defer-internals/>defer internals</a>
</h2>
<div>
<a href=/go-internals-v2/tags/defer/>defer</a>
</div>
<p>Let&rsquo;s Summarize # 本文内容很多，我只关注了其对openDefer的解释，一个openDefer的defer，或者说一个open-coded defer指的是这样的defer，不是在for循环中被调用的defer。
举个例子：
func TestOpenAndNonOpenDefers(t *testing.T) { // f() is a more complicated function that is recover()&ldquo;ed for { defer f() // &lt;&ndash; non open-coded defer } defer f() // &lt;&ndash; open-coded defer }
Source Analysis # References # https://tpaschalis.github.io/defer-internals/
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/demystifying-memory-management-in-modern-programming-languages/>demystifying memory management in modern programming languages</a>
</h2>
<div>
<a href=/go-internals-v2/tags/memory-management/>memory management</a>
</div>
<p>Let&rsquo;s Summarize # Source Analysis # References # https://deepu.tech/memory-management-in-programming/
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/design-philosophy-on-data-and-semantics/>design philosophy on data and semantics</a>
</h2>
<div>
<a href=/go-internals-v2/tags/mechanics/>mechanics</a>
</div>
<p>Let&rsquo;s Summarize # “Value semantics keep values on the stack, which reduces pressure on the Garbage Collector (GC). However, value semantics require various copies of any given value to be stored, tracked and maintained. Pointer semantics place values on the heap, which can put pressure on the GC. However, pointer semantics are efficient because only one value needs to be stored, tracked and maintained.” - Bill Kennedy
A consistent use of value/pointer semantics, for a given type of data, is critical if you want to maintain integrity and readability throughout your software.
<a href=/go-internals-v2/posts/design-philosophy-on-data-and-semantics/>...</a>
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/diagnostics-methods/>diagnostics methods</a>
</h2>
<div>
<a href=/go-internals-v2/tags/diagnostics/>diagnostics</a>
</div>
<p>Let&rsquo;s Summarize # 介绍了go程序开发人员常用的问题诊断方法：
1 profiling：执行go tool pprof对cpu、内存、线程创建、锁使用问题等进行分析、问题定位、优化； 2 tracing：织入代码对运行过程中各阶段耗时进行统计等等，如golang.org/x/net/trace这个包，没怎么使用过； 3 debugging：调试器调试，有调试需求的时候，通过-gcflags=&ldquo;all=-N -l"禁用优化、内联汇编，生成的二进制对调试更友好； 4 runtime statistics and events：运行时信息收集，如内存、gc、stack、heap、goroutines数量等信息； 5 execution tracer：对程序执行过程中运行时行为、事件进行分析、问题定位、优化，如gc、goroutine调度latency、系统调用等等； 6 GODEBUG：该环境变量用来控制一些行为，如：
GODEBUG=gctrace=1，每隔一定时间打印gc的信息，回收内存数，以及停顿时间； GODEBUG=inittrace=1，打印包初始化花费的时间； GODEBUG=schedtrace=X，每隔X毫秒打印调度相关信息； GODEBUG还可以用来禁用全部或者某些指令级扩展，这个不怎么常用，先忽略。 这里的execution tracer数据的生成，可以借助：
代码里面import runtime/trace这个package，然后main函数里trace.Start(os.Stderr), defer trace.Stop()，运行起来go run main.go &> trace.out； 通过go test -trace trace.out； 然后通过go tool trace trace.out查看； 关于GODEBUG=schedtrace=X的输出格式的理解，see https://www.ardanlabs.com/blog/2015/02/scheduler-tracing-in-go.html。举个例子 runqueue 0 [4 4]是说全局queue里面有0个g，现在有两个p，每个p上的queue均有4个g待运行。
Source Analysis # References # https://golang.org/doc/diagnostics
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/discovery-of-the-trace-package/>discovery of the trace package</a>
</h2>
<div>
<a href=/go-internals-v2/tags/trace/>trace</a>
</div>
<p>Let&rsquo;s Summarize # 如何激活trace？
go test -trace，通过选项-trace来激活trace功能，我们可以通过trace package提供的方法来增强默认的trace能力，下面简单总结下。
go test -trace，或者代码中通过trace.Start()/defer trace.Stop来输出trace数据到文件都可以。然后通过go tool trace trace文件，即可进行可视化展示。
trace工作过程？
这里的trace过程大致是：首先Stop the World，然后收集各个goroutines的栈帧信息，收集各个goroutines的snapshots信息，最好再Start the World。这里收集的这些信息会存储到一个bufferlist中。然后go runtime会启动一个专门的goroutine来异步地将bufferlist中的数据写入到trace数据文件中。如果bufferlist没数据的话，这个专门的协程就会被parked。
然后介绍了go tool trace 可视化信息的一些解释，比如GC各个阶段的解释、调度阶段的start、stop、syscall、unblock的解释。
用户自定义trace？
主要有两个层次：
task层次 taskCtx, task := trace.NewTask(ctx, &ldquo;task name&rdquo;) 结束的时候需要task.End()结束自定义trace。
region层次 trace.NewRegion(taskCtx, &ldquo;region name&rdquo;) 结束的时候需要region.End()标记当前阶段的结束。
这里的trace过程很直观，如果有用过opentracing的话会容易理解这里的用法。
用户自定义的trace，在输出到trace数据文件后，也是可通过go tool trace来进行可视化展示的，在选项卡“user-defined tasks”中。
Source Analysis # References # https://medium.com/a-journey-with-go/go-discovery-of-the-trace-package-e5a821743c3c
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/finalizers/>finalizers</a>
</h2>
<div>
<a href=/go-internals-v2/tags/garbage-collector/>garbage collector</a>
</div>
<p>Let&rsquo;s Summarize # runtime.SetFinalizer(p, fn)，运行时提供了这个函数来在p被GC时执行函数fn。
只有一个专门的协程来执行所有的finalizers，所以finalizers的执行是串行执行的，如果某一个finalizer的逻辑比较重，或者耗时比较久，应该启动一个独立的协程来执行该逻辑。
当一个对象obj被垃圾回收器识别为不再被引用时，其存在关联的finalizer的话，首先解除该关联关系，然后将该finalizer(obj)交给上面提的那个专门的协程去执行，至于什么时候执行完成，是没有保证的，可能程序退出时也不能保证已经执行完成了。
在obj关联你的finalizer被执行时，finalizer(obj)又重新引用了该对象obj，不可达对象又变成可达了，这个时候GC不能将其回收，但是因为已经去掉了obj和finalizer的关联，下一轮GC时该对象obj将能够被回收。
finalizer通常用来释放一些不再使用的内存资源、关闭文件等清理工作，因为其什么时候执行是不方便准确预测的，也只适合来做些类似不再使用的资源的清理工作。
Source Analysis # References # https://medium.com/a-journey-with-go/go-finalizers-786df8e17687
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/go-internals-v2/posts/g0-special-goroutines/>g0, special goroutines</a>
</h2>
<div>
<a href=/go-internals-v2/tags/goroutine-select-case/>goroutine, select-case</a>
</div>
<p>Let&rsquo;s Summarize # goroutines是由go scheduler来调度的，go scheduler在某些goroutine出现阻塞的时候调度其他goroutines继续执行，以提高cpu的利用率。
goroutines其实是运行在操作系统线程里面的，GOMAXPROCS限制了最多可以并发执行的线程数量（实际线程可能有阻塞的，线程总数会大于等于该环境变量值）。go scheduler负责将goroutines调度到操作系统线程上执行，在程序初始化阶段，会为每个持有P的线程M创建一个特殊的协程g0，这里的g0其实就是会干go scheduler的工作，g0会调度就绪的goroutines在关联的线程M上执行。
g0的职责
g0的职责并不仅仅是scheduler，它还有其他的用途。g0的协程栈（一开始就是8KB）比普通的协程的栈（一开始为2KB）要大很多，它适用于执行一些对栈容量要求比较大、又不希望栈扩容的情境下。
列举下g0的职责：
goroutine创建，如go func(){}()是在g0中完成的，将其创建完放到P的队列中； defer function创建； GC操作，如STW、扫描协程栈、标记整理等操作； 栈增长，在函数序言prologue部分执行栈增长； 在其他的一些操作中（比如需要更大的内存分配的cgo操作），这个特殊协程g0使我们的程序更加高效的执行管理操作，而又不会带来过高的内存开销。
Source Analysis # TODO 结合源码来分析下go scheduler的详细过程，以及g0的详细用途
References # https://medium.com/a-journey-with-go/go-g0-special-goroutine-8c778c6704d8
</p>
</article>
<ul class="pagination pagination-default">
<li class=page-item>
<a href=/go-internals-v2/posts/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a>
</li>
<li class=page-item>
<a href=/go-internals-v2/posts/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a>
</li>
<li class=page-item>
<a href=/go-internals-v2/posts/ aria-label="Page 1" class=page-link role=button>1</a>
</li>
<li class="page-item active">
<a aria-current=page aria-label="Page 2" class=page-link role=button>2</a>
</li>
<li class=page-item>
<a href=/go-internals-v2/posts/page/3/ aria-label="Page 3" class=page-link role=button>3</a>
</li>
<li class=page-item>
<a href=/go-internals-v2/posts/page/4/ aria-label="Page 4" class=page-link role=button>4</a>
</li>
<li class=page-item>
<a href=/go-internals-v2/posts/page/5/ aria-label="Page 5" class=page-link role=button>5</a>
</li>
<li class=page-item>
<a href=/go-internals-v2/posts/page/3/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a>
</li>
<li class=page-item>
<a href=/go-internals-v2/posts/page/9/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a>
</li>
</ul>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div class=book-languages tabindex=0 aria-haspopup=true>
<ul>
<li class="flex align-center">
<img src=/go-internals-v2/svg/translate.svg class=book-icon alt=Languages>
Chinese
</li>
</ul>
<ul class=book-languages-list>
<li class=active>
<a href=https://hitzhangjie.pro/go-internals-v2/ class="flex align-center">
<img src=/go-internals-v2/svg/translate.svg class=book-icon alt=Languages>
Chinese
</a>
</li>
<li>
<a href=https://hitzhangjie.pro/go-internals-v2/en/posts/ class="flex align-center">
<img src=/go-internals-v2/svg/translate.svg class=book-icon alt=Languages>
English
</a>
</li>
</ul>
</div>
<div>
<a class="flex align-center" href=https://github.com/hitzhangjie/go-internals/edit/master//content/posts/_index.md target=_blank rel=noopener>
<img src=/go-internals-v2/svg/edit.svg class=book-icon alt=Edit>
<span>编辑本页</span>
</a>
</div>
</div>
</footer>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav>
<ul>
<li class=book-section-flat>
<strong>Categories</strong>
<ul>
</ul>
</li>
<li class=book-section-flat>
<strong>Tags</strong>
<ul>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/abi/>abi</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/ast/>ast</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/chan/>chan</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/chan-select-case/>chan, select-case</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/closure/>closure</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/compiler/>compiler</a>
<span>25</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/compiler-linker/>compiler, linker</a>
<span>6</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/concurrency/>concurrency</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/context/>context</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/debug/>debug</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/defer/>defer</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/defer-panic/>defer, panic</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/defer-panic-recover/>defer, panic, recover</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/design/>design</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/diagnostics/>diagnostics</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/fuzzy-test/>fuzzy, test</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/garbage-collector/>garbage collector</a>
<span>23</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goproxy/>goproxy</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goroutine/>goroutine</a>
<span>23</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goroutine-gpm-scheduler/>goroutine, gpm scheduler</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/goroutine-select-case/>goroutine, select-case</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/gpm-scheduler/>gpm scheduler</a>
<span>8</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/init/>init</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/install/>install</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/instrumentation/>instrumentation</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/interface/>interface</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/linker/>linker</a>
<span>4</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/locks/>locks</a>
<span>6</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/map/>map</a>
<span>4</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/map-race-detector/>map, race detector</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/mechanics/>mechanics</a>
<span>8</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/memory-management/>memory management</a>
<span>9</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/monitor/>monitor</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/plugin/>plugin</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/pointer/>pointer</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/pprof/>pprof</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/race-detector/>race detector</a>
<span>4</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/random/>random</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/runtime/>runtime</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/string/>string</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/sync.pool/>sync.pool</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/syscall/>syscall</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/tdd-test/>tdd, test</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/test/>test</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/timer/>timer</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/trace/>trace</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/types/>types</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/go-internals-v2/tags/unsafe/>unsafe</a>
<span>2</span>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>